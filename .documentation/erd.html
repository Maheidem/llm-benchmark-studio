<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LLM Benchmark Studio — ERD v2: Full Domain Normalization</title>
<style>
  *{margin:0;padding:0;box-sizing:border-box}
  body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#0f172a;color:#e2e8f0;min-height:100vh}
  header{background:linear-gradient(135deg,#1e293b,#0f172a);border-bottom:1px solid #334155;padding:12px 20px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100}
  header h1{font-size:17px;font-weight:600;background:linear-gradient(135deg,#38bdf8,#818cf8);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
  header .stats{font-size:11px;color:#94a3b8;margin-top:2px}
  header .stats span{font-weight:600}
  .s-new{color:#34d399} .s-mod{color:#fbbf24} .s-del{color:#f87171} .s-same{color:#94a3b8}
  .controls{display:flex;gap:5px;align-items:center}
  .controls button{background:#1e293b;border:1px solid #334155;color:#cbd5e1;padding:4px 10px;border-radius:5px;cursor:pointer;font-size:11px;transition:all .15s}
  .controls button:hover{background:#334155;color:#f1f5f9}
  .controls button.active{background:#3b82f6;border-color:#3b82f6;color:#fff}
  .search-box{background:#0f172a;border:1px solid #334155;color:#e2e8f0;padding:4px 10px;border-radius:5px;font-size:11px;width:150px;outline:none}
  .search-box:focus{border-color:#3b82f6}
  .search-box::placeholder{color:#475569}

  .bar{display:flex;gap:12px;padding:7px 20px;background:#1e293b;border-bottom:1px solid #334155;flex-wrap:wrap;font-size:11px;align-items:center}
  .bar .pill{padding:2px 8px;border-radius:10px;font-size:10px;font-weight:700}
  .pill-n{background:#10b98130;color:#34d399;border:1px solid #10b98150}
  .pill-m{background:#f59e0b30;color:#fbbf24;border:1px solid #f59e0b50}
  .pill-d{background:#ef444430;color:#f87171;border:1px solid #ef444450}
  .pill-s{background:#47556930;color:#94a3b8;border:1px solid #47556950}
  .legend-item{display:flex;align-items:center;gap:4px;color:#94a3b8}
  .legend-dot{width:8px;height:8px;border-radius:50%}

  .canvas-wrap{position:relative;overflow:auto;height:calc(100vh - 120px);cursor:grab}
  .canvas-wrap:active{cursor:grabbing}
  .canvas{position:relative;min-width:2100px;min-height:1800px;padding:30px;transform-origin:0 0}

  .lines-layer{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:1}
  .lines-layer line,.lines-layer path{stroke:#475569;stroke-width:1.4;opacity:.4;transition:opacity .2s,stroke .2s;fill:none}
  .lines-layer line.hl,.lines-layer path.hl{stroke:#38bdf8;stroke-width:2.5;opacity:1}
  .lines-layer line.nr,.lines-layer path.nr{stroke:#10b981;stroke-width:1.8;opacity:.7;stroke-dasharray:6 3}
  .lines-layer line.nr.hl,.lines-layer path.nr.hl{stroke:#34d399;stroke-width:2.8;opacity:1}
  .lines-layer circle{fill:#475569;transition:fill .2s}
  .lines-layer circle.hl{fill:#38bdf8}
  .lines-layer circle.nr{fill:#10b981}

  .tc{position:absolute;background:#1e293b;border:1px solid #334155;border-radius:8px;min-width:235px;box-shadow:0 3px 12px rgba(0,0,0,.3);z-index:10;transition:box-shadow .2s,border-color .2s,opacity .2s;overflow:hidden}
  .tc:hover,.tc.hl{border-color:#3b82f6;box-shadow:0 0 16px rgba(59,130,246,.2)}
  .tc.dim{opacity:.18}
  .tc.sn{border-color:#10b981;box-shadow:0 0 20px rgba(16,185,129,.25),inset 0 0 20px rgba(16,185,129,.04)}
  .tc.sm{border-color:#f59e0b;box-shadow:0 0 12px rgba(245,158,11,.15)}
  .tc.sd{border-color:#ef4444;box-shadow:0 0 12px rgba(239,68,68,.15);opacity:.6}

  .th{padding:7px 10px;font-weight:600;font-size:12px;display:flex;align-items:center;gap:6px;cursor:pointer;user-select:none}
  .th .ic{width:7px;height:7px;border-radius:50%;flex-shrink:0}
  .th .cnt{margin-left:auto;font-size:9px;color:#64748b;font-weight:400}
  .th .sb{font-size:7px;padding:1px 5px;border-radius:3px;font-weight:700;text-transform:uppercase;letter-spacing:.7px}
  .sb-n{background:#10b98130;color:#34d399} .sb-m{background:#f59e0b30;color:#fbbf24} .sb-d{background:#ef444430;color:#f87171}

  .tc-c{border-top:1px solid #334155;max-height:280px;overflow-y:auto}
  .cr{padding:3px 10px;font-size:10px;display:flex;align-items:center;gap:4px;border-bottom:1px solid rgba(51,65,85,.3);font-family:'SF Mono','Fira Code',monospace}
  .cr:last-child{border-bottom:none}
  .cr:hover{background:rgba(56,189,248,.04)}
  .cr.cn{background:rgba(16,185,129,.07)} .cr.cc{background:rgba(245,158,11,.07)} .cr.cd{background:rgba(239,68,68,.07);text-decoration:line-through;opacity:.45}
  .cn-n{color:#e2e8f0;min-width:140px} .cn-t{color:#64748b;font-size:9px}
  .cb{font-size:7px;padding:1px 4px;border-radius:3px;font-weight:600;text-transform:uppercase;letter-spacing:.4px;margin-left:auto;flex-shrink:0}
  .b-pk{background:#facc1520;color:#fbbf24;border:1px solid #fbbf2440}
  .b-fk{background:#38bdf820;color:#38bdf8;border:1px solid #38bdf840}
  .b-uq{background:#a78bfa20;color:#a78bfa;border:1px solid #a78bfa40}
  .b-ck{background:#34d39920;color:#34d399;border:1px solid #34d39940}
  .b-new{background:#10b98118;color:#34d399;border:1px solid #10b98138}
  .b-chg{background:#f59e0b18;color:#fbbf24;border:1px solid #f59e0b38}
  .b-del{background:#ef444418;color:#f87171;border:1px solid #ef444438}

  .cat-auth .th{background:linear-gradient(135deg,#7c3aed18,#7c3aed08)} .cat-auth .ic{background:#8b5cf6}
  .cat-core .th{background:linear-gradient(135deg,#10b98120,#10b98108)} .cat-core .ic{background:#10b981}
  .cat-suite .th{background:linear-gradient(135deg,#05966918,#05966908)} .cat-suite .ic{background:#059669}
  .cat-exec .th{background:linear-gradient(135deg,#e879f918,#e879f908)} .cat-exec .ic{background:#e879f9}
  .cat-judge .th{background:linear-gradient(135deg,#f4364518,#f4364508)} .cat-judge .ic{background:#f43f5e}
  .cat-tune .th{background:linear-gradient(135deg,#d9770618,#d9770608)} .cat-tune .ic{background:#f59e0b}
  .cat-bench .th{background:linear-gradient(135deg,#2563eb18,#2563eb08)} .cat-bench .ic{background:#3b82f6}
  .cat-plat .th{background:linear-gradient(135deg,#dc262618,#dc262608)} .cat-plat .ic{background:#ef4444}
  .cat-pub .th{background:linear-gradient(135deg,#0891b218,#0891b208)} .cat-pub .ic{background:#06b6d4}

  .zi{position:fixed;bottom:12px;right:12px;background:#1e293b;border:1px solid #334155;padding:4px 10px;border-radius:5px;font-size:10px;color:#94a3b8;z-index:200}
  .tt{position:fixed;background:#1e293b;border:1px solid #475569;padding:7px 11px;border-radius:6px;font-size:10px;color:#cbd5e1;max-width:320px;z-index:300;pointer-events:none;display:none;box-shadow:0 4px 16px rgba(0,0,0,.4);line-height:1.5}
</style>
</head>
<body>
<header>
  <div>
    <h1>LLM Benchmark Studio &mdash; ERD v2: Full Domain Normalization</h1>
    <div class="stats">
      <span class="s-new">+7 new tables</span> &middot;
      <span class="s-mod">8 modified</span> &middot;
      <span class="s-del">1 dropped</span> &middot;
      <span class="s-same">14 unchanged</span> &middot;
      <span style="color:#38bdf8">30</span> total &middot;
      <span style="color:#38bdf8">60</span> FKs
    </div>
  </div>
  <div class="controls">
    <input type="text" class="search-box" placeholder="Search..." id="search">
    <button onclick="fil('all')" class="active" id="btn-all">All</button>
    <button onclick="fil('new')" id="btn-new">New</button>
    <button onclick="fil('modified')" id="btn-modified">Mod</button>
    <button onclick="fil('dropped')" id="btn-dropped">Drop</button>
    <button onclick="zI()">+</button>
    <button onclick="zO()">&minus;</button>
    <button onclick="zR()">Reset</button>
    <button id="tglL" class="active" onclick="tgl()">Lines</button>
  </div>
</header>
<div class="bar">
  <span class="pill pill-n">+7 NEW</span> tool_definitions, case_results, judge_verdicts, benchmark_results, param_tune_combos, prompt_tune_generations, prompt_tune_candidates
  <span class="pill pill-m">8 MOD</span> blobs&rarr;child tables
  <span class="pill pill-d">1 DROP</span> run_results
  <span class="pill pill-s">14 SAME</span>
  <span style="margin-left:auto;display:flex;gap:8px">
    <div class="legend-item"><div class="legend-dot" style="background:#8b5cf6"></div>Auth</div>
    <div class="legend-item"><div class="legend-dot" style="background:#10b981"></div>Core</div>
    <div class="legend-item"><div class="legend-dot" style="background:#059669"></div>Suite</div>
    <div class="legend-item"><div class="legend-dot" style="background:#e879f9;box-shadow:0 0 4px #e879f9"></div>Execution (new)</div>
    <div class="legend-item"><div class="legend-dot" style="background:#f43f5e;box-shadow:0 0 4px #f43f5e"></div>Judge</div>
    <div class="legend-item"><div class="legend-dot" style="background:#f59e0b"></div>Tune</div>
    <div class="legend-item"><div class="legend-dot" style="background:#3b82f6"></div>Bench</div>
    <div class="legend-item"><div class="legend-dot" style="background:#ef4444"></div>Platform</div>
    <div class="legend-item"><div class="legend-dot" style="background:#06b6d4"></div>Public</div>
  </span>
</div>
<div class="canvas-wrap" id="cw">
  <div class="canvas" id="cv"><svg class="lines-layer" id="sl"></svg></div>
</div>
<div class="zi" id="zi">100%</div>
<div class="tt" id="tt"></div>

<script>
// ═══════════════════════════════════════════════════════════
//  ERD v2: FULL DOMAIN NORMALIZATION
//  Key insight: Tool Eval Run = THE atomic execution unit
//  Orchestrators (param/prompt/auto tune) own N eval runs
//  JSON blobs → first-class child tables
// ═══════════════════════════════════════════════════════════

const T=[
// ═══════════ COLUMN 1: AUTH (x:30) ═══════════
{name:"users",cat:"auth",s:"unchanged",x:30,y:30,
 cols:[
  {n:"id",t:"TEXT",pk:1},{n:"email",t:"TEXT",uq:1,nn:1},
  {n:"password_hash",t:"TEXT",nn:1},{n:"role",t:"TEXT",nn:1,ck:"admin|user"},
  {n:"onboarding_completed",t:"INT"},{n:"google_id",t:"TEXT",uq:1},
  {n:"avatar_url",t:"TEXT"},{n:"leaderboard_opt_in",t:"INT"},
  {n:"created_at",t:"TEXT",nn:1},{n:"updated_at",t:"TEXT",nn:1}
]},
{name:"refresh_tokens",cat:"auth",s:"unchanged",x:30,y:330,
 cols:[
  {n:"id",t:"TEXT",pk:1},{n:"user_id",t:"TEXT",fk:"users",nn:1},
  {n:"token_hash",t:"TEXT",uq:1,nn:1},{n:"expires_at",t:"TEXT",nn:1},
  {n:"created_at",t:"TEXT",nn:1}
]},
{name:"password_reset_tokens",cat:"auth",s:"unchanged",x:30,y:500,
 cols:[
  {n:"id",t:"TEXT",pk:1},{n:"user_id",t:"TEXT",fk:"users",nn:1},
  {n:"token_hash",t:"TEXT",uq:1,nn:1},{n:"expires_at",t:"TEXT",nn:1},
  {n:"used",t:"INT",nn:1},{n:"created_at",t:"TEXT",nn:1}
]},
{name:"user_api_keys",cat:"auth",s:"unchanged",x:30,y:700,
 cols:[
  {n:"id",t:"TEXT",pk:1},{n:"user_id",t:"TEXT",fk:"users",nn:1},
  {n:"provider_id",t:"TEXT",fk:"providers",nn:1},
  {n:"key_name",t:"TEXT",nn:1},{n:"encrypted_value",t:"TEXT",nn:1},
  {n:"created_at",t:"TEXT",nn:1},{n:"updated_at",t:"TEXT",nn:1}
]},
{name:"rate_limits",cat:"auth",s:"unchanged",x:30,y:910,
 cols:[
  {n:"id",t:"INT",pk:1},{n:"user_id",t:"TEXT",fk:"users",uq:1,nn:1},
  {n:"benchmarks_per_hour",t:"INT",nn:1},{n:"max_concurrent",t:"INT",nn:1},
  {n:"max_runs_per_benchmark",t:"INT",nn:1},
  {n:"updated_at",t:"TEXT",nn:1},{n:"updated_by",t:"TEXT",fk:"users"}
]},

// ═══════════ COLUMN 2: CORE (x:310) ═══════════
{name:"providers",cat:"core",s:"unchanged",x:310,y:30,
 cols:[
  {n:"id",t:"TEXT",pk:1},{n:"user_id",t:"TEXT",fk:"users",nn:1},
  {n:"key",t:"TEXT",nn:1},{n:"name",t:"TEXT",nn:1},
  {n:"api_base",t:"TEXT"},{n:"api_key_env",t:"TEXT"},
  {n:"model_prefix",t:"TEXT"},{n:"is_active",t:"INT",nn:1},
  {n:"sort_order",t:"INT",nn:1},
  {n:"created_at",t:"TEXT",nn:1},{n:"updated_at",t:"TEXT",nn:1}
]},
{name:"models",cat:"core",s:"unchanged",x:310,y:330,
 cols:[
  {n:"id",t:"TEXT",pk:1},{n:"provider_id",t:"TEXT",fk:"providers",nn:1},
  {n:"litellm_id",t:"TEXT",nn:1},{n:"display_name",t:"TEXT",nn:1},
  {n:"context_window",t:"INT"},{n:"max_output_tokens",t:"INT"},
  {n:"skip_params",t:"TEXT"},{n:"is_active",t:"INT",nn:1},
  {n:"created_at",t:"TEXT",nn:1},{n:"updated_at",t:"TEXT",nn:1}
]},
{name:"model_profiles",cat:"core",s:"unchanged",x:310,y:620,
 cols:[
  {n:"id",t:"TEXT",pk:1},{n:"user_id",t:"TEXT",fk:"users",nn:1},
  {n:"model_id",t:"TEXT",fk:"models",nn:1},
  {n:"name",t:"TEXT",nn:1},{n:"description",t:"TEXT"},
  {n:"is_default",t:"INT",nn:1},{n:"params_json",t:"TEXT",nn:1},
  {n:"system_prompt",t:"TEXT"},
  {n:"prompt_version_id",t:"TEXT",fk:"prompt_versions"},
  {n:"origin_type",t:"TEXT",nn:1,ck:"manual|param_tuner|..."},
  {n:"origin_ref",t:"TEXT"},
  {n:"created_at",t:"TEXT",nn:1},{n:"updated_at",t:"TEXT",nn:1}
]},
{name:"prompt_versions",cat:"core",s:"unchanged",x:310,y:980,
 cols:[
  {n:"id",t:"TEXT",pk:1},{n:"user_id",t:"TEXT",fk:"users",nn:1},
  {n:"prompt_text",t:"TEXT",nn:1},{n:"label",t:"TEXT",nn:1},
  {n:"source",t:"TEXT",nn:1,ck:"manual|prompt_tuner|auto_optimize"},
  {n:"parent_version_id",t:"TEXT",fk:"prompt_versions"},
  {n:"model_db_id",t:"TEXT",fk:"models"},
  {n:"origin_run_id",t:"TEXT"},
  {n:"created_at",t:"TEXT",nn:1}
]},

// ═══════════ COLUMN 3: SUITE (x:600) ═══════════
{name:"tool_suites",cat:"suite",s:"modified",x:600,y:30,
 note:"v2 MOD: tools_json removed — tool definitions extracted to tool_definitions table.",
 cols:[
  {n:"id",t:"TEXT",pk:1},{n:"user_id",t:"TEXT",fk:"users",nn:1},
  {n:"name",t:"TEXT",nn:1},{n:"description",t:"TEXT"},
  {n:"tools_json",t:"TEXT",ch:"removed"},
  {n:"system_prompt",t:"TEXT"},
  {n:"created_at",t:"TEXT",nn:1},{n:"updated_at",t:"TEXT",nn:1}
]},
{name:"tool_definitions",cat:"suite",s:"new",x:600,y:280,
 note:"v2 NEW: First-class tool definitions. Extracted from tool_suites.tools_json. Each tool = 1 row with name, description, JSON Schema params.",
 cols:[
  {n:"id",t:"TEXT",pk:1},{n:"suite_id",t:"TEXT",fk:"tool_suites",nn:1},
  {n:"name",t:"TEXT",nn:1},{n:"description",t:"TEXT",nn:1},
  {n:"parameters_schema",t:"TEXT",nn:1},
  {n:"sort_order",t:"INT",nn:1},
  {n:"created_at",t:"TEXT",nn:1},{n:"updated_at",t:"TEXT",nn:1}
]},
{name:"tool_test_cases",cat:"suite",s:"modified",x:600,y:540,
 note:"v2 MOD: expected_tool_id FK to tool_definitions. expected_tool renamed to expected_tool_name (denormalized for parallel calls).",
 cols:[
  {n:"id",t:"TEXT",pk:1},{n:"suite_id",t:"TEXT",fk:"tool_suites",nn:1},
  {n:"prompt",t:"TEXT",nn:1},
  {n:"expected_tool_id",t:"TEXT",fk:"tool_definitions",ch:"new"},
  {n:"expected_tool_name",t:"TEXT"},
  {n:"expected_params",t:"TEXT"},
  {n:"param_scoring",t:"TEXT",nn:1,ck:"exact|fuzzy|..."},
  {n:"should_call_tool",t:"INT",nn:1},{n:"category",t:"TEXT"},
  {n:"multi_turn_config",t:"TEXT"},{n:"scoring_config_json",t:"TEXT"},
  {n:"created_at",t:"TEXT",nn:1}
]},
{name:"experiments",cat:"suite",s:"modified",x:600,y:870,
 note:"v2 MOD: suite_snapshot_json removed. Snapshots should be a suite version mechanism, not per-experiment.",
 cols:[
  {n:"id",t:"TEXT",pk:1},{n:"user_id",t:"TEXT",fk:"users",nn:1},
  {n:"name",t:"TEXT",nn:1},{n:"description",t:"TEXT"},
  {n:"suite_id",t:"TEXT",fk:"tool_suites",nn:1},
  {n:"suite_snapshot_json",t:"TEXT",ch:"removed"},
  {n:"baseline_eval_id",t:"TEXT",fk:"tool_eval_runs"},
  {n:"baseline_score",t:"REAL"},
  {n:"best_config_json",t:"TEXT"},{n:"best_score",t:"REAL"},
  {n:"best_source",t:"TEXT"},{n:"best_source_id",t:"TEXT"},
  {n:"status",t:"TEXT",nn:1,ck:"active|archived"},
  {n:"created_at",t:"TEXT",nn:1},{n:"updated_at",t:"TEXT",nn:1}
]},

// ═══════════ COLUMN 4: EXECUTION (x:910) ═══════════
{name:"tool_eval_runs",cat:"exec",s:"modified",x:910,y:30,
 note:"v2 MOD: THE atomic execution unit. Blobs removed (models_json, results_json, summary_json, config_json). Orchestrator columns added. Results in case_results table.",
 cols:[
  {n:"id",t:"TEXT",pk:1},{n:"user_id",t:"TEXT",fk:"users",nn:1},
  {n:"suite_id",t:"TEXT",fk:"tool_suites",nn:1},
  {n:"temperature",t:"REAL"},
  {n:"tool_choice",t:"TEXT",nn:1,ch:"new"},
  {n:"system_prompt_config",t:"TEXT",ch:"new"},
  {n:"provider_params_json",t:"TEXT",ch:"new"},
  {n:"models_json",t:"TEXT",ch:"removed"},
  {n:"results_json",t:"TEXT",ch:"removed"},
  {n:"summary_json",t:"TEXT",ch:"removed"},
  {n:"config_json",t:"TEXT",ch:"removed"},
  {n:"profiles_json",t:"TEXT",ch:"removed"},
  {n:"judge_explanations_json",t:"TEXT",ch:"removed"},
  {n:"orchestrator_type",t:"TEXT",ch:"new",ck:"standalone|param_tune|..."},
  {n:"orchestrator_run_id",t:"TEXT",ch:"new"},
  {n:"experiment_id",t:"TEXT",fk:"experiments"},
  {n:"timestamp",t:"TEXT",nn:1}
]},
{name:"case_results",cat:"exec",s:"new",x:910,y:460,
 note:"v2 NEW: THE atomic execution record. One row = one model + one test case + one eval run. Extracted from tool_eval_runs.results_json. Enables per-case SQL analytics.",
 cols:[
  {n:"id",t:"TEXT",pk:1},
  {n:"eval_run_id",t:"TEXT",fk:"tool_eval_runs",nn:1},
  {n:"test_case_id",t:"TEXT",fk:"tool_test_cases",nn:1},
  {n:"model_id",t:"TEXT",fk:"models",nn:1},
  {n:"tool_selection_score",t:"REAL",nn:1},
  {n:"param_accuracy",t:"REAL"},
  {n:"overall_score",t:"REAL",nn:1},
  {n:"irrelevance_score",t:"REAL"},
  {n:"actual_tool",t:"TEXT"},{n:"actual_params",t:"TEXT"},
  {n:"success",t:"INT",nn:1},{n:"error",t:"TEXT"},
  {n:"latency_ms",t:"INT"},
  {n:"format_compliance",t:"TEXT",ck:"PASS|FAIL|NORMALIZED"},
  {n:"error_type",t:"TEXT"},
  {n:"raw_request",t:"TEXT"},{n:"raw_response",t:"TEXT"},
  {n:"created_at",t:"TEXT",nn:1}
]},

// ═══════════ COLUMN 4 (lower): JUDGE ═══════════
{name:"judge_reports",cat:"judge",s:"modified",x:910,y:880,
 note:"v2 MOD: verdicts_json removed — verdicts in judge_verdicts table. instructions_json replaced by custom_instructions TEXT. report_json kept (LLM narrative).",
 cols:[
  {n:"id",t:"TEXT",pk:1},{n:"user_id",t:"TEXT",fk:"users",nn:1},
  {n:"eval_run_id",t:"TEXT",fk:"tool_eval_runs"},
  {n:"eval_run_id_b",t:"TEXT",fk:"tool_eval_runs"},
  {n:"judge_model_id",t:"TEXT",fk:"models"},
  {n:"mode",t:"TEXT",nn:1,ck:"post_eval|live_inline|comparative"},
  {n:"verdicts_json",t:"TEXT",ch:"removed"},
  {n:"instructions_json",t:"TEXT",ch:"removed"},
  {n:"custom_instructions",t:"TEXT",ch:"new"},
  {n:"report_json",t:"TEXT"},
  {n:"overall_grade",t:"TEXT"},{n:"overall_score",t:"REAL"},
  {n:"status",t:"TEXT",nn:1,ck:"running|completed|..."},
  {n:"parent_report_id",t:"TEXT"},{n:"version",t:"INT",nn:1},
  {n:"experiment_id",t:"TEXT",fk:"experiments"},
  {n:"timestamp",t:"TEXT",nn:1}
]},
{name:"judge_verdicts",cat:"judge",s:"new",x:910,y:1300,
 note:"v2 NEW: Per-case judge assessment. Extracted from judge_reports.verdicts_json. FK to case_results = verdict tied to specific execution, not just test case.",
 cols:[
  {n:"id",t:"TEXT",pk:1},
  {n:"judge_report_id",t:"TEXT",fk:"judge_reports",nn:1},
  {n:"case_result_id",t:"TEXT",fk:"case_results",nn:1},
  {n:"quality_score",t:"INT",nn:1},
  {n:"verdict",t:"TEXT",nn:1},{n:"summary",t:"TEXT",nn:1},
  {n:"reasoning",t:"TEXT",nn:1},
  {n:"tool_selection_assessment",t:"TEXT"},
  {n:"param_assessment",t:"TEXT"},
  {n:"judge_override_score",t:"REAL"},{n:"override_reason",t:"TEXT"},
  {n:"created_at",t:"TEXT",nn:1}
]},

// ═══════════ COLUMN 5: ORCHESTRATORS (x:1260) ═══════════
{name:"param_tune_runs",cat:"tune",s:"modified",x:1260,y:30,
 note:"v2 MOD: models_json, results_json, judge_scores_json removed. Combo results in param_tune_combos, each linking to an eval run. n_trials added.",
 cols:[
  {n:"id",t:"TEXT",pk:1},{n:"user_id",t:"TEXT",fk:"users",nn:1},
  {n:"suite_id",t:"TEXT",fk:"tool_suites",nn:1},
  {n:"optimization_mode",t:"TEXT",nn:1,ck:"grid|random|bayesian"},
  {n:"search_space_json",t:"TEXT",nn:1},
  {n:"n_trials",t:"INT",ch:"new"},
  {n:"models_json",t:"TEXT",ch:"removed"},
  {n:"results_json",t:"TEXT",ch:"removed"},
  {n:"judge_scores_json",t:"TEXT",ch:"removed"},
  {n:"total_combos",t:"INT",nn:1},{n:"completed_combos",t:"INT"},
  {n:"status",t:"TEXT",nn:1,ck:"running|completed|..."},
  {n:"best_score",t:"REAL"},{n:"best_config_json",t:"TEXT"},
  {n:"best_profile_id",t:"TEXT",fk:"model_profiles"},
  {n:"duration_s",t:"REAL"},
  {n:"experiment_id",t:"TEXT",fk:"experiments"},
  {n:"timestamp",t:"TEXT",nn:1}
]},
{name:"param_tune_combos",cat:"tune",s:"new",x:1260,y:460,
 note:"v2 NEW: One row per param combination tested. Links to the eval run created for that combination. Extracted from param_tune_runs.results_json.",
 cols:[
  {n:"id",t:"TEXT",pk:1},
  {n:"tune_run_id",t:"TEXT",fk:"param_tune_runs",nn:1},
  {n:"combo_index",t:"INT",nn:1},
  {n:"model_id",t:"TEXT",fk:"models",nn:1},
  {n:"config_json",t:"TEXT",nn:1},
  {n:"eval_run_id",t:"TEXT",fk:"tool_eval_runs"},
  {n:"overall_score",t:"REAL"},{n:"tool_accuracy_pct",t:"REAL"},
  {n:"param_accuracy_pct",t:"REAL"},{n:"latency_avg_ms",t:"INT"},
  {n:"cases_passed",t:"INT"},{n:"cases_total",t:"INT"},
  {n:"adjustments_json",t:"TEXT"},
  {n:"created_at",t:"TEXT",nn:1}
]},
{name:"prompt_tune_runs",cat:"tune",s:"modified",x:1260,y:820,
 note:"v2 MOD: target_models_json, config_json, generations_json removed. Config decomposed to atomic columns. mode gains 'auto_optimize'. Generations in child tables.",
 cols:[
  {n:"id",t:"TEXT",pk:1},{n:"user_id",t:"TEXT",fk:"users",nn:1},
  {n:"suite_id",t:"TEXT",fk:"tool_suites",nn:1},
  {n:"mode",t:"TEXT",nn:1,ck:"quick|evolutionary|auto_optimize",ch:"changed"},
  {n:"meta_model_id",t:"TEXT",fk:"models"},
  {n:"base_prompt",t:"TEXT"},
  {n:"target_models_json",t:"TEXT",ch:"removed"},
  {n:"config_json",t:"TEXT",ch:"removed"},
  {n:"generations_json",t:"TEXT",ch:"removed"},
  {n:"population_size",t:"INT",nn:1,ch:"new"},
  {n:"generations",t:"INT",nn:1,ch:"new"},
  {n:"selection_ratio",t:"REAL",nn:1,ch:"new"},
  {n:"eval_temperature",t:"REAL",ch:"new"},
  {n:"eval_tool_choice",t:"TEXT",ch:"new"},
  {n:"total_prompts",t:"INT"},{n:"completed_prompts",t:"INT"},
  {n:"status",t:"TEXT",nn:1,ck:"running|completed|..."},
  {n:"best_score",t:"REAL"},
  {n:"best_prompt_version_id",t:"TEXT",fk:"prompt_versions"},
  {n:"best_prompt_origin_json",t:"TEXT"},
  {n:"best_profile_id",t:"TEXT",fk:"model_profiles",ch:"new"},
  {n:"duration_s",t:"REAL"},
  {n:"experiment_id",t:"TEXT",fk:"experiments"},
  {n:"timestamp",t:"TEXT",nn:1}
]},
{name:"prompt_tune_generations",cat:"tune",s:"new",x:1260,y:1300,
 note:"v2 NEW: Generation-level tracking for prompt tuning. Extracted from prompt_tune_runs.generations_json. Each generation has N candidates.",
 cols:[
  {n:"id",t:"TEXT",pk:1},
  {n:"tune_run_id",t:"TEXT",fk:"prompt_tune_runs",nn:1},
  {n:"generation_number",t:"INT",nn:1},
  {n:"best_score",t:"REAL"},{n:"best_candidate_index",t:"INT"},
  {n:"created_at",t:"TEXT",nn:1}
]},
{name:"prompt_tune_candidates",cat:"tune",s:"new",x:1260,y:1520,
 note:"v2 NEW: Per-prompt candidate per generation. Links to eval run + prompt version. Extracted from generations_json[].prompts[].",
 cols:[
  {n:"id",t:"TEXT",pk:1},
  {n:"generation_id",t:"TEXT",fk:"prompt_tune_generations",nn:1},
  {n:"candidate_index",t:"INT",nn:1},
  {n:"prompt_version_id",t:"TEXT",fk:"prompt_versions"},
  {n:"prompt_text",t:"TEXT",nn:1},
  {n:"style",t:"TEXT"},{n:"mutation_type",t:"TEXT"},
  {n:"parent_candidate_id",t:"TEXT",fk:"prompt_tune_candidates"},
  {n:"avg_score",t:"REAL"},{n:"survived",t:"INT",nn:1},
  {n:"eval_run_id",t:"TEXT",fk:"tool_eval_runs"},
  {n:"created_at",t:"TEXT",nn:1}
]},

// ═══════════ COLUMN 6: BENCH + PLATFORM (x:1580) ═══════════
{name:"benchmark_runs",cat:"bench",s:"modified",x:1580,y:30,
 note:"v2 MOD: results_json removed. Per-model results in benchmark_results table.",
 cols:[
  {n:"id",t:"TEXT",pk:1},{n:"user_id",t:"TEXT",fk:"users",nn:1},
  {n:"timestamp",t:"TEXT",nn:1},{n:"prompt",t:"TEXT"},
  {n:"context_tiers",t:"TEXT"},
  {n:"results_json",t:"TEXT",ch:"removed"},
  {n:"metadata",t:"TEXT"},{n:"max_tokens",t:"INT"},
  {n:"temperature",t:"REAL"},{n:"warmup",t:"INT"},
  {n:"config_json",t:"TEXT"}
]},
{name:"benchmark_results",cat:"bench",s:"new",x:1580,y:330,
 note:"v2 NEW: Per-model-per-run throughput record. Extracted from benchmark_runs.results_json. Each LLM call = 1 row.",
 cols:[
  {n:"id",t:"TEXT",pk:1},
  {n:"run_id",t:"TEXT",fk:"benchmark_runs",nn:1},
  {n:"model_id",t:"TEXT",fk:"models",nn:1},
  {n:"run_number",t:"INT",nn:1},
  {n:"context_tokens",t:"INT",nn:1},
  {n:"ttft_ms",t:"REAL"},{n:"total_time_s",t:"REAL"},
  {n:"output_tokens",t:"INT"},{n:"input_tokens",t:"INT"},
  {n:"tokens_per_second",t:"REAL"},
  {n:"input_tokens_per_second",t:"REAL"},
  {n:"cost",t:"REAL"},
  {n:"success",t:"INT",nn:1},{n:"error",t:"TEXT"},
  {n:"created_at",t:"TEXT",nn:1}
]},
{name:"schedules",cat:"bench",s:"unchanged",x:1580,y:680,
 cols:[
  {n:"id",t:"TEXT",pk:1},{n:"user_id",t:"TEXT",fk:"users",nn:1},
  {n:"name",t:"TEXT",nn:1},
  {n:"prompt_version_id",t:"TEXT",fk:"prompt_versions"},
  {n:"prompt",t:"TEXT"},
  {n:"models_json",t:"TEXT",nn:1},
  {n:"max_tokens",t:"INT"},{n:"temperature",t:"REAL"},
  {n:"interval_hours",t:"INT",nn:1,ck:">0"},
  {n:"enabled",t:"INT"},{n:"last_run",t:"TEXT"},
  {n:"next_run",t:"TEXT",nn:1},{n:"created",t:"TEXT",nn:1}
]},
{name:"public_leaderboard",cat:"pub",s:"unchanged",x:1580,y:1000,
 cols:[
  {n:"id",t:"TEXT",pk:1},
  {n:"model_db_id",t:"TEXT",fk:"models",nn:1},
  {n:"tool_accuracy_pct",t:"REAL"},{n:"param_accuracy_pct",t:"REAL"},
  {n:"irrel_accuracy_pct",t:"REAL"},{n:"throughput_tps",t:"REAL"},
  {n:"ttft_ms",t:"REAL"},{n:"sample_count",t:"INT",nn:1},
  {n:"last_updated",t:"TEXT",nn:1}
]},
{name:"audit_log",cat:"plat",s:"unchanged",x:1580,y:1240,
 cols:[
  {n:"id",t:"INT",pk:1},{n:"timestamp",t:"TEXT",nn:1},
  {n:"user_id",t:"TEXT",fk:"users"},{n:"username",t:"TEXT",nn:1},
  {n:"action",t:"TEXT",nn:1},{n:"resource_type",t:"TEXT"},
  {n:"resource_id",t:"TEXT"},{n:"detail",t:"TEXT"},
  {n:"ip_address",t:"TEXT"},{n:"user_agent",t:"TEXT"}
]},
{name:"jobs",cat:"plat",s:"unchanged",x:1580,y:1520,
 cols:[
  {n:"id",t:"TEXT",pk:1},{n:"user_id",t:"TEXT",fk:"users",nn:1},
  {n:"job_type",t:"TEXT",nn:1,ck:"8 types"},
  {n:"status",t:"TEXT",nn:1,ck:"7 statuses"},
  {n:"progress_pct",t:"INT",ck:"0-100"},{n:"progress_detail",t:"TEXT"},
  {n:"params_json",t:"TEXT",nn:1},{n:"result_ref",t:"TEXT"},
  {n:"result_type",t:"TEXT"},{n:"error_msg",t:"TEXT"},
  {n:"timeout_seconds",t:"INT",nn:1},
  {n:"created_at",t:"TEXT",nn:1},{n:"started_at",t:"TEXT"},
  {n:"completed_at",t:"TEXT"},{n:"timeout_at",t:"TEXT"}
]},

// ═══════════ DROPPED ═══════════
{name:"run_results",cat:"exec",s:"dropped",x:30,y:1200,
 note:"v2 DROPPED: Was a Phase 4 dual-write shim for per-model metrics. Replaced by case_results (tool eval) and benchmark_results (throughput). Proper per-case granularity now.",
 cols:[
  {n:"id",t:"TEXT",pk:1,ch:"removed"},
  {n:"run_id",t:"TEXT",ch:"removed"},{n:"run_type",t:"TEXT",ch:"removed"},
  {n:"model_id",t:"TEXT",ch:"removed"},{n:"profile_id",t:"TEXT",ch:"removed"},
  {n:"tool_accuracy_pct",t:"REAL",ch:"removed"},{n:"param_accuracy_pct",t:"REAL",ch:"removed"},
  {n:"throughput_tps",t:"REAL",ch:"removed"},{n:"ttft_ms",t:"REAL",ch:"removed"},
  {n:"score",t:"REAL",ch:"removed"},{n:"created_at",t:"TEXT",ch:"removed"}
]}
];

// ═══════════ RELATIONSHIPS ═══════════
// [from, from_col, to, to_col, isNew]
const R=[
  // ── v2 NEW relationships (blob extraction) ──
  ["tool_definitions","suite_id","tool_suites","id",true],
  ["tool_test_cases","expected_tool_id","tool_definitions","id",true],
  ["case_results","eval_run_id","tool_eval_runs","id",true],
  ["case_results","test_case_id","tool_test_cases","id",true],
  ["case_results","model_id","models","id",true],
  ["judge_verdicts","judge_report_id","judge_reports","id",true],
  ["judge_verdicts","case_result_id","case_results","id",true],
  ["benchmark_results","run_id","benchmark_runs","id",true],
  ["benchmark_results","model_id","models","id",true],
  ["param_tune_combos","tune_run_id","param_tune_runs","id",true],
  ["param_tune_combos","model_id","models","id",true],
  ["param_tune_combos","eval_run_id","tool_eval_runs","id",true],
  ["prompt_tune_generations","tune_run_id","prompt_tune_runs","id",true],
  ["prompt_tune_candidates","generation_id","prompt_tune_generations","id",true],
  ["prompt_tune_candidates","prompt_version_id","prompt_versions","id",true],
  ["prompt_tune_candidates","eval_run_id","tool_eval_runs","id",true],
  ["prompt_tune_candidates","parent_candidate_id","prompt_tune_candidates","id",true],
  ["prompt_tune_runs","best_profile_id","model_profiles","id",true],

  // ── Existing relationships (from v1) ──
  // Core chain
  ["providers","user_id","users","id",false],
  ["models","provider_id","providers","id",false],
  ["model_profiles","user_id","users","id",false],
  ["model_profiles","model_id","models","id",false],
  ["model_profiles","prompt_version_id","prompt_versions","id",false],
  ["prompt_versions","user_id","users","id",false],
  ["prompt_versions","parent_version_id","prompt_versions","id",false],
  ["prompt_versions","model_db_id","models","id",false],

  // Auth
  ["refresh_tokens","user_id","users","id",false],
  ["password_reset_tokens","user_id","users","id",false],
  ["user_api_keys","user_id","users","id",false],
  ["user_api_keys","provider_id","providers","id",false],
  ["rate_limits","user_id","users","id",false],
  ["rate_limits","updated_by","users","id",false],

  // Suite & eval
  ["tool_suites","user_id","users","id",false],
  ["tool_test_cases","suite_id","tool_suites","id",false],
  ["experiments","user_id","users","id",false],
  ["experiments","suite_id","tool_suites","id",false],
  ["experiments","baseline_eval_id","tool_eval_runs","id",false],
  ["tool_eval_runs","user_id","users","id",false],
  ["tool_eval_runs","suite_id","tool_suites","id",false],
  ["tool_eval_runs","experiment_id","experiments","id",false],

  // Orchestrators
  ["param_tune_runs","user_id","users","id",false],
  ["param_tune_runs","suite_id","tool_suites","id",false],
  ["param_tune_runs","experiment_id","experiments","id",false],
  ["param_tune_runs","best_profile_id","model_profiles","id",false],
  ["prompt_tune_runs","user_id","users","id",false],
  ["prompt_tune_runs","suite_id","tool_suites","id",false],
  ["prompt_tune_runs","experiment_id","experiments","id",false],
  ["prompt_tune_runs","meta_model_id","models","id",false],
  ["prompt_tune_runs","best_prompt_version_id","prompt_versions","id",false],

  // Judge
  ["judge_reports","user_id","users","id",false],
  ["judge_reports","eval_run_id","tool_eval_runs","id",false],
  ["judge_reports","eval_run_id_b","tool_eval_runs","id",false],
  ["judge_reports","judge_model_id","models","id",false],
  ["judge_reports","experiment_id","experiments","id",false],

  // Bench & platform
  ["benchmark_runs","user_id","users","id",false],
  ["schedules","user_id","users","id",false],
  ["schedules","prompt_version_id","prompt_versions","id",false],
  ["public_leaderboard","model_db_id","models","id",false],
  ["audit_log","user_id","users","id",false],
  ["jobs","user_id","users","id",false],
];

// ═══════════ RENDER ═══════════
const cv=document.getElementById("cv"),sl=document.getElementById("sl"),cw=document.getElementById("cw"),tt=document.getElementById("tt");
let zm=1,sL=true;const te={};

function render(){T.forEach(t=>{
  const c=document.createElement("div");
  c.className="tc cat-"+t.cat;
  if(t.s==="new")c.classList.add("sn");
  if(t.s==="modified")c.classList.add("sm");
  if(t.s==="dropped")c.classList.add("sd");
  c.id="t-"+t.name;c.style.left=t.x+"px";c.style.top=t.y+"px";
  c.dataset.s=t.s;if(t.note)c.dataset.note=t.note;

  const h=document.createElement("div");h.className="th";
  let sb="";
  if(t.s==="new")sb='<span class="sb sb-n">NEW</span>';
  else if(t.s==="modified")sb='<span class="sb sb-m">MOD</span>';
  else if(t.s==="dropped")sb='<span class="sb sb-d">DROP</span>';
  const ac=t.cols.filter(c=>c.ch!=="removed").length;
  h.innerHTML='<div class="ic"></div>'+t.name+sb+'<span class="cnt">'+ac+' cols</span>';
  h.onclick=()=>hl(t.name);c.appendChild(h);

  if(t.note){
    c.onmouseenter=e=>{tt.textContent=t.note;tt.style.display="block";tt.style.left=e.clientX+10+"px";tt.style.top=e.clientY+10+"px"};
    c.onmousemove=e=>{tt.style.left=e.clientX+10+"px";tt.style.top=e.clientY+10+"px"};
    c.onmouseleave=()=>{tt.style.display="none"};
  }

  const cd=document.createElement("div");cd.className="tc-c";
  t.cols.forEach(col=>{
    const r=document.createElement("div");r.className="cr";
    if(col.ch==="new")r.classList.add("cn");
    else if(col.ch==="changed")r.classList.add("cc");
    else if(col.ch==="removed")r.classList.add("cd");
    let b="";
    if(col.pk)b+='<span class="cb b-pk">PK</span>';
    if(col.fk&&col.ch!=="removed")b+='<span class="cb b-fk">FK</span>';
    if(col.uq)b+='<span class="cb b-uq">UQ</span>';
    if(col.ck)b+='<span class="cb b-ck">CK</span>';
    if(col.ch==="new")b+='<span class="cb b-new">NEW</span>';
    else if(col.ch==="changed")b+='<span class="cb b-chg">CHG</span>';
    else if(col.ch==="removed")b+='<span class="cb b-del">DEL</span>';
    r.innerHTML='<span class="cn-n">'+col.n+'</span><span class="cn-t">'+col.t+'</span>'+b;
    cd.appendChild(r);
  });
  c.appendChild(cd);cv.appendChild(c);te[t.name]=c;
})}

function ga(el,side){
  const r=el.getBoundingClientRect(),cr=cv.getBoundingClientRect();
  const x=(r.left-cr.left)/zm,y=(r.top-cr.top)/zm,w=r.width/zm,h=r.height/zm;
  if(side==="l")return{x,y:y+h/2};if(side==="r")return{x:x+w,y:y+h/2};
  if(side==="t")return{x:x+w/2,y};return{x:x+w/2,y:y+h};
}

function dl(){
  sl.innerHTML="";if(!sL)return;
  const d=document.createElementNS("http://www.w3.org/2000/svg","defs");
  ["aw","awn"].forEach(id=>{
    const m=document.createElementNS("http://www.w3.org/2000/svg","marker");
    m.setAttribute("id",id);m.setAttribute("markerWidth","8");m.setAttribute("markerHeight","6");
    m.setAttribute("refX","8");m.setAttribute("refY","3");m.setAttribute("orient","auto");
    const p=document.createElementNS("http://www.w3.org/2000/svg","polygon");
    p.setAttribute("points","0 0, 8 3, 0 6");p.setAttribute("fill",id==="awn"?"#10b981":"#475569");
    m.appendChild(p);d.appendChild(m);
  });sl.appendChild(d);

  R.forEach(([f,,t,,nw])=>{
    const fe=te[f],toe=te[t];if(!fe||!toe)return;
    if(fe.style.display==="none"||toe.style.display==="none")return;
    const cr=cv.getBoundingClientRect();
    const fx=(fe.getBoundingClientRect().left+fe.getBoundingClientRect().width/2-cr.left)/zm;
    const fy=(fe.getBoundingClientRect().top+fe.getBoundingClientRect().height/2-cr.top)/zm;
    const tx=(toe.getBoundingClientRect().left+toe.getBoundingClientRect().width/2-cr.left)/zm;
    const ty=(toe.getBoundingClientRect().top+toe.getBoundingClientRect().height/2-cr.top)/zm;
    const dx=tx-fx,dy=ty-fy;

    if(f===t){
      const a=ga(fe,"r");
      const p=document.createElementNS("http://www.w3.org/2000/svg","path");
      p.setAttribute("d",`M ${a.x} ${a.y} C ${a.x+45} ${a.y-25}, ${a.x+45} ${a.y+25}, ${a.x} ${a.y+4}`);
      if(nw)p.classList.add("nr");p.dataset.f=f;p.dataset.t=t;sl.appendChild(p);return;
    }
    let fs,ts;
    if(Math.abs(dx)>Math.abs(dy)){fs=dx>0?"r":"l";ts=dx>0?"l":"r";}
    else{fs=dy>0?"b":"t";ts=dy>0?"t":"b";}
    const a=ga(fe,fs),b=ga(toe,ts);
    const ln=document.createElementNS("http://www.w3.org/2000/svg","line");
    ln.setAttribute("x1",a.x);ln.setAttribute("y1",a.y);
    ln.setAttribute("x2",b.x);ln.setAttribute("y2",b.y);
    ln.setAttribute("marker-end",nw?"url(#awn)":"url(#aw)");
    if(nw)ln.classList.add("nr");ln.dataset.f=f;ln.dataset.t=t;sl.appendChild(ln);
    const dot=document.createElementNS("http://www.w3.org/2000/svg","circle");
    dot.setAttribute("cx",a.x);dot.setAttribute("cy",a.y);dot.setAttribute("r","3");
    if(nw)dot.classList.add("nr");dot.dataset.f=f;dot.dataset.t=t;sl.appendChild(dot);
  });
}

let ah=null;
function hl(n){
  if(ah===n){ch();return;}ah=n;
  const cn=new Set([n]);
  R.forEach(([f,,t])=>{if(f===n)cn.add(t);if(t===n)cn.add(f);});
  Object.entries(te).forEach(([k,el])=>{el.classList.toggle("hl",k===n);el.classList.toggle("dim",!cn.has(k));});
  sl.querySelectorAll("line,path").forEach(l=>{const m=l.dataset.f===n||l.dataset.t===n;l.classList.toggle("hl",m);l.style.opacity=m?1:.06;});
  sl.querySelectorAll("circle").forEach(c=>{const m=c.dataset.f===n||c.dataset.t===n;c.classList.toggle("hl",m);c.style.opacity=m?1:.06;});
}
function ch(){
  ah=null;Object.values(te).forEach(e=>e.classList.remove("hl","dim"));
  sl.querySelectorAll("line,path").forEach(l=>{l.classList.remove("hl");l.style.opacity="";});
  sl.querySelectorAll("circle").forEach(c=>{c.classList.remove("hl");c.style.opacity="";});
}
cv.onclick=e=>{if(e.target===cv||e.target===sl)ch();};

function fil(s){
  document.querySelectorAll(".controls button").forEach(b=>b.classList.remove("active"));
  (document.getElementById("btn-"+s)||{}).classList?.add("active");
  Object.entries(te).forEach(([,el])=>{el.style.display=(s==="all"||el.dataset.s===s)?"":"none";});
  requestAnimationFrame(dl);
}
document.getElementById("search").oninput=e=>{
  const q=e.target.value.toLowerCase().trim();
  if(!q){ch();Object.values(te).forEach(el=>el.style.display="");requestAnimationFrame(dl);return;}
  Object.entries(te).forEach(([n,el])=>{
    const tb=T.find(t=>t.name===n);
    const m=n.includes(q)||tb?.cols.some(c=>c.n.includes(q))||tb?.note?.toLowerCase().includes(q);
    el.style.display=m?"":"none";
  });requestAnimationFrame(dl);
};

function sz(z){zm=Math.max(.2,Math.min(2,z));cv.style.transform=`scale(${zm})`;document.getElementById("zi").textContent=Math.round(zm*100)+"%";requestAnimationFrame(dl);}
function zI(){sz(zm+.1)} function zO(){sz(zm-.1)} function zR(){sz(1)}
function tgl(){sL=!sL;document.getElementById("tglL").classList.toggle("active",sL);dl();}
cw.onwheel=e=>{e.preventDefault();sz(zm+(e.deltaY>0?-.05:.05));};

render();requestAnimationFrame(dl);
window.onresize=()=>requestAnimationFrame(dl);
</script>
</body>
</html>
