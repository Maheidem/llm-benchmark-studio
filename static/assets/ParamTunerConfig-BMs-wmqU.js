import{w as U,b as a,c as r,d as t,t as v,l as q,f as A,F as T,x as V,k as F,Q as W,B as N,m as ae,h as G,D as se,e as Y,v as re,O as le,r as j,J as oe,L as X,o as ie,z as de,y as ee,E as K,j as te,i as ce,a as ue,q as pe,g as me,R as fe}from"./index-DdRTlIgb.js";import{a as ye,u as xe}from"./useSharedContext-Ck8vzsgc.js";import{u as ve}from"./paramTuner-WruKFjGx.js";import{u as be}from"./config-Bc3_eHPH.js";import"./useActiveSession-DdoXJmDo.js";const ge={class:"card rounded-md p-5 mb-6"},he={class:"flex items-center justify-between mb-4"},ke={class:"flex items-center gap-2"},_e={class:"text-xs font-mono text-zinc-600"},we={key:0,class:"text-xs text-zinc-600 font-body text-center py-4"},Se={key:1,class:"space-y-4"},$e=["data-param-name"],Pe={class:"relative inline-flex items-center cursor-pointer mt-1.5"},Ce=["checked","disabled","onChange"],ze={class:"flex-1"},Ae={class:"flex items-center gap-2 mb-2"},Me={class:"text-xs text-zinc-400 font-body"},je={key:1,class:"text-[10px] text-zinc-600 font-mono"},Te={class:"grid grid-cols-3 gap-2 mb-2"},Ve=["step","value","onInput"],Ee=["step","value","onInput"],Be=["min","step","value","onInput"],Ie={class:"flex flex-wrap gap-1"},Ne={key:1,class:"flex flex-wrap gap-4"},Oe=["checked","onChange"],Re={key:2,class:"text-[10px] text-zinc-600 font-body"},De={key:3,class:"text-xs font-mono text-zinc-500"},Le={key:2,class:"mt-4 pt-3",style:{"border-top":"1px solid var(--border-subtle)"}},Ke={class:"text-[10px] text-zinc-600 font-body"},Ue={__name:"SearchSpaceBuilder",props:{paramDefs:{type:Array,default:()=>[]},modelValue:{type:Object,default:()=>({})}},emits:["update:modelValue","update:totalCombos"],setup(S,{expose:E,emit:$}){const _=S,w=$,y=W({}),n=W({});U(()=>_.paramDefs,o=>{const s=new Set(["temperature","tool_choice"]);for(const e of o)if(e.name in y||(y[e.name]=!e.locked&&(s.has(e.name)||e.name in(_.modelValue||{}))),!(e.name in n))if(e.name in(_.modelValue||{}))n[e.name]=_.modelValue[e.name];else if(e.type==="float"||e.type==="int")n[e.name]={min:e.min??0,max:e.max??1,step:e.step??(e.type==="float"?.1:1)};else if(e.type==="enum"){const u=e.name==="tool_choice"?["auto","required"]:[...e.values||[]];n[e.name]=u}else e.type==="bool"&&(n[e.name]=[!0,!1]);I()},{immediate:!0}),U(()=>_.modelValue,o=>{if(!(!o||Object.keys(o).length===0)){for(const[s,e]of Object.entries(o))y[s]=!0,n[s]=e;for(const s of Object.keys(y))s in o||(y[s]=!1)}},{deep:!0});const p={temperature:"Temperature",top_p:"Top P",top_k:"Top K",tool_choice:"Tool Choice",repetition_penalty:"Repetition Penalty",min_p:"Min P",frequency_penalty:"Frequency Penalty",presence_penalty:"Presence Penalty",max_tokens:"Max Tokens"};function x(o){return p[o]||o.replace(/_/g," ").replace(/\b\w/g,s=>s.toUpperCase())}function h(o,s){const e=s>0?o/s:0;return e>=1?{background:"rgba(191,255,0,0.1)",color:"var(--lime)"}:e>=.5?{background:"rgba(234,179,8,0.1)",color:"#EAB308"}:{background:"rgba(255,59,92,0.1)",color:"var(--coral)"}}function i(o){y[o]=!y[o],I()}function P(o,s,e){const u=n[o];return u&&typeof u=="object"&&!Array.isArray(u)?u[s]??e:e}function C(o,s,e,u){(!n[o]||typeof n[o]!="object"||Array.isArray(n[o]))&&(n[o]={}),n[o][s]=u==="int"?parseInt(e):parseFloat(e),I()}function b(o,s){const e=n[o];return Array.isArray(e)&&e.includes(s)}function d(o,s){Array.isArray(n[o])||(n[o]=[]);const e=n[o].indexOf(s);e>=0?n[o].splice(e,1):n[o].push(s),I()}function g(o,s,e){const u=[];if(e<=0||o>s)return u;for(let B=o;B<=s+e*.001;B+=e)u.push(Math.round(B*1e3)/1e3);return u}function k(o,s){if(!y[o])return[];const e=n[o];if(!e||typeof e!="object"||Array.isArray(e))return[];const u=e.min??0,B=e.max??1,J=e.step??(s==="float"?.1:1),D=g(u,B,J);return s==="int"?D.map(m=>Math.round(m)):D}const z=N(()=>{const o=[];for(const s of _.paramDefs)if(y[s.name])if(s.type==="float"||s.type==="int"){const e=k(s.name,s.type);e.length>0&&o.push(e.length)}else if(s.type==="enum"){const e=n[s.name];Array.isArray(e)&&e.length>0&&o.push(e.length)}else s.type==="bool"&&o.push(2);return o.length>0?o.reduce((s,e)=>s*e,1):0});U(z,o=>w("update:totalCombos",o));const R=N(()=>{const o=[];for(const s of _.paramDefs){if(!y[s.name])continue;let e=0;if(s.type==="float"||s.type==="int")e=k(s.name,s.type).length;else if(s.type==="enum"){const u=n[s.name];e=Array.isArray(u)?u.length:0}else s.type==="bool"&&(e=2);e>0&&o.push(`${e} ${s.name}`)}return o.length>1?"= "+o.map(s=>s.split(" ")[0]).join(" x "):""}),O=N(()=>{const o=z.value;return o<20?"QUICK":o<50?"MODERATE":o<=100?"LARGE":"WARNING"}),H=N(()=>{const o=z.value;return o<20?{background:"rgba(191,255,0,0.1)",color:"var(--lime)"}:o<50?{background:"rgba(234,179,8,0.1)",color:"#EAB308"}:o<=100?{background:"rgba(249,115,22,0.1)",color:"#F97316"}:{background:"rgba(255,59,92,0.1)",color:"var(--coral)"}});function I(){const o={};for(const s of _.paramDefs)if(y[s.name])if(s.type==="float"||s.type==="int"){const e=n[s.name];e&&typeof e=="object"&&!Array.isArray(e)&&(o[s.name]={min:e.min??0,max:e.max??1,step:e.step??.1})}else if(s.type==="enum"){const e=n[s.name];Array.isArray(e)&&e.length>0&&(o[s.name]=[...e])}else s.type==="bool"&&(o[s.name]=[!0,!1]);w("update:modelValue",o)}return E({enabledParams:y,paramValues:n}),(o,s)=>(a(),r("div",ge,[t("div",he,[s[0]||(s[0]=t("span",{class:"section-label"},"Search Space",-1)),t("div",ke,[t("span",_e,v(z.value)+" combos",1),z.value>0?(a(),r("span",{key:0,class:"text-[10px] font-display tracking-wider uppercase px-2 py-0.5 rounded-sm",style:q(H.value)},v(O.value),5)):A("",!0)])]),S.paramDefs.length===0?(a(),r("div",we," Select models to configure parameters ")):(a(),r("div",Se,[(a(!0),r(T,null,V(S.paramDefs,e=>(a(),r("div",{key:e.name,"data-param-name":e.name,class:"flex items-start gap-3"},[t("label",Pe,[t("input",{type:"checkbox",checked:y[e.name],disabled:e.locked,class:"sr-only peer",onChange:u=>i(e.name)},null,40,Ce),s[1]||(s[1]=t("div",{class:"w-8 h-4 bg-zinc-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-zinc-400 after:rounded-full after:h-3 after:w-3 after:transition-all peer-checked:bg-lime-900 peer-checked:after:bg-lime-400"},null,-1))]),t("div",ze,[t("div",Ae,[t("span",Me,v(x(e.name)),1),e.supportedBy!=null?(a(),r("span",{key:0,class:"text-[10px] font-mono px-1.5 py-0.5 rounded-sm",style:q(h(e.supportedBy,e.totalModels))},v(e.supportedBy)+"/"+v(e.totalModels),5)):A("",!0),e.locked?(a(),r("span",je,"locked: "+v(e.lockedValue),1)):A("",!0)]),(e.type==="float"||e.type==="int")&&!e.locked?(a(),r(T,{key:0},[t("div",Te,[t("div",null,[s[2]||(s[2]=t("label",{class:"text-[10px] text-zinc-600 font-display tracking-wider uppercase"},"Min",-1)),t("input",{type:"number",step:e.type==="float"?.01:1,value:P(e.name,"min",e.min??0),onInput:u=>C(e.name,"min",u.target.value,e.type),class:"w-full px-2 py-1.5 rounded-sm text-xs font-mono text-zinc-200",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)",outline:"none"}},null,40,Ve)]),t("div",null,[s[3]||(s[3]=t("label",{class:"text-[10px] text-zinc-600 font-display tracking-wider uppercase"},"Max",-1)),t("input",{type:"number",step:e.type==="float"?.01:1,value:P(e.name,"max",e.max??1),onInput:u=>C(e.name,"max",u.target.value,e.type),class:"w-full px-2 py-1.5 rounded-sm text-xs font-mono text-zinc-200",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)",outline:"none"}},null,40,Ee)]),t("div",null,[s[4]||(s[4]=t("label",{class:"text-[10px] text-zinc-600 font-display tracking-wider uppercase"},"Step",-1)),t("input",{type:"number",min:e.type==="float"?.01:1,step:e.type==="float"?.01:1,value:P(e.name,"step",e.step??(e.type==="float"?.1:1)),onInput:u=>C(e.name,"step",u.target.value,e.type),class:"w-full px-2 py-1.5 rounded-sm text-xs font-mono text-zinc-200",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)",outline:"none"}},null,40,Be)])]),t("div",Ie,[(a(!0),r(T,null,V(k(e.name,e.type),u=>(a(),r("span",{key:u,class:"inline-block px-2 py-0.5 rounded-sm text-[10px] font-mono text-zinc-300",style:{background:"rgba(255,255,255,0.04)",border:"1px solid var(--border-subtle)"}},v(u),1))),128))])],64)):e.type==="enum"&&!e.locked?(a(),r("div",Ne,[(a(!0),r(T,null,V(e.values||[],u=>(a(),r("label",{key:u,class:"flex items-center gap-2 text-xs text-zinc-400 font-body cursor-pointer"},[t("input",{type:"checkbox",checked:b(e.name,u),onChange:B=>d(e.name,u),class:"accent-lime-400"},null,40,Oe),F(" "+v(u),1)]))),128))])):e.type==="bool"&&!e.locked?(a(),r("span",Re,"Values: true, false")):e.locked?(a(),r("div",De,v(e.lockedValue),1)):A("",!0)])],8,$e))),128))])),z.value>0?(a(),r("div",Le,[t("div",Ke,v(R.value),1)])):A("",!0)]))}},Fe={key:0,class:"card rounded-md overflow-hidden mb-6"},qe={class:"px-5 py-3 flex items-center justify-between",style:{"border-bottom":"1px solid var(--border-subtle)"}},Ge={class:"text-[10px] text-zinc-600 font-body"},He={class:"px-5 py-3 overflow-x-auto"},Je={class:"w-full text-xs results-table"},Qe={style:{"border-bottom":"1px solid var(--border-subtle)"}},We={class:"px-3 py-2 text-xs font-mono text-zinc-300"},Ye={key:0,class:"text-lime-400",title:"Supported"},Xe=["title"],Ze={key:2,class:"text-red-400",title:"Not supported - will be dropped"},et={key:3,class:"text-zinc-600",title:"Passthrough (unknown)"},tt={__name:"CompatibilityMatrix",props:{models:{type:Array,default:()=>[]},enabledParams:{type:Array,default:()=>[]},paramSupport:{type:Object,default:null},registry:{type:Object,default:null}},setup(S){const E=S;function $(n){return{temperature:"Temp",top_p:"Top P",top_k:"Top K",tool_choice:"Tool Choice",repetition_penalty:"Rep Pen",min_p:"Min P",frequency_penalty:"Freq Pen",presence_penalty:"Pres Pen"}[n]||n.replace(/_/g," ")}function _(n,p){var C,b,d;const x=E.paramSupport;if(!x||!x.provider_defaults)return"passthrough";const h=x.provider_defaults[n.rk||n.providerKey];if(!h)return"passthrough";const i=((C=x.model_overrides)==null?void 0:C[n.rk||n.providerKey])||{};for(const[g,k]of Object.entries(i))if(y(n.id,g)){const z=(b=k==null?void 0:k.params)==null?void 0:b[p];if(z)return z.supported===!1?"dropped":"supported"}const P=(d=h.params)==null?void 0:d[p];return P?P.supported===!1?"dropped":P.clamp?"clamped":"supported":(h.skip_params||[]).includes(p)?"dropped":"passthrough"}function w(n,p){var P;const x=E.paramSupport;if(!x||!x.provider_defaults)return"";const h=x.provider_defaults[n.rk||n.providerKey];if(!h)return"";const i=(P=h.params)==null?void 0:P[p];return!i||!i.clamp?"":`min: ${i.clamp.min??"?"}, max: ${i.clamp.max??"?"}`}function y(n,p){return p.split("|").some(x=>new RegExp("^"+x.replace(/[.*+?^${}()|[\]\\]/g,i=>i==="*"?".*":"\\"+i)+"$","i").test(n))}return(n,p)=>S.models.length>0&&S.enabledParams.length>0?(a(),r("div",Fe,[t("div",qe,[p[0]||(p[0]=t("span",{class:"section-label"},"Compatibility Matrix",-1)),t("span",Ge,v(S.models.length)+" models, "+v(S.enabledParams.length)+" params",1)]),t("div",He,[t("table",Je,[t("thead",null,[t("tr",Qe,[p[1]||(p[1]=t("th",{class:"px-3 py-2 text-left section-label"},"Model",-1)),(a(!0),r(T,null,V(S.enabledParams,x=>(a(),r("th",{key:x,class:"px-3 py-2 text-center section-label"},v($(x)),1))),128))])]),t("tbody",null,[(a(!0),r(T,null,V(S.models,x=>(a(),r("tr",{key:x.id},[t("td",We,v(x.shortName),1),(a(!0),r(T,null,V(S.enabledParams,h=>(a(),r("td",{key:h,class:"px-3 py-2 text-center"},[_(x,h)==="supported"?(a(),r("span",Ye,[...p[2]||(p[2]=[t("svg",{class:"w-3.5 h-3.5 inline",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"})],-1)])])):_(x,h)==="clamped"?(a(),r("span",{key:1,class:"text-yellow-400",title:"Clamped: "+w(x,h)},[...p[3]||(p[3]=[t("svg",{class:"w-3.5 h-3.5 inline",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})],-1)])],8,Xe)):_(x,h)==="dropped"?(a(),r("span",Ze,[...p[4]||(p[4]=[t("svg",{class:"w-3.5 h-3.5 inline",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)])])):(a(),r("span",et,[...p[5]||(p[5]=[t("svg",{class:"w-3.5 h-3.5 inline",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01"})],-1)])]))]))),128))]))),128))])]),p[6]||(p[6]=ae('<div class="flex gap-4 mt-3 text-[10px] font-body text-zinc-600"><span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-lime-400 inline-block"></span> Supported</span><span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-yellow-400 inline-block"></span> Clamped</span><span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-red-400 inline-block"></span> Dropped</span><span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-zinc-600 inline-block"></span> Passthrough</span></div>',1))])])):A("",!0)}},st={class:"card rounded-md p-5 mb-6"},ot={class:"flex items-center gap-2"},nt=["value"],at=["disabled"],rt={key:0,class:"mt-3 flex items-center gap-2"},lt={__name:"PresetManager",props:{presets:{type:Array,default:()=>[]},currentSearchSpace:{type:Object,default:()=>({})}},emits:["load","update:presets"],setup(S,{emit:E}){const $=S,_=E,{showToast:w}=oe(),y=j(""),n=j(!1),p=j("");function x(){if(y.value==="")return;const b=parseInt(y.value),d=$.presets[b];d&&(_("load",d.search_space||{}),w(`Preset "${d.name}" loaded`,"success"))}function h(){if(Object.keys($.currentSearchSpace).length===0){w("Enable at least one parameter before saving","error");return}n.value=!0,p.value=""}async function i(){const b=p.value.trim();if(!b){w("Name is required","error");return}const d=[...$.presets],g=d.findIndex(z=>z.name===b),k={name:b,search_space:{...$.currentSearchSpace}};if(g>=0)d[g]=k;else{if(d.length>=20){w("Maximum 20 presets allowed","error");return}d.push(k)}await C(d),_("update:presets",d),n.value=!1,w(`Preset "${b}" saved`,"success")}async function P(){var k;if(y.value==="")return;const b=parseInt(y.value),d=((k=$.presets[b])==null?void 0:k.name)||"Unnamed",g=[...$.presets];g.splice(b,1),await C(g),_("update:presets",g),y.value="",w(`Preset "${d}" deleted`,"success")}async function C(b){try{const d=await X("/api/settings/phase10"),g=d.ok?await d.json():{},k={...g,param_tuner:{...g.param_tuner||{},presets:b}};await X("/api/settings/phase10",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(k)})}catch{w("Failed to save presets","error")}}return(b,d)=>(a(),r("div",st,[d[4]||(d[4]=t("div",{class:"flex items-center justify-between mb-3"},[t("span",{class:"section-label"},"Presets")],-1)),t("div",ot,[G(t("select",{"onUpdate:modelValue":d[0]||(d[0]=g=>y.value=g),class:"text-xs font-mono px-3 py-1.5 rounded-sm flex-1",style:{background:"var(--surface)",border:"1px solid var(--border-subtle)",color:"#E4E4E7",outline:"none"}},[d[3]||(d[3]=t("option",{value:""},"-- Presets --",-1)),(a(!0),r(T,null,V(S.presets,(g,k)=>(a(),r("option",{key:k,value:k},v(g.name||"Unnamed"),9,nt))),128))],512),[[se,y.value]]),t("button",{onClick:x,disabled:y.value==="",class:Y(["text-[10px] font-display tracking-wider uppercase px-3 py-1.5 rounded-sm transition-colors",{"opacity-50 cursor-not-allowed":y.value===""}]),style:{border:"1px solid var(--border-subtle)",color:"var(--zinc-400)"}},"Load",10,at),t("button",{onClick:h,class:"text-[10px] font-display tracking-wider uppercase px-3 py-1.5 rounded-sm transition-colors",style:{border:"1px solid rgba(191,255,0,0.2)",color:"var(--lime)"}},"Save"),y.value!==""?(a(),r("button",{key:0,onClick:P,class:"text-[10px] font-display tracking-wider uppercase px-3 py-1.5 rounded-sm transition-colors",style:{border:"1px solid rgba(255,59,92,0.2)",color:"var(--coral)"}},"Delete")):A("",!0)]),n.value?(a(),r("div",rt,[G(t("input",{"onUpdate:modelValue":d[1]||(d[1]=g=>p.value=g),type:"text",placeholder:"Preset name",class:"text-xs font-mono px-3 py-1.5 rounded-sm flex-1",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)",color:"#E4E4E7",outline:"none"},onKeyup:le(i,["enter"])},null,544),[[re,p.value]]),t("button",{onClick:i,class:"text-[10px] font-display tracking-wider uppercase px-3 py-1.5 rounded-sm",style:{background:"rgba(191,255,0,0.08)",border:"1px solid rgba(191,255,0,0.2)",color:"var(--lime)"}},"Save"),t("button",{onClick:d[2]||(d[2]=g=>n.value=!1),class:"text-[10px] font-display tracking-wider uppercase px-3 py-1.5 rounded-sm",style:{border:"1px solid var(--border-subtle)",color:"var(--zinc-600)"}},"Cancel")])):A("",!0)]))}},it={class:"flex items-center justify-between mb-6"},dt={class:"flex items-center gap-2"},ct={class:"card rounded-md p-5 mb-6"},ut=["value"],pt={class:"card rounded-md p-5 mb-6"},mt={class:"flex items-center justify-between mb-3"},ft={class:"text-xs font-mono text-zinc-600"},yt={key:0,class:"text-xs text-zinc-600 font-body"},xt={key:1,class:"text-xs text-zinc-600 font-body"},vt={key:2,class:"flex flex-col gap-1"},bt=["onClick"],gt={class:"provider-group-count"},ht=["onClick"],kt={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2 pl-4 pb-2"},_t=["onClick"],wt={class:"flex-1 min-w-0"},St={class:"text-xs font-mono text-zinc-200 truncate"},$t={class:"flex items-center justify-between mt-6"},Pt={class:"text-xs text-zinc-600 font-body"},Ct={key:0},zt=["disabled"],Et={__name:"ParamTunerConfig",setup(S){const E=pe(),$=ye(),_=ve(),w=be(),{showToast:y}=oe(),{context:n,setSuite:p,setModels:x}=xe(),h=j(""),i=W(new Set),P=j(!0),C=j([]),b=j({}),d=j(0),g=j([]),k=j([]),z=j(null),R=j(null),O=N(()=>h.value&&i.size>0&&d.value>0&&!_.isRunning),H=N(()=>{const m=[];for(const l of C.value)for(const f of l.models)i.has(f.key)&&m.push({id:f.model_id,shortName:f.display_name||f.model_id.split("/").pop(),rk:f.registryKey||f.provider_key,providerKey:f.provider_key});return m});ie(async()=>{var m,l;if($.suites.length===0)try{await $.loadSuites()}catch{}try{await w.loadConfig(),w.config&&I(w.config)}catch{y("Failed to load model config","error")}finally{P.value=!1}try{await w.loadParamsRegistry(),R.value=w.providerParamsRegistry}catch{}try{const f=await X("/api/settings/phase10");if(f.ok){const c=await f.json();g.value=((m=c.param_tuner)==null?void 0:m.presets)||[],z.value=c.param_support||null}}catch{}n.suiteId&&(h.value=n.suiteId),(l=n.selectedModels)!=null&&l.length&&(n.selectedModels.forEach(f=>i.add(f)),o())}),U(()=>i.size,()=>{o()});function I(m){const l=[],f=m.providers||{};for(const[c,M]of Object.entries(f)){const Q=M.provider_key||c,Z=(M.models||[]).map(L=>({key:`${Q}::${L.model_id}`,model_id:L.model_id,display_name:L.display_name||L.model_id,provider_key:Q}));if(Z.length===0)continue;const ne=de(M.display_name||c);l.push({provider:M.display_name||c,color:ne.text,models:Z,collapsed:!1})}C.value=l}function o(){const m=i.size;if(m===0){k.value=[];return}const l=[{name:"temperature",type:"float",min:0,max:2,step:.1},{name:"top_p",type:"float",min:0,max:1,step:.1},{name:"top_k",type:"int",min:1,max:100,step:10},{name:"tool_choice",type:"enum",values:["auto","required","none"]},{name:"frequency_penalty",type:"float",min:-2,max:2,step:.1},{name:"presence_penalty",type:"float",min:-2,max:2,step:.1},{name:"repetition_penalty",type:"float",min:.5,max:2,step:.1},{name:"min_p",type:"float",min:0,max:1,step:.05}];k.value=l.map(f=>({...f,supportedBy:m,totalModels:m,locked:!1,lockedValue:null,notes:[]}))}function s(m){i.has(m)?i.delete(m):i.add(m),x(Array.from(i))}function e(m){return m.models.every(l=>i.has(l.key))}function u(m){const l=e(m);for(const f of m.models)l?i.delete(f.key):i.add(f.key);x(Array.from(i))}function B(){const m=$.suites.find(l=>l.id===h.value);m&&p(m.id,m.name)}function J(m){b.value={...m}}async function D(){if(!O.value)return;const m=Array.from(i).map(f=>{const c=f.indexOf("::");return{provider_key:f.substring(0,c),model_id:f.substring(c+2)}}),l={suite_id:h.value,models:Array.from(i).map(f=>f.substring(f.indexOf("::")+2)),targets:m,search_space:b.value};n.experimentId&&(l.experiment_id=n.experimentId);try{await _.startTuning(l),y("Param tuning started","success"),E.push({name:"ParamTunerRun"})}catch(f){y(f.message||"Failed to start tuning","error")}}return(m,l)=>{const f=ue("router-link");return a(),r("div",null,[t("div",it,[l[6]||(l[6]=t("div",null,[t("h2",{class:"font-display font-bold text-lg text-zinc-100 mb-1"},"Param Tuner"),t("p",{class:"text-sm text-zinc-600 font-body"},"Grid search across parameter combinations to find optimal tool calling config.")],-1)),t("div",dt,[ee(_).isRunning?(a(),K(f,{key:0,to:{name:"ParamTunerRun"},class:"text-[10px] font-display tracking-wider uppercase px-3 py-1.5 rounded-sm",style:{background:"rgba(191,255,0,0.08)",border:"1px solid rgba(191,255,0,0.2)",color:"var(--lime)"}},{default:te(()=>[...l[4]||(l[4]=[F("View Active Run",-1)])]),_:1})):A("",!0),ce(f,{to:{name:"ParamTunerHistory"},class:"text-[10px] font-display tracking-wider uppercase px-3 py-1.5 rounded-sm",style:{border:"1px solid var(--border-subtle)",color:"var(--zinc-400)"}},{default:te(()=>[...l[5]||(l[5]=[F("History",-1)])]),_:1})])]),t("div",ct,[l[8]||(l[8]=t("label",{class:"section-label mb-2 block"},"Suite",-1)),G(t("select",{"onUpdate:modelValue":l[0]||(l[0]=c=>h.value=c),onChange:B,class:"text-sm font-mono px-3 py-2 rounded-sm w-full",style:{background:"var(--surface)",border:"1px solid var(--border-subtle)",color:"#E4E4E7",outline:"none"}},[l[7]||(l[7]=t("option",{value:""},"-- Select a suite --",-1)),(a(!0),r(T,null,V(ee($).suites,c=>(a(),r("option",{key:c.id,value:c.id},v(c.name)+" ("+v(c.tool_count||0)+" tools, "+v(c.test_case_count||0)+" cases) ",9,ut))),128))],544),[[se,h.value]])]),t("div",pt,[t("div",mt,[l[9]||(l[9]=t("span",{class:"section-label"},"Models",-1)),t("span",ft,v(i.size)+" selected",1)]),P.value?(a(),r("div",yt,"Loading models...")):C.value.length===0?(a(),r("div",xt," No models available. Configure providers in Settings. ")):(a(),r("div",vt,[(a(!0),r(T,null,V(C.value,c=>(a(),r("div",{key:c.provider,class:"provider-group"},[t("div",{class:"provider-group-header",onClick:M=>c.collapsed=!c.collapsed},[t("div",{class:"provider-group-dot",style:q({background:c.color})},null,4),t("span",{class:"provider-group-label",style:q({color:c.color})},v(c.provider),5),t("span",gt,v(c.models.length),1),t("button",{onClick:me(M=>u(c),["stop"]),class:"text-[10px] font-display tracking-wider uppercase text-zinc-600 hover:text-zinc-400 ml-2"},v(e(c)?"None":"All"),9,ht)],8,bt),G(t("div",kt,[(a(!0),r(T,null,V(c.models,M=>(a(),r("div",{key:M.key,class:Y(["model-card rounded-sm px-3 py-2 flex items-center gap-2",{selected:i.has(M.key)}]),onClick:Q=>s(M.key)},[l[10]||(l[10]=t("div",{class:"check-dot"},null,-1)),t("div",wt,[t("div",St,v(M.display_name||M.model_id),1)])],10,_t))),128))],512),[[fe,!c.collapsed]])]))),128))]))]),i.size>0?(a(),K(lt,{key:0,presets:g.value,"current-search-space":b.value,onLoad:J,"onUpdate:presets":l[1]||(l[1]=c=>g.value=c)},null,8,["presets","current-search-space"])):A("",!0),i.size>0?(a(),K(Ue,{key:1,"param-defs":k.value,modelValue:b.value,"onUpdate:modelValue":l[2]||(l[2]=c=>b.value=c),"onUpdate:totalCombos":l[3]||(l[3]=c=>d.value=c)},null,8,["param-defs","modelValue"])):A("",!0),i.size>0&&Object.keys(b.value).length>0?(a(),K(tt,{key:2,models:H.value,"enabled-params":Object.keys(b.value),"param-support":z.value,registry:R.value},null,8,["models","enabled-params","param-support","registry"])):A("",!0),t("div",$t,[t("div",Pt,[d.value>0?(a(),r("span",Ct,v(d.value)+" combos x "+v(i.size)+" model"+v(i.size!==1?"s":"")+" = "+v(d.value*i.size)+" total evaluations",1)):A("",!0)]),t("button",{onClick:D,disabled:!O.value,class:Y(["run-btn px-6 py-2 rounded-sm text-xs flex items-center gap-2",{"opacity-50 cursor-not-allowed":!O.value}])},[...l[11]||(l[11]=[t("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor","stroke-width":"2.5",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1),F(" Start Tuning ",-1)])],10,zt)])])}}};export{Et as default};
