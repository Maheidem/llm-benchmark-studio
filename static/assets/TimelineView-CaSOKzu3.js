import{b as s,c as a,d as o,F as y,A as T,l as h,e as B,t as i,f as d,r as f,B as k,U as S,o as C,s as D,h as j,z as N,y as A,K as I,q as P}from"./index-DkTk070G.js";import{a as U,u as L}from"./useSharedContext-BSH6ZAZw.js";const J={class:"space-y-3"},V={class:"flex items-center gap-2 mb-4"},H=["onClick"],O={key:0,class:"text-xs text-zinc-600 font-body text-center py-8"},M={class:"text-[10px] text-zinc-600 font-display tracking-wider uppercase mb-2"},Y=["onClick"],q=["title"],G={class:"flex-1 min-w-0"},K={class:"flex items-center gap-2"},R={class:"text-xs font-mono text-zinc-300"},Q={key:0,class:"text-[10px] text-zinc-600 font-body truncate"},W={key:1,class:"text-[10px] text-zinc-600 font-body truncate max-w-[200px]"},X={key:2,class:"text-[9px] px-1.5 py-0.5 rounded-sm bg-blue-400/10 text-blue-400 font-display tracking-wider uppercase"},Z={key:3,class:"text-[9px] px-1.5 py-0.5 rounded-sm bg-zinc-600/20 text-zinc-500 font-display tracking-wider uppercase"},ee={class:"text-[10px] text-zinc-600 font-body"},te={class:"text-right"},se={__name:"ExperimentTimeline",props:{entries:{type:Array,default:()=>[]}},emits:["navigate"],setup($){const v=$,p=f(null),w=[{value:"eval",label:"Evals",bg:"rgba(56,189,248,0.1)",border:"rgba(56,189,248,0.3)"},{value:"param_tune",label:"Param Tune",bg:"rgba(129,140,248,0.1)",border:"rgba(129,140,248,0.3)"},{value:"prompt_tune",label:"Prompt Tune",bg:"rgba(168,85,247,0.1)",border:"rgba(168,85,247,0.3)"},{value:"judge",label:"Judge",bg:"rgba(245,158,11,0.1)",border:"rgba(245,158,11,0.3)"}],z=k(()=>p.value?v.entries.filter(t=>t.type===p.value):v.entries),_=k(()=>{const t={};for(const r of z.value){const n=c(r.timestamp);t[n]||(t[n]=[]),t[n].push(r)}return Object.entries(t).map(([r,n])=>({date:r,entries:n}))});function E(t){return{eval:S.tool_eval,param_tune:S.param_tune,prompt_tune:S.prompt_tune,judge:S.judge}[t]||""}function x(t){return{eval:"Eval",param_tune:"Param Tune",prompt_tune:"Prompt Tune",judge:"Judge"}[t]||t}function c(t){if(!t)return"Unknown";const r=new Date(t),n=new Date;if(r.toDateString()===n.toDateString())return"Today";const e=new Date(n);return e.setDate(e.getDate()-1),r.toDateString()===e.toDateString()?"Yesterday":r.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}function b(t){return t?new Date(t).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}):""}function g(t){return t>=80?"var(--lime)":t>=50?"#FBBF24":"var(--coral)"}function F(t){if(!t)return"#71717A";const r=t.charAt(0).toUpperCase();return r==="A"?"var(--lime)":r==="B"?"#60A5FA":r==="C"?"#FBBF24":r==="D"?"#F97316":"var(--coral)"}return(t,r)=>(s(),a("div",J,[o("div",V,[(s(),a(y,null,T(w,n=>o("button",{key:n.value,onClick:e=>p.value=p.value===n.value?null:n.value,class:B(["text-[10px] font-display tracking-wider uppercase px-2.5 py-1 rounded-sm transition-colors",p.value===n.value?"text-zinc-200":"text-zinc-600 hover:text-zinc-400"]),style:h(p.value===n.value?{background:n.bg,border:"1px solid "+n.border}:{border:"1px solid var(--border-subtle)"})},i(n.label),15,H)),64))]),z.value.length===0?(s(),a("div",O," No experiments found ")):d("",!0),(s(!0),a(y,null,T(_.value,n=>(s(),a("div",{key:n.date,class:"mb-4"},[o("div",M,i(n.date),1),(s(!0),a(y,null,T(n.entries,e=>(s(),a("div",{key:e.id,class:"flex items-center gap-3 px-4 py-2.5 rounded-sm mb-1 hover:bg-white/[0.02] cursor-pointer transition-colors",style:{border:"1px solid var(--border-subtle)"},onClick:u=>t.$emit("navigate",e)},[o("span",{class:"text-base",title:x(e.type)},i(E(e.type)),9,q),o("div",G,[o("div",K,[o("span",R,i(x(e.type)),1),e.config_summary?(s(),a("span",Q,i(e.config_summary),1)):d("",!0),e.prompt_preview?(s(),a("span",W,'"'+i(e.prompt_preview)+'"',1)):d("",!0),e.is_baseline?(s(),a("span",X,"baseline")):d("",!0),e.status==="cancelled"?(s(),a("span",Z,"cancelled")):d("",!0)]),o("div",ee,i(b(e.timestamp)),1)]),o("div",te,[e.type==="judge"?(s(),a("span",{key:0,class:"text-sm font-display font-bold",style:h({color:F(e.grade)})},i(e.grade||"?"),5)):e.score!=null?(s(),a(y,{key:1},[o("span",{class:"text-xs font-mono font-bold",style:h({color:g(e.score*100)})},i((e.score*100).toFixed(1))+"% ",5),e.delta!=null?(s(),a("span",{key:0,class:"text-[10px] font-mono block",style:h({color:e.delta>0?"var(--lime)":e.delta<0?"var(--coral)":"#71717A"})},i(e.delta>0?"+":"")+i((e.delta*100).toFixed(1))+"%",5)):d("",!0)],64)):d("",!0)])],8,Y))),128))]))),128))]))}},ae={class:"flex items-center justify-between mb-6"},ne={class:"text-sm text-zinc-600 font-body"},oe={key:0,class:"card rounded-md p-5 mb-6"},re=["value"],ie={key:1,class:"card rounded-md p-4 mb-6 flex items-center gap-4"},le={key:0,class:"ml-auto flex items-center gap-2"},ce={class:"text-xs font-mono font-bold",style:{color:"var(--lime)"}},ue={key:0,class:"text-[10px] text-zinc-600 font-body"},de={key:2,class:"text-xs text-zinc-600 font-body text-center py-8"},pe={key:3,class:"text-xs text-zinc-600 font-body text-center py-8"},me={key:5,class:"text-xs text-zinc-600 font-body text-center py-8"},be={__name:"TimelineView",setup($){const v=P(),p=U(),{context:w}=L(),{showToast:z}=I(),_=f(!1),E=f([]),x=f(""),c=f(null),b=f([]),g=k(()=>w.experimentId),F=k(()=>{var u;return w.experimentName||((u=c.value)==null?void 0:u.experiment_name)||""}),t=k(()=>g.value||x.value);C(async()=>{try{await p.loadExperiments(),E.value=p.experiments}catch{}g.value&&await r()});async function r(){const u=t.value;if(u){_.value=!0;try{const l=await D(`/api/experiments/${u}/timeline`);if(!l.ok)throw new Error("Failed to load timeline");const m=await l.json();c.value=m,b.value=m.entries||[]}catch{z("Failed to load timeline","error"),b.value=[]}finally{_.value=!1}}}function n(u){switch(u.type){case"eval":v.push({name:"ToolEvalEvaluate"});break;case"param_tune":v.push({name:"ParamTunerHistory"});break;case"prompt_tune":v.push({name:"PromptTunerHistory"});break;case"judge":v.push({name:"JudgeHistory"});break}}function e(u){return u>=80?"var(--lime)":u>=50?"#FBBF24":"var(--coral)"}return(u,l)=>(s(),a("div",null,[o("div",ae,[o("div",null,[l[1]||(l[1]=o("h2",{class:"font-display font-bold text-lg text-zinc-100 mb-1"},"Experiment Timeline",-1)),o("p",ne,i(F.value?F.value+" - ":"")+"Chronological view of all runs. ",1)])]),g.value?d("",!0):(s(),a("div",oe,[l[3]||(l[3]=o("label",{class:"section-label mb-2 block"},"Select Experiment",-1)),j(o("select",{"onUpdate:modelValue":l[0]||(l[0]=m=>x.value=m),onChange:r,class:"text-sm font-mono px-3 py-2 rounded-sm w-full",style:{background:"var(--surface)",border:"1px solid var(--border-subtle)",color:"#E4E4E7",outline:"none"}},[l[2]||(l[2]=o("option",{value:""},"-- Select an experiment --",-1)),(s(!0),a(y,null,T(E.value,m=>(s(),a("option",{key:m.id,value:m.id},i(m.name)+" ("+i(m.suite_name||"")+") ",9,re))),128))],544),[[N,x.value]])])),c.value&&c.value.baseline?(s(),a("div",ie,[l[5]||(l[5]=o("div",{class:"text-[10px] text-zinc-600 font-display tracking-wider uppercase"},"Baseline",-1)),o("div",{class:"text-xs font-mono",style:h({color:e((c.value.baseline.score||0)*100)})},i(((c.value.baseline.score||0)*100).toFixed(1))+"% ",5),c.value.best&&c.value.best.score?(s(),a("div",le,[l[4]||(l[4]=o("span",{class:"text-[10px] text-zinc-600 font-display tracking-wider uppercase"},"Best",-1)),o("span",ce,i(((c.value.best.score||0)*100).toFixed(1))+"% ",1),c.value.best.source?(s(),a("span",ue," via "+i(c.value.best.source),1)):d("",!0)])):d("",!0)])):d("",!0),_.value?(s(),a("div",de,"Loading...")):t.value?b.value.length>0?(s(),A(se,{key:4,entries:b.value,onNavigate:n},null,8,["entries"])):(s(),a("div",me," No runs in this experiment yet. ")):(s(),a("div",pe," Select an experiment to view its timeline, or create one from the Evaluate page. "))]))}};export{be as default};
