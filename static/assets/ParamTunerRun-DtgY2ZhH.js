import{p as T,o as j,H as F,c as a,d as e,t as r,y as o,i as C,j as w,f as d,l as p,F as f,x as m,E as B,k as _,g as P,J as N,a as I,r as V,b as i}from"./index-DdRTlIgb.js";import{u as $}from"./paramTuner-WruKFjGx.js";import{_ as E}from"./ParamTunerResults-DoozOnDK.js";import"./useActiveSession-DdoXJmDo.js";const J={class:"flex items-center justify-between mb-6"},A={class:"text-sm text-zinc-600 font-body"},M={class:"flex items-center gap-2"},D={key:0,class:"card rounded-md p-5 mb-6"},q={class:"flex items-center justify-between mb-3"},H={class:"flex items-center gap-3"},L={key:0,class:"pulse-dot"},U={class:"text-sm text-zinc-400 font-body"},W={class:"flex items-center gap-3"},G={key:0,class:"text-[10px] font-mono text-zinc-600"},K={class:"text-xs font-mono text-zinc-600"},O={class:"progress-track rounded-full overflow-hidden"},Q={key:1,class:"card rounded-md p-5 mb-6",style:{"border-left":"3px solid var(--lime)"}},X={class:"flex items-center justify-between mb-2"},Y={class:"text-sm font-mono font-bold",style:{color:"var(--lime)"}},Z={class:"flex flex-wrap gap-2"},ee={class:"text-[10px] text-zinc-600 font-body mt-2"},te={key:3,class:"text-xs text-zinc-600 font-body text-center py-8"},se={key:4,class:"text-xs text-zinc-600 font-body text-center py-8"},oe={class:"card rounded-md p-6 max-w-2xl w-full mx-4",style:{"max-height":"80vh","overflow-y":"auto"}},ne={class:"flex items-center justify-between mb-4"},le={class:"mb-3"},re={class:"text-xs font-mono text-zinc-300"},ie={class:"flex flex-wrap gap-2 mb-4"},ae={key:0,class:"mb-4"},ce={class:"flex flex-wrap gap-2"},de={key:1},ue={class:"w-full text-xs results-table"},pe={class:"px-3 py-1.5 text-xs font-mono text-zinc-500"},xe={class:"px-3 py-1.5 text-xs font-mono text-zinc-500"},ge={__name:"ParamTunerRun",setup(fe){const t=$(),z=T(),{showToast:x}=N(),c=V(null);let b=null;j(()=>{t.restoreJob(),b=z.onMessage(l=>{if(!t.activeJobId||l.job_id&&l.job_id!==t.activeJobId)return;["tune_start","combo_result","tune_complete","job_progress","job_completed","job_failed","job_cancelled"].includes(l.type)&&(t.handleProgress(l),l.type==="tune_complete"&&x("Param tuning complete!","success"),l.type==="job_failed"&&x(l.error||"Tuning failed","error"))}),t.activeRunId&&t.results.length===0&&t.loadRun(t.activeRunId).catch(()=>{})}),F(()=>{b&&b()});async function R(){try{await t.cancelTuning(),x("Cancellation requested","")}catch{x("Failed to cancel","error")}}function S(l){c.value=l}function y(l){return l==null?"-":typeof l=="number"?Number.isInteger(l)?l.toString():l.toFixed(3):String(l)}function g(l){return l>=80?"var(--lime)":l>=50?"#FBBF24":"var(--coral)"}return(l,s)=>{var h,k;const v=I("router-link");return i(),a("div",null,[e("div",J,[e("div",null,[s[3]||(s[3]=e("h2",{class:"font-display font-bold text-lg text-zinc-100 mb-1"},"Param Tuner Run",-1)),e("p",A,r(o(t).isRunning?"Tuning in progress...":"Run complete"),1)]),e("div",M,[C(v,{to:{name:"ParamTunerConfig"},class:"text-[10px] font-display tracking-wider uppercase px-3 py-1.5 rounded-sm",style:{border:"1px solid var(--border-subtle)",color:"var(--zinc-400)"}},{default:w(()=>[...s[4]||(s[4]=[_("Config",-1)])]),_:1}),o(t).isRunning?(i(),a("button",{key:0,onClick:R,class:"text-[10px] font-display font-medium tracking-wider uppercase px-3 py-1 rounded-sm transition-colors",style:{color:"var(--coral)",border:"1px solid rgba(255,59,92,0.3)"}},"Cancel")):d("",!0)])]),o(t).isRunning||o(t).progress.pct>0?(i(),a("div",D,[e("div",q,[e("div",H,[o(t).isRunning?(i(),a("div",L)):d("",!0),e("span",U,r(o(t).progress.detail),1)]),e("div",W,[o(t).progress.eta?(i(),a("span",G,r(o(t).progress.eta),1)):d("",!0),e("span",K,r(o(t).progress.pct)+"%",1)])]),e("div",O,[e("div",{class:"progress-fill",style:p({width:o(t).progress.pct+"%"})},null,4)])])):d("",!0),o(t).bestConfig?(i(),a("div",Q,[e("div",X,[s[5]||(s[5]=e("span",{class:"section-label"},"Best Config",-1)),e("span",Y,r((o(t).bestScore*100).toFixed(1))+"% ",1)]),e("div",Z,[(i(!0),a(f,null,m(o(t).bestConfig.config,(n,u)=>(i(),a("span",{key:u,class:"text-[10px] font-mono px-2 py-1 rounded-sm",style:{background:"rgba(191,255,0,0.06)",border:"1px solid rgba(191,255,0,0.15)",color:"var(--lime)"}},r(u)+": "+r(y(n)),1))),128))]),e("div",ee,r(o(t).bestConfig.model_name||o(t).bestConfig.model_id||"")+" - "+r(o(t).bestConfig.cases_passed||0)+"/"+r(o(t).bestConfig.cases_total||0)+" cases passed ",1)])):d("",!0),o(t).results.length>0?(i(),B(E,{key:2,results:o(t).sortedResults,"best-overall-score":o(t).bestScore,onSort:s[0]||(s[0]=n=>o(t).setSort(n)),onSelect:S},null,8,["results","best-overall-score"])):o(t).isRunning?(i(),a("div",te," Waiting for first combo result... ")):!o(t).isRunning&&o(t).results.length===0?(i(),a("div",se,[s[7]||(s[7]=_(" No active run. ",-1)),C(v,{to:{name:"ParamTunerConfig"},class:"text-lime-400 hover:text-lime-300"},{default:w(()=>[...s[6]||(s[6]=[_("Start a new tune",-1)])]),_:1})])):d("",!0),c.value?(i(),a("div",{key:5,class:"fixed inset-0 z-50 flex items-center justify-center",style:{background:"rgba(0,0,0,0.7)"},onClick:s[2]||(s[2]=P(n=>c.value=null,["self"]))},[e("div",oe,[e("div",ne,[s[8]||(s[8]=e("span",{class:"section-label"},"Combo Detail",-1)),e("button",{onClick:s[1]||(s[1]=n=>c.value=null),class:"text-zinc-500 hover:text-zinc-300",style:{background:"none",border:"none",cursor:"pointer"}},"Close")]),e("div",le,[e("span",re,r(c.value.model_name),1),e("span",{class:"text-xs font-mono ml-2",style:p({color:g(c.value.overall_score*100)})},r((c.value.overall_score*100).toFixed(1))+"% ",5)]),e("div",ie,[(i(!0),a(f,null,m(c.value.config,(n,u)=>(i(),a("span",{key:u,class:"text-[10px] font-mono px-2 py-1 rounded-sm",style:{background:"rgba(255,255,255,0.04)",border:"1px solid var(--border-subtle)"}},r(u)+": "+r(y(n)),1))),128))]),((h=c.value.adjustments)==null?void 0:h.length)>0?(i(),a("div",ae,[s[9]||(s[9]=e("div",{class:"text-[10px] text-zinc-600 font-display tracking-wider uppercase mb-1"},"Adjustments",-1)),e("div",ce,[(i(!0),a(f,null,m(c.value.adjustments,n=>(i(),a("span",{key:n.param,class:"text-[10px] font-mono px-2 py-1 rounded-sm",style:p(n.type==="dropped"?{background:"rgba(255,59,92,0.1)",color:"var(--coral)"}:{background:"rgba(234,179,8,0.1)",color:"#EAB308"})},r(n.param)+": "+r(n.type)+r(n.type==="clamped"?` (${n.original} -> ${n.clamped})`:""),5))),128))])])):d("",!0),((k=c.value.case_results)==null?void 0:k.length)>0?(i(),a("div",de,[s[11]||(s[11]=e("div",{class:"text-[10px] text-zinc-600 font-display tracking-wider uppercase mb-2"},"Per-Case Results",-1)),e("table",ue,[s[10]||(s[10]=e("thead",null,[e("tr",{style:{"border-bottom":"1px solid var(--border-subtle)"}},[e("th",{class:"px-3 py-1.5 text-left section-label"},"Case"),e("th",{class:"px-3 py-1.5 text-left section-label"},"Expected"),e("th",{class:"px-3 py-1.5 text-left section-label"},"Actual"),e("th",{class:"px-3 py-1.5 text-right section-label"},"Score")])],-1)),e("tbody",null,[(i(!0),a(f,null,m(c.value.case_results,(n,u)=>(i(),a("tr",{key:u},[e("td",pe,r(n.test_case_id||u+1),1),e("td",xe,r(n.expected_tool),1),e("td",{class:"px-3 py-1.5 text-xs font-mono",style:p({color:n.tool_selection_score>0?"var(--lime)":"var(--coral)"})},r(n.actual_tool||"(none)"),5),e("td",{class:"px-3 py-1.5 text-right text-xs font-mono",style:p({color:g((n.overall_score||0)*100)})},r(((n.overall_score||0)*100).toFixed(0))+"% ",5)]))),128))])])])):d("",!0)])])):d("",!0)])}}};export{ge as default};
