import{w as ee,b as r,c as d,d as e,f as p,g as D,e as K,h as T,R as te,F,x as M,l as $,t as i,r as y,B as S,L as G,k as z,o as _e,z as be,K as ge,D as H,y as C,v as Q,P as ke,E as Y,i as Z,j as he,J as we,I as $e,a as Ce}from"./index-DdRTlIgb.js";import{a as ze,u as je}from"./useSharedContext-Ck8vzsgc.js";import{u as Se}from"./profiles-z0bYLHRr.js";const Ee={class:"card rounded-md p-5","data-section":"system-prompt"},Ie={class:"flex items-center gap-2"},Fe={key:0,class:"text-[9px] px-1.5 py-0.5 rounded",style:{background:"rgba(34,197,94,0.15)",color:"#22C55E"}},Me={class:"flex items-center gap-2"},Be={key:0,class:"flex flex-wrap gap-1.5 mb-2"},Pe=["onClick"],Te=["value"],Ae={__name:"SystemPromptEditor",props:{models:{type:Array,default:()=>[]},systemPrompts:{type:Object,default:()=>({})}},emits:["update:systemPrompts"],setup(E,{emit:c}){const b=E,f=c,m=y(!1),h=y("_global"),B=S(()=>{const a=[{key:"_global",label:"Default (All)"}];for(const s of b.models){const o=typeof s=="string"?s:s.model_id||s.id||"";if(!o)continue;const g=typeof s=="string"?s.split("/").pop():s.display_name||s.model_id||s.id||"Model";a.push({key:o,label:g})}return a}),I=S(()=>b.systemPrompts[h.value]||""),w=S(()=>b.systemPrompts?Object.values(b.systemPrompts).some(a=>a&&a.trim()):!1);function _(a){const s={...b.systemPrompts,[h.value]:a};f("update:systemPrompts",s)}function x(){f("update:systemPrompts",{}),h.value="_global"}return ee(()=>b.systemPrompts,a=>{a&&Object.values(a).some(s=>s&&s.trim())&&(m.value=!0)},{immediate:!0}),(a,s)=>(r(),d("div",Ee,[e("div",{class:"flex items-center justify-between mb-3 cursor-pointer",onClick:s[0]||(s[0]=o=>m.value=!m.value)},[e("div",Ie,[s[2]||(s[2]=e("span",{class:"section-label",style:{cursor:"pointer"}},"System Prompt",-1)),w.value?(r(),d("span",Fe,"Active")):p("",!0)]),e("div",Me,[w.value?(r(),d("button",{key:0,onClick:D(x,["stop"]),class:"text-[10px] font-display tracking-wider uppercase px-2 py-0.5 rounded-sm",style:{color:"var(--coral)",border:"1px solid rgba(255,59,92,0.2)",background:"none",cursor:"pointer"}},"Clear")):p("",!0),(r(),d("svg",{class:K(["w-4 h-4 text-zinc-600 transition-transform",{"rotate-180":m.value}]),fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[...s[3]||(s[3]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19 9l-7 7-7-7"},null,-1)])],2))])]),T(e("div",null,[E.models.length>1?(r(),d("div",Be,[(r(!0),d(F,null,M(B.value,o=>(r(),d("button",{key:o.key,onClick:g=>h.value=o.key,class:K(["text-[10px] font-display tracking-wider uppercase px-2 py-1 rounded-sm transition-colors",h.value===o.key?"text-zinc-200":"text-zinc-600 hover:text-zinc-400"]),style:$(h.value===o.key?"background:rgba(255,255,255,0.06);border:1px solid var(--border);":"background:transparent;border:1px solid transparent;")},i(o.label),15,Pe))),128))])):p("",!0),e("textarea",{value:I.value,onInput:s[1]||(s[1]=o=>_(o.target.value)),rows:"5",class:"w-full px-3 py-2 rounded-sm text-sm text-zinc-200",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)",outline:"none","font-family":"'Space Mono',monospace","font-size":"12px",resize:"vertical"},placeholder:"Enter a system prompt to prepend to eval calls..."},null,40,Te)],512),[[te,m.value]])]))}},Re={class:"card rounded-md overflow-hidden"},Je={class:"flex items-center justify-between px-5 py-3",style:{"border-bottom":"1px solid var(--border-subtle)"}},Ve={class:"text-xs text-zinc-600 font-body"},Ne={class:"w-full text-sm results-table"},Oe={style:{"border-bottom":"1px solid var(--border-subtle)"}},De={key:0},Le=["onClick"],qe={class:"px-5 py-3 text-sm font-body text-zinc-200"},Ue={key:0,class:"text-[9px] font-display tracking-wider uppercase px-1.5 py-0.5 rounded-sm ml-2 align-middle",style:{color:"#FBBF24",background:"rgba(251,191,36,0.08)",border:"1px solid rgba(251,191,36,0.2)"},title:"Judge analysis available — click to view"},We=["title"],He={class:"px-5 py-3 text-right text-xs font-mono text-zinc-500"},Ke={__name:"EvalResultsTable",props:{results:{type:Array,required:!0}},emits:["showDetail"],setup(E){const c=E,b=y("overall_pct"),f=y(!1);function m(x){b.value===x?f.value=!f.value:(b.value=x,f.value=x==="model_name")}function h(x){return b.value!==x?"":f.value?"▲":"▼"}const B=S(()=>{const x=[...c.results];return x.sort((a,s)=>{const o=a[b.value]??0,g=s[b.value]??0;return typeof o=="string"?f.value?o.localeCompare(g):g.localeCompare(o):f.value?o-g:g-o}),x}),I=S(()=>c.results.some(x=>x.irrelevance_pct!=null)),w=S(()=>{const x=c.results.length;return`${c.results.reduce((s,o)=>s+(o.cases_run||0),0)} evaluations across ${x} model${x>1?"s":""}`});function _(x){return x>=80?"var(--lime)":x>=50?"#FBBF24":"var(--coral)"}return(x,a)=>(r(),d("div",Re,[e("div",Je,[a[5]||(a[5]=e("span",{class:"section-label"},"Summary",-1)),e("span",Ve,i(w.value),1)]),e("table",Ne,[e("thead",null,[e("tr",Oe,[e("th",{class:"px-5 py-3 text-left section-label cursor-pointer",onClick:a[0]||(a[0]=s=>m("model_name"))}," Model "+i(h("model_name")),1),e("th",{class:"px-5 py-3 text-right section-label cursor-pointer",onClick:a[1]||(a[1]=s=>m("tool_accuracy_pct"))}," Tool % "+i(h("tool_accuracy_pct")),1),e("th",{class:"px-5 py-3 text-right section-label cursor-pointer",onClick:a[2]||(a[2]=s=>m("param_accuracy_pct"))}," Param % "+i(h("param_accuracy_pct")),1),e("th",{class:"px-5 py-3 text-right section-label cursor-pointer",onClick:a[3]||(a[3]=s=>m("overall_pct"))}," Overall % "+i(h("overall_pct")),1),I.value?(r(),d("th",{key:0,class:"px-5 py-3 text-right section-label cursor-pointer",onClick:a[4]||(a[4]=s=>m("irrelevance_pct")),title:"Score on cases where model should NOT call any tool"}," Irrel. % "+i(h("irrelevance_pct")),1)):p("",!0),a[6]||(a[6]=e("th",{class:"px-5 py-3 text-right section-label"},"Cases",-1))])]),e("tbody",null,[E.results.length?p("",!0):(r(),d("tr",De,[...a[7]||(a[7]=[e("td",{colspan:"5",class:"px-5 py-8 text-center text-zinc-600 text-sm font-body"}," No results yet. ",-1)])])),(r(!0),d(F,null,M(B.value,s=>(r(),d("tr",{key:s.model_id,class:"cursor-pointer",onClick:o=>x.$emit("showDetail",s.model_id)},[e("td",qe,[e("span",null,i(s.model_name||s.model_id),1),s.judge_grade!=null?(r(),d("span",Ue,"Judge: "+i(s.judge_grade),1)):p("",!0)]),e("td",{class:"px-5 py-3 text-right text-sm font-mono font-bold",style:$({color:_(s.tool_accuracy_pct)})},i((s.tool_accuracy_pct??0).toFixed(1))+"% ",5),e("td",{class:"px-5 py-3 text-right text-sm font-mono font-bold",style:$({color:_(s.param_accuracy_pct??0)})},i(s.param_accuracy_pct!=null?s.param_accuracy_pct.toFixed(1)+"%":"-"),5),e("td",{class:"px-5 py-3 text-right text-sm font-mono font-bold",style:$({color:_(s.overall_pct??0)})},i((s.overall_pct??0).toFixed(1))+"% ",5),I.value?(r(),d("td",{key:0,class:"px-5 py-3 text-right text-sm font-mono font-bold",style:$({color:s.irrelevance_pct!=null?_(s.irrelevance_pct):"#52525B"}),title:s.irrelevance_pct!=null?"Abstention accuracy on irrelevance test cases":"No irrelevance cases"},i(s.irrelevance_pct!=null?s.irrelevance_pct.toFixed(1)+"%":"-"),13,We)):p("",!0),e("td",He,i(s.cases_run||0),1)],8,Le))),128))])])]))}},Ge={class:"modal-box",style:{"max-width":"720px","max-height":"80vh","overflow-y":"auto"}},Xe={class:"flex items-center justify-between mb-4"},Qe={class:"modal-title"},Ye={key:0,class:"text-[10px] text-amber-400 font-body mt-0.5"},Ze={class:"space-y-3"},et={class:"flex items-center gap-2 mb-1"},tt={key:0,class:"text-[9px] font-display tracking-wider uppercase px-1.5 py-0.5 rounded-sm",style:{background:"rgba(56,189,248,0.08)",color:"#38BDF8",border:"1px solid rgba(56,189,248,0.2)"}},st={key:1,class:"text-[10px] text-zinc-700 font-mono ml-auto"},ot={class:"text-sm text-zinc-300 font-body mb-1"},lt={key:0},at={class:"text-[10px] font-mono mt-1"},nt={key:1,class:"grid grid-cols-2 gap-4 text-xs font-mono"},rt={class:"text-zinc-400"},it={key:0,class:"text-zinc-600 mt-0.5 break-all"},dt={key:0,class:"text-zinc-600 mt-0.5 break-all"},ct={class:"flex gap-4 mt-2 text-[10px] font-mono text-zinc-600"},ut={key:0},pt={key:2,class:"mt-2"},vt={class:"text-[10px] font-mono"},mt={style:{color:"var(--lime)"}},xt={class:"text-zinc-600 ml-1"},ft={class:"mt-1 grid grid-cols-4 gap-2 text-[10px] font-mono"},yt={class:"text-zinc-500"},_t={style:{color:"var(--lime)"}},bt={class:"text-zinc-500"},gt={style:{color:"var(--lime)"}},kt={class:"text-zinc-500"},ht={style:{color:"var(--coral)"}},wt={class:"text-zinc-500"},$t={style:{color:"var(--coral)"}},Ct={key:3,class:"mt-2 rounded-sm px-3 py-2",style:{background:"rgba(251,191,36,0.04)",border:"1px solid rgba(251,191,36,0.15)"}},zt={class:"text-[10px] font-body text-zinc-400 leading-relaxed"},jt={key:4,class:"mt-2 text-xs",style:{color:"var(--coral)"}},St={key:5,class:"mt-2"},Et=["onClick"],It={key:0,class:"mt-2 space-y-2",style:{"max-height":"300px","overflow-y":"auto"}},Ft={key:0},Mt={class:"text-[10px] font-mono text-zinc-400 p-2 rounded-sm overflow-x-auto",style:{background:"rgba(0,0,0,0.3)",border:"1px solid var(--border-subtle)","white-space":"pre-wrap","word-break":"break-all"}},Bt={key:1},Pt={class:"text-[10px] font-mono text-zinc-400 p-2 rounded-sm overflow-x-auto",style:{background:"rgba(0,0,0,0.3)",border:"1px solid var(--border-subtle)","white-space":"pre-wrap","word-break":"break-all"}},Tt={class:"flex justify-end mt-4"},At={__name:"ModelDetailModal",props:{visible:{type:Boolean,default:!1},modelId:{type:String,default:""},allResults:{type:Array,default:()=>[]},evalId:{type:String,default:null}},emits:["close"],setup(E){const c=E,b=y({}),f=y({}),m=y(!1),h=S(()=>c.allResults.filter(a=>a.model_id===c.modelId)),B=S(()=>{const a=h.value[0];return(a==null?void 0:a.model_name)||(a==null?void 0:a.model_id)||c.modelId});ee(()=>c.visible,async a=>{if(!a){f.value={};return}if(c.evalId){m.value=!0;try{const s=await G(`/api/tool-eval/${c.evalId}/judge-report`);if(!s.ok)return;const o=await s.json(),g={},A=o.cases||o.case_results||[];for(const j of A)j.model_id===c.modelId&&j.explanation&&(g[j.test_case_id]=j.explanation);f.value=g}catch{}finally{m.value=!1}}},{immediate:!1});function I(a){return a.judge_explanation?a.judge_explanation:a.test_case_id&&f.value[a.test_case_id]?f.value[a.test_case_id]:null}function w(a){return a>=80?"var(--lime)":a>=50?"#FBBF24":"var(--coral)"}function _(a){return a==null?"(no tool call)":Array.isArray(a)?a.join(" | "):a}function x(a){b.value[a]=!b.value[a]}return(a,s)=>E.visible?(r(),d("div",{key:0,class:"modal-overlay",onClick:s[2]||(s[2]=D(o=>a.$emit("close"),["self"]))},[e("div",Ge,[e("div",Xe,[e("div",null,[e("div",Qe,i(B.value),1),m.value?(r(),d("div",Ye,"Loading judge analysis...")):p("",!0)]),e("button",{onClick:s[0]||(s[0]=o=>a.$emit("close")),class:"text-zinc-600 hover:text-zinc-400 text-lg"},"×")]),e("div",Ze,[(r(!0),d(F,null,M(h.value,(o,g)=>{var A;return r(),d("div",{key:o.test_case_id||g,class:"rounded-sm p-3",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)"}},[e("div",et,[e("span",{style:$({color:o.tool_selection_score===1?"var(--lime)":"var(--coral)"}),class:"text-xs font-mono font-bold"},i(o.tool_selection_score===1?"OK":"X"),5),e("span",{class:"text-xs font-mono font-bold",style:$({color:w(o.overall_score*100)})},i((o.overall_score*100).toFixed(0))+"% ",5),o.should_call_tool===!1?(r(),d("span",tt,"Irrelevance")):p("",!0),o.latency_ms?(r(),d("span",st,i(o.latency_ms)+"ms",1)):p("",!0)]),e("div",ot,'"'+i(o.prompt||"")+'"',1),o.should_call_tool===!1?(r(),d("div",lt,[e("div",at,[s[3]||(s[3]=e("span",{class:"text-zinc-600"},"Expected: ",-1)),s[4]||(s[4]=e("span",{style:{color:"#38BDF8"}},"abstain (no tool call)",-1)),s[5]||(s[5]=e("span",{class:"ml-4 text-zinc-600"},"Actual: ",-1)),e("span",{style:$({color:o.tool_selection_score===1?"var(--lime)":"var(--coral)"})},i(o.actual_tool?o.actual_tool:"no tool call"),5)]),e("div",{class:"text-[10px] font-mono mt-1",style:$({color:o.tool_selection_score===1?"var(--lime)":"var(--coral)"})},i(o.tool_selection_score===1?"Correctly abstained":"Should not have called a tool"),5)])):(r(),d("div",nt,[e("div",null,[s[6]||(s[6]=e("div",{class:"text-[10px] font-display tracking-wider text-zinc-500 uppercase mb-0.5"},"Expected",-1)),e("div",rt,i(_(o.expected_tool)),1),o.expected_params?(r(),d("div",it,i(JSON.stringify(o.expected_params)),1)):p("",!0)]),e("div",null,[s[7]||(s[7]=e("div",{class:"text-[10px] font-display tracking-wider text-zinc-500 uppercase mb-0.5"},"Actual",-1)),e("div",{style:$({color:o.tool_selection_score>0?"var(--lime)":"var(--coral)"})},i(o.actual_tool||"(no tool call)"),5),o.actual_params?(r(),d("div",dt,i(JSON.stringify(o.actual_params)),1)):p("",!0)])])),e("div",ct,[e("span",null,[s[8]||(s[8]=z("Tool: ",-1)),e("span",{style:$({color:w(o.tool_selection_score*100)})},i((o.tool_selection_score*100).toFixed(0))+"%",5)]),o.param_accuracy!=null?(r(),d("span",ut,[s[9]||(s[9]=z("Param: ",-1)),e("span",{style:$({color:w(o.param_accuracy*100)})},i((o.param_accuracy*100).toFixed(0))+"%",5)])):p("",!0)]),o.multi_turn&&((A=o.tool_chain)!=null&&A.length)?(r(),d("div",pt,[e("div",vt,[s[10]||(s[10]=e("span",{class:"text-zinc-600"},"Chain:",-1)),e("span",mt,i(o.tool_chain.map(j=>j.tool_name).join(" → ")),1),e("span",xt,"("+i(o.rounds_used||o.tool_chain.length)+" round"+i((o.rounds_used||o.tool_chain.length)>1?"s":"")+")",1)]),e("div",ft,[e("span",yt,[s[11]||(s[11]=z("Completion: ",-1)),e("span",_t,i(((o.completion_score||0)*100).toFixed(0))+"%",1)]),e("span",bt,[s[12]||(s[12]=z("Efficiency: ",-1)),e("span",gt,i(((o.efficiency_score||0)*100).toFixed(0))+"%",1)]),e("span",kt,[s[13]||(s[13]=z("Redundancy: ",-1)),e("span",ht,"-"+i(((o.redundancy_penalty||0)*100).toFixed(0))+"%",1)]),e("span",wt,[s[14]||(s[14]=z("Detour: ",-1)),e("span",$t,"-"+i(((o.detour_penalty||0)*100).toFixed(0))+"%",1)])])])):p("",!0),I(o)?(r(),d("div",Ct,[s[15]||(s[15]=e("div",{class:"text-[10px] font-display tracking-wider uppercase text-yellow-500 mb-1"},"Judge Analysis",-1)),e("div",zt,i(I(o)),1)])):p("",!0),o.error?(r(),d("div",jt,i(o.error),1)):p("",!0),o.raw_request||o.raw_response?(r(),d("div",St,[e("button",{onClick:j=>x(g),class:"text-[10px] font-display tracking-wider uppercase px-2 py-0.5 rounded-sm",style:{color:"var(--lime)",border:"1px solid rgba(191,255,0,0.15)"}},i(b.value[g]?"HIDE RAW":"VIEW RAW"),9,Et),b.value[g]?(r(),d("div",It,[o.raw_request?(r(),d("div",Ft,[s[16]||(s[16]=e("div",{class:"text-[10px] font-display tracking-wider text-zinc-500 uppercase mb-1"},"Request",-1)),e("pre",Mt,i(JSON.stringify(o.raw_request,null,2)),1)])):p("",!0),o.raw_response?(r(),d("div",Bt,[s[17]||(s[17]=e("div",{class:"text-[10px] font-display tracking-wider text-zinc-500 uppercase mb-1"},"Response",-1)),e("pre",Pt,i(JSON.stringify(o.raw_response,null,2)),1)])):p("",!0)])):p("",!0)])):p("",!0)])}),128))]),e("div",Tt,[e("button",{onClick:s[1]||(s[1]=o=>a.$emit("close")),class:"modal-btn modal-btn-cancel"},"Close")])])])):p("",!0)}},Rt={class:"card rounded-md p-5 mb-6"},Jt=["value"],Vt={class:"card rounded-md p-5 mb-6"},Nt={class:"flex items-center justify-between mb-3"},Ot={class:"text-xs font-mono text-zinc-600"},Dt={key:0,class:"text-xs text-zinc-600 font-body"},Lt={key:1,class:"text-xs text-zinc-600 font-body"},qt={key:2,class:"flex flex-col gap-1"},Ut=["onClick"],Wt={class:"provider-group-count"},Ht=["onClick"],Kt={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2 pl-4 pb-2"},Gt=["onClick"],Xt={class:"flex-1 min-w-0"},Qt={class:"text-xs font-mono text-zinc-200 truncate"},Yt={key:0,class:"card rounded-md p-5 mb-6"},Zt={class:"flex flex-col gap-2"},es=["title"],ts=["onUpdate:modelValue"],ss=["value"],os={class:"card rounded-md p-5 mb-6"},ls={class:"flex items-center gap-4 flex-wrap"},as={class:"flex items-center gap-2 cursor-pointer",title:"Automatically run judge analysis after eval completes"},ns={key:0,class:"flex items-center gap-2",title:"Trigger judge when a model's overall score falls below this threshold"},rs={class:"text-[10px] font-mono text-amber-400 w-8"},is={class:"ml-auto flex gap-2"},ds=["disabled"],cs={key:0,class:"w-3.5 h-3.5 animate-spin",fill:"none",viewBox:"0 0 24 24"},us={key:1,class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor","stroke-width":"2.5",viewBox:"0 0 24 24"},ps={key:1,class:"mb-6 px-4 py-3 rounded-sm flex items-start gap-3",style:{background:"rgba(251,191,36,0.06)",border:"1px solid rgba(251,191,36,0.25)"}},vs={class:"text-xs text-zinc-400 font-body mt-0.5"},ms={key:3,class:"mb-6 fade-in"},xs={class:"card rounded-md p-5"},fs={class:"flex items-center justify-between mb-3"},ys={class:"flex items-center gap-3"},_s={class:"text-sm text-zinc-400 font-body"},bs={class:"text-xs font-mono text-zinc-600"},gs={class:"progress-track rounded-full overflow-hidden"},ks={key:0,class:"error-banner mt-3"},hs={key:4,class:"card rounded-md overflow-hidden mb-6"},ws={style:{"max-height":"400px","overflow-y":"auto"}},$s={class:"w-full text-sm results-table"},Cs={class:"px-5 py-2 text-xs font-mono text-zinc-300"},zs={class:"px-5 py-2 text-xs font-body text-zinc-400"},js={key:0,class:"text-[9px] font-display tracking-wider uppercase px-1 py-0.5 rounded-sm ml-1 align-middle",style:{color:"#38BDF8",background:"rgba(56,189,248,0.08)",border:"1px solid rgba(56,189,248,0.15)"}},Ss={class:"px-5 py-2 text-xs font-mono text-zinc-500"},Es=["title"],Is={key:6,class:"mt-4 px-4 py-3 rounded-sm flex items-center justify-between",style:{background:"rgba(251,191,36,0.06)",border:"1px solid rgba(251,191,36,0.25)"}},Ps={__name:"EvaluateView",setup(E){const c=ze(),b=Se(),{showToast:f}=we(),{context:m,setSuite:h,setModels:B,setConfig:I}=je(),w=y(""),_=y(new Set),x=y(0),a=y("required"),s=y(!1),o=y(80),g=y({}),A=y(!0),j=y([]),P=y("Initializing..."),J=y("0/0"),R=y(0),V=y(""),L=y(!1),X=y(""),q=y(!1),U=y({}),W=S(()=>Array.from(_.value).filter(n=>n&&n.includes("::")).map(n=>{const t=n.indexOf("::"),v=n.substring(t+2);return{id:n,model_id:v,display_name:v.split("/").pop()||v}}));_e(async()=>{var t;if(c.suites.length===0)try{await c.loadSuites()}catch{}try{const v=await G("/api/config");if(v.ok){const l=await v.json();se(l)}}catch{f("Failed to load model config","error")}finally{A.value=!1}m.suiteId&&(w.value=m.suiteId),(t=m.selectedModels)!=null&&t.length&&(_.value=new Set(m.selectedModels)),m.temperature!=null&&(x.value=m.temperature),m.toolChoice&&(a.value=m.toolChoice),m.systemPrompts&&(g.value={...m.systemPrompts});try{await b.fetchProfiles()}catch{}try{const v=await G("/api/settings/judge");if(v.ok){const l=await v.json();s.value=!!l.auto_judge_after_eval}}catch{}const n=sessionStorage.getItem("_teJobId");n&&(c.activeJobId=n,c.isEvaluating=!0),ie()});function se(n){const t=[],v=n.providers||{};for(const[l,u]of Object.entries(v)){const k=u.provider_key||l,N=(u.models||[]).map(O=>({key:`${k}::${O.model_id}`,model_id:O.model_id,display_name:O.display_name||O.model_id,provider_key:k}));if(N.length===0)continue;const ye=be(u.display_name||l);t.push({provider:u.display_name||l,color:ye.text,models:N,collapsed:!1})}j.value=t}function oe(n){const t=new Set(_.value);t.has(n)?t.delete(n):t.add(n),_.value=t,B(Array.from(t))}function le(n){return n.models.every(t=>_.value.has(t.key))}function ae(n){const t=new Set(_.value),v=n.models.every(l=>t.has(l.key));for(const l of n.models)v?t.delete(l.key):t.add(l.key);_.value=t,B(Array.from(t))}async function ne(){const n=c.suites.find(t=>t.id===w.value);if(n){h(n.id,n.name);try{await c.loadSuite(w.value)}catch{}}}const re=S(()=>{var t;if(a.value!=="required")return!1;const n=(t=c.currentSuite)==null?void 0:t.test_cases;return n?n.some(v=>v.should_call_tool===!1):!1});function ie(){const n=ge();if(!n)return;const v=`${location.protocol==="https:"?"wss:":"ws:"}//${location.host}/ws?token=${n}`,{connect:l}=$e(v,{onMessage:de});l()}function de(n){if(n.type==="judge_complete"){q.value=!0,f("Judge report ready — view in Judge History","success");return}if(c.activeJobId&&n.job_id===c.activeJobId)switch(c.handleEvalProgress(n),n.type){case"tool_eval_init":{const t=n.data||n;P.value=`Evaluating ${t.suite_name||""}...`,J.value=`0/${c.evalTotalCases}`;break}case"tool_eval_progress":{const t=n.data||n,v=t.total>0?Math.round(t.current/t.total*100):0;if(R.value=v,J.value=`${t.current}/${t.total}`,P.value=`Testing ${t.model||""}...`,c.evalStartTime&&v>0&&v<100){const u=(Date.now()-c.evalStartTime)/1e3/v*(100-v),k=u>60?Math.ceil(u/60)+"m left":Math.ceil(u)+"s left";P.value+=" — "+k}break}case"tool_eval_result":{c.evalTotalCases>0&&(R.value=Math.round(c.evalResults.length/c.evalTotalCases*100),J.value=`${c.evalResults.length}/${c.evalTotalCases}`);break}case"tool_eval_complete":P.value="Complete!",R.value=100,f("Eval complete!","success");break;case"job_completed":P.value="Complete!",R.value=100;break;case"job_failed":V.value=n.error||n.error_msg||"Eval failed";break;case"job_cancelled":P.value="Cancelled",f("Eval cancelled","");break}}async function ce(){if(_.value.size===0){f("Select at least one model","error");return}if(!w.value){f("No suite selected","error");return}c.resetEval(),P.value="Initializing...",R.value=0,J.value="0/0",V.value="",q.value=!1;const n=Array.from(_.value).map(u=>{const k=u.indexOf("::");return{provider_key:u.substring(0,k),model_id:u.substring(k+2)}}),t={suite_id:w.value,targets:n,temperature:x.value,tool_choice:a.value,auto_judge:s.value,auto_judge_threshold:s.value?o.value/100:null},v={};for(const[u,k]of Object.entries(g.value))k&&k.trim()&&(v[u]=k);Object.keys(v).length>0&&(t.system_prompt=v);const l={};for(const[u,k]of Object.entries(U.value))k&&(l[u]=k);Object.keys(l).length>0&&(t.profiles=l),m.experimentId&&(t.experiment_id=m.experimentId),I({temperature:x.value,toolChoice:a.value,systemPrompts:v,lastUpdatedBy:null});try{await c.runEval(t),f("Eval submitted","success")}catch(u){f(u.message||"Failed to start eval","error"),c.isEvaluating=!1}}async function ue(){try{await c.cancelEval(),f("Cancellation requested","")}catch{f("Failed to cancel","error")}}function pe(n,t){return n?n.length>t?n.slice(0,t)+"...":n:""}function ve(n){return n==null?"(none)":Array.isArray(n)?n.join(" | "):typeof n=="object"?JSON.stringify(n):n}function me(n){return n>=80?"var(--lime)":n>=50?"#FBBF24":"var(--coral)"}function xe(n){return n.should_call_tool===!1?n.actual_tool?"var(--coral)":"var(--lime)":n.tool_selection_score>0?"var(--lime)":"var(--coral)"}function fe(n){X.value=n,L.value=!0}return(n,t)=>{const v=Ce("router-link");return r(),d("div",null,[t[33]||(t[33]=e("div",{class:"flex items-center justify-between mb-6"},[e("div",null,[e("h2",{class:"font-display font-bold text-lg text-zinc-100 mb-1"},"Evaluate"),e("p",{class:"text-sm text-zinc-600 font-body"},"Select models, configure settings, and run tool calling evaluations.")])],-1)),e("div",Rt,[t[9]||(t[9]=e("label",{class:"section-label mb-2 block"},"Suite",-1)),T(e("select",{"onUpdate:modelValue":t[0]||(t[0]=l=>w.value=l),onChange:ne,class:"text-sm font-mono px-3 py-2 rounded-sm w-full",style:{background:"var(--surface)",border:"1px solid var(--border-subtle)",color:"#E4E4E7",outline:"none"}},[t[8]||(t[8]=e("option",{value:""},"-- Select a suite --",-1)),(r(!0),d(F,null,M(C(c).suites,l=>(r(),d("option",{key:l.id,value:l.id},i(l.name)+" ("+i(l.tool_count||0)+" tools, "+i(l.test_case_count||0)+" cases) ",9,Jt))),128))],544),[[H,w.value]])]),e("div",Vt,[e("div",Nt,[t[10]||(t[10]=e("span",{class:"section-label"},"Models",-1)),e("span",Ot,i(_.value.size)+" selected",1)]),A.value?(r(),d("div",Dt,"Loading models...")):j.value.length===0?(r(),d("div",Lt," No models available. Configure providers in Settings. ")):(r(),d("div",qt,[(r(!0),d(F,null,M(j.value,l=>(r(),d("div",{key:l.provider,class:"provider-group"},[e("div",{class:"provider-group-header",onClick:u=>l.collapsed=!l.collapsed},[e("div",{class:"provider-group-dot",style:$({background:l.color})},null,4),e("span",{class:"provider-group-label",style:$({color:l.color})},i(l.provider),5),e("span",Wt,i(l.models.length),1),e("button",{onClick:D(u=>ae(l),["stop"]),class:"text-[10px] font-display tracking-wider uppercase text-zinc-600 hover:text-zinc-400 ml-2"},i(le(l)?"None":"All"),9,Ht)],8,Ut),T(e("div",Kt,[(r(!0),d(F,null,M(l.models,u=>(r(),d("div",{key:u.key,class:K(["model-card rounded-sm px-3 py-2 flex items-center gap-2",{selected:_.value.has(u.key)}]),onClick:D(k=>oe(u.key),["stop"])},[t[11]||(t[11]=e("div",{class:"check-dot"},null,-1)),e("div",Xt,[e("div",Qt,i(u.display_name||u.model_id),1)])],10,Gt))),128))],512),[[te,!l.collapsed]])]))),128))]))]),W.value.length>0&&C(b).profiles.length>0?(r(),d("div",Yt,[t[13]||(t[13]=e("span",{class:"section-label block mb-3"},"Profiles (optional)",-1)),e("div",Zt,[(r(!0),d(F,null,M(W.value,l=>(r(),d("div",{key:l.id,class:"flex items-center gap-3"},[e("span",{class:"text-xs font-mono text-zinc-400 w-40 truncate",title:l.model_id},i(l.display_name),9,es),T(e("select",{"onUpdate:modelValue":u=>U.value[l.model_id]=u,class:"text-xs font-mono px-2 py-1 rounded-sm flex-1",style:{background:"var(--surface)",border:"1px solid var(--border-subtle)",color:"var(--zinc-200)",outline:"none"}},[t[12]||(t[12]=e("option",{value:""},"No Profile",-1)),(r(!0),d(F,null,M(C(b).profilesByModel[l.model_id]||[],u=>(r(),d("option",{key:u.id,value:u.id},i(u.name)+i(u.is_default?" (default)":""),9,ss))),128))],8,ts),[[H,U.value[l.model_id]]])]))),128))])])):p("",!0),e("div",os,[t[21]||(t[21]=e("div",{class:"flex items-center justify-between mb-4"},[e("span",{class:"section-label"},"Eval Settings")],-1)),e("div",ls,[e("div",null,[t[14]||(t[14]=e("span",{class:"text-zinc-500 font-body text-xs"},"Temperature",-1)),T(e("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>x.value=l),type:"number",min:"0",max:"2",step:"0.1",class:"ml-2 w-16 px-2 py-1 rounded-sm text-sm font-mono text-zinc-200 text-center",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)",outline:"none"}},null,512),[[Q,x.value,void 0,{number:!0}]])]),e("div",null,[t[16]||(t[16]=e("label",{class:"text-xs font-display tracking-wider text-zinc-500 uppercase"},"Tool Choice",-1)),T(e("select",{"onUpdate:modelValue":t[2]||(t[2]=l=>a.value=l),class:"text-xs font-mono px-3 py-1.5 rounded-sm ml-2",style:{background:"var(--surface)",border:"1px solid var(--border-subtle)",color:"var(--zinc-200)",width:"120px"}},[...t[15]||(t[15]=[e("option",{value:"required"},"Required",-1),e("option",{value:"auto"},"Auto",-1),e("option",{value:"none"},"None",-1)])],512),[[H,a.value]])]),e("label",as,[T(e("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=l=>s.value=l),class:"accent-amber-400"},null,512),[[ke,s.value]]),t[17]||(t[17]=e("span",{class:"text-xs font-body text-zinc-400"},"Auto-run Judge",-1))]),s.value?(r(),d("div",ns,[t[18]||(t[18]=e("span",{class:"text-[10px] text-zinc-600 font-body"},"on score <",-1)),T(e("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>o.value=l),type:"range",min:"0",max:"100",step:"5",class:"w-20 accent-amber-400"},null,512),[[Q,o.value,void 0,{number:!0}]]),e("span",rs,i(o.value)+"%",1)])):p("",!0),e("div",is,[C(c).isEvaluating?(r(),d("button",{key:0,onClick:ue,class:"text-[11px] font-display font-medium tracking-wider uppercase px-3 py-1 rounded-sm transition-colors",style:{color:"var(--coral)",border:"1px solid rgba(255,59,92,0.3)"}},"Cancel")):p("",!0),e("button",{onClick:ce,disabled:C(c).isEvaluating||_.value.size===0||!w.value,class:"run-btn px-6 py-2 rounded-sm text-xs flex items-center gap-2"},[C(c).isEvaluating?(r(),d("svg",cs,[...t[19]||(t[19]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"},null,-1)])])):(r(),d("svg",us,[...t[20]||(t[20]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M13 10V3L4 14h7v7l9-11h-7z"},null,-1)])])),z(" "+i(C(c).isEvaluating?"Running...":"Start Eval"),1)],8,ds)])])]),re.value?(r(),d("div",ps,[t[27]||(t[27]=e("svg",{class:"w-4 h-4 flex-shrink-0 mt-0.5",fill:"none",stroke:"#FBBF24","stroke-width":"2",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 9v2m0 4h.01M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"})],-1)),e("div",null,[t[26]||(t[26]=e("span",{class:"text-xs font-display tracking-wider uppercase text-amber-400"},"Warning",-1)),e("p",vs,[t[22]||(t[22]=z(" This suite contains irrelevance test cases but ",-1)),t[23]||(t[23]=e("strong",{class:"text-zinc-200"},'Tool Choice is set to "Required"',-1)),t[24]||(t[24]=z(". The model will be forced to call a tool, making all irrelevance cases fail artificially. Switch Tool Choice to ",-1)),e("button",{onClick:t[5]||(t[5]=l=>a.value="auto"),class:"text-amber-400 underline hover:text-amber-300 font-mono"},'"auto"'),t[25]||(t[25]=z(" to test abstention correctly. ",-1))])])])):p("",!0),_.value.size>0?(r(),Y(Ae,{key:2,models:W.value,"system-prompts":g.value,"onUpdate:systemPrompts":t[6]||(t[6]=l=>g.value=l)},null,8,["models","system-prompts"])):p("",!0),C(c).isEvaluating?(r(),d("div",ms,[e("div",xs,[e("div",fs,[e("div",ys,[t[28]||(t[28]=e("div",{class:"pulse-dot"},null,-1)),e("span",_s,i(P.value),1)]),e("span",bs,i(J.value),1)]),e("div",gs,[e("div",{class:"progress-fill",style:$({width:R.value+"%"})},null,4)])]),V.value?(r(),d("div",ks,[e("span",null,i(V.value),1)])):p("",!0)])):p("",!0),C(c).evalResults.length>0?(r(),d("div",hs,[t[30]||(t[30]=e("div",{class:"px-5 py-3",style:{"border-bottom":"1px solid var(--border-subtle)"}},[e("span",{class:"section-label"},"Live Results")],-1)),e("div",ws,[e("table",$s,[t[29]||(t[29]=e("thead",null,[e("tr",{style:{"border-bottom":"1px solid var(--border-subtle)"}},[e("th",{class:"px-5 py-2 text-left section-label"},"Model"),e("th",{class:"px-5 py-2 text-left section-label"},"Prompt"),e("th",{class:"px-5 py-2 text-left section-label"},"Expected"),e("th",{class:"px-5 py-2 text-left section-label"},"Actual"),e("th",{class:"px-5 py-2 text-right section-label"},"Hops"),e("th",{class:"px-5 py-2 text-right section-label"},"Score")])],-1)),e("tbody",null,[(r(!0),d(F,null,M(C(c).evalResults,(l,u)=>{var k;return r(),d("tr",{key:u},[e("td",Cs,i(l.model_name||l.model_id||""),1),e("td",zs,[z(i(pe(l.prompt||l.test_case_id||"",40))+" ",1),l.should_call_tool===!1?(r(),d("span",js,"IRREL")):p("",!0)]),e("td",Ss,i(l.should_call_tool===!1?"(abstain)":ve(l.expected_tool)),1),e("td",{class:"px-5 py-2 text-xs font-mono",style:$({color:xe(l)})},i(l.actual_tool||"(none)"),5),e("td",{class:"px-5 py-2 text-right text-xs font-mono text-zinc-500",title:l.tool_chain?l.tool_chain.map(N=>N.tool_name).join(" → "):""},i(l.multi_turn?((k=l.tool_chain)==null?void 0:k.length)||1:""),9,Es),e("td",{class:"px-5 py-2 text-right text-xs font-mono font-bold",style:$({color:me(l.overall_score*100)})},i((l.overall_score*100).toFixed(0))+"% ",5)])}),128))])])])])):p("",!0),C(c).evalSummaries.length>0?(r(),Y(Ke,{key:5,results:C(c).evalSummaries,onShowDetail:fe},null,8,["results"])):p("",!0),q.value?(r(),d("div",Is,[t[32]||(t[32]=e("div",{class:"flex items-center gap-2"},[e("svg",{class:"w-4 h-4 flex-shrink-0",fill:"none",stroke:"#FBBF24","stroke-width":"2",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})]),e("span",{class:"text-xs text-zinc-400 font-body"},"Judge analysis complete")],-1)),Z(v,{to:{name:"JudgeHistory"},class:"text-[10px] font-display tracking-wider uppercase px-3 py-1 rounded-sm",style:{color:"#FBBF24",background:"rgba(251,191,36,0.08)",border:"1px solid rgba(251,191,36,0.2)"}},{default:he(()=>[...t[31]||(t[31]=[z("View Report →",-1)])]),_:1})])):p("",!0),Z(At,{visible:L.value,"model-id":X.value,"all-results":C(c).evalResults,"eval-id":C(c).lastEvalId,onClose:t[7]||(t[7]=l=>L.value=!1)},null,8,["visible","model-id","all-results","eval-id"])])}}};export{Ps as default};
