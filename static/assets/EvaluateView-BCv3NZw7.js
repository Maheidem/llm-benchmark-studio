import{w as ee,b as o,c as s,d as e,f as v,g as W,e as D,h as N,R as te,F as B,A as I,l as C,t as r,r as g,B as M,z as q,s as G,k as O,o as _e,D as be,L as ge,x as F,v as X,P as ke,y as Q,i as Y,j as he,K as we,J as $e,a as Ce}from"./index-BqpQFpv6.js";import{a as ze,u as Se}from"./useSharedContext-BnDn8Z30.js";import{u as je}from"./profiles-DZkAa5Kq.js";const Ae={class:"card rounded-md p-5","data-section":"system-prompt"},Ee={class:"flex items-center gap-2"},Fe={key:0,class:"text-[9px] px-1.5 py-0.5 rounded",style:{background:"rgba(34,197,94,0.15)",color:"#22C55E"}},Be={class:"flex items-center gap-2"},Ie={key:0,class:"flex flex-wrap gap-1.5 mb-2"},Me=["onClick"],Pe=["value"],Te={__name:"SystemPromptEditor",props:{models:{type:Array,default:()=>[]},systemPrompts:{type:Object,default:()=>({})}},emits:["update:systemPrompts"],setup(J,{emit:u}){const w=J,k=u,h=g(!1),j=g("_global"),P=M(()=>{const _=[{key:"_global",label:"Default (All)"}];for(const x of w.models){const S=typeof x=="string"?x:x.model_id||x.id||"";if(!S)continue;const d=typeof x=="string"?x.split("/").pop():x.display_name||x.model_id||x.id||"Model";_.push({key:S,label:d})}return _}),T=M(()=>w.systemPrompts[j.value]||""),E=M(()=>w.systemPrompts?Object.values(w.systemPrompts).some(_=>_&&_.trim()):!1);function z(_){const x={...w.systemPrompts,[j.value]:_};k("update:systemPrompts",x)}function R(){k("update:systemPrompts",{}),j.value="_global"}return ee(()=>w.systemPrompts,_=>{_&&Object.values(_).some(x=>x&&x.trim())&&(h.value=!0)},{immediate:!0}),(_,x)=>(o(),s("div",Ae,[e("div",{class:"flex items-center justify-between mb-3 cursor-pointer",onClick:x[0]||(x[0]=S=>h.value=!h.value)},[e("div",Ee,[x[2]||(x[2]=e("span",{class:"section-label",style:{cursor:"pointer"}},"System Prompt",-1)),E.value?(o(),s("span",Fe,"Active")):v("",!0)]),e("div",Be,[E.value?(o(),s("button",{key:0,onClick:W(R,["stop"]),class:"text-[10px] font-display tracking-wider uppercase px-2 py-0.5 rounded-sm",style:{color:"var(--coral)",border:"1px solid rgba(255,59,92,0.2)",background:"none",cursor:"pointer"}},"Clear")):v("",!0),(o(),s("svg",{class:D(["w-4 h-4 text-zinc-600 transition-transform",{"rotate-180":h.value}]),fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[...x[3]||(x[3]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19 9l-7 7-7-7"},null,-1)])],2))])]),N(e("div",null,[J.models.length>1?(o(),s("div",Ie,[(o(!0),s(B,null,I(P.value,S=>(o(),s("button",{key:S.key,onClick:d=>j.value=S.key,class:D(["text-[10px] font-display tracking-wider uppercase px-2 py-1 rounded-sm transition-colors",j.value===S.key?"text-zinc-200":"text-zinc-600 hover:text-zinc-400"]),style:C(j.value===S.key?"background:rgba(255,255,255,0.06);border:1px solid var(--border);":"background:transparent;border:1px solid transparent;")},r(S.label),15,Me))),128))])):v("",!0),e("textarea",{value:T.value,onInput:x[1]||(x[1]=S=>z(S.target.value)),rows:"5",class:"w-full px-3 py-2 rounded-sm text-sm text-zinc-200",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)",outline:"none","font-family":"'Space Mono',monospace","font-size":"12px",resize:"vertical"},placeholder:"Enter a system prompt to prepend to eval calls..."},null,40,Pe)],512),[[te,h.value]])]))}},Re={class:"card rounded-md overflow-hidden"},Oe={class:"flex items-center justify-between px-5 py-3",style:{"border-bottom":"1px solid var(--border-subtle)"}},Je={class:"flex items-center gap-3"},Ne=["value"],Ve={class:"text-xs text-zinc-600 font-body"},De={key:0,class:"flex items-center gap-1 px-5 py-2",style:{"border-bottom":"1px solid var(--border-subtle)","overflow-x":"auto"}},Le=["onClick"],Ue={class:"w-full text-sm results-table"},qe={style:{"border-bottom":"1px solid var(--border-subtle)"}},We={key:1,class:"px-5 py-3 text-right section-label",title:"Format compliance across test cases"},He={key:0},Ke=["onClick"],Ze={class:"px-5 py-3 text-sm font-body text-zinc-200"},Ge={key:0,class:"text-[9px] font-display tracking-wider uppercase px-1.5 py-0.5 rounded-sm ml-2 align-middle",style:{color:"#FBBF24",background:"rgba(251,191,36,0.08)",border:"1px solid rgba(251,191,36,0.2)"},title:"Judge analysis available — click to view"},Xe=["title"],Qe={key:1,class:"px-5 py-3 text-right"},Ye=["title"],et={key:1,class:"text-zinc-600 text-xs"},tt={class:"px-5 py-3 text-right text-xs font-mono text-zinc-500"},ot={__name:"EvalResultsTable",props:{results:{type:Array,required:!0}},emits:["showDetail"],setup(J){const u=J,w=g("overall_pct"),k=g(!1),h=g(""),j=g("");function P(m){w.value===m?k.value=!k.value:(w.value=m,k.value=m==="model_name")}function T(m){return w.value!==m?"":k.value?"▲":"▼"}const E=M(()=>{const m=[...u.results];return m.sort((c,i)=>{const b=c[w.value]??0,V=i[w.value]??0;return typeof b=="string"?k.value?b.localeCompare(V):V.localeCompare(b):k.value?b-V:V-b}),m}),z=M(()=>u.results.some(m=>m.irrelevance_pct!=null)),R=M(()=>u.results.some(m=>m.format_compliance_summary!=null)),_=M(()=>{const m=new Set;for(const c of u.results){const i=c.category_breakdown||{};for(const b of Object.keys(i))m.add(b)}return Array.from(m).sort()}),x=M(()=>{const m=new Set;for(const c of u.results){const i=c.error_type_breakdown||{};for(const b of Object.keys(i))m.add(b)}return Array.from(m).sort()}),S=M(()=>{const m=u.results.length;return`${u.results.reduce((i,b)=>i+(b.cases_run||0),0)} evaluations across ${m} model${m>1?"s":""}`});function d(m){return m>=80?"var(--lime)":m>=50?"#FBBF24":"var(--coral)"}function p(m){if(!m)return{};const c=m.toUpperCase();return c==="PASS"?{background:"rgba(191,255,0,0.08)",color:"var(--lime)",border:"1px solid rgba(191,255,0,0.2)"}:c==="NORMALIZED"?{background:"rgba(251,191,36,0.08)",color:"#FBBF24",border:"1px solid rgba(251,191,36,0.2)"}:{background:"rgba(255,59,92,0.08)",color:"var(--coral)",border:"1px solid rgba(255,59,92,0.2)"}}function n(m){if(!m)return"";const c=m.toUpperCase();return c==="PASS"?"All responses matched expected format exactly":c==="NORMALIZED"?"Some responses required normalization (e.g., case correction) to match":"Some responses failed format requirements"}function $(m,c){const b=(m.category_breakdown||{})[c];return b==null?null:b<=1?b*100:b}return(m,c)=>(o(),s("div",Re,[e("div",Oe,[c[8]||(c[8]=e("span",{class:"section-label"},"Summary",-1)),e("div",Je,[x.value.length>0?N((o(),s("select",{key:0,"onUpdate:modelValue":c[0]||(c[0]=i=>h.value=i),class:"text-[10px] font-mono px-2 py-1 rounded-sm",style:{background:"var(--surface)",border:"1px solid var(--border-subtle)",color:"#A1A1AA",outline:"none"}},[c[7]||(c[7]=e("option",{value:""},"All errors",-1)),(o(!0),s(B,null,I(x.value,i=>(o(),s("option",{key:i,value:i},r(i),9,Ne))),128))],512)),[[q,h.value]]):v("",!0),e("span",Ve,r(S.value),1)])]),_.value.length>0?(o(),s("div",De,[e("button",{class:D(["text-[10px] font-display tracking-wider uppercase px-2 py-0.5 rounded-sm transition-colors",j.value===""?"text-lime-400 border border-lime-400/30 bg-lime-400/05":"text-zinc-500 border border-zinc-800 hover:text-zinc-300"]),onClick:c[1]||(c[1]=i=>j.value="")},"All",2),(o(!0),s(B,null,I(_.value,i=>(o(),s("button",{key:i,class:D(["text-[10px] font-display tracking-wider uppercase px-2 py-0.5 rounded-sm transition-colors",j.value===i?"text-lime-400 border border-lime-400/30 bg-lime-400/05":"text-zinc-500 border border-zinc-800 hover:text-zinc-300"]),onClick:b=>j.value=i},r(i),11,Le))),128))])):v("",!0),e("table",Ue,[e("thead",null,[e("tr",qe,[e("th",{class:"px-5 py-3 text-left section-label cursor-pointer",onClick:c[2]||(c[2]=i=>P("model_name"))}," Model "+r(T("model_name")),1),e("th",{class:"px-5 py-3 text-right section-label cursor-pointer",onClick:c[3]||(c[3]=i=>P("tool_accuracy_pct"))}," Tool % "+r(T("tool_accuracy_pct")),1),e("th",{class:"px-5 py-3 text-right section-label cursor-pointer",onClick:c[4]||(c[4]=i=>P("param_accuracy_pct"))}," Param % "+r(T("param_accuracy_pct")),1),e("th",{class:"px-5 py-3 text-right section-label cursor-pointer",onClick:c[5]||(c[5]=i=>P("overall_pct"))}," Overall % "+r(T("overall_pct")),1),z.value?(o(),s("th",{key:0,class:"px-5 py-3 text-right section-label cursor-pointer",onClick:c[6]||(c[6]=i=>P("irrelevance_pct")),title:"Score on cases where model should NOT call any tool"}," Irrel. % "+r(T("irrelevance_pct")),1)):v("",!0),R.value?(o(),s("th",We," Format ")):v("",!0),j.value===""&&_.value.length>0?(o(!0),s(B,{key:2},I(_.value,i=>(o(),s("th",{key:"th-"+i,class:"px-3 py-3 text-right section-label",style:{"min-width":"70px"}},r(i),1))),128)):v("",!0),c[9]||(c[9]=e("th",{class:"px-5 py-3 text-right section-label"},"Cases",-1))])]),e("tbody",null,[J.results.length?v("",!0):(o(),s("tr",He,[...c[10]||(c[10]=[e("td",{colspan:"6",class:"px-5 py-8 text-center text-zinc-600 text-sm font-body"}," No results yet. ",-1)])])),(o(!0),s(B,null,I(E.value,i=>(o(),s("tr",{key:i.model_id,class:"cursor-pointer",onClick:b=>m.$emit("showDetail",i.model_id)},[e("td",Ze,[e("span",null,r(i.model_name||i.model_id),1),i.judge_grade!=null?(o(),s("span",Ge,"Judge: "+r(i.judge_grade),1)):v("",!0)]),e("td",{class:"px-5 py-3 text-right text-sm font-mono font-bold",style:C({color:d(i.tool_accuracy_pct)})},r((i.tool_accuracy_pct??0).toFixed(1))+"% ",5),e("td",{class:"px-5 py-3 text-right text-sm font-mono font-bold",style:C({color:d(i.param_accuracy_pct??0)})},r(i.param_accuracy_pct!=null?i.param_accuracy_pct.toFixed(1)+"%":"-"),5),e("td",{class:"px-5 py-3 text-right text-sm font-mono font-bold",style:C({color:d(i.overall_pct??0)})},r((i.overall_pct??0).toFixed(1))+"% ",5),z.value?(o(),s("td",{key:0,class:"px-5 py-3 text-right text-sm font-mono font-bold",style:C({color:i.irrelevance_pct!=null?d(i.irrelevance_pct):"#52525B"}),title:i.irrelevance_pct!=null?"Abstention accuracy on irrelevance test cases":"No irrelevance cases"},r(i.irrelevance_pct!=null?i.irrelevance_pct.toFixed(1)+"%":"-"),13,Xe)):v("",!0),R.value?(o(),s("td",Qe,[i.format_compliance_summary?(o(),s("span",{key:0,class:"text-[9px] font-display tracking-wider uppercase px-1.5 py-0.5 rounded-sm",style:C(p(i.format_compliance_summary)),title:n(i.format_compliance_summary)},r(i.format_compliance_summary),13,Ye)):(o(),s("span",et,"-"))])):v("",!0),j.value===""&&_.value.length>0?(o(!0),s(B,{key:2},I(_.value,b=>(o(),s("td",{key:"td-"+b+i.model_id,class:"px-3 py-3 text-right text-xs font-mono",style:C({color:$(i,b)!=null?d($(i,b)):"#52525B"})},r($(i,b)!=null?$(i,b).toFixed(0)+"%":"-"),5))),128)):v("",!0),e("td",tt,r(i.cases_run||0),1)],8,Ke))),128))])])]))}},st={class:"modal-box",style:{"max-width":"720px","max-height":"80vh","overflow-y":"auto"}},lt={class:"flex items-center justify-between mb-4"},rt={class:"modal-title"},nt={key:0,class:"text-[10px] text-amber-400 font-body mt-0.5"},at={class:"space-y-3"},it={class:"flex items-center gap-2 mb-1 flex-wrap"},dt={key:0,class:"text-[9px] font-display tracking-wider uppercase px-1.5 py-0.5 rounded-sm",style:{background:"rgba(56,189,248,0.08)",color:"#38BDF8",border:"1px solid rgba(56,189,248,0.2)"}},ct={key:1,class:"text-[9px] font-display tracking-wider uppercase px-1.5 py-0.5 rounded-sm",style:{background:"rgba(168,85,247,0.08)",color:"#A855F7",border:"1px solid rgba(168,85,247,0.2)"}},ut=["title"],pt={key:3,class:"text-[9px] font-display tracking-wider uppercase px-1.5 py-0.5 rounded-sm",style:{background:"rgba(255,59,92,0.08)",color:"var(--coral)",border:"1px solid rgba(255,59,92,0.2)"},title:"Error classification"},mt={key:4,class:"text-[10px] text-zinc-700 font-mono ml-auto"},vt={class:"text-sm text-zinc-300 font-body mb-1"},xt={key:0},yt={class:"text-[10px] font-mono mt-1"},ft={key:1,class:"grid grid-cols-2 gap-4 text-xs font-mono"},_t={class:"text-zinc-400"},bt={key:0,class:"text-zinc-600 mt-0.5 break-all"},gt={key:0,class:"text-zinc-600 mt-0.5 break-all"},kt={class:"flex gap-4 mt-2 text-[10px] font-mono text-zinc-600"},ht={key:0},wt={key:2,class:"mt-2"},$t={class:"text-[10px] font-mono mb-1.5"},Ct={key:0,class:"text-zinc-700 mx-1"},zt={style:{color:"var(--lime)"}},St=["title"],jt={class:"text-zinc-600 ml-1"},At={class:"mt-1 grid grid-cols-4 gap-2 text-[10px] font-mono"},Et={class:"text-zinc-500"},Ft={style:{color:"var(--lime)"}},Bt={class:"text-zinc-500"},It={style:{color:"var(--lime)"}},Mt={class:"text-zinc-500"},Pt={style:{color:"var(--coral)"}},Tt={class:"text-zinc-500"},Rt={style:{color:"var(--coral)"}},Ot={key:3,class:"mt-2 rounded-sm px-3 py-2",style:{background:"rgba(251,191,36,0.04)",border:"1px solid rgba(251,191,36,0.15)"}},Jt={class:"text-[10px] font-body text-zinc-400 leading-relaxed"},Nt={key:4,class:"mt-2 text-xs",style:{color:"var(--coral)"}},Vt={key:5,class:"mt-2"},Dt=["onClick"],Lt={key:0,class:"mt-2 space-y-2",style:{"max-height":"300px","overflow-y":"auto"}},Ut={key:0},qt={class:"text-[10px] font-mono text-zinc-400 p-2 rounded-sm overflow-x-auto",style:{background:"rgba(0,0,0,0.3)",border:"1px solid var(--border-subtle)","white-space":"pre-wrap","word-break":"break-all"}},Wt={key:1},Ht={class:"text-[10px] font-mono text-zinc-400 p-2 rounded-sm overflow-x-auto",style:{background:"rgba(0,0,0,0.3)",border:"1px solid var(--border-subtle)","white-space":"pre-wrap","word-break":"break-all"}},Kt={class:"flex justify-end mt-4"},Zt={__name:"ModelDetailModal",props:{visible:{type:Boolean,default:!1},modelId:{type:String,default:""},allResults:{type:Array,default:()=>[]},evalId:{type:String,default:null}},emits:["close"],setup(J){const u=J,w=g({}),k=g({}),h=g(!1),j=M(()=>u.allResults.filter(d=>d.model_id===u.modelId)),P=M(()=>{const d=j.value[0];return(d==null?void 0:d.model_name)||(d==null?void 0:d.model_id)||u.modelId});ee(()=>u.visible,async d=>{if(!d){k.value={};return}if(u.evalId){h.value=!0;try{const p=await G(`/api/tool-eval/${u.evalId}/judge-report`);if(!p.ok)return;const n=await p.json(),$={},m=n.cases||n.case_results||[];for(const c of m)c.model_id===u.modelId&&c.explanation&&($[c.test_case_id]=c.explanation);k.value=$}catch{}finally{h.value=!1}}},{immediate:!1});function T(d){return d.judge_explanation?d.judge_explanation:d.test_case_id&&k.value[d.test_case_id]?k.value[d.test_case_id]:null}function E(d){return d>=80?"var(--lime)":d>=50?"#FBBF24":"var(--coral)"}function z(d){if(!d)return{};const p=d.toUpperCase();return p==="PASS"?{background:"rgba(191,255,0,0.08)",color:"var(--lime)",border:"1px solid rgba(191,255,0,0.2)"}:p==="NORMALIZED"?{background:"rgba(251,191,36,0.08)",color:"#FBBF24",border:"1px solid rgba(251,191,36,0.2)"}:{background:"rgba(255,59,92,0.08)",color:"var(--coral)",border:"1px solid rgba(255,59,92,0.2)"}}function R(d){return d==="previous_tool"?{background:"rgba(56,189,248,0.1)",color:"#38BDF8"}:d==="inferred"?{background:"rgba(168,85,247,0.1)",color:"#A855F7"}:{background:"rgba(255,255,255,0.04)",color:"#71717A"}}function _(d){return d==="previous_tool"?"Arguments sourced from previous tool output":d==="inferred"?"Arguments inferred from conversation context":d==="user"?"Arguments provided directly by user":`Argument source: ${d}`}function x(d){return d==null?"(no tool call)":Array.isArray(d)?d.join(" | "):d}function S(d){w.value[d]=!w.value[d]}return(d,p)=>J.visible?(o(),s("div",{key:0,class:"modal-overlay",onClick:p[2]||(p[2]=W(n=>d.$emit("close"),["self"]))},[e("div",st,[e("div",lt,[e("div",null,[e("div",rt,r(P.value),1),h.value?(o(),s("div",nt,"Loading judge analysis...")):v("",!0)]),e("button",{onClick:p[0]||(p[0]=n=>d.$emit("close")),class:"text-zinc-600 hover:text-zinc-400 text-lg"},"×")]),e("div",at,[(o(!0),s(B,null,I(j.value,(n,$)=>{var m;return o(),s("div",{key:n.test_case_id||$,class:"rounded-sm p-3",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)"}},[e("div",it,[e("span",{style:C({color:n.tool_selection_score===1?"var(--lime)":"var(--coral)"}),class:"text-xs font-mono font-bold"},r(n.tool_selection_score===1?"OK":"X"),5),e("span",{class:"text-xs font-mono font-bold",style:C({color:E(n.overall_score*100)})},r((n.overall_score*100).toFixed(0))+"% ",5),n.should_call_tool===!1?(o(),s("span",dt,"Irrelevance")):v("",!0),n.category?(o(),s("span",ct,r(n.category),1)):v("",!0),n.format_compliance?(o(),s("span",{key:2,class:"text-[9px] font-display tracking-wider uppercase px-1.5 py-0.5 rounded-sm",style:C(z(n.format_compliance)),title:n.format_compliance_detail||""},r(n.format_compliance),13,ut)):v("",!0),n.error_type&&n.tool_selection_score<1?(o(),s("span",pt,r(n.error_type),1)):v("",!0),n.latency_ms?(o(),s("span",mt,r(n.latency_ms)+"ms",1)):v("",!0)]),e("div",vt,'"'+r(n.prompt||"")+'"',1),n.should_call_tool===!1?(o(),s("div",xt,[e("div",yt,[p[3]||(p[3]=e("span",{class:"text-zinc-600"},"Expected: ",-1)),p[4]||(p[4]=e("span",{style:{color:"#38BDF8"}},"abstain (no tool call)",-1)),p[5]||(p[5]=e("span",{class:"ml-4 text-zinc-600"},"Actual: ",-1)),e("span",{style:C({color:n.tool_selection_score===1?"var(--lime)":"var(--coral)"})},r(n.actual_tool?n.actual_tool:"no tool call"),5)]),e("div",{class:"text-[10px] font-mono mt-1",style:C({color:n.tool_selection_score===1?"var(--lime)":"var(--coral)"})},r(n.tool_selection_score===1?"Correctly abstained":"Should not have called a tool"),5)])):(o(),s("div",ft,[e("div",null,[p[6]||(p[6]=e("div",{class:"text-[10px] font-display tracking-wider text-zinc-500 uppercase mb-0.5"},"Expected",-1)),e("div",_t,r(x(n.expected_tool)),1),n.expected_params?(o(),s("div",bt,r(JSON.stringify(n.expected_params)),1)):v("",!0)]),e("div",null,[p[7]||(p[7]=e("div",{class:"text-[10px] font-display tracking-wider text-zinc-500 uppercase mb-0.5"},"Actual",-1)),e("div",{style:C({color:n.tool_selection_score>0?"var(--lime)":"var(--coral)"})},r(n.actual_tool||"(no tool call)"),5),n.actual_params?(o(),s("div",gt,r(JSON.stringify(n.actual_params)),1)):v("",!0)])])),e("div",kt,[e("span",null,[p[8]||(p[8]=O("Tool: ",-1)),e("span",{style:C({color:E(n.tool_selection_score*100)})},r((n.tool_selection_score*100).toFixed(0))+"%",5)]),n.param_accuracy!=null?(o(),s("span",ht,[p[9]||(p[9]=O("Param: ",-1)),e("span",{style:C({color:E(n.param_accuracy*100)})},r((n.param_accuracy*100).toFixed(0))+"%",5)])):v("",!0)]),n.multi_turn&&((m=n.tool_chain)!=null&&m.length)?(o(),s("div",wt,[e("div",$t,[p[10]||(p[10]=e("span",{class:"text-zinc-600"},"Chain:",-1)),(o(!0),s(B,null,I(n.tool_chain,(c,i)=>(o(),s("span",{key:i,class:"inline-flex items-center"},[i>0?(o(),s("span",Ct,"→")):v("",!0),e("span",zt,r(c.tool_name),1),c.argument_source&&c.argument_source!=="user"?(o(),s("span",{key:1,class:"text-[8px] px-1 py-0.5 rounded-sm ml-0.5",style:C(R(c.argument_source)),title:_(c.argument_source)},r(c.argument_source),13,St)):v("",!0)]))),128)),e("span",jt,"("+r(n.rounds_used||n.tool_chain.length)+" round"+r((n.rounds_used||n.tool_chain.length)>1?"s":"")+")",1)]),e("div",At,[e("span",Et,[p[11]||(p[11]=O("Completion: ",-1)),e("span",Ft,r(((n.completion_score||0)*100).toFixed(0))+"%",1)]),e("span",Bt,[p[12]||(p[12]=O("Efficiency: ",-1)),e("span",It,r(((n.efficiency_score||0)*100).toFixed(0))+"%",1)]),e("span",Mt,[p[13]||(p[13]=O("Redundancy: ",-1)),e("span",Pt,"-"+r(((n.redundancy_penalty||0)*100).toFixed(0))+"%",1)]),e("span",Tt,[p[14]||(p[14]=O("Detour: ",-1)),e("span",Rt,"-"+r(((n.detour_penalty||0)*100).toFixed(0))+"%",1)])])])):v("",!0),T(n)?(o(),s("div",Ot,[p[15]||(p[15]=e("div",{class:"text-[10px] font-display tracking-wider uppercase text-yellow-500 mb-1"},"Judge Analysis",-1)),e("div",Jt,r(T(n)),1)])):v("",!0),n.error?(o(),s("div",Nt,r(n.error),1)):v("",!0),n.raw_request||n.raw_response?(o(),s("div",Vt,[e("button",{onClick:c=>S($),class:"text-[10px] font-display tracking-wider uppercase px-2 py-0.5 rounded-sm",style:{color:"var(--lime)",border:"1px solid rgba(191,255,0,0.15)"}},r(w.value[$]?"HIDE RAW":"VIEW RAW"),9,Dt),w.value[$]?(o(),s("div",Lt,[n.raw_request?(o(),s("div",Ut,[p[16]||(p[16]=e("div",{class:"text-[10px] font-display tracking-wider text-zinc-500 uppercase mb-1"},"Request",-1)),e("pre",qt,r(JSON.stringify(n.raw_request,null,2)),1)])):v("",!0),n.raw_response?(o(),s("div",Wt,[p[17]||(p[17]=e("div",{class:"text-[10px] font-display tracking-wider text-zinc-500 uppercase mb-1"},"Response",-1)),e("pre",Ht,r(JSON.stringify(n.raw_response,null,2)),1)])):v("",!0)])):v("",!0)])):v("",!0)])}),128))]),e("div",Kt,[e("button",{onClick:p[1]||(p[1]=n=>d.$emit("close")),class:"modal-btn modal-btn-cancel"},"Close")])])])):v("",!0)}},Gt={class:"card rounded-md p-5 mb-6"},Xt=["value"],Qt={class:"card rounded-md p-5 mb-6"},Yt={class:"flex items-center justify-between mb-3"},eo={class:"text-xs font-mono text-zinc-600"},to={key:0,class:"text-xs text-zinc-600 font-body"},oo={key:1,class:"text-xs text-zinc-600 font-body"},so={key:2,class:"flex flex-col gap-1"},lo=["onClick"],ro={class:"provider-group-count"},no=["onClick"],ao={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2 pl-4 pb-2"},io=["onClick"],co={class:"flex-1 min-w-0"},uo={class:"text-xs font-mono text-zinc-200 truncate"},po={key:0,class:"card rounded-md p-5 mb-6"},mo={class:"flex flex-col gap-2"},vo=["title"],xo=["onUpdate:modelValue"],yo=["value"],fo={class:"card rounded-md p-5 mb-6"},_o={class:"flex items-center gap-4 flex-wrap"},bo={class:"flex items-center gap-2 cursor-pointer",title:"Automatically run judge analysis after eval completes"},go={key:0,class:"flex items-center gap-2",title:"Trigger judge when a model's overall score falls below this threshold"},ko={class:"text-[10px] font-mono text-amber-400 w-8"},ho={class:"ml-auto flex gap-2"},wo=["disabled"],$o={key:0,class:"w-3.5 h-3.5 animate-spin",fill:"none",viewBox:"0 0 24 24"},Co={key:1,class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor","stroke-width":"2.5",viewBox:"0 0 24 24"},zo={key:1,class:"mb-6 px-4 py-3 rounded-sm flex items-start gap-3",style:{background:"rgba(251,191,36,0.06)",border:"1px solid rgba(251,191,36,0.25)"}},So={class:"text-xs text-zinc-400 font-body mt-0.5"},jo={key:3,class:"mb-6 fade-in"},Ao={class:"card rounded-md p-5"},Eo={class:"flex items-center justify-between mb-3"},Fo={class:"flex items-center gap-3"},Bo={class:"text-sm text-zinc-400 font-body"},Io={class:"text-xs font-mono text-zinc-600"},Mo={class:"progress-track rounded-full overflow-hidden"},Po={key:0,class:"error-banner mt-3"},To={key:4,class:"card rounded-md overflow-hidden mb-6"},Ro={style:{"max-height":"400px","overflow-y":"auto"}},Oo={class:"w-full text-sm results-table"},Jo={class:"px-5 py-2 text-xs font-mono text-zinc-300"},No={class:"px-5 py-2 text-xs font-body text-zinc-400"},Vo={key:0,class:"text-[9px] font-display tracking-wider uppercase px-1 py-0.5 rounded-sm ml-1 align-middle",style:{color:"#38BDF8",background:"rgba(56,189,248,0.08)",border:"1px solid rgba(56,189,248,0.15)"}},Do={class:"px-5 py-2 text-xs font-mono text-zinc-500"},Lo=["title"],Uo={key:6,class:"mt-4 px-4 py-3 rounded-sm flex items-center justify-between",style:{background:"rgba(251,191,36,0.06)",border:"1px solid rgba(251,191,36,0.25)"}},Ko={__name:"EvaluateView",setup(J){const u=ze(),w=je(),{showToast:k}=we(),{context:h,setSuite:j,setModels:P,setConfig:T}=Se(),E=g(""),z=g(new Set),R=g(0),_=g("required"),x=g(!1),S=g(80),d=g({}),p=g(!0),n=g([]),$=g("Initializing..."),m=g("0/0"),c=g(0),i=g(""),b=g(!1),V=g(""),H=g(!1),K=g({}),Z=M(()=>Array.from(z.value).filter(a=>a&&a.includes("::")).map(a=>{const t=a.indexOf("::"),f=a.substring(t+2);return{id:a,model_id:f,display_name:f.split("/").pop()||f}}));_e(async()=>{var t;if(u.suites.length===0)try{await u.loadSuites()}catch{}try{const f=await G("/api/config");if(f.ok){const l=await f.json();oe(l)}}catch{k("Failed to load model config","error")}finally{p.value=!1}h.suiteId&&(E.value=h.suiteId),(t=h.selectedModels)!=null&&t.length&&(z.value=new Set(h.selectedModels)),h.temperature!=null&&(R.value=h.temperature),h.toolChoice&&(_.value=h.toolChoice),h.systemPrompts&&(d.value={...h.systemPrompts});try{await w.fetchProfiles()}catch{}try{const f=await G("/api/settings/judge");if(f.ok){const l=await f.json();x.value=!!l.auto_judge_after_eval}}catch{}const a=sessionStorage.getItem("_teJobId");a&&(u.activeJobId=a,u.isEvaluating=!0),ie()});function oe(a){const t=[],f=a.providers||{};for(const[l,y]of Object.entries(f)){const A=y.provider_key||l,L=(y.models||[]).map(U=>({key:`${A}::${U.model_id}`,model_id:U.model_id,display_name:U.display_name||U.model_id,provider_key:A}));if(L.length===0)continue;const fe=be(y.display_name||l);t.push({provider:y.display_name||l,color:fe.text,models:L,collapsed:!1})}n.value=t}function se(a){const t=new Set(z.value);t.has(a)?t.delete(a):t.add(a),z.value=t,P(Array.from(t))}function le(a){return a.models.every(t=>z.value.has(t.key))}function re(a){const t=new Set(z.value),f=a.models.every(l=>t.has(l.key));for(const l of a.models)f?t.delete(l.key):t.add(l.key);z.value=t,P(Array.from(t))}async function ne(){const a=u.suites.find(t=>t.id===E.value);if(a){j(a.id,a.name);try{await u.loadSuite(E.value)}catch{}}}const ae=M(()=>{var t;if(_.value!=="required")return!1;const a=(t=u.currentSuite)==null?void 0:t.test_cases;return a?a.some(f=>f.should_call_tool===!1):!1});function ie(){const a=ge();if(!a)return;const f=`${location.protocol==="https:"?"wss:":"ws:"}//${location.host}/ws?token=${a}`,{connect:l}=$e(f,{onMessage:de});l()}function de(a){if(a.type==="judge_complete"){H.value=!0,k("Judge report ready — view in Judge History","success");return}if(u.activeJobId&&a.job_id===u.activeJobId)switch(u.handleEvalProgress(a),a.type){case"tool_eval_init":{const t=a.data||a;$.value=`Evaluating ${t.suite_name||""}...`,m.value=`0/${u.evalTotalCases}`;break}case"tool_eval_progress":{const t=a.data||a,f=t.total>0?Math.round(t.current/t.total*100):0;if(c.value=f,m.value=`${t.current}/${t.total}`,$.value=`Testing ${t.model||""}...`,u.evalStartTime&&f>0&&f<100){const y=(Date.now()-u.evalStartTime)/1e3/f*(100-f),A=y>60?Math.ceil(y/60)+"m left":Math.ceil(y)+"s left";$.value+=" — "+A}break}case"tool_eval_result":{u.evalTotalCases>0&&(c.value=Math.round(u.evalResults.length/u.evalTotalCases*100),m.value=`${u.evalResults.length}/${u.evalTotalCases}`);break}case"tool_eval_complete":$.value="Complete!",c.value=100,k("Eval complete!","success");break;case"job_completed":$.value="Complete!",c.value=100;break;case"job_failed":i.value=a.error||a.error_msg||"Eval failed";break;case"job_cancelled":$.value="Cancelled",k("Eval cancelled","");break}}async function ce(){if(z.value.size===0){k("Select at least one model","error");return}if(!E.value){k("No suite selected","error");return}u.resetEval(),$.value="Initializing...",c.value=0,m.value="0/0",i.value="",H.value=!1;const a=Array.from(z.value).map(y=>{const A=y.indexOf("::");return{provider_key:y.substring(0,A),model_id:y.substring(A+2)}}),t={suite_id:E.value,targets:a,temperature:R.value,tool_choice:_.value,auto_judge:x.value,auto_judge_threshold:x.value?S.value/100:null},f={};for(const[y,A]of Object.entries(d.value))A&&A.trim()&&(f[y]=A);Object.keys(f).length>0&&(t.system_prompt=f);const l={};for(const[y,A]of Object.entries(K.value))A&&(l[y]=A);Object.keys(l).length>0&&(t.profiles=l),h.experimentId&&(t.experiment_id=h.experimentId),T({temperature:R.value,toolChoice:_.value,systemPrompts:f,lastUpdatedBy:null});try{await u.runEval(t),k("Eval submitted","success")}catch(y){k(y.message||"Failed to start eval","error"),u.isEvaluating=!1}}async function ue(){try{await u.cancelEval(),k("Cancellation requested","")}catch{k("Failed to cancel","error")}}function pe(a,t){return a?a.length>t?a.slice(0,t)+"...":a:""}function me(a){return a==null?"(none)":Array.isArray(a)?a.join(" | "):typeof a=="object"?JSON.stringify(a):a}function ve(a){return a>=80?"var(--lime)":a>=50?"#FBBF24":"var(--coral)"}function xe(a){return a.should_call_tool===!1?a.actual_tool?"var(--coral)":"var(--lime)":a.tool_selection_score>0?"var(--lime)":"var(--coral)"}function ye(a){V.value=a,b.value=!0}return(a,t)=>{const f=Ce("router-link");return o(),s("div",null,[t[33]||(t[33]=e("div",{class:"flex items-center justify-between mb-6"},[e("div",null,[e("h2",{class:"font-display font-bold text-lg text-zinc-100 mb-1"},"Evaluate"),e("p",{class:"text-sm text-zinc-600 font-body"},"Select models, configure settings, and run tool calling evaluations.")])],-1)),e("div",Gt,[t[9]||(t[9]=e("label",{class:"section-label mb-2 block"},"Suite",-1)),N(e("select",{"onUpdate:modelValue":t[0]||(t[0]=l=>E.value=l),onChange:ne,class:"text-sm font-mono px-3 py-2 rounded-sm w-full",style:{background:"var(--surface)",border:"1px solid var(--border-subtle)",color:"#E4E4E7",outline:"none"}},[t[8]||(t[8]=e("option",{value:""},"-- Select a suite --",-1)),(o(!0),s(B,null,I(F(u).suites,l=>(o(),s("option",{key:l.id,value:l.id},r(l.name)+" ("+r(l.tool_count||0)+" tools, "+r(l.test_case_count||0)+" cases) ",9,Xt))),128))],544),[[q,E.value]])]),e("div",Qt,[e("div",Yt,[t[10]||(t[10]=e("span",{class:"section-label"},"Models",-1)),e("span",eo,r(z.value.size)+" selected",1)]),p.value?(o(),s("div",to,"Loading models...")):n.value.length===0?(o(),s("div",oo," No models available. Configure providers in Settings. ")):(o(),s("div",so,[(o(!0),s(B,null,I(n.value,l=>(o(),s("div",{key:l.provider,class:"provider-group"},[e("div",{class:"provider-group-header",onClick:y=>l.collapsed=!l.collapsed},[e("div",{class:"provider-group-dot",style:C({background:l.color})},null,4),e("span",{class:"provider-group-label",style:C({color:l.color})},r(l.provider),5),e("span",ro,r(l.models.length),1),e("button",{onClick:W(y=>re(l),["stop"]),class:"text-[10px] font-display tracking-wider uppercase text-zinc-600 hover:text-zinc-400 ml-2"},r(le(l)?"None":"All"),9,no)],8,lo),N(e("div",ao,[(o(!0),s(B,null,I(l.models,y=>(o(),s("div",{key:y.key,class:D(["model-card rounded-sm px-3 py-2 flex items-center gap-2",{selected:z.value.has(y.key)}]),onClick:W(A=>se(y.key),["stop"])},[t[11]||(t[11]=e("div",{class:"check-dot"},null,-1)),e("div",co,[e("div",uo,r(y.display_name||y.model_id),1)])],10,io))),128))],512),[[te,!l.collapsed]])]))),128))]))]),Z.value.length>0&&F(w).profiles.length>0?(o(),s("div",po,[t[13]||(t[13]=e("span",{class:"section-label block mb-3"},"Profiles (optional)",-1)),e("div",mo,[(o(!0),s(B,null,I(Z.value,l=>(o(),s("div",{key:l.id,class:"flex items-center gap-3"},[e("span",{class:"text-xs font-mono text-zinc-400 w-40 truncate",title:l.model_id},r(l.display_name),9,vo),N(e("select",{"onUpdate:modelValue":y=>K.value[l.model_id]=y,class:"text-xs font-mono px-2 py-1 rounded-sm flex-1",style:{background:"var(--surface)",border:"1px solid var(--border-subtle)",color:"var(--zinc-200)",outline:"none"}},[t[12]||(t[12]=e("option",{value:""},"No Profile",-1)),(o(!0),s(B,null,I(F(w).profilesByModel[l.model_id]||[],y=>(o(),s("option",{key:y.id,value:y.id},r(y.name)+r(y.is_default?" (default)":""),9,yo))),128))],8,xo),[[q,K.value[l.model_id]]])]))),128))])])):v("",!0),e("div",fo,[t[21]||(t[21]=e("div",{class:"flex items-center justify-between mb-4"},[e("span",{class:"section-label"},"Eval Settings")],-1)),e("div",_o,[e("div",null,[t[14]||(t[14]=e("span",{class:"text-zinc-500 font-body text-xs"},"Temperature",-1)),N(e("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>R.value=l),type:"number",min:"0",max:"2",step:"0.1",class:"ml-2 w-16 px-2 py-1 rounded-sm text-sm font-mono text-zinc-200 text-center",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)",outline:"none"}},null,512),[[X,R.value,void 0,{number:!0}]])]),e("div",null,[t[16]||(t[16]=e("label",{class:"text-xs font-display tracking-wider text-zinc-500 uppercase"},"Tool Choice",-1)),N(e("select",{"onUpdate:modelValue":t[2]||(t[2]=l=>_.value=l),class:"text-xs font-mono px-3 py-1.5 rounded-sm ml-2",style:{background:"var(--surface)",border:"1px solid var(--border-subtle)",color:"var(--zinc-200)",width:"120px"}},[...t[15]||(t[15]=[e("option",{value:"required"},"Required",-1),e("option",{value:"auto"},"Auto",-1),e("option",{value:"none"},"None",-1)])],512),[[q,_.value]])]),e("label",bo,[N(e("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=l=>x.value=l),class:"accent-amber-400"},null,512),[[ke,x.value]]),t[17]||(t[17]=e("span",{class:"text-xs font-body text-zinc-400"},"Auto-run Judge",-1))]),x.value?(o(),s("div",go,[t[18]||(t[18]=e("span",{class:"text-[10px] text-zinc-600 font-body"},"on score <",-1)),N(e("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>S.value=l),type:"range",min:"0",max:"100",step:"5",class:"w-20 accent-amber-400"},null,512),[[X,S.value,void 0,{number:!0}]]),e("span",ko,r(S.value)+"%",1)])):v("",!0),e("div",ho,[F(u).isEvaluating?(o(),s("button",{key:0,onClick:ue,class:"text-[11px] font-display font-medium tracking-wider uppercase px-3 py-1 rounded-sm transition-colors",style:{color:"var(--coral)",border:"1px solid rgba(255,59,92,0.3)"}},"Cancel")):v("",!0),e("button",{onClick:ce,disabled:F(u).isEvaluating||z.value.size===0||!E.value,class:"run-btn px-6 py-2 rounded-sm text-xs flex items-center gap-2"},[F(u).isEvaluating?(o(),s("svg",$o,[...t[19]||(t[19]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"},null,-1)])])):(o(),s("svg",Co,[...t[20]||(t[20]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M13 10V3L4 14h7v7l9-11h-7z"},null,-1)])])),O(" "+r(F(u).isEvaluating?"Running...":"Start Eval"),1)],8,wo)])])]),ae.value?(o(),s("div",zo,[t[27]||(t[27]=e("svg",{class:"w-4 h-4 flex-shrink-0 mt-0.5",fill:"none",stroke:"#FBBF24","stroke-width":"2",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 9v2m0 4h.01M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"})],-1)),e("div",null,[t[26]||(t[26]=e("span",{class:"text-xs font-display tracking-wider uppercase text-amber-400"},"Warning",-1)),e("p",So,[t[22]||(t[22]=O(" This suite contains irrelevance test cases but ",-1)),t[23]||(t[23]=e("strong",{class:"text-zinc-200"},'Tool Choice is set to "Required"',-1)),t[24]||(t[24]=O(". The model will be forced to call a tool, making all irrelevance cases fail artificially. Switch Tool Choice to ",-1)),e("button",{onClick:t[5]||(t[5]=l=>_.value="auto"),class:"text-amber-400 underline hover:text-amber-300 font-mono"},'"auto"'),t[25]||(t[25]=O(" to test abstention correctly. ",-1))])])])):v("",!0),z.value.size>0?(o(),Q(Te,{key:2,models:Z.value,"system-prompts":d.value,"onUpdate:systemPrompts":t[6]||(t[6]=l=>d.value=l)},null,8,["models","system-prompts"])):v("",!0),F(u).isEvaluating?(o(),s("div",jo,[e("div",Ao,[e("div",Eo,[e("div",Fo,[t[28]||(t[28]=e("div",{class:"pulse-dot"},null,-1)),e("span",Bo,r($.value),1)]),e("span",Io,r(m.value),1)]),e("div",Mo,[e("div",{class:"progress-fill",style:C({width:c.value+"%"})},null,4)])]),i.value?(o(),s("div",Po,[e("span",null,r(i.value),1)])):v("",!0)])):v("",!0),F(u).evalResults.length>0?(o(),s("div",To,[t[30]||(t[30]=e("div",{class:"px-5 py-3",style:{"border-bottom":"1px solid var(--border-subtle)"}},[e("span",{class:"section-label"},"Live Results")],-1)),e("div",Ro,[e("table",Oo,[t[29]||(t[29]=e("thead",null,[e("tr",{style:{"border-bottom":"1px solid var(--border-subtle)"}},[e("th",{class:"px-5 py-2 text-left section-label"},"Model"),e("th",{class:"px-5 py-2 text-left section-label"},"Prompt"),e("th",{class:"px-5 py-2 text-left section-label"},"Expected"),e("th",{class:"px-5 py-2 text-left section-label"},"Actual"),e("th",{class:"px-5 py-2 text-right section-label"},"Hops"),e("th",{class:"px-5 py-2 text-right section-label"},"Score")])],-1)),e("tbody",null,[(o(!0),s(B,null,I(F(u).evalResults,(l,y)=>{var A;return o(),s("tr",{key:y},[e("td",Jo,r(l.model_name||l.model_id||""),1),e("td",No,[O(r(pe(l.prompt||l.test_case_id||"",40))+" ",1),l.should_call_tool===!1?(o(),s("span",Vo,"IRREL")):v("",!0)]),e("td",Do,r(l.should_call_tool===!1?"(abstain)":me(l.expected_tool)),1),e("td",{class:"px-5 py-2 text-xs font-mono",style:C({color:xe(l)})},r(l.actual_tool||"(none)"),5),e("td",{class:"px-5 py-2 text-right text-xs font-mono text-zinc-500",title:l.tool_chain?l.tool_chain.map(L=>L.tool_name).join(" → "):""},r(l.multi_turn?((A=l.tool_chain)==null?void 0:A.length)||1:""),9,Lo),e("td",{class:"px-5 py-2 text-right text-xs font-mono font-bold",style:C({color:ve(l.overall_score*100)})},r((l.overall_score*100).toFixed(0))+"% ",5)])}),128))])])])])):v("",!0),F(u).evalSummaries.length>0?(o(),Q(ot,{key:5,results:F(u).evalSummaries,onShowDetail:ye},null,8,["results"])):v("",!0),H.value?(o(),s("div",Uo,[t[32]||(t[32]=e("div",{class:"flex items-center gap-2"},[e("svg",{class:"w-4 h-4 flex-shrink-0",fill:"none",stroke:"#FBBF24","stroke-width":"2",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})]),e("span",{class:"text-xs text-zinc-400 font-body"},"Judge analysis complete")],-1)),Y(f,{to:{name:"JudgeHistory"},class:"text-[10px] font-display tracking-wider uppercase px-3 py-1 rounded-sm",style:{color:"#FBBF24",background:"rgba(251,191,36,0.08)",border:"1px solid rgba(251,191,36,0.2)"}},{default:he(()=>[...t[31]||(t[31]=[O("View Report →",-1)])]),_:1})])):v("",!0),Y(Zt,{visible:b.value,"model-id":V.value,"all-results":F(u).evalResults,"eval-id":F(u).lastEvalId,onClose:t[7]||(t[7]=l=>b.value=!1)},null,8,["visible","model-id","all-results","eval-id"])])}}};export{Ko as default};
