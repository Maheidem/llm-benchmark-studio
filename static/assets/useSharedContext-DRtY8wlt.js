import{S as oe,r as u,P as ae,y as f,K as s}from"./index-BxbfhC3f.js";const se=oe("toolEval",()=>{const i=u([]),p=u(null),a=ae({suiteId:null,suiteName:null,selectedModels:[],systemPrompts:{},temperature:0,toolChoice:"required",providerParams:{},experimentId:null,experimentName:null,lastUpdatedBy:null,promptTunerHint:null}),m=u([]),h=u([]),d=u(!1),l=u(null),n=u(null),c=u(0),S=u([]),w=u([]),b=u(null),x=f(()=>i.value.length),T=f(()=>{var e;return((e=p.value)==null?void 0:e.tools)||[]}),k=f(()=>{var e;return((e=p.value)==null?void 0:e.test_cases)||[]}),_=f(()=>a.selectedModels.length),E="_sharedContext_vue";function y(){try{sessionStorage.setItem(E,JSON.stringify({suiteId:a.suiteId,suiteName:a.suiteName,selectedModels:a.selectedModels,systemPrompts:a.systemPrompts,temperature:a.temperature,toolChoice:a.toolChoice,providerParams:a.providerParams,experimentId:a.experimentId,experimentName:a.experimentName,lastUpdatedBy:a.lastUpdatedBy}))}catch{}}function O(){try{const e=sessionStorage.getItem(E);if(e){const t=JSON.parse(e);Object.assign(a,t)}}catch{}}async function P(){try{const e=await s("/api/tool-suites");if(!e.ok)throw new Error("Failed to load suites");const t=await e.json();i.value=t.suites||[]}catch(e){throw console.error("loadSuites:",e),e}}async function I(e){try{const t=await s(`/api/tool-suites/${e}`);if(!t.ok)throw new Error("Suite not found");return p.value=await t.json(),p.value}catch(t){throw console.error("loadSuite:",t),t}}async function g(e){const t=await s("/api/tool-suites",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){const r=await t.json().catch(()=>({}));throw new Error(r.error||"Failed to create suite")}return await t.json()}async function N(e,t){const o=await s(`/api/tool-suites/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!o.ok){const r=await o.json().catch(()=>({}));throw new Error(r.error||"Failed to update suite")}return await o.json()}async function J(e,t){const o=await s(`/api/tool-suites/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!o.ok)throw new Error("Failed to patch suite");return await o.json()}async function F(e){if(!(await s(`/api/tool-suites/${e}`,{method:"DELETE"})).ok)throw new Error("Failed to delete suite");i.value=i.value.filter(o=>o.id!==e)}async function U(e){const t=await s(`/api/tool-suites/${e}/export`);if(!t.ok)throw new Error("Failed to export suite");const o=await t.blob(),j=(t.headers.get("content-disposition")||"").match(/filename=([^\s;]+)/),te=j?j[1]:`suite-${e.slice(0,8)}.json`,C=URL.createObjectURL(o),v=document.createElement("a");v.href=C,v.download=te,document.body.appendChild(v),v.click(),document.body.removeChild(v),URL.revokeObjectURL(C)}async function $(e){const t=await s("/api/tool-eval/import",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){const o=await t.json().catch(()=>({}));throw new Error(o.error||"Import failed")}return await t.json()}async function L(){const e=await s("/api/tool-eval/import/example");if(!e.ok)throw new Error("Failed to download example");const t=await e.blob(),o=URL.createObjectURL(t),r=document.createElement("a");r.href=o,r.download="suite-example.json",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(o)}async function R(e,t){const o=await s(`/api/tool-suites/${e}/cases`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!o.ok)throw new Error("Failed to create test case");return await o.json()}async function M(e,t,o){const r=await s(`/api/tool-suites/${e}/cases/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!r.ok)throw new Error("Failed to update test case");return await r.json()}async function H(e,t){if(!(await s(`/api/tool-suites/${e}/cases/${t}`,{method:"DELETE"})).ok)throw new Error("Failed to delete test case")}async function D(e){const t=await s("/api/tool-eval",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(t.status===409)throw new Error("A benchmark or eval is already running");if(!t.ok){const r=await t.json().catch(()=>({}));throw new Error(r.error||`Server error (${t.status})`)}const o=await t.json();l.value=o.job_id,d.value=!0,n.value=Date.now();try{sessionStorage.setItem("_teJobId",o.job_id)}catch{}return o}async function A(){if(l.value){if(!(await s("/api/tool-eval/cancel",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({job_id:l.value})})).ok)throw new Error("Failed to cancel")}else await s("/api/tool-eval/cancel",{method:"POST"})}function B(e){switch(e.type){case"job_started":d.value=!0,n.value=Date.now();break;case"tool_eval_init":{const t=e.data||e,o=t.targets?t.targets.length:0;c.value=o*(t.total_cases||0);break}case"tool_eval_result":{const t=e.data||e;m.value.push(t);break}case"tool_eval_progress":{const t=e.data||e;c.value=t.total||c.value;break}case"tool_eval_summary":{const t=e.data||e;h.value.push(t);break}case"tool_eval_complete":{const t=e.data||e;d.value=!1,t.eval_id&&(b.value=t.eval_id),l.value=null,n.value=null;try{sessionStorage.removeItem("_teJobId")}catch{}break}case"job_completed":d.value=!1,l.value=null,n.value=null;try{sessionStorage.removeItem("_teJobId")}catch{}break;case"job_failed":d.value=!1,l.value=null,n.value=null;try{sessionStorage.removeItem("_teJobId")}catch{}break;case"job_cancelled":d.value=!1,l.value=null,n.value=null;try{sessionStorage.removeItem("_teJobId")}catch{}break}}function q(){m.value=[],h.value=[],d.value=!1,l.value=null,n.value=null,c.value=0,b.value=null}async function K(){try{const e=await s("/api/tool-eval/history");if(!e.ok)throw new Error("Failed to load history");const t=await e.json();w.value=t.runs||[]}catch(e){throw console.error("loadHistory:",e),e}}async function Y(e){const t=await s(`/api/tool-eval/history/${e}`);if(!t.ok)throw new Error("Eval run not found");return await t.json()}async function z(e){if(!(await s(`/api/tool-eval/history/${e}`,{method:"DELETE"})).ok)throw new Error("Failed to delete eval run");w.value=w.value.filter(o=>o.id!==e)}async function G(e){const t=e?`/api/experiments?suite_id=${e}`:"/api/experiments",o=await s(t);if(!o.ok)throw new Error("Failed to load experiments");const r=await o.json();return S.value=r.experiments||r||[],S.value}async function Q(e){const o=await(await s("/api/mcp/discover",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:e})})).json();if(o.error)throw new Error(o.error);return o}async function V(e){const o=await(await s("/api/mcp/import",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();if(o.error)throw new Error(o.error);return o}function W(e,t){a.suiteId=e,a.suiteName=t,a.lastUpdatedBy=null,y()}function X(e){a.selectedModels=Array.isArray(e)?e:Array.from(e),y()}function Z(e,t){a.systemPrompts||(a.systemPrompts={}),a.systemPrompts[e]=t,y()}function ee(){Object.assign(a,{suiteId:null,suiteName:null,selectedModels:[],systemPrompts:{},temperature:0,toolChoice:"required",providerParams:{},experimentId:null,experimentName:null,lastUpdatedBy:null,promptTunerHint:null}),y()}return{suites:i,currentSuite:p,sharedContext:a,evalResults:m,evalSummaries:h,isEvaluating:d,activeJobId:l,evalStartTime:n,evalTotalCases:c,experiments:S,history:w,lastEvalId:b,suiteCount:x,currentTools:T,currentTestCases:k,selectedModelCount:_,loadSuites:P,loadSuite:I,createSuite:g,updateSuite:N,patchSuite:J,deleteSuite:F,exportSuite:U,importSuite:$,downloadImportExample:L,createTestCase:R,updateTestCase:M,deleteTestCase:H,runEval:D,cancelEval:A,handleEvalProgress:B,resetEval:q,loadHistory:K,loadHistoryRun:Y,deleteHistoryRun:z,loadExperiments:G,mcpDiscover:Q,mcpImport:V,setSuite:W,setModels:X,setSystemPrompt:Z,clearContext:ee,saveContext:y,loadContext:O}});function re(){const i=se();function p(n,c){i.setSuite(n,c)}function a(n){i.setModels(n)}function m(n,c){i.setSystemPrompt(n,c)}function h(){i.clearContext()}function d(n,c){i.sharedContext.experimentId=n,i.sharedContext.experimentName=c||null,i.saveContext()}function l(n){Object.assign(i.sharedContext,n),i.saveContext()}return{context:i.sharedContext,setSuite:p,setModels:a,setSystemPrompt:m,clearContext:h,setExperiment:d,setConfig:l}}export{se as a,re as u};
