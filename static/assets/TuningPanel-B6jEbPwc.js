import{o as Q,c as o,d as t,e as U,h as v,v as x,f as T,z as I,F as N,A as D,l as G,t as z,s as h,r as w,Q as V,B as $,K,M as H,b as l}from"./index-DQrEf9q5.js";import{_ as W}from"./_plugin-vue_export-helper-DlAUqK2U.js";const X={key:0,class:"text-zinc-600 text-sm font-body"},Y={key:1,class:"space-y-6"},Z={class:"card rounded-md overflow-hidden"},ee={key:0,class:"px-5 py-4"},te={class:"grid grid-cols-1 sm:grid-cols-3 gap-4"},se={class:"mt-4"},ae={class:"grid grid-cols-3 gap-4"},ne={class:"mt-4"},oe={class:"grid grid-cols-3 gap-4"},le={class:"card rounded-md overflow-hidden"},re={key:0,class:"px-5 py-4"},ie={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},pe={class:"card rounded-md overflow-hidden"},ue={key:0,class:"px-5 py-4"},de={key:0,class:"text-center py-4"},me={key:1},ve={class:"flex items-center gap-3 mb-4"},ce=["value"],xe={key:0,class:"overflow-x-auto"},_e={class:"w-full text-xs"},ye={class:"px-2 py-2 font-mono text-zinc-300"},fe={class:"px-2 py-2 text-center"},be=["checked","onChange"],ge={class:"px-2 py-2 text-center text-zinc-500"},ke={class:"px-2 py-2 text-right"},he=["value","onChange"],we={key:1},Ce={class:"px-2 py-2 text-right"},Te=["value","onChange"],ze={key:1},Pe={class:"px-2 py-2 text-right"},Se=["value","onChange"],Me={key:1},Fe={class:"px-2 py-2 text-right"},je=["type","value","onChange"],Ue={key:1},Ve={class:"px-2 py-2 text-center"},Be=["onClick"],Oe={key:1,class:"text-xs text-zinc-600 font-body text-center py-3"},Ie={__name:"TuningPanel",setup(Ne){const{showToast:_}=K(),{inputModal:q}=H(),P=w(!0),y=w(""),C=w(!0);let S=null,M=null;const m=V({paramTuner:!0,promptTuner:!1,paramSupport:!1}),a=V({max_combinations:50,temp_min:0,temp_max:1,temp_step:.5,top_p_min:.5,top_p_max:1,top_p_step:.25}),u=V({mode:"quick",max_api_calls:100,generations:3,population_size:5}),i=w(null),d=w(""),f=$(()=>{var n;return(n=i.value)!=null&&n.provider_defaults?Object.keys(i.value.provider_defaults).sort():[]}),F=$(()=>{var n,e;return(e=(n=i.value)==null?void 0:n.provider_defaults)!=null&&e[d.value]?i.value.provider_defaults[d.value].params||{}:{}});function b(n){return n==="float"||n==="int"}function A(){}async function R(){P.value=!0;try{const n=await h("/api/settings/phase10");if(n.ok){const e=await n.json(),s=e.param_tuner||{};a.max_combinations=s.max_combinations??50,a.temp_min=s.temp_min??0,a.temp_max=s.temp_max??1,a.temp_step=s.temp_step??.5,a.top_p_min=s.top_p_min??.5,a.top_p_max=s.top_p_max??1,a.top_p_step=s.top_p_step??.25;const r=e.prompt_tuner||{};u.mode=r.mode||"quick",u.max_api_calls=r.max_api_calls??100,u.generations=r.generations??3,u.population_size=r.population_size??5,e.param_support&&e.param_support.provider_defaults&&Object.keys(e.param_support.provider_defaults).length>0&&(i.value=e.param_support,f.value.length>0&&(d.value=f.value[0]))}}catch{_("Failed to load settings","error")}finally{P.value=!1}}function c(){S&&clearTimeout(S),S=setTimeout(E,500)}async function E(){const n={param_tuner:{max_combinations:parseInt(a.max_combinations)||50,temp_min:parseFloat(a.temp_min)||0,temp_max:parseFloat(a.temp_max)||1,temp_step:parseFloat(a.temp_step)||.5,top_p_min:parseFloat(a.top_p_min)||.5,top_p_max:parseFloat(a.top_p_max)||1,top_p_step:parseFloat(a.top_p_step)||.25},prompt_tuner:{mode:u.mode||"quick",max_api_calls:parseInt(u.max_api_calls)||100,generations:parseInt(u.generations)||3,population_size:parseInt(u.population_size)||5}};try{(await h("/api/settings/phase10",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})).ok?(y.value="Saved",C.value=!0,setTimeout(()=>{y.value=""},3e3)):(y.value="Failed to save",C.value=!1)}catch{y.value="Network error",C.value=!1}}async function B(){try{const n=await h("/api/param-support/seed",{method:"POST"});if(!n.ok){_("Failed to seed param support","error");return}const e=await n.json();i.value=e,await h("/api/settings/phase10",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({param_support:e})}),f.value.length>0&&(d.value=f.value[0]),_("Parameter support initialized","success")}catch{_("Failed to seed param support","error")}}function g(n,e,s){var r,p,k,O;(O=(k=(p=(r=i.value)==null?void 0:r.provider_defaults)==null?void 0:p[d.value])==null?void 0:k.params)!=null&&O[n]&&(i.value.provider_defaults[d.value].params[n][e]=s,j())}function J(n){var e,s,r;(r=(s=(e=i.value)==null?void 0:e.provider_defaults)==null?void 0:s[d.value])!=null&&r.params&&(delete i.value.provider_defaults[d.value].params[n],i.value={...i.value},j())}async function L(){var p,k;const n=await q("Add Parameter","Parameter name (e.g. top_k)"),e=typeof n=="object"?n==null?void 0:n.value:n;if(!e||!e.trim())return;const s=e.trim();if(!((k=(p=i.value)==null?void 0:p.provider_defaults)!=null&&k[d.value]))return;if(i.value.provider_defaults[d.value].params||(i.value.provider_defaults[d.value].params={}),i.value.provider_defaults[d.value].params[s]){_("Parameter already exists","error");return}i.value.provider_defaults[d.value].params[s]={enabled:!0,type:"float",min:0,max:1,step:.1,default:0},i.value={...i.value},j(),_(`Parameter "${s}" added`,"success")}function j(){M&&clearTimeout(M),M=setTimeout(async()=>{try{await h("/api/settings/phase10",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({param_support:i.value})})}catch{_("Failed to save param support config","error")}},600)}return Q(R),(n,e)=>(l(),o("div",null,[P.value?(l(),o("div",X,"Loading settings...")):(l(),o("div",Y,[t("div",Z,[t("div",{class:"px-5 py-3 flex items-center justify-between cursor-pointer",style:{"border-bottom":"1px solid var(--border-subtle)"},onClick:e[0]||(e[0]=s=>m.paramTuner=!m.paramTuner)},[e[16]||(e[16]=t("span",{class:"section-label"},"Parameter Tuner Defaults",-1)),(l(),o("svg",{class:U(["w-4 h-4 text-zinc-600 transition-transform",{"rotate-180":m.paramTuner}]),fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[...e[15]||(e[15]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19 9l-7 7-7-7"},null,-1)])],2))]),m.paramTuner?(l(),o("div",ee,[t("div",te,[t("div",null,[e[17]||(e[17]=t("label",{class:"field-label"},"Max Combinations",-1)),v(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>a.max_combinations=s),type:"number",onChange:c,class:"settings-input"},null,544),[[x,a.max_combinations,void 0,{number:!0}]])])]),t("div",se,[e[21]||(e[21]=t("span",{class:"text-[10px] text-zinc-600 font-display tracking-wider uppercase block mb-2"},"Temperature Range",-1)),t("div",ae,[t("div",null,[e[18]||(e[18]=t("label",{class:"field-label"},"Min",-1)),v(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>a.temp_min=s),type:"number",step:"0.1",onChange:c,class:"settings-input"},null,544),[[x,a.temp_min,void 0,{number:!0}]])]),t("div",null,[e[19]||(e[19]=t("label",{class:"field-label"},"Max",-1)),v(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>a.temp_max=s),type:"number",step:"0.1",onChange:c,class:"settings-input"},null,544),[[x,a.temp_max,void 0,{number:!0}]])]),t("div",null,[e[20]||(e[20]=t("label",{class:"field-label"},"Step",-1)),v(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>a.temp_step=s),type:"number",step:"0.1",onChange:c,class:"settings-input"},null,544),[[x,a.temp_step,void 0,{number:!0}]])])])]),t("div",ne,[e[25]||(e[25]=t("span",{class:"text-[10px] text-zinc-600 font-display tracking-wider uppercase block mb-2"},"Top P Range",-1)),t("div",oe,[t("div",null,[e[22]||(e[22]=t("label",{class:"field-label"},"Min",-1)),v(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>a.top_p_min=s),type:"number",step:"0.05",onChange:c,class:"settings-input"},null,544),[[x,a.top_p_min,void 0,{number:!0}]])]),t("div",null,[e[23]||(e[23]=t("label",{class:"field-label"},"Max",-1)),v(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>a.top_p_max=s),type:"number",step:"0.05",onChange:c,class:"settings-input"},null,544),[[x,a.top_p_max,void 0,{number:!0}]])]),t("div",null,[e[24]||(e[24]=t("label",{class:"field-label"},"Step",-1)),v(t("input",{"onUpdate:modelValue":e[7]||(e[7]=s=>a.top_p_step=s),type:"number",step:"0.05",onChange:c,class:"settings-input"},null,544),[[x,a.top_p_step,void 0,{number:!0}]])])])])])):T("",!0)]),t("div",le,[t("div",{class:"px-5 py-3 flex items-center justify-between cursor-pointer",style:{"border-bottom":"1px solid var(--border-subtle)"},onClick:e[8]||(e[8]=s=>m.promptTuner=!m.promptTuner)},[e[27]||(e[27]=t("span",{class:"section-label"},"Prompt Tuner Defaults",-1)),(l(),o("svg",{class:U(["w-4 h-4 text-zinc-600 transition-transform",{"rotate-180":m.promptTuner}]),fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[...e[26]||(e[26]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19 9l-7 7-7-7"},null,-1)])],2))]),m.promptTuner?(l(),o("div",re,[t("div",ie,[t("div",null,[e[29]||(e[29]=t("label",{class:"field-label"},"Mode",-1)),v(t("select",{"onUpdate:modelValue":e[9]||(e[9]=s=>u.mode=s),onChange:c,class:"settings-select"},[...e[28]||(e[28]=[t("option",{value:"quick"},"Quick",-1),t("option",{value:"thorough"},"Thorough",-1),t("option",{value:"exhaustive"},"Exhaustive",-1)])],544),[[I,u.mode]])]),t("div",null,[e[30]||(e[30]=t("label",{class:"field-label"},"Max API Calls",-1)),v(t("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>u.max_api_calls=s),type:"number",onChange:c,class:"settings-input"},null,544),[[x,u.max_api_calls,void 0,{number:!0}]])]),t("div",null,[e[31]||(e[31]=t("label",{class:"field-label"},"Generations",-1)),v(t("input",{"onUpdate:modelValue":e[11]||(e[11]=s=>u.generations=s),type:"number",onChange:c,class:"settings-input"},null,544),[[x,u.generations,void 0,{number:!0}]])]),t("div",null,[e[32]||(e[32]=t("label",{class:"field-label"},"Population Size",-1)),v(t("input",{"onUpdate:modelValue":e[12]||(e[12]=s=>u.population_size=s),type:"number",onChange:c,class:"settings-input"},null,544),[[x,u.population_size,void 0,{number:!0}]])])])])):T("",!0)]),t("div",pe,[t("div",{class:"px-5 py-3 flex items-center justify-between cursor-pointer",style:{"border-bottom":"1px solid var(--border-subtle)"},onClick:e[13]||(e[13]=s=>m.paramSupport=!m.paramSupport)},[e[34]||(e[34]=t("span",{class:"section-label"},"Provider Parameter Support",-1)),(l(),o("svg",{class:U(["w-4 h-4 text-zinc-600 transition-transform",{"rotate-180":m.paramSupport}]),fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[...e[33]||(e[33]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19 9l-7 7-7-7"},null,-1)])],2))]),m.paramSupport?(l(),o("div",ue,[i.value?(l(),o("div",me,[t("div",ve,[v(t("select",{"onUpdate:modelValue":e[14]||(e[14]=s=>d.value=s),onChange:A,class:"settings-select",style:{"max-width":"240px"}},[(l(!0),o(N,null,D(f.value,s=>{var r;return l(),o("option",{key:s,value:s},z(((r=i.value.provider_defaults[s])==null?void 0:r.display_name)||s),9,ce)}),128))],544),[[I,d.value]]),t("button",{onClick:B,class:"text-[10px] font-display tracking-wider uppercase text-zinc-500 hover:text-zinc-300 transition-colors px-2 py-1",style:{border:"1px solid var(--border-subtle)","border-radius":"2px"}},"Reset to Defaults")]),F.value&&Object.keys(F.value).length>0?(l(),o("div",xe,[t("table",_e,[e[37]||(e[37]=t("thead",null,[t("tr",{style:{"border-bottom":"1px solid var(--border-subtle)"}},[t("th",{class:"px-2 py-1.5 text-left text-[10px] font-display tracking-wider uppercase text-zinc-500"},"Param"),t("th",{class:"px-2 py-1.5 text-center text-[10px] font-display tracking-wider uppercase text-zinc-500"},"Enabled"),t("th",{class:"px-2 py-1.5 text-center text-[10px] font-display tracking-wider uppercase text-zinc-500"},"Type"),t("th",{class:"px-2 py-1.5 text-right text-[10px] font-display tracking-wider uppercase text-zinc-500"},"Min"),t("th",{class:"px-2 py-1.5 text-right text-[10px] font-display tracking-wider uppercase text-zinc-500"},"Max"),t("th",{class:"px-2 py-1.5 text-right text-[10px] font-display tracking-wider uppercase text-zinc-500"},"Step"),t("th",{class:"px-2 py-1.5 text-right text-[10px] font-display tracking-wider uppercase text-zinc-500"},"Default"),t("th",{class:"px-2 py-1.5 text-center text-[10px] font-display tracking-wider uppercase text-zinc-500"})])],-1)),t("tbody",null,[(l(!0),o(N,null,D(F.value,(s,r)=>(l(),o("tr",{key:r,style:{"border-bottom":"1px solid rgba(255,255,255,0.03)"}},[t("td",ye,z(r),1),t("td",fe,[t("input",{type:"checkbox",checked:s.enabled!==!1,onChange:p=>g(r,"enabled",p.target.checked),class:"accent-lime-400"},null,40,be)]),t("td",ge,z(s.type||"-"),1),t("td",ke,[b(s.type)?(l(),o("input",{key:0,type:"number",value:s.min,onChange:p=>g(r,"min",parseFloat(p.target.value)),class:"param-input"},null,40,he)):(l(),o("span",we,"-"))]),t("td",Ce,[b(s.type)?(l(),o("input",{key:0,type:"number",value:s.max,onChange:p=>g(r,"max",parseFloat(p.target.value)),class:"param-input"},null,40,Te)):(l(),o("span",ze,"-"))]),t("td",Pe,[b(s.type)?(l(),o("input",{key:0,type:"number",value:s.step,onChange:p=>g(r,"step",parseFloat(p.target.value)),class:"param-input"},null,40,Se)):(l(),o("span",Me,"-"))]),t("td",Fe,[s.default!==void 0?(l(),o("input",{key:0,type:b(s.type)?"number":"text",value:s.default,onChange:p=>g(r,"default",b(s.type)?parseFloat(p.target.value):p.target.value),class:"param-input"},null,40,je)):(l(),o("span",Ue,"-"))]),t("td",Ve,[t("button",{onClick:p=>J(r),class:"text-zinc-700 hover:text-red-400 transition-colors",title:"Remove"},[...e[36]||(e[36]=[t("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])],8,Be)])]))),128))])])])):(l(),o("div",Oe,"No parameters configured for this provider.")),t("button",{onClick:L,class:"mt-3 text-[10px] font-mono text-zinc-500 hover:text-zinc-300 px-2 py-1 rounded-sm",style:{border:"1px solid var(--border-subtle)"}},"+ Add Parameter")])):(l(),o("div",de,[e[35]||(e[35]=t("p",{class:"text-zinc-600 text-xs font-body mb-3"},"Parameter support not configured yet.",-1)),t("button",{onClick:B,class:"lime-btn"},"Initialize Parameter Support")]))])):T("",!0)]),y.value?(l(),o("div",{key:0,class:"text-[11px] font-body",style:G(`color:${C.value?"var(--lime)":"var(--coral)"}`)},z(y.value),5)):T("",!0)]))]))}},qe=W(Ie,[["__scopeId","data-v-e7e7fdfa"]]);export{qe as default};
