import{b as c,c as x,d as e,f as F,F as E,A as T,t as f,Q as A,o as O,n as W,y as U,h as S,v as z,z as q,l as N,e as X,g as Y,a0 as Z,s as w,r as $,K as B,i as ee,M as te}from"./index-BMBAIBBO.js";import{u as le}from"./useProviderColors-Da1NAcoQ.js";const oe={class:"overflow-x-auto"},se={class:"w-full text-sm results-table"},ne={key:0},re={key:1},ae={class:"px-5 py-3 text-zinc-200 text-sm"},ie={class:"px-5 py-3 text-center font-mono text-xs text-zinc-400"},de={class:"px-5 py-3 text-center text-xs text-zinc-400"},ce={class:"px-5 py-3 text-right text-xs font-mono text-zinc-500"},ue={class:"px-5 py-3 text-right text-xs font-mono text-zinc-500"},pe={class:"px-5 py-3 text-center"},me={class:"relative inline-flex items-center cursor-pointer"},xe=["checked","onChange"],fe={class:"px-5 py-3 text-right"},be={class:"flex items-center justify-end gap-2"},ve=["onClick"],he=["onClick"],ye={__name:"ScheduleTable",props:{schedules:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["toggle-enabled","trigger","delete"],setup(y){const b=[{value:1,label:"Every hour"},{value:6,label:"Every 6 hours"},{value:12,label:"Every 12 hours"},{value:24,label:"Every day"},{value:168,label:"Every week"}];function u(o){const s=o.models||[];if(typeof o.models_json=="string")try{return JSON.parse(o.models_json).length}catch{return 0}return s.length}function g(o){const s=b.find(r=>r.value===o);return s?s.label:o<24?`Every ${o}h`:o%168===0?`Every ${o/168}w`:o%24===0?`Every ${o/24}d`:`Every ${o}h`}function m(o){if(!o)return"--";const s=new Date(o),r=new Date,p=s.getTime()-r.getTime();if(Math.abs(p)<6e4)return"just now";const a=Math.abs(p);if(a<36e5){const h=Math.round(a/6e4);return p>0?`in ${h}m`:`${h}m ago`}if(a<864e5){const h=Math.round(a/36e5);return p>0?`in ${h}h`:`${h}h ago`}return s.toLocaleDateString()+" "+s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}return(o,s)=>(c(),x("div",oe,[e("table",se,[s[3]||(s[3]=e("thead",null,[e("tr",{style:{"border-bottom":"1px solid var(--border-subtle)"}},[e("th",{class:"px-5 py-3 text-left section-label"},"Name"),e("th",{class:"px-5 py-3 text-center section-label"},"Models"),e("th",{class:"px-5 py-3 text-center section-label"},"Interval"),e("th",{class:"px-5 py-3 text-right section-label"},"Last Run"),e("th",{class:"px-5 py-3 text-right section-label"},"Next Run"),e("th",{class:"px-5 py-3 text-center section-label"},"Status"),e("th",{class:"px-5 py-3 text-right section-label"},"Actions")])],-1)),e("tbody",null,[y.loading?(c(),x("tr",ne,[...s[0]||(s[0]=[e("td",{colspan:"7",class:"px-5 py-8 text-center text-zinc-600 text-sm"},"Loading...",-1)])])):y.schedules.length?F("",!0):(c(),x("tr",re,[...s[1]||(s[1]=[e("td",{colspan:"7",class:"px-5 py-8 text-center text-zinc-600 text-sm"}," No schedules yet. Create one to automate recurring benchmarks. ",-1)])])),(c(!0),x(E,null,T(y.schedules,r=>(c(),x("tr",{key:r.id,style:{"border-top":"1px solid var(--border-subtle)"}},[e("td",ae,f(r.name),1),e("td",ie,f(u(r)),1),e("td",de,f(g(r.interval_hours)),1),e("td",ce,f(m(r.last_run)),1),e("td",ue,f(m(r.next_run)),1),e("td",pe,[e("label",me,[e("input",{type:"checkbox",checked:!!r.enabled,class:"sr-only peer",onChange:p=>o.$emit("toggle-enabled",r.id,p.target.checked)},null,40,xe),s[2]||(s[2]=e("div",{class:"w-8 h-4 rounded-full peer bg-zinc-700 peer-checked:bg-[rgba(191,255,0,0.4)] after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-zinc-400 after:rounded-full after:h-3 after:w-3 after:transition-all peer-checked:after:translate-x-4 peer-checked:after:bg-[var(--lime)]"},null,-1))])]),e("td",fe,[e("div",be,[e("button",{class:"text-[10px] font-display tracking-wider uppercase text-zinc-500 hover:text-zinc-300 transition-colors px-2 py-1 rounded-sm border border-[var(--border-subtle)]",onClick:p=>o.$emit("trigger",r.id)},"Run Now",8,ve),e("button",{class:"text-[10px] font-display tracking-wider uppercase text-zinc-600 hover:text-red-400 transition-colors px-2 py-1 rounded-sm border border-[var(--border-subtle)]",onClick:p=>o.$emit("delete",r.id,r.name)},"Del",8,he)])])]))),128))])])]))}},ge={class:"modal-box",style:{"max-width":"600px","max-height":"85vh","overflow-y":"auto"}},ke={class:"modal-title"},_e={class:"space-y-4"},we={class:"grid grid-cols-2 gap-4"},$e=["value"],Se={key:0,class:"text-zinc-600 text-xs py-2"},Ce={key:1,class:"flex flex-col gap-1 max-h-48 overflow-y-auto pr-1",style:{"scrollbar-width":"thin"}},ze=["onClick"],Ee={class:"provider-group-count"},Te={class:"grid grid-cols-1 sm:grid-cols-2 gap-2 pl-3"},De=["onClick"],Me={class:"text-[12px] font-medium text-zinc-200 truncate"},Ne={class:"mt-1 text-[10px] font-mono text-zinc-600"},je={class:"modal-buttons mt-4"},Ie={__name:"NewScheduleModal",props:{editId:{type:String,default:null},initialData:{type:Object,default:null}},emits:["close","created"],setup(y,{emit:b}){var j,I,P,L,V;const u=y,g=b,{showToast:m}=B(),{getColor:o}=le(),s=$(null),r=$(!1),p=$([]),a=A(new Set),h=[{value:1,label:"Every hour"},{value:6,label:"Every 6 hours"},{value:12,label:"Every 12 hours"},{value:24,label:"Every day"},{value:168,label:"Every week"}],n=A({name:((j=u.initialData)==null?void 0:j.name)||"",prompt:((I=u.initialData)==null?void 0:I.prompt)||"Write a short story about a robot learning to paint.",interval_hours:((P=u.initialData)==null?void 0:P.interval_hours)||24,max_tokens:((L=u.initialData)==null?void 0:L.max_tokens)||512,temperature:((V=u.initialData)==null?void 0:V.temperature)||.7});function i(d){a.has(d)?a.delete(d):a.add(d)}function k(d){const t=d.models.every(l=>a.has(l.model_id));d.models.forEach(l=>{t?a.delete(l.model_id):a.add(l.model_id)})}function D(){p.value.forEach(d=>d.models.forEach(t=>a.add(t.model_id)))}function R(){a.clear()}async function J(){r.value=!0;try{const t=await(await w("/api/config")).json(),l=[];for(const[v,_]of Object.entries(t.providers||{})){const H=o(v),M=[],K=_.models||[];for(const C of K){const Q=_.model_id_prefix?`${_.model_id_prefix}${C.model_id}`:C.model_id;M.push({model_id:Q,display_name:C.display_name||C.id})}M.length&&l.push({provider:v,color:H,models:M})}p.value=l}catch{m("Failed to load model config","error")}finally{r.value=!1}}async function G(){if(!n.name.trim()){m("Please enter a schedule name","error");return}if(!n.prompt.trim()){m("Please enter a prompt","error");return}if(!a.size){m("Please select at least one model","error");return}const d={name:n.name.trim(),prompt:n.prompt.trim(),models:Array.from(a),interval_hours:n.interval_hours,max_tokens:n.max_tokens,temperature:n.temperature};try{const t=u.editId?`/api/schedules/${u.editId}`:"/api/schedules",l=u.editId?"PUT":"POST",v=await w(t,{method:l,headers:{"Content-Type":"application/json"},body:JSON.stringify(d)});if(v.ok)g("created");else{const _=await v.json();m(_.error||_.detail||"Failed to save schedule","error")}}catch{m("Network error saving schedule","error")}}return O(async()=>{var d,t;await J(),(d=u.initialData)!=null&&d.models&&u.initialData.models.forEach(l=>a.add(l)),await W(),(t=s.value)==null||t.focus()}),(d,t)=>(c(),U(Z,{to:"body"},[e("div",{class:"modal-overlay",onClick:t[6]||(t[6]=Y(l=>d.$emit("close"),["self"]))},[e("div",ge,[e("div",ke,f(y.editId?"Edit Schedule":"New Schedule"),1),e("div",_e,[e("div",null,[t[7]||(t[7]=e("label",{class:"text-[10px] text-zinc-600 font-display tracking-wider uppercase block mb-1"},"Schedule Name",-1)),S(e("input",{ref_key:"nameInput",ref:s,"onUpdate:modelValue":t[0]||(t[0]=l=>n.name=l),class:"modal-input w-full",style:{"margin-bottom":"0"},placeholder:"e.g. Daily throughput check"},null,512),[[z,n.name]])]),e("div",null,[t[8]||(t[8]=e("label",{class:"text-[10px] text-zinc-600 font-display tracking-wider uppercase block mb-1"},"Prompt",-1)),S(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=l=>n.prompt=l),rows:"3",class:"prompt-input w-full rounded-sm px-4 py-3",placeholder:"Enter benchmark prompt..."},null,512),[[z,n.prompt]])]),e("div",we,[e("div",null,[t[9]||(t[9]=e("label",{class:"text-[10px] text-zinc-600 font-display tracking-wider uppercase block mb-1"},"Interval",-1)),S(e("select",{"onUpdate:modelValue":t[2]||(t[2]=l=>n.interval_hours=l),class:"w-full px-3 py-2 rounded-sm text-sm font-mono text-zinc-200 outline-none",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)"}},[(c(),x(E,null,T(h,l=>e("option",{key:l.value,value:l.value},f(l.label),9,$e)),64))],512),[[q,n.interval_hours,void 0,{number:!0}]])]),e("div",null,[t[10]||(t[10]=e("label",{class:"text-[10px] text-zinc-600 font-display tracking-wider uppercase block mb-1"},"Max Tokens",-1)),S(e("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>n.max_tokens=l),type:"number",class:"w-full px-3 py-2 rounded-sm text-sm font-mono text-zinc-200 outline-none",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)"}},null,512),[[z,n.max_tokens,void 0,{number:!0}]])])]),e("div",null,[t[11]||(t[11]=e("label",{class:"text-[10px] text-zinc-600 font-display tracking-wider uppercase block mb-1"},"Temperature",-1)),S(e("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>n.temperature=l),type:"number",step:"0.1",min:"0",max:"2",class:"px-3 py-2 rounded-sm text-sm font-mono text-zinc-200 outline-none",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)","max-width":"120px"}},null,512),[[z,n.temperature,void 0,{number:!0}]])]),e("div",null,[e("div",{class:"flex items-center justify-between mb-2"},[t[12]||(t[12]=e("label",{class:"text-[10px] text-zinc-600 font-display tracking-wider uppercase"},"Select Models",-1)),e("div",{class:"flex gap-2"},[e("button",{class:"text-[10px] font-display tracking-wider uppercase px-2 py-0.5 rounded-sm text-[var(--lime)] border border-[rgba(191,255,0,0.2)]",onClick:D},"All"),e("button",{class:"text-[10px] font-display tracking-wider uppercase px-2 py-0.5 rounded-sm text-zinc-600 border border-[var(--border-subtle)]",onClick:R},"Clear")])]),r.value?(c(),x("div",Se,"Loading models...")):(c(),x("div",Ce,[(c(!0),x(E,null,T(p.value,l=>(c(),x("div",{key:l.provider,class:"provider-group",style:N({borderColor:l.color.border})},[e("div",{class:"provider-group-header",onClick:v=>k(l)},[e("div",{class:"provider-group-dot",style:N({background:l.color.text})},null,4),e("span",{class:"provider-group-label",style:N({color:l.color.text})},f(l.provider),5),e("span",Ee,f(l.models.length),1)],8,ze),e("div",Te,[(c(!0),x(E,null,T(l.models,v=>(c(),x("div",{key:v.model_id,class:X(["model-card rounded-sm px-3 py-2 flex items-center gap-2",{selected:a.has(v.model_id)}]),onClick:_=>i(v.model_id)},[t[13]||(t[13]=e("div",{class:"check-dot flex-shrink-0"},null,-1)),e("div",Me,f(v.display_name),1)],10,De))),128))])],4))),128))])),e("div",Ne,f(a.size)+" models selected",1)])]),e("div",je,[e("button",{class:"modal-btn modal-btn-cancel",onClick:t[5]||(t[5]=l=>d.$emit("close"))},"Cancel"),e("button",{class:"modal-btn modal-btn-confirm",onClick:G},f(y.editId?"Save":"Create Schedule"),1)])])])]))}},Pe={class:"max-w-7xl mx-auto px-6 py-8"},Le={class:"flex items-center justify-between mb-6"},Fe={__name:"SchedulesPage",setup(y){const{showToast:b}=B(),{confirm:u}=te(),g=$([]),m=$(!1),o=$(!1);async function s(){m.value=!0;try{const i=await(await w("/api/schedules")).json();g.value=i.schedules||i||[]}catch{g.value=[]}finally{m.value=!1}}async function r(n,i){try{await w(`/api/schedules/${n}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({enabled:i})}),b(i?"Schedule enabled":"Schedule paused","success");const k=g.value.find(D=>D.id===n);k&&(k.enabled=i?1:0)}catch{b("Failed to update schedule","error"),s()}}async function p(n){try{await w(`/api/schedules/${n}/trigger`,{method:"POST"}),b("Schedule triggered - benchmark starting","success"),s()}catch{b("Failed to trigger schedule","error")}}async function a(n,i){if(await u("Delete Schedule",`Delete schedule "${i}"? This cannot be undone.`,{danger:!0,confirmLabel:"Delete"}))try{await w(`/api/schedules/${n}`,{method:"DELETE"}),b("Schedule deleted","success"),s()}catch{b("Failed to delete schedule","error")}}function h(){o.value=!1,b("Schedule created","success"),s()}return O(s),(n,i)=>(c(),x("div",Pe,[e("div",Le,[i[2]||(i[2]=e("h1",{class:"font-display text-lg font-semibold text-zinc-200 uppercase tracking-wider"},"Schedules",-1)),e("button",{class:"text-[11px] font-display tracking-wider uppercase px-4 py-2 rounded-sm text-[var(--lime)] border border-[rgba(191,255,0,0.3)] bg-[var(--lime-dim)] hover:bg-[rgba(191,255,0,0.15)] transition-all",onClick:i[0]||(i[0]=k=>o.value=!0)}," New Schedule ")]),ee(ye,{schedules:g.value,loading:m.value,onToggleEnabled:r,onTrigger:p,onDelete:a},null,8,["schedules","loading"]),o.value?(c(),U(Ie,{key:0,onClose:i[1]||(i[1]=k=>o.value=!1),onCreated:h})):F("",!0)]))}};export{Fe as default};
