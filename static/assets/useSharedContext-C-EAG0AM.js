import{S as re,r as u,Q as ne,B as S,s as n}from"./index-DBNJ0RjU.js";const se=re("toolEval",()=>{const i=u([]),p=u(null),a=ne({suiteId:null,suiteName:null,selectedModels:[],systemPrompts:{},temperature:0,toolChoice:"required",providerParams:{},experimentId:null,experimentName:null,lastUpdatedBy:null,promptTunerHint:null}),m=u([]),f=u([]),d=u(!1),l=u(null),s=u(null),c=u(0),b=u([]),w=u([]),j=u(null),k=S(()=>i.value.length),_=S(()=>{var e;return((e=p.value)==null?void 0:e.tools)||[]}),O=S(()=>{var e;return((e=p.value)==null?void 0:e.test_cases)||[]}),I=S(()=>a.selectedModels.length),C="_sharedContext_vue";function y(){try{sessionStorage.setItem(C,JSON.stringify({suiteId:a.suiteId,suiteName:a.suiteName,selectedModels:a.selectedModels,systemPrompts:a.systemPrompts,temperature:a.temperature,toolChoice:a.toolChoice,providerParams:a.providerParams,experimentId:a.experimentId,experimentName:a.experimentName,lastUpdatedBy:a.lastUpdatedBy}))}catch{}}function g(){try{const e=sessionStorage.getItem(C);if(e){const t=JSON.parse(e);Object.assign(a,t)}}catch{}}async function P(){try{const e=await n("/api/tool-suites");if(!e.ok)throw new Error("Failed to load suites");const t=await e.json();i.value=t.suites||[]}catch(e){throw console.error("loadSuites:",e),e}}async function N(e){try{const t=await n(`/api/tool-suites/${e}`);if(!t.ok)throw new Error("Suite not found");return p.value=await t.json(),p.value}catch(t){throw console.error("loadSuite:",t),t}}async function F(e){const t=await n("/api/tool-suites",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){const r=await t.json().catch(()=>({}));throw new Error(r.error||"Failed to create suite")}return await t.json()}async function J(e,t){const o=await n(`/api/tool-suites/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!o.ok){const r=await o.json().catch(()=>({}));throw new Error(r.error||"Failed to update suite")}return await o.json()}async function U(e,t){const o=await n(`/api/tool-suites/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!o.ok)throw new Error("Failed to patch suite");return await o.json()}async function $(e){if(!(await n(`/api/tool-suites/${e}`,{method:"DELETE"})).ok)throw new Error("Failed to delete suite");i.value=i.value.filter(o=>o.id!==e)}async function L(e){const t=await n(`/api/tool-suites/${e}/export`);if(!t.ok)throw new Error("Failed to export suite");const o=await t.blob(),v=(t.headers.get("content-disposition")||"").match(/filename=([^\s;]+)/),ae=v?v[1]:`suite-${e.slice(0,8)}.json`,T=URL.createObjectURL(o),h=document.createElement("a");h.href=T,h.download=ae,document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(T)}async function E(e){const t=await n("/api/tool-eval/import",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){const o=await t.json().catch(()=>({}));throw new Error(o.error||"Import failed")}return await t.json()}async function x(e,t){const o=await n("/api/tool-eval/import/bfcl",{method:"POST",headers:{"Content-Type":"application/json","X-Suite-Name":t||"BFCL Import"},body:JSON.stringify(e)});if(!o.ok){const r=await o.json().catch(()=>({}));throw new Error(r.error||"BFCL import failed")}return await o.json()}async function B(e,t){if(Array.isArray(e)||e&&typeof e=="object"&&("function"in e||"question"in e)){const r=(t||"").replace(/\.json$/i,"")||"BFCL Import",v=Array.isArray(e)?e:[e];return await x(v,r)}if(!e||!e.name||typeof e.name!="string")throw new Error('Unrecognized format: expected a standard suite (with "name") or BFCL format (with "function"/"question")');return await E(e)}async function R(){const e=await n("/api/tool-eval/import/example");if(!e.ok)throw new Error("Failed to download example");const t=await e.blob(),o=URL.createObjectURL(t),r=document.createElement("a");r.href=o,r.download="suite-example.json",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(o)}async function M(e,t){const o=await n(`/api/tool-suites/${e}/cases`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!o.ok)throw new Error("Failed to create test case");return await o.json()}async function A(e,t,o){const r=await n(`/api/tool-suites/${e}/cases/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!r.ok)throw new Error("Failed to update test case");return await r.json()}async function H(e,t){if(!(await n(`/api/tool-suites/${e}/cases/${t}`,{method:"DELETE"})).ok)throw new Error("Failed to delete test case")}async function D(e){const t=await n("/api/tool-eval",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(t.status===409)throw new Error("A benchmark or eval is already running");if(!t.ok){const r=await t.json().catch(()=>({}));throw new Error(r.error||`Server error (${t.status})`)}const o=await t.json();l.value=o.job_id,d.value=!0,s.value=Date.now();try{sessionStorage.setItem("_teJobId",o.job_id)}catch{}return o}async function q(){if(l.value){if(!(await n("/api/tool-eval/cancel",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({job_id:l.value})})).ok)throw new Error("Failed to cancel")}else await n("/api/tool-eval/cancel",{method:"POST"})}function z(e){switch(e.type){case"job_started":d.value=!0,s.value=Date.now();break;case"tool_eval_init":{const t=e.data||e,o=t.targets?t.targets.length:0;c.value=o*(t.total_cases||0);break}case"tool_eval_result":{const t=e.data||e;m.value.push(t);break}case"tool_eval_progress":{const t=e.data||e;c.value=t.total||c.value;break}case"tool_eval_summary":{const t=e.data||e;f.value.push(t);break}case"tool_eval_complete":{const t=e.data||e;d.value=!1,t.eval_id&&(j.value=t.eval_id),l.value=null,s.value=null;try{sessionStorage.removeItem("_teJobId")}catch{}break}case"job_completed":d.value=!1,l.value=null,s.value=null;try{sessionStorage.removeItem("_teJobId")}catch{}break;case"job_failed":d.value=!1,l.value=null,s.value=null;try{sessionStorage.removeItem("_teJobId")}catch{}break;case"job_cancelled":d.value=!1,l.value=null,s.value=null;try{sessionStorage.removeItem("_teJobId")}catch{}break}}function K(){m.value=[],f.value=[],d.value=!1,l.value=null,s.value=null,c.value=0,j.value=null}async function Q(){try{const e=await n("/api/tool-eval/history");if(!e.ok)throw new Error("Failed to load history");const t=await e.json();w.value=t.runs||[]}catch(e){throw console.error("loadHistory:",e),e}}async function X(e){const t=await n(`/api/tool-eval/history/${e}`);if(!t.ok)throw new Error("Eval run not found");return await t.json()}async function Y(e){if(!(await n(`/api/tool-eval/history/${e}`,{method:"DELETE"})).ok)throw new Error("Failed to delete eval run");w.value=w.value.filter(o=>o.id!==e)}async function G(e){const t=e?`/api/experiments?suite_id=${e}`:"/api/experiments",o=await n(t);if(!o.ok)throw new Error("Failed to load experiments");const r=await o.json();return b.value=r.experiments||r||[],b.value}async function V(e){const o=await(await n("/api/mcp/discover",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:e})})).json();if(o.error)throw new Error(o.error);return o}async function W(e){const o=await(await n("/api/mcp/import",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();if(o.error)throw new Error(o.error);return o}function Z(e,t){a.suiteId=e,a.suiteName=t,a.lastUpdatedBy=null,y()}function ee(e){a.selectedModels=Array.isArray(e)?e:Array.from(e),y()}function te(e,t){a.systemPrompts||(a.systemPrompts={}),a.systemPrompts[e]=t,y()}function oe(){Object.assign(a,{suiteId:null,suiteName:null,selectedModels:[],systemPrompts:{},temperature:0,toolChoice:"required",providerParams:{},experimentId:null,experimentName:null,lastUpdatedBy:null,promptTunerHint:null}),y()}return{suites:i,currentSuite:p,sharedContext:a,evalResults:m,evalSummaries:f,isEvaluating:d,activeJobId:l,evalStartTime:s,evalTotalCases:c,experiments:b,history:w,lastEvalId:j,suiteCount:k,currentTools:_,currentTestCases:O,selectedModelCount:I,loadSuites:P,loadSuite:N,createSuite:F,updateSuite:J,patchSuite:U,deleteSuite:$,exportSuite:L,importSuite:E,importBfclSuite:x,smartImport:B,downloadImportExample:R,createTestCase:M,updateTestCase:A,deleteTestCase:H,runEval:D,cancelEval:q,handleEvalProgress:z,resetEval:K,loadHistory:Q,loadHistoryRun:X,deleteHistoryRun:Y,loadExperiments:G,mcpDiscover:V,mcpImport:W,setSuite:Z,setModels:ee,setSystemPrompt:te,clearContext:oe,saveContext:y,loadContext:g}});function le(){const i=se();function p(s,c){i.setSuite(s,c)}function a(s){i.setModels(s)}function m(s,c){i.setSystemPrompt(s,c)}function f(){i.clearContext()}function d(s,c){i.sharedContext.experimentId=s,i.sharedContext.experimentName=c||null,i.saveContext()}function l(s){Object.assign(i.sharedContext,s),i.saveContext()}return{context:i.sharedContext,setSuite:p,setModels:a,setSystemPrompt:m,clearContext:f,setExperiment:d,setConfig:l}}export{se as a,le as u};
