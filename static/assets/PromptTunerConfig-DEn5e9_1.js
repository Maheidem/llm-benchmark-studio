import{i as W,w as X,s as Z,c as n,a as t,q as j,B as ee,Q as F,d as _,l as te,f as x,A as G,F as M,p as P,g as E,b as V,t as i,v as q,k as I,G as oe,r as p,P as se,J as le,y as K,m as ne,o as l,R as re}from"./index-BxbfhC3f.js";import{a as ae,u as ie}from"./useSharedContext-DRtY8wlt.js";import{u as de}from"./promptTuner-CWsfemrF.js";import{u as ue}from"./config-DjVRhl1q.js";import"./useActiveSession-DdoXJmDo.js";const pe={class:"flex items-center justify-between mb-6"},ce={class:"flex items-center gap-2"},me={class:"card rounded-md p-5 mb-6"},ve=["value"],be={class:"card rounded-md p-5 mb-6"},xe={class:"grid grid-cols-2 gap-3"},ye={class:"card rounded-md p-5 mb-6"},fe=["value"],ge={class:"card rounded-md p-5 mb-6"},ke={class:"flex items-center justify-between mb-3"},_e={class:"text-xs font-mono text-zinc-600"},we={key:0,class:"text-xs text-zinc-600 font-body"},ze={key:1,class:"flex flex-col gap-1"},Se=["onClick"],he={class:"provider-group-count"},Ce={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2 pl-4 pb-2"},Te=["onClick"],Me={class:"text-xs font-mono text-zinc-200 truncate"},Pe={class:"card rounded-md p-5 mb-6"},Ee={class:"card rounded-md p-5 mb-6"},Ve={class:"grid grid-cols-3 gap-4"},qe={key:0},Ie={key:1},Re={key:0,class:"mt-3 text-[10px] text-zinc-600 font-body"},Be={key:0,class:"text-yellow-400 ml-2"},$e={class:"flex items-center justify-end"},Ae=["disabled"],Oe={__name:"PromptTunerConfig",setup(Ue){const N=ne(),w=ae(),z=de(),S=ue(),{showToast:R}=oe(),{context:m,setSuite:O}=ie(),c=p(""),r=p("quick"),y=p(""),d=se(new Set),h=p("You are a helpful assistant that uses tools to answer questions. When the user asks you to perform an action, use the appropriate tool."),g=p(5),k=p(3),B=p(.4),A=p(!0),U=p([]),v=p(null),D=K(()=>S.allModels||[]),$=K(()=>c.value&&y.value&&d.size>0&&!z.isRunning);W(async()=>{var s,e;if(w.suites.length===0)try{await w.loadSuites()}catch{}try{await S.loadConfig(),S.config&&L(S.config)}catch{R("Failed to load model config","error")}finally{A.value=!1}m.suiteId&&(c.value=m.suiteId),(s=m.selectedModels)!=null&&s.length&&m.selectedModels.forEach(b=>d.add(b)),(e=m.systemPrompts)!=null&&e._global&&(h.value=m.systemPrompts._global)}),X([c,r,g,k,()=>d.size],async()=>{if(!c.value){v.value=null;return}try{v.value=await z.getEstimate({suite_id:c.value,mode:r.value,population_size:g.value,generations:r.value==="quick"?1:k.value,num_models:d.size||1})}catch{v.value=null}},{debounce:500});function L(s){const e=[],b=s.providers||{};for(const[o,a]of Object.entries(b)){const f=a.provider_key||o,u=(a.models||[]).map(T=>({key:`${f}::${T.model_id}`,model_id:T.model_id,display_name:T.display_name||T.model_id,provider_key:f}));if(u.length===0)continue;const C=Z(a.display_name||o);e.push({provider:a.display_name||o,color:C.text,models:u,collapsed:!1})}U.value=e}function H(s){d.has(s)?d.delete(s):d.add(s)}function Q(){const s=w.suites.find(e=>e.id===c.value);s&&O(s.id,s.name)}function Y(s){return s?s<60?`${Math.round(s)}s`:`${Math.ceil(s/60)}m`:"?"}async function J(){if(!$.value)return;const s=y.value.indexOf("::"),e=y.value.substring(0,s),b=y.value.substring(s+2),o=Array.from(d).map(u=>{const C=u.indexOf("::");return{provider_key:u.substring(0,C),model_id:u.substring(C+2)}}),a=Array.from(d).map(u=>u.substring(u.indexOf("::")+2)),f={suite_id:c.value,mode:r.value,meta_model:b,meta_provider_key:e,target_models:a,target_targets:o,base_prompt:h.value,config:{population_size:g.value,generations:r.value==="quick"?1:k.value,selection_ratio:B.value}};m.experimentId&&(f.experiment_id=m.experimentId);try{await z.startTuning(f),R("Prompt tuning started","success"),N.push({name:"PromptTunerRun"})}catch(u){R(u.message||"Failed to start tuning","error")}}return(s,e)=>{const b=le("router-link");return l(),n("div",null,[t("div",pe,[e[10]||(e[10]=t("div",null,[t("h2",{class:"font-display font-bold text-lg text-zinc-100 mb-1"},"Prompt Tuner"),t("p",{class:"text-sm text-zinc-600 font-body"},"AI-powered system prompt optimization for tool calling.")],-1)),t("div",ce,[j(z).isRunning?(l(),ee(b,{key:0,to:{name:"PromptTunerRun"},class:"text-[10px] font-display tracking-wider uppercase px-3 py-1.5 rounded-sm",style:{background:"rgba(191,255,0,0.08)",border:"1px solid rgba(191,255,0,0.2)",color:"var(--lime)"}},{default:F(()=>[...e[8]||(e[8]=[I("View Active Run",-1)])]),_:1})):_("",!0),te(b,{to:{name:"PromptTunerHistory"},class:"text-[10px] font-display tracking-wider uppercase px-3 py-1.5 rounded-sm",style:{border:"1px solid var(--border-subtle)",color:"var(--zinc-400)"}},{default:F(()=>[...e[9]||(e[9]=[I("History",-1)])]),_:1})])]),t("div",me,[e[12]||(e[12]=t("label",{class:"section-label mb-2 block"},"Suite",-1)),x(t("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>c.value=o),onChange:Q,class:"text-sm font-mono px-3 py-2 rounded-sm w-full",style:{background:"var(--surface)",border:"1px solid var(--border-subtle)",color:"#E4E4E7",outline:"none"}},[e[11]||(e[11]=t("option",{value:""},"-- Select a suite --",-1)),(l(!0),n(M,null,P(j(w).suites,o=>(l(),n("option",{key:o.id,value:o.id},i(o.name)+" ("+i(o.tool_count||0)+" tools, "+i(o.test_case_count||0)+" cases) ",9,ve))),128))],544),[[G,c.value]])]),t("div",be,[e[15]||(e[15]=t("span",{class:"section-label mb-3 block"},"Tuning Mode",-1)),t("div",xe,[t("div",{class:V(["rounded-sm px-4 py-3 cursor-pointer transition-colors",r.value==="quick"?"bg-white/[0.04]":"hover:bg-white/[0.02]"]),style:E(r.value==="quick"?{border:"1px solid rgba(191,255,0,0.3)"}:{border:"1px solid var(--border-subtle)"}),onClick:e[1]||(e[1]=o=>r.value="quick")},[...e[13]||(e[13]=[t("div",{class:"text-xs font-display font-bold text-zinc-200 mb-1"},"Quick",-1),t("div",{class:"text-[10px] text-zinc-600 font-body"},"Generate N prompts, evaluate once. Fast and simple.",-1)])],6),t("div",{class:V(["rounded-sm px-4 py-3 cursor-pointer transition-colors",r.value==="evolutionary"?"bg-white/[0.04]":"hover:bg-white/[0.02]"]),style:E(r.value==="evolutionary"?{border:"1px solid rgba(168,85,247,0.3)"}:{border:"1px solid var(--border-subtle)"}),onClick:e[2]||(e[2]=o=>r.value="evolutionary")},[...e[14]||(e[14]=[t("div",{class:"text-xs font-display font-bold text-zinc-200 mb-1"},"Evolutionary",-1),t("div",{class:"text-[10px] text-zinc-600 font-body"},"Multiple generations with selection. Best survive and mutate.",-1)])],6)])]),t("div",ye,[e[17]||(e[17]=t("span",{class:"section-label mb-3 block"},"Meta Model (generates prompts)",-1)),x(t("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>y.value=o),class:"text-sm font-mono px-3 py-2 rounded-sm w-full",style:{background:"var(--surface)",border:"1px solid var(--border-subtle)",color:"#E4E4E7",outline:"none"}},[e[16]||(e[16]=t("option",{value:""},"-- Select meta model --",-1)),(l(!0),n(M,null,P(D.value,o=>(l(),n("option",{key:o.compoundKey,value:o.compoundKey},i(o.display_name||o.model_id)+" ("+i(o.provider)+") ",9,fe))),128))],512),[[G,y.value]])]),t("div",ge,[t("div",ke,[e[18]||(e[18]=t("span",{class:"section-label"},"Target Models (evaluated with generated prompts)",-1)),t("span",_e,i(d.size)+" selected",1)]),A.value?(l(),n("div",we,"Loading models...")):(l(),n("div",ze,[(l(!0),n(M,null,P(U.value,o=>(l(),n("div",{key:o.provider,class:"provider-group"},[t("div",{class:"provider-group-header",onClick:a=>o.collapsed=!o.collapsed},[t("div",{class:"provider-group-dot",style:E({background:o.color})},null,4),t("span",{class:"provider-group-label",style:E({color:o.color})},i(o.provider),5),t("span",he,i(o.models.length),1)],8,Se),x(t("div",Ce,[(l(!0),n(M,null,P(o.models,a=>(l(),n("div",{key:a.key,class:V(["model-card rounded-sm px-3 py-2 flex items-center gap-2",{selected:d.has(a.key)}]),onClick:f=>H(a.key)},[e[19]||(e[19]=t("div",{class:"check-dot"},null,-1)),t("div",Me,i(a.display_name||a.model_id),1)],10,Te))),128))],512),[[re,!o.collapsed]])]))),128))]))]),t("div",Pe,[e[20]||(e[20]=t("span",{class:"section-label mb-2 block"},"Base System Prompt",-1)),x(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=o=>h.value=o),rows:"4",class:"w-full text-xs font-body px-3 py-2 rounded-sm resize-y",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)",color:"#E4E4E7",outline:"none"},placeholder:"You are a helpful assistant that uses tools to answer questions..."},null,512),[[q,h.value]])]),t("div",Ee,[e[24]||(e[24]=t("span",{class:"section-label mb-3 block"},"Configuration",-1)),t("div",Ve,[t("div",null,[e[21]||(e[21]=t("label",{class:"text-[10px] text-zinc-600 font-display tracking-wider uppercase"},"Population Size",-1)),x(t("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>g.value=o),type:"number",min:"2",max:"20",class:"w-full px-2 py-1.5 rounded-sm text-xs font-mono text-zinc-200 mt-1",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)",outline:"none"}},null,512),[[q,g.value,void 0,{number:!0}]])]),r.value==="evolutionary"?(l(),n("div",qe,[e[22]||(e[22]=t("label",{class:"text-[10px] text-zinc-600 font-display tracking-wider uppercase"},"Generations",-1)),x(t("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>k.value=o),type:"number",min:"1",max:"10",class:"w-full px-2 py-1.5 rounded-sm text-xs font-mono text-zinc-200 mt-1",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)",outline:"none"}},null,512),[[q,k.value,void 0,{number:!0}]])])):_("",!0),r.value==="evolutionary"?(l(),n("div",Ie,[e[23]||(e[23]=t("label",{class:"text-[10px] text-zinc-600 font-display tracking-wider uppercase"},"Selection Ratio",-1)),x(t("input",{"onUpdate:modelValue":e[7]||(e[7]=o=>B.value=o),type:"number",min:"0.1",max:"0.9",step:"0.1",class:"w-full px-2 py-1.5 rounded-sm text-xs font-mono text-zinc-200 mt-1",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)",outline:"none"}},null,512),[[q,B.value,void 0,{number:!0}]])])):_("",!0)]),v.value?(l(),n("div",Re,[I(" Estimated: "+i(v.value.total_api_calls)+" API calls, ~"+i(Y(v.value.estimated_duration_s))+" ",1),v.value.warning?(l(),n("span",Be,i(v.value.warning),1)):_("",!0)])):_("",!0)]),t("div",$e,[t("button",{onClick:J,disabled:!$.value,class:V(["run-btn px-6 py-2 rounded-sm text-xs flex items-center gap-2",{"opacity-50 cursor-not-allowed":!$.value}])},[...e[25]||(e[25]=[t("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor","stroke-width":"2.5",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1),I(" Start Prompt Tuning ",-1)])],10,Ae)])])}}};export{Oe as default};
