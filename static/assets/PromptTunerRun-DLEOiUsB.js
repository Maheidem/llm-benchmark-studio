import{u as R}from"./promptTuner-B6E68GtL.js";import{u as j}from"./promptLibrary-BIeT8SgM.js";import{p as z,o as L,I as V,c as a,d as t,t as l,x as o,i as x,j as f,f as c,l as g,y as _,k as d,K as F,r as v,a as N,b as r}from"./index-BqpQFpv6.js";import{u as I}from"./useSharedContext-BnDn8Z30.js";import{_ as D}from"./PromptTimeline-CDZf5t4b.js";import"./useActiveSession-DdoXJmDo.js";const J={class:"flex items-center justify-between mb-6"},E={class:"text-sm text-zinc-600 font-body"},M={class:"flex items-center gap-2"},U={key:0,class:"card rounded-md p-5 mb-6"},$={class:"flex items-center justify-between mb-3"},q={class:"flex items-center gap-3"},A={key:0,class:"pulse-dot"},H={class:"text-sm text-zinc-400 font-body"},K={class:"flex items-center gap-3"},W={key:0,class:"text-[10px] font-mono text-zinc-600"},G={class:"text-xs font-mono text-zinc-600"},O={class:"progress-track rounded-full overflow-hidden"},Q={key:1,class:"card rounded-md p-5 mb-6",style:{"border-left":"3px solid var(--lime)"}},X={class:"flex items-center justify-between mb-2"},Y={class:"text-sm font-mono font-bold",style:{color:"var(--lime)"}},Z={class:"flex items-center gap-2 mt-2"},ee={key:3,class:"text-xs text-zinc-600 font-body text-center py-8"},te={key:4,class:"text-xs text-zinc-600 font-body text-center py-8"},pe={__name:"PromptTunerRun",setup(oe){const e=R(),y=j(),k=z(),{setConfig:P,setSystemPrompt:h}=I(),{showToast:n}=F(),p=v(!1),u=v(!1);let m=null;L(()=>{e.restoreJob(),m=k.onMessage(i=>{if(!e.activeJobId||i.job_id&&i.job_id!==e.activeJobId)return;["tune_start","generation_start","prompt_generated","prompt_eval_start","prompt_eval_result","generation_complete","generation_error","tune_complete","job_progress","job_completed","job_failed","job_cancelled"].includes(i.type)&&(e.handleProgress(i),i.type==="tune_complete"&&(n("Prompt tuning complete!","success"),S()),i.type==="job_failed"&&n(i.error||"Tuning failed","error"))}),e.activeRunId&&e.generations.length===0&&e.loadRun(e.activeRunId).catch(()=>{})}),V(()=>{m&&m()});async function w(){try{await e.cancelTuning(),n("Cancellation requested","")}catch{n("Failed to cancel","error")}}function C(){e.bestPrompt&&(h("_global",e.bestPrompt),P({lastUpdatedBy:"prompt_tuner"}),n("Best prompt applied to shared context","success"))}function T(){e.bestPrompt&&navigator.clipboard.writeText(e.bestPrompt).then(()=>n("Copied to clipboard","success"),()=>n("Failed to copy","error"))}async function S(){if(e.bestPrompt)try{await y.saveVersion(e.bestPrompt,null,"tuner"),u.value=!0,n("Best prompt auto-saved to Prompt Library","success")}catch{}}async function B(){if(e.bestPrompt)try{await y.saveVersion(e.bestPrompt,null,"tuner"),u.value=!0,n("Saved to Prompt Library","success")}catch{n("Failed to save to library","error")}}return(i,s)=>{const b=N("router-link");return r(),a("div",null,[t("div",J,[t("div",null,[s[1]||(s[1]=t("h2",{class:"font-display font-bold text-lg text-zinc-100 mb-1"},"Prompt Tuner Run",-1)),t("p",E,l(o(e).isRunning?"Tuning in progress...":"Run complete"),1)]),t("div",M,[x(b,{to:{name:"PromptTunerConfig"},class:"text-[10px] font-display tracking-wider uppercase px-3 py-1.5 rounded-sm",style:{border:"1px solid var(--border-subtle)",color:"var(--zinc-400)"}},{default:f(()=>[...s[2]||(s[2]=[d("Config",-1)])]),_:1}),o(e).isRunning?(r(),a("button",{key:0,onClick:w,class:"text-[10px] font-display font-medium tracking-wider uppercase px-3 py-1 rounded-sm transition-colors",style:{color:"var(--coral)",border:"1px solid rgba(255,59,92,0.3)"}},"Cancel")):c("",!0)])]),o(e).isRunning||o(e).progress.pct>0?(r(),a("div",U,[t("div",$,[t("div",q,[o(e).isRunning?(r(),a("div",A)):c("",!0),t("span",H,l(o(e).progress.detail),1)]),t("div",K,[o(e).progress.eta?(r(),a("span",W,l(o(e).progress.eta),1)):c("",!0),t("span",G,l(o(e).progress.pct)+"%",1)])]),t("div",O,[t("div",{class:"progress-fill",style:g({width:o(e).progress.pct+"%"})},null,4)])])):c("",!0),o(e).bestPrompt?(r(),a("div",Q,[t("div",X,[s[3]||(s[3]=t("span",{class:"section-label"},"Best Prompt",-1)),t("span",Y,l((o(e).bestScore*100).toFixed(1))+"% ",1)]),t("div",{class:"text-xs text-zinc-400 font-body rounded-sm px-3 py-2 cursor-pointer",style:g([{background:"rgba(0,0,0,0.2)",border:"1px solid var(--border-subtle)"},{maxHeight:p.value?"none":"80px",overflow:p.value?"visible":"hidden"}]),onClick:s[0]||(s[0]=se=>p.value=!p.value)},l(o(e).bestPrompt),5),t("div",Z,[t("button",{onClick:C,class:"text-[10px] font-display tracking-wider uppercase px-3 py-1 rounded-sm",style:{background:"rgba(191,255,0,0.08)",border:"1px solid rgba(191,255,0,0.2)",color:"var(--lime)"}},"Apply to Context"),u.value?(r(),_(b,{key:0,to:{name:"PromptLibrary"},class:"text-[10px] font-display tracking-wider uppercase px-3 py-1 rounded-sm",style:{background:"rgba(56,189,248,0.08)",border:"1px solid rgba(56,189,248,0.2)",color:"#38BDF8"}},{default:f(()=>[...s[4]||(s[4]=[d("View in Library â†’",-1)])]),_:1})):(r(),a("button",{key:1,onClick:B,class:"text-[10px] font-display tracking-wider uppercase px-3 py-1 rounded-sm",style:{background:"rgba(56,189,248,0.08)",border:"1px solid rgba(56,189,248,0.2)",color:"#38BDF8"}},"Save to Library")),t("button",{onClick:T,class:"text-[10px] font-display tracking-wider uppercase px-3 py-1 rounded-sm",style:{border:"1px solid var(--border-subtle)",color:"var(--zinc-400)"}},"Copy")])])):c("",!0),o(e).generations.length>0?(r(),_(D,{key:2,generations:o(e).generations,"current-generation-num":o(e).progress.generation},null,8,["generations","current-generation-num"])):o(e).isRunning?(r(),a("div",ee," Waiting for first generation... ")):!o(e).isRunning&&o(e).generations.length===0?(r(),a("div",te,[s[6]||(s[6]=d(" No active run. ",-1)),x(b,{to:{name:"PromptTunerConfig"},class:"text-lime-400 hover:text-lime-300"},{default:f(()=>[...s[5]||(s[5]=[d("Start a new tune",-1)])]),_:1})])):c("",!0)])}}};export{pe as default};
