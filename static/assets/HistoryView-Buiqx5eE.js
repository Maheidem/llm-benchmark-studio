import{o as q,c as l,d as t,e as J,h as U,v as G,x as I,F as b,A as h,t as a,f as _,g as k,k as Q,l as c,r as y,B as K,K as W,q as X,b as n,M as Y}from"./index-Qa3B9ygH.js";import{a as Z,u as tt}from"./useSharedContext-QT4OJfv8.js";import{_ as et}from"./_plugin-vue_export-helper-DlAUqK2U.js";const st={class:"flex items-center justify-between mb-6"},ot={class:"flex items-center gap-3"},rt=["disabled"],lt={key:0},nt={key:1},at={key:0,class:"text-zinc-600 text-sm font-body"},it={key:1,class:"card rounded-sm p-10 text-center"},dt={key:2,class:"card rounded-sm overflow-hidden"},ct={class:"overflow-x-auto"},ut={class:"w-full text-xs"},pt=["onClick"],xt={class:"px-4 py-2.5 text-zinc-400 font-mono text-[11px] whitespace-nowrap"},bt={class:"px-4 py-2.5 text-zinc-300 font-body"},yt={class:"px-4 py-2.5"},ft={class:"flex flex-wrap gap-1"},vt={class:"px-4 py-2.5 text-center"},mt={key:1,class:"text-zinc-700"},gt={class:"flex items-center justify-end gap-2"},ht=["onClick"],_t=["onClick"],kt={key:3,class:"text-red-400 text-sm font-body mt-4"},wt={class:"card rounded-md p-6 mx-4 w-full",style:{"max-width":"800px","max-height":"88vh","overflow-y":"auto"}},zt={class:"flex items-center justify-between mb-5"},Ct={class:"text-[11px] font-mono text-zinc-600 mt-0.5"},jt={class:"flex items-center gap-2"},At={key:0,class:"text-xs text-zinc-600 font-body text-center py-6"},Ft={class:"grid grid-cols-2 sm:grid-cols-4 gap-3 mb-5"},Et={class:"p-3 rounded-sm",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)"}},Ht={class:"text-xs font-body text-zinc-300 truncate"},Mt={class:"p-3 rounded-sm",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)"}},Rt={class:"text-sm font-mono text-zinc-300"},Bt={class:"p-3 rounded-sm",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)"}},St={class:"p-3 rounded-sm",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)"}},Dt={key:1,class:"text-sm font-mono text-zinc-600"},Lt={key:0,class:"mb-5"},$t={class:"overflow-x-auto rounded-sm",style:{border:"1px solid var(--border-subtle)"}},Tt={class:"w-full text-xs"},Vt={class:"px-3 py-2 font-mono text-zinc-300 text-[11px]"},Ot={class:"px-3 py-2 text-right font-mono text-zinc-600"},Nt={key:1},Pt={class:"flex items-center justify-between mb-2"},qt={class:"text-[10px] font-mono text-zinc-600"},Jt={class:"overflow-x-auto rounded-sm",style:{border:"1px solid var(--border-subtle)","max-height":"320px","overflow-y":"auto"}},Ut={class:"w-full text-xs"},Gt={class:"px-3 py-2 font-mono text-zinc-400 text-[10px] whitespace-nowrap"},It={class:"px-3 py-2 text-zinc-500 font-body",style:{"max-width":"180px"}},Qt={class:"px-3 py-2 font-mono text-zinc-600 text-[10px]"},Kt={__name:"HistoryView",setup(Wt){const R=X(),u=Z(),{showToast:x}=W(),{confirm:B}=Y(),{setSuite:S,setModels:D,setConfig:L}=tt(),p=y(!0),w=y(""),f=y(""),r=y(null),z=y(!1),F=K(()=>{const o=u.history||[];if(!f.value)return o;const e=f.value.toLowerCase();return o.filter(s=>{const i=m(s.timestamp).toLowerCase(),d=(s.suite_name||"").toLowerCase(),A=v(s).join(" ").toLowerCase();return i.includes(e)||d.includes(e)||A.includes(e)})});function v(o){return Array.isArray(o.models)?o.models:[]}function C(o){if(o.summary&&typeof o.summary=="object"){const e=Object.values(o.summary).map(s=>typeof s=="object"&&s!==null?s.score??s.overall_score??s.tool_score??null:typeof s=="number"?s:null).filter(s=>s!=null);if(e.length>0)return(e.reduce((i,d)=>i+d,0)/e.length*100).toFixed(1)+"%"}return o.judge_score!==null&&o.judge_score!==void 0?(o.judge_score*100).toFixed(1)+"%":"-"}function E(o){return C(o)==="-"?"color:var(--zinc-600)":"color:var(--lime)"}function H(o){const e={A:{bg:"rgba(34,197,94,0.1)",border:"rgba(34,197,94,0.3)",text:"#22C55E"},B:{bg:"rgba(191,255,0,0.08)",border:"rgba(191,255,0,0.2)",text:"var(--lime)"},C:{bg:"rgba(245,158,11,0.1)",border:"rgba(245,158,11,0.25)",text:"#F59E0B"},D:{bg:"rgba(239,68,68,0.1)",border:"rgba(239,68,68,0.25)",text:"#EF4444"},F:{bg:"rgba(239,68,68,0.15)",border:"rgba(239,68,68,0.3)",text:"#EF4444"}},s=o?o.charAt(0).toUpperCase():"",i=e[s]||{bg:"rgba(255,255,255,0.04)",border:"var(--border-subtle)",text:"#A1A1AA"};return`background:${i.bg};border:1px solid ${i.border};color:${i.text};font-size:10px`}function m(o){return o?new Date(o).toLocaleString():"-"}function j(o){return o==null?"-":(o*100).toFixed(1)+"%"}function g(o){return o==null?"color:#71717A":o>=.8?"color:var(--lime)":o>=.5?"color:#FBBF24":"color:#EF4444"}function $(o,e){return o?o.length>e?o.slice(0,e)+"...":o:""}function T(o){return o==null?"(none)":Array.isArray(o)?o.join(" | "):typeof o=="object"?JSON.stringify(o):o}function V(){window.open("/api/export/tool-eval?format=csv")}async function O(o){r.value={...o},z.value=!0;try{const e=await u.loadHistoryRun(o.id);r.value=e}catch{}finally{z.value=!1}}async function M(o){let e=o;if(o.id&&!o.config&&!o.results)try{e=await u.loadHistoryRun(o.id)}catch{}const s=e.config||{};if(e.suite_id||s.suite_id){const d=e.suite_id||s.suite_id,A=e.suite_name||s.suite_name||d;S(d,A)}const i=v(e);i.length>0&&D(i),L({temperature:s.temperature??e.temperature??0,toolChoice:s.tool_choice??e.tool_choice??"required",systemPrompts:s.system_prompt??e.system_prompt??{},lastUpdatedBy:null}),r.value=null,x("Settings pre-filled from run. Adjust and submit.","success"),R.push({name:"ToolEvalEvaluate"})}async function N(){p.value=!0;try{await u.loadHistory(),x("History refreshed","success")}catch{x("Failed to refresh history","error")}finally{p.value=!1}}async function P(o){var s;if(await B("Delete Eval Run",`Delete eval run from ${m(o.timestamp)}?`,{danger:!0,confirmLabel:"Delete"}))try{await u.deleteHistoryRun(o.id),x("Eval run deleted","success"),((s=r.value)==null?void 0:s.id)===o.id&&(r.value=null)}catch{x("Failed to delete eval run","error")}}return q(async()=>{try{await u.loadHistory()}catch{w.value="Failed to load eval history."}finally{p.value=!1}}),(o,e)=>(n(),l("div",null,[t("div",st,[e[7]||(e[7]=t("h2",{class:"section-label"},"Eval History",-1)),t("div",ot,[t("button",{onClick:N,disabled:p.value,class:J(["text-[10px] font-display tracking-wider uppercase px-3 py-1.5 rounded-sm transition-opacity",p.value?"opacity-50 cursor-not-allowed":""]),style:{border:"1px solid var(--border-subtle)",color:"var(--zinc-400)"},title:"Refresh history"},[p.value?(n(),l("span",lt,"...")):(n(),l("span",nt,"Refresh"))],10,rt),U(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>f.value=s),type:"text",placeholder:"Search history...",class:"px-3 py-1.5 rounded-sm text-xs font-mono text-zinc-200",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)",outline:"none",width:"200px"},onFocus:e[1]||(e[1]=s=>s.target.style.borderColor="rgba(191,255,0,0.3)"),onBlur:e[2]||(e[2]=s=>s.target.style.borderColor="var(--border-subtle)")},null,544),[[G,f.value]]),t("button",{onClick:V,class:"lime-btn text-[10px]"},"Export CSV")])]),p.value?(n(),l("div",at,"Loading history...")):F.value.length===0&&I(u).history.length===0?(n(),l("div",it,[...e[8]||(e[8]=[t("p",{class:"text-zinc-600 font-body"},"No eval history yet.",-1),t("p",{class:"text-zinc-700 text-xs mt-1 font-body"},"Run your first tool evaluation to see results here.",-1)])])):(n(),l("div",dt,[t("div",ct,[t("table",ut,[e[11]||(e[11]=t("thead",null,[t("tr",{style:{"border-bottom":"1px solid var(--border-subtle)"}},[t("th",{class:"px-4 py-3 text-left section-label"},"Date"),t("th",{class:"px-4 py-3 text-left section-label"},"Suite"),t("th",{class:"px-4 py-3 text-left section-label"},"Models"),t("th",{class:"px-4 py-3 text-right section-label"},"Overall Score"),t("th",{class:"px-4 py-3 text-center section-label"},"Judge"),t("th",{class:"px-4 py-3 text-right section-label"},"Actions")])],-1)),t("tbody",null,[(n(!0),l(b,null,h(F.value,(s,i)=>(n(),l("tr",{key:s.id||i,class:"fade-in cursor-pointer hover:bg-white/[0.02] transition-colors",style:c([{"border-top":"1px solid var(--border-subtle)"},`animation-delay: ${i*30}ms`]),onClick:d=>O(s)},[t("td",xt,a(m(s.timestamp)),1),t("td",bt,a(s.suite_name||"-"),1),t("td",yt,[t("div",ft,[(n(!0),l(b,null,h(v(s),d=>(n(),l("span",{key:d,class:"badge",style:{background:"rgba(255,255,255,0.04)",border:"1px solid var(--border-subtle)",color:"var(--zinc-400)","font-size":"9px"}},a(d),1))),128))])]),t("td",{class:"px-4 py-2.5 text-right font-mono",style:c(E(s))},a(C(s)),5),t("td",vt,[s.judge_grade?(n(),l("span",{key:0,class:"badge",style:c(H(s.judge_grade))},a(s.judge_grade),5)):(n(),l("span",mt,"-"))]),t("td",{class:"px-4 py-2.5 text-right",onClick:e[3]||(e[3]=k(()=>{},["stop"]))},[t("div",gt,[t("button",{onClick:k(d=>M(s),["stop"]),class:"text-zinc-700 hover:text-lime-400 transition-colors",title:"Re-run this eval"},[...e[9]||(e[9]=[t("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)])],8,ht),t("button",{onClick:k(d=>P(s),["stop"]),class:"text-zinc-700 hover:text-red-400 transition-colors",title:"Delete run"},[...e[10]||(e[10]=[t("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,_t)])])],12,pt))),128))])])])])),w.value?(n(),l("div",kt,a(w.value),1)):_("",!0),r.value?(n(),l("div",{key:4,class:"fixed inset-0 z-50 flex items-center justify-center",style:{background:"rgba(0,0,0,0.75)"},onClick:e[6]||(e[6]=k(s=>r.value=null,["self"]))},[t("div",wt,[t("div",zt,[t("div",null,[e[12]||(e[12]=t("span",{class:"section-label"},"Eval Run Detail",-1)),t("p",Ct,a(m(r.value.timestamp)),1)]),t("div",jt,[t("button",{onClick:e[4]||(e[4]=s=>M(r.value)),class:"text-[10px] font-display tracking-wider uppercase px-3 py-1.5 rounded-sm transition-colors flex items-center gap-1.5",style:{background:"rgba(191,255,0,0.08)",border:"1px solid rgba(191,255,0,0.2)",color:"var(--lime)"}},[...e[13]||(e[13]=[t("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),Q(" Re-Run ",-1)])]),t("button",{onClick:e[5]||(e[5]=s=>r.value=null),class:"text-zinc-500 hover:text-zinc-300 transition-colors",style:{background:"none",border:"none",cursor:"pointer"}},"Close")])]),z.value?(n(),l("div",At,"Loading details...")):(n(),l(b,{key:1},[t("div",Ft,[t("div",Et,[e[14]||(e[14]=t("p",{class:"text-[10px] font-display tracking-wider uppercase text-zinc-600 mb-1"},"Suite",-1)),t("p",Ht,a(r.value.suite_name||"-"),1)]),t("div",Mt,[e[15]||(e[15]=t("p",{class:"text-[10px] font-display tracking-wider uppercase text-zinc-600 mb-1"},"Models",-1)),t("p",Rt,a(v(r.value).length),1)]),t("div",Bt,[e[16]||(e[16]=t("p",{class:"text-[10px] font-display tracking-wider uppercase text-zinc-600 mb-1"},"Overall Score",-1)),t("p",{class:"text-sm font-mono",style:c(E(r.value))},a(C(r.value)),5)]),t("div",St,[e[17]||(e[17]=t("p",{class:"text-[10px] font-display tracking-wider uppercase text-zinc-600 mb-1"},"Judge Grade",-1)),r.value.judge_grade?(n(),l("span",{key:0,class:"badge text-sm",style:c(H(r.value.judge_grade))},a(r.value.judge_grade),5)):(n(),l("p",Dt,"-"))])]),r.value.summary&&Object.keys(r.value.summary).length>0?(n(),l("div",Lt,[e[19]||(e[19]=t("p",{class:"text-[10px] font-display tracking-wider uppercase text-zinc-600 mb-2"},"Model Scores",-1)),t("div",$t,[t("table",Tt,[e[18]||(e[18]=t("thead",null,[t("tr",{style:{"border-bottom":"1px solid var(--border-subtle)"}},[t("th",{class:"px-3 py-2 text-left section-label"},"Model"),t("th",{class:"px-3 py-2 text-right section-label"},"Tool Select"),t("th",{class:"px-3 py-2 text-right section-label"},"Param Acc."),t("th",{class:"px-3 py-2 text-right section-label"},"Overall"),t("th",{class:"px-3 py-2 text-right section-label"},"Cases")])],-1)),t("tbody",null,[(n(!0),l(b,null,h(r.value.summary,(s,i)=>(n(),l("tr",{key:i,style:{"border-top":"1px solid var(--border-subtle)"}},[t("td",Vt,a(i.split("/").pop()),1),t("td",{class:"px-3 py-2 text-right font-mono",style:c(g(s.tool_selection_score))},a(j(s.tool_selection_score)),5),t("td",{class:"px-3 py-2 text-right font-mono",style:c(g(s.param_accuracy_score))},a(j(s.param_accuracy_score)),5),t("td",{class:"px-3 py-2 text-right font-mono font-bold",style:c(g(s.overall_score??s.score))},a(j(s.overall_score??s.score)),5),t("td",Ot,a(s.total_cases??s.cases??"-"),1)]))),128))])])])])):_("",!0),r.value.results&&r.value.results.length>0?(n(),l("div",Nt,[t("div",Pt,[e[20]||(e[20]=t("p",{class:"text-[10px] font-display tracking-wider uppercase text-zinc-600"},"Test Cases",-1)),t("span",qt,a(r.value.results.length)+" results",1)]),t("div",Jt,[t("table",Ut,[e[21]||(e[21]=t("thead",{class:"sticky top-0",style:{background:"var(--surface-raised, #1a1a1a)"}},[t("tr",{style:{"border-bottom":"1px solid var(--border-subtle)"}},[t("th",{class:"px-3 py-2 text-left section-label"},"Model"),t("th",{class:"px-3 py-2 text-left section-label"},"Prompt"),t("th",{class:"px-3 py-2 text-left section-label"},"Expected"),t("th",{class:"px-3 py-2 text-left section-label"},"Actual"),t("th",{class:"px-3 py-2 text-right section-label"},"Score")])],-1)),t("tbody",null,[(n(!0),l(b,null,h(r.value.results,(s,i)=>(n(),l("tr",{key:i,style:{"border-top":"1px solid var(--border-subtle)"}},[t("td",Gt,a((s.model_name||s.model_id||"").split("/").pop()),1),t("td",It,a($(s.prompt||s.test_case_id||"",50)),1),t("td",Qt,a(T(s.expected_tool)),1),t("td",{class:"px-3 py-2 font-mono text-[10px]",style:c(s.tool_selection_score>0?"color:var(--lime)":"color:var(--coral, #ff3b5c)")},a(s.actual_tool||"(none)"),5),t("td",{class:"px-3 py-2 text-right font-mono font-bold text-[11px]",style:c(g(s.overall_score))},a(s.overall_score!=null?(s.overall_score*100).toFixed(0)+"%":"-"),5)]))),128))])])])])):_("",!0)],64))])])):_("",!0)]))}},te=et(Kt,[["__scopeId","data-v-9be65f63"]]);export{te as default};
