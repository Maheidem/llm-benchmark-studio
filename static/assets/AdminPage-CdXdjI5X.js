import{o as D,b as r,c,d as t,t as i,s as b,r as f,F as $,A as S,l as M,N as I,u as O,f as N,y as H,g as Z,h,v as F,a0 as q,Q as E,K as J,M as V,z as P,m as K,e as R,B as Y,V as G,x as Q,i as T,R as j}from"./index-Csqbeob9.js";const W={class:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6"},X={class:"card rounded-md p-4 stat-card"},tt={class:"text-2xl font-display font-bold text-zinc-100"},et={class:"card rounded-md p-4 stat-card"},st={class:"text-2xl font-display font-bold text-zinc-100"},nt={class:"card rounded-md p-4 stat-card"},ot={class:"text-2xl font-display font-bold text-zinc-100"},at={class:"card rounded-md p-4 stat-card"},it={class:"text-2xl font-display font-bold text-zinc-100"},lt={__name:"AdminStats",setup(w,{expose:_}){const u=f({});async function x(){try{const d=await b("/api/admin/stats");d.ok&&(u.value=await d.json())}catch{}}return _({load:x}),D(x),(d,p)=>(r(),c("div",W,[t("div",X,[p[0]||(p[0]=t("div",{class:"text-[10px] font-display tracking-wider uppercase text-zinc-600 mb-1"},"Benchmarks (24h)",-1)),t("div",tt,i(u.value.benchmarks_24h||0),1)]),t("div",et,[p[1]||(p[1]=t("div",{class:"text-[10px] font-display tracking-wider uppercase text-zinc-600 mb-1"},"Benchmarks (7d)",-1)),t("div",st,i(u.value.benchmarks_7d||0),1)]),t("div",nt,[p[2]||(p[2]=t("div",{class:"text-[10px] font-display tracking-wider uppercase text-zinc-600 mb-1"},"Benchmarks (30d)",-1)),t("div",ot,i(u.value.benchmarks_30d||0),1)]),t("div",at,[p[3]||(p[3]=t("div",{class:"text-[10px] font-display tracking-wider uppercase text-zinc-600 mb-1"},"Total Users",-1)),t("div",it,i(u.value.total_users||0),1)])]))}},rt={class:"overflow-x-auto"},ct={key:0,class:"text-zinc-600 text-xs py-3"},dt={key:1,class:"text-zinc-600 text-xs py-3"},ut={key:2,class:"w-full text-xs"},pt={class:"px-3 py-2.5 text-zinc-300"},xt={class:"px-3 py-2.5 font-mono text-zinc-500"},mt={class:"px-3 py-2.5 text-center"},ft={class:"px-3 py-2.5 text-right font-mono text-zinc-400"},bt=["title"],_t={class:"px-3 py-2.5 text-zinc-500"},vt={class:"px-3 py-2.5 text-right"},yt=["onClick"],ht={__name:"JobsTable",props:{jobs:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["cancel"],setup(w){const _={benchmark:"Benchmark",tool_eval:"Tool Eval",judge:"Judge",judge_compare:"Judge Compare",param_tune:"Param Tuner",prompt_tune:"Prompt Tuner",scheduled_benchmark:"Scheduled"},u={running:"#38BDF8",pending:"#85858F",queued:"#85858F",done:"#22C55E",failed:"#FF3B5C",cancelled:"#8B8B95"};function x(l){return _[l]||l}function d(l){return u[l]||"#85858F"}function p(l){const m=l.started_at||l.created_at;return m?I(m):"-"}return(l,m)=>(r(),c("div",rt,[w.loading?(r(),c("div",ct,"Loading processes...")):w.jobs.length?(r(),c("table",ut,[m[0]||(m[0]=t("thead",null,[t("tr",{style:{"border-bottom":"1px solid var(--border-subtle)"}},[t("th",{class:"text-left px-3 py-2 section-label"},"Type"),t("th",{class:"text-left px-3 py-2 section-label"},"User"),t("th",{class:"text-center px-3 py-2 section-label"},"Status"),t("th",{class:"text-right px-3 py-2 section-label"},"Progress"),t("th",{class:"text-left px-3 py-2 section-label"},"Detail"),t("th",{class:"text-left px-3 py-2 section-label"},"Started"),t("th",{class:"text-right px-3 py-2 section-label"},"Actions")])],-1)),t("tbody",null,[(r(!0),c($,null,S(w.jobs,o=>(r(),c("tr",{key:o.id,style:{"border-bottom":"1px solid var(--border-subtle)"}},[t("td",pt,i(x(o.job_type)),1),t("td",xt,i(o.user_email||"-"),1),t("td",mt,[t("span",{class:"text-[10px] font-display tracking-wider uppercase",style:M({color:d(o.status)})},i(o.status),5)]),t("td",ft,i(o.progress_pct||0)+"%",1),t("td",{class:"px-3 py-2.5 text-zinc-500 max-w-[200px] truncate",title:o.progress_detail||"-"},i(o.progress_detail||"-"),9,bt),t("td",_t,i(p(o)),1),t("td",vt,[t("button",{class:"text-[10px] font-display tracking-wider uppercase",style:{color:"var(--coral)"},onClick:g=>l.$emit("cancel",o.id)},"Cancel",8,yt)])]))),128))])])):(r(),c("div",dt,"No active processes."))]))}},gt={class:"overflow-x-auto"},kt={key:0,class:"text-zinc-600 text-xs py-3"},wt={key:1,class:"text-zinc-600 text-sm py-3"},zt={key:2,class:"w-full text-xs results-table"},$t={class:"px-3 py-2 font-mono text-zinc-300"},Ct={class:"px-3 py-2"},St=["value","disabled","title","onChange"],Lt={class:"px-3 py-2 text-right font-mono text-zinc-400"},At={class:"px-3 py-2 text-right font-mono text-zinc-400"},Tt={class:"px-3 py-2 text-zinc-500"},Ut={class:"px-3 py-2 text-zinc-500"},Dt={class:"px-3 py-2 text-right whitespace-nowrap"},Bt=["onClick"],Ft=["onClick"],Pt={class:"modal-box",style:{"max-width":"380px"}},jt={class:"text-xs text-zinc-500 mb-4"},Rt={class:"space-y-3"},Nt={class:"flex gap-2 mt-5"},Mt={__name:"UsersTable",emits:["stats-changed"],setup(w,{emit:_}){const u=_,x=O(),{showToast:d}=J(),{confirm:p}=V(),l=f([]),m=f(!1),o=E({visible:!1,userId:"",email:"",bph:20,mc:1,mrpb:10});function g(a){return x.user&&a===x.user.id}function C(a){return a?new Date(a+"Z").toLocaleDateString():"Never"}function k(a){return a?new Date(a+"Z").toLocaleDateString():"-"}async function v(){m.value=!0;try{const a=await b("/api/admin/users");if(a.ok){const e=await a.json();l.value=e.users||[]}}catch{}finally{m.value=!1}}async function y(a,e){try{const s=await b(`/api/admin/users/${a}/role`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({role:e})});if(s.ok){d("Role updated","success");const n=l.value.find(B=>B.id===a);n&&(n.role=e)}else{const n=await s.json();d(n.error||"Failed to update role","error"),v()}}catch{d("Failed to update role","error"),v()}}async function L(a){if(await p("Delete User",`Delete user "${a.email}"? This will permanently remove the user and ALL their data. This cannot be undone.`,{danger:!0,confirmLabel:"Delete"}))try{const s=await b(`/api/admin/users/${a.id}`,{method:"DELETE"});if(s.ok)d("User deleted","success"),v(),u("stats-changed");else{const n=await s.json();d(n.error||"Failed to delete user","error")}}catch{d("Failed to delete user","error")}}async function z(a){try{const e=await b(`/api/admin/users/${a.id}/rate-limit`),s=e.ok?await e.json():{benchmarks_per_hour:20,max_concurrent:1,max_runs_per_benchmark:10};o.userId=a.id,o.email=a.email,o.bph=s.benchmarks_per_hour,o.mc=s.max_concurrent,o.mrpb=s.max_runs_per_benchmark,o.visible=!0}catch{}}async function A(){try{const a=await b(`/api/admin/users/${o.userId}/rate-limit`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({benchmarks_per_hour:o.bph||20,max_concurrent:o.mc||1,max_runs_per_benchmark:o.mrpb||10})});if(a.ok)d("Rate limits updated","success"),o.visible=!1;else{const e=await a.json();d(e.error||"Failed to save","error")}}catch{d("Failed to save rate limits","error")}}return D(v),(a,e)=>(r(),c("div",gt,[m.value?(r(),c("div",kt,"Loading users...")):l.value.length?(r(),c("table",zt,[e[6]||(e[6]=t("thead",null,[t("tr",{class:"text-[10px] font-display tracking-wider uppercase text-zinc-500"},[t("th",{class:"text-left px-3 py-2"},"Email"),t("th",{class:"text-left px-3 py-2"},"Role"),t("th",{class:"text-right px-3 py-2"},"Benchmarks"),t("th",{class:"text-right px-3 py-2"},"Keys"),t("th",{class:"text-left px-3 py-2"},"Last Login"),t("th",{class:"text-left px-3 py-2"},"Created"),t("th",{class:"text-right px-3 py-2"},"Actions")])],-1)),t("tbody",null,[(r(!0),c($,null,S(l.value,s=>(r(),c("tr",{key:s.id},[t("td",$t,i(s.email),1),t("td",Ct,[t("select",{value:s.role,disabled:g(s.id),title:g(s.id)?"Cannot change own role":"",class:"text-xs font-mono px-1 py-0.5 rounded-sm outline-none",style:M({background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)",color:s.role==="admin"?"#BFFF00":"#A1A1AA"}),onChange:n=>y(s.id,n.target.value)},[...e[5]||(e[5]=[t("option",{value:"user"},"user",-1),t("option",{value:"admin"},"admin",-1)])],44,St)]),t("td",Lt,i(s.benchmark_count||0),1),t("td",At,i(s.key_count||0),1),t("td",Tt,i(C(s.last_login)),1),t("td",Ut,i(k(s.created_at)),1),t("td",Dt,[t("button",{class:"text-[10px] font-display tracking-wider uppercase px-2 py-1 rounded-sm border border-[var(--border-subtle)] text-zinc-500 hover:text-zinc-300 transition-colors",onClick:n=>z(s)},"Limits",8,Bt),g(s.id)?N("",!0):(r(),c("button",{key:0,class:"text-[10px] font-display tracking-wider uppercase px-2 py-1 rounded-sm ml-1 border border-[var(--coral)] text-[var(--coral)] hover:bg-[rgba(255,59,92,0.1)] transition-colors",onClick:n=>L(s)},"Delete",8,Ft))])]))),128))])])):(r(),c("div",wt,"No users found.")),(r(),H(q,{to:"body"},[o.visible?(r(),c("div",{key:0,class:"modal-overlay",onClick:e[4]||(e[4]=Z(s=>o.visible=!1,["self"]))},[t("div",Pt,[e[10]||(e[10]=t("h3",{class:"font-display font-semibold text-sm text-zinc-100 mb-1"},"Rate Limits",-1)),t("p",jt,i(o.email),1),t("div",Rt,[t("div",null,[e[7]||(e[7]=t("label",{class:"text-[10px] text-zinc-600 font-display tracking-wider uppercase block mb-1"},"Benchmarks Per Hour",-1)),h(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>o.bph=s),type:"number",min:"1",max:"1000",class:"modal-input w-full"},null,512),[[F,o.bph,void 0,{number:!0}]])]),t("div",null,[e[8]||(e[8]=t("label",{class:"text-[10px] text-zinc-600 font-display tracking-wider uppercase block mb-1"},"Max Concurrent",-1)),h(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>o.mc=s),type:"number",min:"1",max:"10",class:"modal-input w-full"},null,512),[[F,o.mc,void 0,{number:!0}]])]),t("div",null,[e[9]||(e[9]=t("label",{class:"text-[10px] text-zinc-600 font-display tracking-wider uppercase block mb-1"},"Max Runs Per Benchmark",-1)),h(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>o.mrpb=s),type:"number",min:"1",max:"50",class:"modal-input w-full"},null,512),[[F,o.mrpb,void 0,{number:!0}]])])]),t("div",Nt,[t("button",{class:"modal-btn flex-1",onClick:e[3]||(e[3]=s=>o.visible=!1)},"Cancel"),t("button",{class:"modal-btn modal-btn-confirm flex-1",onClick:A},"Save")])])])):N("",!0)]))]))}},Ot={class:"flex items-center gap-3 mb-4 flex-wrap"},Et=["value"],Jt=["value"],Vt={class:"overflow-x-auto"},It={key:0,class:"text-zinc-600 text-xs py-3"},Ht={key:1,class:"text-zinc-600 text-sm py-3"},Zt={key:2,class:"w-full text-xs results-table"},qt={class:"px-3 py-2 text-zinc-500 whitespace-nowrap"},Kt={class:"px-3 py-2 font-mono text-zinc-400"},Yt={class:"px-3 py-2 text-zinc-500"},Gt=["title"],Qt={class:"px-3 py-2 text-zinc-600 font-mono"},Wt={class:"flex items-center justify-between mt-3"},Xt={class:"text-[10px] font-mono text-zinc-600"},te={class:"flex gap-2"},ee=["disabled"],se=["disabled"],U=50,ne={__name:"AuditLog",setup(w){const _={user_login:"text-green-400",user_login_failed:"text-red-400",user_register:"text-blue-400",user_logout:"text-zinc-500",benchmark_start:"text-yellow-400",benchmark_complete:"text-green-400",benchmark_cancel:"text-orange-400",admin_user_update:"text-purple-400",admin_user_delete:"text-red-400",admin_rate_limit:"text-purple-400",token_refresh:"text-zinc-500"},u=f([]),x=f(!1),d=f(0),p=f([]),l=E({user:"",action:"",since:""}),m=["user_login","user_login_failed","user_register","user_logout","benchmark_start","benchmark_complete","benchmark_cancel","admin_user_update","admin_user_delete","admin_rate_limit","token_refresh"],o=Y(()=>{if(!u.value.length)return"";const e=d.value*U+1,s=e+u.value.length-1;return`${e}-${s}`});function g(e){return e?new Date(e+"Z").toLocaleString():"-"}function C(e){return _[e]||"text-zinc-400"}function k(e){if(!e)return"";let s=typeof e=="string"?e:JSON.stringify(e);return s.length>60&&(s=s.slice(0,57)+"..."),s}function v(){if(!l.since)return"";const e=new Date,n={"1h":36e5,"24h":864e5,"7d":6048e5,"30d":2592e6}[l.since]||0;return n?new Date(e.getTime()-n).toISOString().replace("T"," ").slice(0,19):""}async function y(){x.value=!0;try{const e=new URLSearchParams;l.user&&e.set("user",l.user),l.action&&e.set("action",l.action);const s=v();s&&e.set("since",s),e.set("limit",U),e.set("offset",d.value*U);const n=await b(`/api/admin/audit?${e.toString()}`);if(n.ok){const B=await n.json();u.value=B.entries||[]}}catch{}finally{x.value=!1}}async function L(){try{const e=await b("/api/admin/stats");if(e.ok){const s=await e.json();p.value=(s.top_users||[]).map(n=>n.username)}}catch{}}function z(){d.value=0,y()}function A(){d.value>0&&(d.value--,y())}function a(){d.value++,y()}return D(()=>{L(),y()}),(e,s)=>(r(),c("div",null,[t("div",Ot,[h(t("select",{"onUpdate:modelValue":s[0]||(s[0]=n=>l.user=n),class:"text-xs font-mono px-2 py-1 rounded-sm bg-[rgba(255,255,255,0.02)] border border-[var(--border-subtle)] text-zinc-300 outline-none",onChange:z},[s[3]||(s[3]=t("option",{value:""},"All Users",-1)),(r(!0),c($,null,S(p.value,n=>(r(),c("option",{key:n,value:n},i(n),9,Et))),128))],544),[[P,l.user]]),h(t("select",{"onUpdate:modelValue":s[1]||(s[1]=n=>l.action=n),class:"text-xs font-mono px-2 py-1 rounded-sm bg-[rgba(255,255,255,0.02)] border border-[var(--border-subtle)] text-zinc-300 outline-none",onChange:z},[s[4]||(s[4]=t("option",{value:""},"All Actions",-1)),(r(),c($,null,S(m,n=>t("option",{key:n,value:n},i(n),9,Jt)),64))],544),[[P,l.action]]),h(t("select",{"onUpdate:modelValue":s[2]||(s[2]=n=>l.since=n),class:"text-xs font-mono px-2 py-1 rounded-sm bg-[rgba(255,255,255,0.02)] border border-[var(--border-subtle)] text-zinc-300 outline-none",onChange:z},[...s[5]||(s[5]=[K('<option value="">All Time</option><option value="1h">Last Hour</option><option value="24h">Last 24 Hours</option><option value="7d">Last 7 Days</option><option value="30d">Last 30 Days</option>',5)])],544),[[P,l.since]])]),t("div",Vt,[x.value?(r(),c("div",It,"Loading audit log...")):u.value.length?(r(),c("table",Zt,[s[6]||(s[6]=t("thead",null,[t("tr",{class:"text-[10px] font-display tracking-wider uppercase text-zinc-500"},[t("th",{class:"text-left px-3 py-2"},"Time"),t("th",{class:"text-left px-3 py-2"},"User"),t("th",{class:"text-left px-3 py-2"},"Action"),t("th",{class:"text-left px-3 py-2"},"Resource"),t("th",{class:"text-left px-3 py-2"},"Detail"),t("th",{class:"text-left px-3 py-2"},"IP")])],-1)),t("tbody",null,[(r(!0),c($,null,S(u.value,n=>(r(),c("tr",{key:n.id||n.timestamp},[t("td",qt,i(g(n.timestamp)),1),t("td",Kt,i(n.username||""),1),t("td",{class:R(["px-3 py-2 font-mono",C(n.action)])},i(n.action||""),3),t("td",Yt,i(n.resource_type||"")+i(n.resource_id?":"+n.resource_id:""),1),t("td",{class:"px-3 py-2 text-zinc-600 font-mono max-w-[200px] truncate",title:k(n.detail)},i(k(n.detail)),9,Gt),t("td",Qt,i(n.ip_address||""),1)]))),128))])])):(r(),c("div",Ht,"No audit entries found."))]),t("div",Wt,[t("span",Xt,i(o.value),1),t("div",te,[t("button",{disabled:d.value===0,class:"text-[10px] font-display tracking-wider uppercase px-2 py-1 rounded-sm border border-[var(--border-subtle)] text-zinc-500 disabled:opacity-30 hover:text-zinc-300 transition-colors",onClick:A},"Prev",8,ee),t("button",{disabled:u.value.length<U,class:"text-[10px] font-display tracking-wider uppercase px-2 py-1 rounded-sm border border-[var(--border-subtle)] text-zinc-500 disabled:opacity-30 hover:text-zinc-300 transition-colors",onClick:a},"Next",8,se)])])]))}},oe={class:"max-w-7xl mx-auto px-6 py-8"},ae={key:0,class:"text-center py-16"},ie={class:"card rounded-md p-4 mb-6"},le={key:0,class:"grid grid-cols-2 md:grid-cols-5 gap-4"},re={class:"text-sm font-mono text-zinc-300"},ce={class:"text-sm font-mono text-zinc-300"},de={class:"text-sm font-mono text-zinc-300"},ue={class:"text-sm font-mono text-zinc-300"},pe={key:1,class:"text-zinc-600 text-xs"},xe={class:"flex gap-2 mb-6 border-b border-zinc-800"},me=["onClick"],be={__name:"AdminPage",setup(w){const _=O(),{showToast:u}=J(),{confirm:x}=V(),d=f("jobs"),p=[{id:"jobs",label:"Active Jobs"},{id:"users",label:"Users"},{id:"audit",label:"Audit Log"}],l=f(null),m=f(null),o=f(null);async function g(){try{const a=await b("/api/admin/system");a.ok&&(o.value=await a.json())}catch{}}const C=f([]),k=f(!1);let v=null;async function y(){k.value=!0;try{const a=await b("/api/admin/jobs");if(a.ok){const e=await a.json();C.value=e.jobs||[]}}catch{}finally{k.value=!1}}async function L(a){if(await x("Cancel Process","Cancel this process? This cannot be undone.",{danger:!0,confirmLabel:"Cancel Process"}))try{if(!(await b(`/api/admin/jobs/${a}/cancel`,{method:"POST"})).ok){u("Failed to cancel","error");return}u("Process cancelled","success"),await y()}catch{u("Failed to cancel","error")}}function z(){var a;(a=l.value)!=null&&a.load&&l.value.load()}function A(a){if(!a)return"-";const e=Math.floor(a/3600),s=Math.floor(a%3600/60);return`${e}h ${s}m`}return D(()=>{_.isAdmin&&(g(),y(),v=setInterval(y,15e3))}),G(()=>{v&&clearInterval(v)}),(a,e)=>(r(),c("div",oe,[Q(_).isAdmin?(r(),c($,{key:1},[e[7]||(e[7]=t("h1",{class:"font-display text-lg font-semibold text-zinc-200 uppercase tracking-wider mb-6"},"Admin Dashboard",-1)),T(lt,{ref_key:"statsRef",ref:l},null,512),t("div",ie,[e[6]||(e[6]=t("h3",{class:"font-display font-semibold text-sm text-zinc-100 tracking-wider uppercase mb-4"},"System Health",-1)),o.value?(r(),c("div",le,[t("div",null,[e[1]||(e[1]=t("div",{class:"text-[10px] font-display tracking-wider uppercase text-zinc-600 mb-1"},"DB Size",-1)),t("div",re,i(o.value.db_size_mb)+" MB",1)]),t("div",null,[e[2]||(e[2]=t("div",{class:"text-[10px] font-display tracking-wider uppercase text-zinc-600 mb-1"},"Results Files",-1)),t("div",ce,i(o.value.results_count)+" ("+i(o.value.results_size_mb)+" MB)",1)]),t("div",null,[e[3]||(e[3]=t("div",{class:"text-[10px] font-display tracking-wider uppercase text-zinc-600 mb-1"},"Uptime",-1)),t("div",de,i(A(o.value.process_uptime_s)),1)]),t("div",null,[e[4]||(e[4]=t("div",{class:"text-[10px] font-display tracking-wider uppercase text-zinc-600 mb-1"},"Active Jobs",-1)),t("div",{class:R(["text-sm font-mono",o.value.total_active?"text-yellow-400":"text-zinc-500"])},i(o.value.total_active||0)+" running, "+i(o.value.total_queued||0)+" queued ",3)]),t("div",null,[e[5]||(e[5]=t("div",{class:"text-[10px] font-display tracking-wider uppercase text-zinc-600 mb-1"},"WS Clients",-1)),t("div",ue,i(o.value.connected_ws_clients||0),1)])])):(r(),c("div",pe,"Loading system health..."))]),t("nav",xe,[(r(),c($,null,S(p,s=>t("button",{key:s.id,class:R(["tab px-4",{"tab-active":d.value===s.id}]),onClick:n=>d.value=s.id},i(s.label),11,me)),64))]),h(t("div",null,[T(ht,{jobs:C.value,loading:k.value,onCancel:L},null,8,["jobs","loading"])],512),[[j,d.value==="jobs"]]),h(t("div",null,[T(Mt,{ref_key:"usersRef",ref:m,onStatsChanged:z},null,512)],512),[[j,d.value==="users"]]),h(t("div",null,[T(ne)],512),[[j,d.value==="audit"]])],64)):(r(),c("div",ae,[...e[0]||(e[0]=[t("div",{class:"text-2xl font-display font-bold text-zinc-500 mb-2"},"Access Denied",-1),t("p",{class:"text-zinc-600 text-sm"},"You need admin privileges to view this page.",-1)])]))]))}};export{be as default};
