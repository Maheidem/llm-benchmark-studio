import{o as J,c as r,d as t,e as U,h as G,v as I,x as Q,F as b,A as _,t as a,f as y,g as k,k as R,l as c,r as f,B as K,K as W,q as X,b as l,M as Y}from"./index-Csqbeob9.js";import{a as Z,u as tt}from"./useSharedContext-P5pYt6Pj.js";import{_ as et}from"./_plugin-vue_export-helper-DlAUqK2U.js";const st={class:"flex items-center justify-between mb-6"},ot={class:"flex items-center gap-3"},rt=["disabled"],lt={key:0},nt={key:1},at={key:0,class:"text-zinc-600 text-sm font-body"},it={key:1,class:"card rounded-sm p-10 text-center"},dt={key:2,class:"card rounded-sm overflow-hidden"},ct={class:"overflow-x-auto"},ut={class:"w-full text-xs"},pt=["onClick"],xt={class:"px-4 py-2.5 text-zinc-400 font-mono text-[11px] whitespace-nowrap"},bt={class:"px-4 py-2.5 text-zinc-300 font-body"},yt={class:"px-4 py-2.5"},ft={class:"flex flex-wrap gap-1"},vt={class:"px-4 py-2.5 text-center"},mt={key:1,class:"text-zinc-700"},gt={class:"flex items-center justify-end gap-2"},ht=["onClick"],_t=["onClick"],kt={key:3,class:"text-red-400 text-sm font-body mt-4"},wt={class:"card rounded-md p-6 mx-4 w-full",style:{"max-width":"800px","max-height":"88vh","overflow-y":"auto"}},zt={class:"flex items-center justify-between mb-5"},Ct={class:"text-[11px] font-mono text-zinc-600 mt-0.5"},jt={class:"flex items-center gap-2"},At={key:0,class:"text-xs text-zinc-600 font-body text-center py-6"},Et={class:"grid grid-cols-2 sm:grid-cols-4 gap-3 mb-5"},Ft={class:"p-3 rounded-sm",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)"}},Ht={class:"text-xs font-body text-zinc-300 truncate"},Mt={class:"p-3 rounded-sm",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)"}},Rt={class:"text-sm font-mono text-zinc-300"},Bt={class:"p-3 rounded-sm",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)"}},St={class:"p-3 rounded-sm",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)"}},Dt={key:1,class:"text-sm font-mono text-zinc-600"},Lt={key:0,class:"mb-5"},$t={class:"overflow-x-auto rounded-sm",style:{border:"1px solid var(--border-subtle)"}},Tt={class:"w-full text-xs"},Vt={class:"px-3 py-2 font-mono text-zinc-300 text-[11px]"},Ot={class:"px-3 py-2 text-right font-mono text-zinc-600"},Nt={key:1},Pt={class:"flex items-center justify-between mb-2"},qt={class:"text-[10px] font-mono text-zinc-600"},Jt={class:"overflow-x-auto rounded-sm",style:{border:"1px solid var(--border-subtle)","max-height":"320px","overflow-y":"auto"}},Ut={class:"w-full text-xs"},Gt={class:"px-3 py-2 font-mono text-zinc-400 text-[10px] whitespace-nowrap"},It={class:"px-3 py-2 text-zinc-500 font-body",style:{"max-width":"180px"}},Qt=["title"],Kt={class:"px-3 py-2 font-mono text-zinc-600 text-[10px]"},Wt={__name:"HistoryView",setup(Xt){const B=X(),u=Z(),{showToast:x}=W(),{confirm:S}=Y(),{setSuite:D,setModels:L,setConfig:$}=tt(),p=f(!0),w=f(""),v=f(""),n=f(null),z=f(!1),E=K(()=>{const o=u.history||[];if(!v.value)return o;const s=v.value.toLowerCase();return o.filter(e=>{const i=g(e.timestamp).toLowerCase(),d=(e.suite_name||"").toLowerCase(),A=m(e).join(" ").toLowerCase();return i.includes(s)||d.includes(s)||A.includes(s)})});function m(o){return Array.isArray(o.models)?o.models:[]}function C(o){if(o.summary&&typeof o.summary=="object"){const s=Object.values(o.summary).map(e=>typeof e=="object"&&e!==null?e.score??e.overall_score??e.tool_score??null:typeof e=="number"?e:null).filter(e=>e!=null);if(s.length>0)return(s.reduce((i,d)=>i+d,0)/s.length*100).toFixed(1)+"%"}return o.judge_score!==null&&o.judge_score!==void 0?(o.judge_score*100).toFixed(1)+"%":"-"}function F(o){return C(o)==="-"?"color:var(--zinc-600)":"color:var(--lime)"}function H(o){const s={A:{bg:"rgba(34,197,94,0.1)",border:"rgba(34,197,94,0.3)",text:"#22C55E"},B:{bg:"rgba(191,255,0,0.08)",border:"rgba(191,255,0,0.2)",text:"var(--lime)"},C:{bg:"rgba(245,158,11,0.1)",border:"rgba(245,158,11,0.25)",text:"#F59E0B"},D:{bg:"rgba(239,68,68,0.1)",border:"rgba(239,68,68,0.25)",text:"#EF4444"},F:{bg:"rgba(239,68,68,0.15)",border:"rgba(239,68,68,0.3)",text:"#EF4444"}},e=o?o.charAt(0).toUpperCase():"",i=s[e]||{bg:"rgba(255,255,255,0.04)",border:"var(--border-subtle)",text:"#A1A1AA"};return`background:${i.bg};border:1px solid ${i.border};color:${i.text};font-size:10px`}function g(o){return o?new Date(o).toLocaleString():"-"}function j(o){return o==null?"-":(o*100).toFixed(1)+"%"}function h(o){return o==null?"color:#71717A":o>=.8?"color:var(--lime)":o>=.5?"color:#FBBF24":"color:#EF4444"}function T(o,s){return o?o.length>s?o.slice(0,s)+"...":o:""}function V(o){return o==null?"(none)":Array.isArray(o)?o.join(" | "):typeof o=="object"?JSON.stringify(o):o}function O(){window.open("/api/export/tool-eval?format=csv")}async function N(o){n.value={...o},z.value=!0;try{const s=await u.loadHistoryRun(o.id);n.value=s}catch{}finally{z.value=!1}}async function M(o){let s=o;if(o.id&&!o.config&&!o.results)try{s=await u.loadHistoryRun(o.id)}catch{}const e=s.config||{};if(s.suite_id||e.suite_id){const d=s.suite_id||e.suite_id,A=s.suite_name||e.suite_name||d;D(d,A)}const i=m(s);i.length>0&&L(i),$({temperature:e.temperature??s.temperature??0,toolChoice:e.tool_choice??s.tool_choice??"required",systemPrompts:e.system_prompt??s.system_prompt??{},lastUpdatedBy:null}),n.value=null,x("Settings pre-filled from run. Adjust and submit.","success"),B.push({name:"ToolEvalEvaluate"})}async function P(){p.value=!0;try{await u.loadHistory(),x("History refreshed","success")}catch{x("Failed to refresh history","error")}finally{p.value=!1}}async function q(o){var e;if(await S("Delete Eval Run",`Delete eval run from ${g(o.timestamp)}?`,{danger:!0,confirmLabel:"Delete"}))try{await u.deleteHistoryRun(o.id),x("Eval run deleted","success"),((e=n.value)==null?void 0:e.id)===o.id&&(n.value=null)}catch{x("Failed to delete eval run","error")}}return J(async()=>{try{await u.loadHistory()}catch{w.value="Failed to load eval history."}finally{p.value=!1}}),(o,s)=>(l(),r("div",null,[t("div",st,[s[7]||(s[7]=t("h2",{class:"section-label"},"Eval History",-1)),t("div",ot,[t("button",{onClick:P,disabled:p.value,class:U(["text-[10px] font-display tracking-wider uppercase px-3 py-1.5 rounded-sm transition-opacity",p.value?"opacity-50 cursor-not-allowed":""]),style:{border:"1px solid var(--border-subtle)",color:"var(--zinc-400)"},title:"Refresh history"},[p.value?(l(),r("span",lt,"...")):(l(),r("span",nt,"Refresh"))],10,rt),G(t("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>v.value=e),type:"text",placeholder:"Search history...",class:"px-3 py-1.5 rounded-sm text-xs font-mono text-zinc-200",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)",outline:"none",width:"200px"},onFocus:s[1]||(s[1]=e=>e.target.style.borderColor="rgba(191,255,0,0.3)"),onBlur:s[2]||(s[2]=e=>e.target.style.borderColor="var(--border-subtle)")},null,544),[[I,v.value]]),t("button",{onClick:O,class:"lime-btn text-[10px]"},"Export CSV")])]),p.value?(l(),r("div",at,"Loading history...")):E.value.length===0&&Q(u).history.length===0?(l(),r("div",it,[...s[8]||(s[8]=[t("p",{class:"text-zinc-600 font-body"},"No eval history yet.",-1),t("p",{class:"text-zinc-700 text-xs mt-1 font-body"},"Run your first tool evaluation to see results here.",-1)])])):(l(),r("div",dt,[t("div",ct,[t("table",ut,[s[11]||(s[11]=t("thead",null,[t("tr",{style:{"border-bottom":"1px solid var(--border-subtle)"}},[t("th",{class:"px-4 py-3 text-left section-label"},"Date"),t("th",{class:"px-4 py-3 text-left section-label"},"Suite"),t("th",{class:"px-4 py-3 text-left section-label"},"Models"),t("th",{class:"px-4 py-3 text-right section-label"},"Overall Score"),t("th",{class:"px-4 py-3 text-center section-label"},"Judge"),t("th",{class:"px-4 py-3 text-right section-label"},"Actions")])],-1)),t("tbody",null,[(l(!0),r(b,null,_(E.value,(e,i)=>(l(),r("tr",{key:e.id||i,class:"fade-in cursor-pointer hover:bg-white/[0.02] transition-colors",style:c([{"border-top":"1px solid var(--border-subtle)"},`animation-delay: ${i*30}ms`]),onClick:d=>N(e)},[t("td",xt,a(g(e.timestamp)),1),t("td",bt,a(e.suite_name||"-"),1),t("td",yt,[t("div",ft,[(l(!0),r(b,null,_(m(e),d=>(l(),r("span",{key:d,class:"badge",style:{background:"rgba(255,255,255,0.04)",border:"1px solid var(--border-subtle)",color:"var(--zinc-400)","font-size":"9px"}},a(d),1))),128))])]),t("td",{class:"px-4 py-2.5 text-right font-mono",style:c(F(e))},a(C(e)),5),t("td",vt,[e.judge_grade?(l(),r("span",{key:0,class:"badge",style:c(H(e.judge_grade))},a(e.judge_grade),5)):(l(),r("span",mt,"-"))]),t("td",{class:"px-4 py-2.5 text-right",onClick:s[3]||(s[3]=k(()=>{},["stop"]))},[t("div",gt,[t("button",{onClick:k(d=>M(e),["stop"]),class:"text-zinc-700 hover:text-lime-400 transition-colors",title:"Re-run this eval"},[...s[9]||(s[9]=[t("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)])],8,ht),t("button",{onClick:k(d=>q(e),["stop"]),class:"text-zinc-700 hover:text-red-400 transition-colors",title:"Delete run"},[...s[10]||(s[10]=[t("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,_t)])])],12,pt))),128))])])])])),w.value?(l(),r("div",kt,a(w.value),1)):y("",!0),n.value?(l(),r("div",{key:4,class:"fixed inset-0 z-50 flex items-center justify-center",style:{background:"rgba(0,0,0,0.75)"},onClick:s[6]||(s[6]=k(e=>n.value=null,["self"]))},[t("div",wt,[t("div",zt,[t("div",null,[s[12]||(s[12]=t("span",{class:"section-label"},"Eval Run Detail",-1)),t("p",Ct,a(g(n.value.timestamp)),1)]),t("div",jt,[t("button",{onClick:s[4]||(s[4]=e=>M(n.value)),class:"text-[10px] font-display tracking-wider uppercase px-3 py-1.5 rounded-sm transition-colors flex items-center gap-1.5",style:{background:"rgba(191,255,0,0.08)",border:"1px solid rgba(191,255,0,0.2)",color:"var(--lime)"}},[...s[13]||(s[13]=[t("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),R(" Re-Run ",-1)])]),t("button",{onClick:s[5]||(s[5]=e=>n.value=null),class:"text-zinc-500 hover:text-zinc-300 transition-colors",style:{background:"none",border:"none",cursor:"pointer"}},"Close")])]),z.value?(l(),r("div",At,"Loading details...")):(l(),r(b,{key:1},[t("div",Et,[t("div",Ft,[s[14]||(s[14]=t("p",{class:"text-[10px] font-display tracking-wider uppercase text-zinc-600 mb-1"},"Suite",-1)),t("p",Ht,a(n.value.suite_name||"-"),1)]),t("div",Mt,[s[15]||(s[15]=t("p",{class:"text-[10px] font-display tracking-wider uppercase text-zinc-600 mb-1"},"Models",-1)),t("p",Rt,a(m(n.value).length),1)]),t("div",Bt,[s[16]||(s[16]=t("p",{class:"text-[10px] font-display tracking-wider uppercase text-zinc-600 mb-1"},"Overall Score",-1)),t("p",{class:"text-sm font-mono",style:c(F(n.value))},a(C(n.value)),5)]),t("div",St,[s[17]||(s[17]=t("p",{class:"text-[10px] font-display tracking-wider uppercase text-zinc-600 mb-1"},"Judge Grade",-1)),n.value.judge_grade?(l(),r("span",{key:0,class:"badge text-sm",style:c(H(n.value.judge_grade))},a(n.value.judge_grade),5)):(l(),r("p",Dt,"-"))])]),n.value.summary&&Object.keys(n.value.summary).length>0?(l(),r("div",Lt,[s[19]||(s[19]=t("p",{class:"text-[10px] font-display tracking-wider uppercase text-zinc-600 mb-2"},"Model Scores",-1)),t("div",$t,[t("table",Tt,[s[18]||(s[18]=t("thead",null,[t("tr",{style:{"border-bottom":"1px solid var(--border-subtle)"}},[t("th",{class:"px-3 py-2 text-left section-label"},"Model"),t("th",{class:"px-3 py-2 text-right section-label"},"Tool Select"),t("th",{class:"px-3 py-2 text-right section-label"},"Param Acc."),t("th",{class:"px-3 py-2 text-right section-label"},"Overall"),t("th",{class:"px-3 py-2 text-right section-label"},"Cases")])],-1)),t("tbody",null,[(l(!0),r(b,null,_(n.value.summary,(e,i)=>(l(),r("tr",{key:i,style:{"border-top":"1px solid var(--border-subtle)"}},[t("td",Vt,a(i.split("/").pop()),1),t("td",{class:"px-3 py-2 text-right font-mono",style:c(h(e.tool_selection_score))},a(j(e.tool_selection_score)),5),t("td",{class:"px-3 py-2 text-right font-mono",style:c(h(e.param_accuracy_score))},a(j(e.param_accuracy_score)),5),t("td",{class:"px-3 py-2 text-right font-mono font-bold",style:c(h(e.overall_score??e.score))},a(j(e.overall_score??e.score)),5),t("td",Ot,a(e.total_cases??e.cases??"-"),1)]))),128))])])])])):y("",!0),n.value.results&&n.value.results.length>0?(l(),r("div",Nt,[t("div",Pt,[s[20]||(s[20]=t("p",{class:"text-[10px] font-display tracking-wider uppercase text-zinc-600"},"Test Cases",-1)),t("span",qt,a(n.value.results.length)+" results",1)]),t("div",Jt,[t("table",Ut,[s[21]||(s[21]=t("thead",{class:"sticky top-0",style:{background:"var(--surface-raised, #1a1a1a)"}},[t("tr",{style:{"border-bottom":"1px solid var(--border-subtle)"}},[t("th",{class:"px-3 py-2 text-left section-label"},"Model"),t("th",{class:"px-3 py-2 text-left section-label"},"Prompt"),t("th",{class:"px-3 py-2 text-left section-label"},"Expected"),t("th",{class:"px-3 py-2 text-left section-label"},"Actual"),t("th",{class:"px-3 py-2 text-right section-label"},"Score")])],-1)),t("tbody",null,[(l(!0),r(b,null,_(n.value.results,(e,i)=>(l(),r("tr",{key:i,style:{"border-top":"1px solid var(--border-subtle)"}},[t("td",Gt,a((e.model_name||e.model_id||"").split("/").pop()),1),t("td",It,[R(a(T(e.prompt||e.test_case_id||"",50))+" ",1),e.error?(l(),r("span",{key:0,class:"text-[9px] ml-1 px-1 py-0.5 rounded-sm",style:{color:"var(--coral)",background:"rgba(255,59,92,0.08)",border:"1px solid rgba(255,59,92,0.15)"},title:e.error},"ERR",8,Qt)):y("",!0)]),t("td",Kt,a(V(e.expected_tool)),1),t("td",{class:"px-3 py-2 font-mono text-[10px]",style:c(e.tool_selection_score>0?"color:var(--lime)":"color:var(--coral, #ff3b5c)")},a(e.actual_tool||"(none)"),5),t("td",{class:"px-3 py-2 text-right font-mono font-bold text-[11px]",style:c(h(e.overall_score))},a(e.overall_score!=null?(e.overall_score*100).toFixed(0)+"%":"-"),5)]))),128))])])])])):y("",!0)],64))])])):y("",!0)]))}},ee=et(Wt,[["__scopeId","data-v-04bb7f69"]]);export{ee as default};
