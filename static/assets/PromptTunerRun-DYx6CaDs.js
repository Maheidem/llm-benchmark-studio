import{u as z}from"./promptTuner-CgvK3rS_.js";import{u as $}from"./promptLibrary-EwM49QAX.js";import{p as L,o as V,I as F,c as l,d as t,t as p,x as o,i as _,j as x,f as c,l as v,y as k,k as m,K as N,r as P,a as I,b as a}from"./index-DBNJ0RjU.js";import{u as J}from"./useSharedContext-C-EAG0AM.js";import{_ as D}from"./PromptTimeline-DMogx2aK.js";import"./useActiveSession-DdoXJmDo.js";const E={class:"flex items-center justify-between mb-6"},M={class:"text-sm text-zinc-600 font-body"},U={class:"flex items-center gap-2"},W={key:0,class:"card rounded-md p-5 mb-6"},q={class:"flex items-center justify-between mb-3"},A={class:"flex items-center gap-3"},H={key:0,class:"pulse-dot"},K={class:"text-sm text-zinc-400 font-body"},G={class:"flex items-center gap-3"},O={key:0,class:"text-[10px] font-mono text-zinc-600"},Q={class:"text-xs font-mono text-zinc-600"},X={class:"progress-track rounded-full overflow-hidden"},Y={key:1,class:"card rounded-md p-5 mb-6",style:{"border-left":"3px solid var(--lime)"}},Z={class:"flex items-center justify-between mb-2"},ee={class:"text-sm font-mono font-bold",style:{color:"var(--lime)"}},te={class:"flex items-center gap-2 mt-2"},oe={key:3,class:"text-xs text-zinc-600 font-body text-center py-8"},re={key:4,class:"text-xs text-zinc-600 font-body text-center py-8"},ce={__name:"PromptTunerRun",setup(se){const e=z(),g=$(),h=L(),{setConfig:w,setSystemPrompt:C}=J(),{showToast:n}=N(),u=P(!1),b=P(!1);let f=null;V(()=>{e.restoreJob(),f=h.onMessage(r=>{if(!e.activeJobId||r.job_id&&r.job_id!==e.activeJobId)return;if(["tune_start","generation_start","prompt_generated","prompt_eval_start","prompt_eval_result","generation_complete","generation_error","tune_complete","job_progress","job_completed","job_failed","job_cancelled"].includes(r.type)&&(e.handleProgress(r),r.type==="tune_complete"&&(n("Prompt tuning complete!","success"),B()),r.type==="job_failed"&&n(r.error||"Tuning failed","error")),r.type==="eval_warning"&&n(r.detail||"Warning",""),r.type==="param_adjustments"&&r.models)for(const d of r.models){const y=(d.adjustments||[]).map(i=>i.action==="drop"?`${i.param} dropped`:i.action==="clamp"?`${i.param} clamped ${i.original}→${i.adjusted}`:i.action==="rename"?`${i.param} renamed`:`${i.param} ${i.action}`);y.length&&n(`${d.model_id}: ${y.join(", ")}`,"")}r.type==="judge_failed"&&n(r.detail||"Judge analysis failed","error")}),e.activeRunId&&e.generations.length===0&&e.loadRun(e.activeRunId).catch(()=>{})}),F(()=>{f&&f()});async function j(){try{await e.cancelTuning(),n("Cancellation requested","")}catch{n("Failed to cancel","error")}}function T(){e.bestPrompt&&(C("_global",e.bestPrompt),w({lastUpdatedBy:"prompt_tuner"}),n("Best prompt applied to shared context","success"))}function S(){e.bestPrompt&&navigator.clipboard.writeText(e.bestPrompt).then(()=>n("Copied to clipboard","success"),()=>n("Failed to copy","error"))}async function B(){if(e.bestPrompt)try{await g.saveVersion(e.bestPrompt,null,"tuner"),b.value=!0,n("Best prompt auto-saved to Prompt Library","success")}catch{}}async function R(){if(e.bestPrompt)try{await g.saveVersion(e.bestPrompt,null,"tuner"),b.value=!0,n("Saved to Prompt Library","success")}catch{n("Failed to save to library","error")}}return(r,s)=>{const d=I("router-link");return a(),l("div",null,[t("div",E,[t("div",null,[s[1]||(s[1]=t("h2",{class:"font-display font-bold text-lg text-zinc-100 mb-1"},"Prompt Tuner Run",-1)),t("p",M,p(o(e).isRunning?"Tuning in progress...":"Run complete"),1)]),t("div",U,[_(d,{to:{name:"PromptTunerConfig"},class:"text-[10px] font-display tracking-wider uppercase px-3 py-1.5 rounded-sm",style:{border:"1px solid var(--border-subtle)",color:"var(--zinc-400)"}},{default:x(()=>[...s[2]||(s[2]=[m("Config",-1)])]),_:1}),o(e).isRunning?(a(),l("button",{key:0,onClick:j,class:"text-[10px] font-display font-medium tracking-wider uppercase px-3 py-1 rounded-sm transition-colors",style:{color:"var(--coral)",border:"1px solid rgba(255,59,92,0.3)"}},"Cancel")):c("",!0)])]),o(e).isRunning||o(e).progress.pct>0?(a(),l("div",W,[t("div",q,[t("div",A,[o(e).isRunning?(a(),l("div",H)):c("",!0),t("span",K,p(o(e).progress.detail),1)]),t("div",G,[o(e).progress.eta?(a(),l("span",O,p(o(e).progress.eta),1)):c("",!0),t("span",Q,p(o(e).progress.pct)+"%",1)])]),t("div",X,[t("div",{class:"progress-fill",style:v({width:o(e).progress.pct+"%"})},null,4)])])):c("",!0),o(e).bestPrompt?(a(),l("div",Y,[t("div",Z,[s[3]||(s[3]=t("span",{class:"section-label"},"Best Prompt",-1)),t("span",ee,p((o(e).bestScore*100).toFixed(1))+"% ",1)]),t("div",{class:"text-xs text-zinc-400 font-body rounded-sm px-3 py-2 cursor-pointer",style:v([{background:"rgba(0,0,0,0.2)",border:"1px solid var(--border-subtle)"},{maxHeight:u.value?"none":"80px",overflow:u.value?"visible":"hidden"}]),onClick:s[0]||(s[0]=y=>u.value=!u.value)},p(o(e).bestPrompt),5),t("div",te,[t("button",{onClick:T,class:"text-[10px] font-display tracking-wider uppercase px-3 py-1 rounded-sm",style:{background:"rgba(191,255,0,0.08)",border:"1px solid rgba(191,255,0,0.2)",color:"var(--lime)"}},"Apply to Context"),b.value?(a(),k(d,{key:0,to:{name:"PromptLibrary"},class:"text-[10px] font-display tracking-wider uppercase px-3 py-1 rounded-sm",style:{background:"rgba(56,189,248,0.08)",border:"1px solid rgba(56,189,248,0.2)",color:"#38BDF8"}},{default:x(()=>[...s[4]||(s[4]=[m("View in Library →",-1)])]),_:1})):(a(),l("button",{key:1,onClick:R,class:"text-[10px] font-display tracking-wider uppercase px-3 py-1 rounded-sm",style:{background:"rgba(56,189,248,0.08)",border:"1px solid rgba(56,189,248,0.2)",color:"#38BDF8"}},"Save to Library")),t("button",{onClick:S,class:"text-[10px] font-display tracking-wider uppercase px-3 py-1 rounded-sm",style:{border:"1px solid var(--border-subtle)",color:"var(--zinc-400)"}},"Copy")])])):c("",!0),o(e).generations.length>0?(a(),k(D,{key:2,generations:o(e).generations,"current-generation-num":o(e).progress.generation},null,8,["generations","current-generation-num"])):o(e).isRunning?(a(),l("div",oe," Waiting for first generation... ")):!o(e).isRunning&&o(e).generations.length===0?(a(),l("div",re,[s[6]||(s[6]=m(" No active run. ",-1)),_(d,{to:{name:"PromptTunerConfig"},class:"text-lime-400 hover:text-lime-300"},{default:x(()=>[...s[5]||(s[5]=[m("Start a new tune",-1)])]),_:1})])):c("",!0)])}}};export{ce as default};
