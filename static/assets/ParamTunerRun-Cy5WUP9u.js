import{h as T,i as j,D as B,c as a,a as e,t as r,q as n,l as C,Q as w,d as u,g as p,F as f,p as m,B as F,k as _,e as P,G as N,J as I,r as V,o as i}from"./index-BxbfhC3f.js";import{u as $}from"./paramTuner-BwsIV-4h.js";import{_ as J}from"./ParamTunerResults-DOPzSw5X.js";import"./useActiveSession-DdoXJmDo.js";const A={class:"flex items-center justify-between mb-6"},D={class:"text-sm text-zinc-600 font-body"},E={class:"flex items-center gap-2"},M={key:0,class:"card rounded-md p-5 mb-6"},q={class:"flex items-center justify-between mb-3"},G={class:"flex items-center gap-3"},L={key:0,class:"pulse-dot"},Q={class:"text-sm text-zinc-400 font-body"},U={class:"text-xs font-mono text-zinc-600"},W={class:"progress-track rounded-full overflow-hidden"},H={key:1,class:"card rounded-md p-5 mb-6",style:{"border-left":"3px solid var(--lime)"}},K={class:"flex items-center justify-between mb-2"},O={class:"text-sm font-mono font-bold",style:{color:"var(--lime)"}},X={class:"flex flex-wrap gap-2"},Y={class:"text-[10px] text-zinc-600 font-body mt-2"},Z={key:3,class:"text-xs text-zinc-600 font-body text-center py-8"},ee={key:4,class:"text-xs text-zinc-600 font-body text-center py-8"},te={class:"card rounded-md p-6 max-w-2xl w-full mx-4",style:{"max-height":"80vh","overflow-y":"auto"}},se={class:"flex items-center justify-between mb-4"},oe={class:"mb-3"},ne={class:"text-xs font-mono text-zinc-300"},le={class:"flex flex-wrap gap-2 mb-4"},re={key:0,class:"mb-4"},ie={class:"flex flex-wrap gap-2"},ae={key:1},ce={class:"w-full text-xs results-table"},de={class:"px-3 py-1.5 text-xs font-mono text-zinc-500"},ue={class:"px-3 py-1.5 text-xs font-mono text-zinc-500"},_e={__name:"ParamTunerRun",setup(pe){const t=$(),z=T(),{showToast:x}=N(),c=V(null);let b=null;j(()=>{t.restoreJob(),b=z.onMessage(l=>{if(!t.activeJobId||l.job_id&&l.job_id!==t.activeJobId)return;["tune_start","combo_result","tune_complete","job_progress","job_completed","job_failed","job_cancelled"].includes(l.type)&&(t.handleProgress(l),l.type==="tune_complete"&&x("Param tuning complete!","success"),l.type==="job_failed"&&x(l.error||"Tuning failed","error"))}),t.activeRunId&&t.results.length===0&&t.loadRun(t.activeRunId).catch(()=>{})}),B(()=>{b&&b()});async function R(){try{await t.cancelTuning(),x("Cancellation requested","")}catch{x("Failed to cancel","error")}}function S(l){c.value=l}function y(l){return l==null?"-":typeof l=="number"?Number.isInteger(l)?l.toString():l.toFixed(3):String(l)}function g(l){return l>=80?"var(--lime)":l>=50?"#FBBF24":"var(--coral)"}return(l,s)=>{var h,k;const v=I("router-link");return i(),a("div",null,[e("div",A,[e("div",null,[s[3]||(s[3]=e("h2",{class:"font-display font-bold text-lg text-zinc-100 mb-1"},"Param Tuner Run",-1)),e("p",D,r(n(t).isRunning?"Tuning in progress...":"Run complete"),1)]),e("div",E,[C(v,{to:{name:"ParamTunerConfig"},class:"text-[10px] font-display tracking-wider uppercase px-3 py-1.5 rounded-sm",style:{border:"1px solid var(--border-subtle)",color:"var(--zinc-400)"}},{default:w(()=>[...s[4]||(s[4]=[_("Config",-1)])]),_:1}),n(t).isRunning?(i(),a("button",{key:0,onClick:R,class:"text-[10px] font-display font-medium tracking-wider uppercase px-3 py-1 rounded-sm transition-colors",style:{color:"var(--coral)",border:"1px solid rgba(255,59,92,0.3)"}},"Cancel")):u("",!0)])]),n(t).isRunning||n(t).progress.pct>0?(i(),a("div",M,[e("div",q,[e("div",G,[n(t).isRunning?(i(),a("div",L)):u("",!0),e("span",Q,r(n(t).progress.detail),1)]),e("span",U,r(n(t).progress.pct)+"%",1)]),e("div",W,[e("div",{class:"progress-fill",style:p({width:n(t).progress.pct+"%"})},null,4)])])):u("",!0),n(t).bestConfig?(i(),a("div",H,[e("div",K,[s[5]||(s[5]=e("span",{class:"section-label"},"Best Config",-1)),e("span",O,r((n(t).bestScore*100).toFixed(1))+"% ",1)]),e("div",X,[(i(!0),a(f,null,m(n(t).bestConfig.config,(o,d)=>(i(),a("span",{key:d,class:"text-[10px] font-mono px-2 py-1 rounded-sm",style:{background:"rgba(191,255,0,0.06)",border:"1px solid rgba(191,255,0,0.15)",color:"var(--lime)"}},r(d)+": "+r(y(o)),1))),128))]),e("div",Y,r(n(t).bestConfig.model_name||n(t).bestConfig.model_id||"")+" - "+r(n(t).bestConfig.cases_passed||0)+"/"+r(n(t).bestConfig.cases_total||0)+" cases passed ",1)])):u("",!0),n(t).results.length>0?(i(),F(J,{key:2,results:n(t).sortedResults,"best-overall-score":n(t).bestScore,onSort:s[0]||(s[0]=o=>n(t).setSort(o)),onSelect:S},null,8,["results","best-overall-score"])):n(t).isRunning?(i(),a("div",Z," Waiting for first combo result... ")):!n(t).isRunning&&n(t).results.length===0?(i(),a("div",ee,[s[7]||(s[7]=_(" No active run. ",-1)),C(v,{to:{name:"ParamTunerConfig"},class:"text-lime-400 hover:text-lime-300"},{default:w(()=>[...s[6]||(s[6]=[_("Start a new tune",-1)])]),_:1})])):u("",!0),c.value?(i(),a("div",{key:5,class:"fixed inset-0 z-50 flex items-center justify-center",style:{background:"rgba(0,0,0,0.7)"},onClick:s[2]||(s[2]=P(o=>c.value=null,["self"]))},[e("div",te,[e("div",se,[s[8]||(s[8]=e("span",{class:"section-label"},"Combo Detail",-1)),e("button",{onClick:s[1]||(s[1]=o=>c.value=null),class:"text-zinc-500 hover:text-zinc-300",style:{background:"none",border:"none",cursor:"pointer"}},"Close")]),e("div",oe,[e("span",ne,r(c.value.model_name),1),e("span",{class:"text-xs font-mono ml-2",style:p({color:g(c.value.overall_score*100)})},r((c.value.overall_score*100).toFixed(1))+"% ",5)]),e("div",le,[(i(!0),a(f,null,m(c.value.config,(o,d)=>(i(),a("span",{key:d,class:"text-[10px] font-mono px-2 py-1 rounded-sm",style:{background:"rgba(255,255,255,0.04)",border:"1px solid var(--border-subtle)"}},r(d)+": "+r(y(o)),1))),128))]),((h=c.value.adjustments)==null?void 0:h.length)>0?(i(),a("div",re,[s[9]||(s[9]=e("div",{class:"text-[10px] text-zinc-600 font-display tracking-wider uppercase mb-1"},"Adjustments",-1)),e("div",ie,[(i(!0),a(f,null,m(c.value.adjustments,o=>(i(),a("span",{key:o.param,class:"text-[10px] font-mono px-2 py-1 rounded-sm",style:p(o.type==="dropped"?{background:"rgba(255,59,92,0.1)",color:"var(--coral)"}:{background:"rgba(234,179,8,0.1)",color:"#EAB308"})},r(o.param)+": "+r(o.type)+r(o.type==="clamped"?` (${o.original} -> ${o.clamped})`:""),5))),128))])])):u("",!0),((k=c.value.case_results)==null?void 0:k.length)>0?(i(),a("div",ae,[s[11]||(s[11]=e("div",{class:"text-[10px] text-zinc-600 font-display tracking-wider uppercase mb-2"},"Per-Case Results",-1)),e("table",ce,[s[10]||(s[10]=e("thead",null,[e("tr",{style:{"border-bottom":"1px solid var(--border-subtle)"}},[e("th",{class:"px-3 py-1.5 text-left section-label"},"Case"),e("th",{class:"px-3 py-1.5 text-left section-label"},"Expected"),e("th",{class:"px-3 py-1.5 text-left section-label"},"Actual"),e("th",{class:"px-3 py-1.5 text-right section-label"},"Score")])],-1)),e("tbody",null,[(i(!0),a(f,null,m(c.value.case_results,(o,d)=>(i(),a("tr",{key:d},[e("td",de,r(o.test_case_id||d+1),1),e("td",ue,r(o.expected_tool),1),e("td",{class:"px-3 py-1.5 text-xs font-mono",style:p({color:o.tool_selection_score>0?"var(--lime)":"var(--coral)"})},r(o.actual_tool||"(none)"),5),e("td",{class:"px-3 py-1.5 text-right text-xs font-mono",style:p({color:g((o.overall_score||0)*100)})},r(((o.overall_score||0)*100).toFixed(0))+"% ",5)]))),128))])])])):u("",!0)])])):u("",!0)])}}};export{_e as default};
