import{p as M,o as P,I as $,c as l,d as t,t as a,x as s,i as z,j as C,f as c,l as x,F as b,A as g,y as I,k as h,g as N,K as A,a as V,B as S,r as D,b as r}from"./index-BqpQFpv6.js";import{u as E}from"./paramTuner-BccFH9UM.js";import{_ as J}from"./ParamTunerResults-4fiF-DMi.js";import"./useActiveSession-DdoXJmDo.js";const L={class:"flex items-center justify-between mb-6"},q={class:"text-sm text-zinc-600 font-body"},K={class:"flex items-center gap-2"},U={key:0,class:"card rounded-md p-5 mb-6"},W={class:"flex items-center justify-between mb-3"},G={class:"flex items-center gap-3"},H={key:0,class:"pulse-dot"},O={class:"text-sm text-zinc-400 font-body"},Q={class:"flex items-center gap-3"},X={key:0,class:"text-[9px] font-display tracking-wider uppercase px-1.5 py-0.5 rounded-sm",style:{background:"rgba(251,191,36,0.08)",color:"#FBBF24",border:"1px solid rgba(251,191,36,0.2)"},title:"Bayesian search converged early"},Y={key:1,class:"text-[10px] font-mono text-zinc-600"},Z={class:"text-xs font-mono text-zinc-600"},ee={class:"progress-track rounded-full overflow-hidden"},te={key:0,class:"text-[10px] text-zinc-600 font-mono mt-1"},se={key:1,class:"card rounded-md p-5 mb-6"},oe={class:"relative",style:{height:"80px"}},ne=["viewBox"],re=["points"],le=["cx","cy","fill"],ie={key:2,class:"card rounded-md p-5 mb-6",style:{"border-left":"3px solid var(--lime)"}},ae={class:"flex items-center justify-between mb-2"},ce={class:"text-sm font-mono font-bold",style:{color:"var(--lime)"}},de={class:"flex flex-wrap gap-2"},ue={class:"text-[10px] text-zinc-600 font-body mt-2"},pe={key:4,class:"text-xs text-zinc-600 font-body text-center py-8"},xe={key:5,class:"text-xs text-zinc-600 font-body text-center py-8"},fe={class:"card rounded-md p-6 max-w-2xl w-full mx-4",style:{"max-height":"80vh","overflow-y":"auto"}},me={class:"flex items-center justify-between mb-4"},be={class:"mb-3"},ge={class:"text-xs font-mono text-zinc-300"},ye={class:"flex flex-wrap gap-2 mb-4"},_e={key:0,class:"mb-4"},ve={class:"flex flex-wrap gap-2"},he={key:1},ke={class:"w-full text-xs results-table"},we={class:"px-3 py-1.5 text-xs font-mono text-zinc-500"},ze={class:"px-3 py-1.5 text-xs font-mono text-zinc-500"},Te={__name:"ParamTunerRun",setup(Ce){const e=E(),B=M(),{showToast:y}=A(),d=D(null),f=S(()=>{if(!e.results.length)return[];let n=0;return e.results.map((o,_)=>{const p=o.overall_score||0,m=p>n;return m&&(n=p),{index:_,score:p,bestSoFar:n,isBest:m}})}),R=S(()=>f.value.length?f.value.map((n,o)=>`${o*8+4},${100-n.bestSoFar*100}`).join(" "):"");function F(n){return n==="bayesian"?{background:"rgba(168,85,247,0.08)",color:"#A855F7",border:"1px solid rgba(168,85,247,0.2)"}:n==="random"?{background:"rgba(56,189,248,0.08)",color:"#38BDF8",border:"1px solid rgba(56,189,248,0.2)"}:{}}let v=null;P(()=>{e.restoreJob(),v=B.onMessage(n=>{if(!e.activeJobId||n.job_id&&n.job_id!==e.activeJobId)return;["tune_start","combo_result","tune_complete","job_progress","job_completed","job_failed","job_cancelled"].includes(n.type)&&(e.handleProgress(n),n.type==="tune_complete"&&y("Param tuning complete!","success"),n.type==="job_failed"&&y(n.error||"Tuning failed","error"))}),e.activeRunId&&e.results.length===0&&e.loadRun(e.activeRunId).catch(()=>{})}),$(()=>{v&&v()});async function T(){try{await e.cancelTuning(),y("Cancellation requested","")}catch{y("Failed to cancel","error")}}function j(n){d.value=n}function k(n){return n==null?"-":typeof n=="number"?Number.isInteger(n)?n.toString():n.toFixed(3):String(n)}function w(n){return n>=80?"var(--lime)":n>=50?"#FBBF24":"var(--coral)"}return(n,o)=>{var p,m;const _=V("router-link");return r(),l("div",null,[t("div",L,[t("div",null,[o[3]||(o[3]=t("h2",{class:"font-display font-bold text-lg text-zinc-100 mb-1"},"Param Tuner Run",-1)),t("p",q,a(s(e).isRunning?"Tuning in progress...":"Run complete"),1)]),t("div",K,[z(_,{to:{name:"ParamTunerConfig"},class:"text-[10px] font-display tracking-wider uppercase px-3 py-1.5 rounded-sm",style:{border:"1px solid var(--border-subtle)",color:"var(--zinc-400)"}},{default:C(()=>[...o[4]||(o[4]=[h("Config",-1)])]),_:1}),s(e).isRunning?(r(),l("button",{key:0,onClick:T,class:"text-[10px] font-display font-medium tracking-wider uppercase px-3 py-1 rounded-sm transition-colors",style:{color:"var(--coral)",border:"1px solid rgba(255,59,92,0.3)"}},"Cancel")):c("",!0)])]),s(e).isRunning||s(e).progress.pct>0?(r(),l("div",U,[t("div",W,[t("div",G,[s(e).isRunning?(r(),l("div",H)):c("",!0),t("span",O,a(s(e).progress.detail),1),s(e).optimizationMode&&s(e).optimizationMode!=="grid"?(r(),l("span",{key:1,class:"text-[9px] font-display tracking-wider uppercase px-1.5 py-0.5 rounded-sm",style:x(F(s(e).optimizationMode))},a(s(e).optimizationMode),5)):c("",!0)]),t("div",Q,[s(e).earlyStopped?(r(),l("span",X,"Converged")):c("",!0),s(e).progress.eta?(r(),l("span",Y,a(s(e).progress.eta),1)):c("",!0),t("span",Z,a(s(e).progress.pct)+"%",1)])]),t("div",ee,[t("div",{class:"progress-fill",style:x({width:s(e).progress.pct+"%"})},null,4)]),s(e).optimizationMode&&s(e).optimizationMode!=="grid"&&s(e).progress.iteration?(r(),l("div",te,"Trial "+a(s(e).progress.iteration)+"/"+a(s(e).progress.totalIterations||"?"),1)):c("",!0)])):c("",!0),s(e).optimizationMode==="bayesian"&&f.value.length>1?(r(),l("div",se,[o[5]||(o[5]=t("div",{class:"flex items-center justify-between mb-3"},[t("span",{class:"section-label"},"Convergence"),t("span",{class:"text-[10px] text-zinc-600 font-body"},"Score vs iteration")],-1)),t("div",oe,[(r(),l("svg",{class:"w-full h-full",viewBox:`0 0 ${f.value.length*8} 100`,preserveAspectRatio:"none"},[t("polyline",{points:R.value,fill:"none",stroke:"var(--lime)","stroke-width":"1.5"},null,8,re),(r(!0),l(b,null,g(f.value,(i,u)=>(r(),l("circle",{key:u,cx:u*8+4,cy:100-i.score*100,r:"1.5",fill:i.isBest?"var(--lime)":"rgba(191,255,0,0.3)"},null,8,le))),128))],8,ne))])])):c("",!0),s(e).bestConfig?(r(),l("div",ie,[t("div",ae,[o[6]||(o[6]=t("span",{class:"section-label"},"Best Config",-1)),t("span",ce,a((s(e).bestScore*100).toFixed(1))+"% ",1)]),t("div",de,[(r(!0),l(b,null,g(s(e).bestConfig.config,(i,u)=>(r(),l("span",{key:u,class:"text-[10px] font-mono px-2 py-1 rounded-sm",style:{background:"rgba(191,255,0,0.06)",border:"1px solid rgba(191,255,0,0.15)",color:"var(--lime)"}},a(u)+": "+a(k(i)),1))),128))]),t("div",ue,a(s(e).bestConfig.model_name||s(e).bestConfig.model_id||"")+" - "+a(s(e).bestConfig.cases_passed||0)+"/"+a(s(e).bestConfig.cases_total||0)+" cases passed ",1)])):c("",!0),s(e).results.length>0?(r(),I(J,{key:3,results:s(e).sortedResults,"best-overall-score":s(e).bestScore,onSort:o[0]||(o[0]=i=>s(e).setSort(i)),onSelect:j},null,8,["results","best-overall-score"])):s(e).isRunning?(r(),l("div",pe," Waiting for first combo result... ")):!s(e).isRunning&&s(e).results.length===0?(r(),l("div",xe,[o[8]||(o[8]=h(" No active run. ",-1)),z(_,{to:{name:"ParamTunerConfig"},class:"text-lime-400 hover:text-lime-300"},{default:C(()=>[...o[7]||(o[7]=[h("Start a new tune",-1)])]),_:1})])):c("",!0),d.value?(r(),l("div",{key:6,class:"fixed inset-0 z-50 flex items-center justify-center",style:{background:"rgba(0,0,0,0.7)"},onClick:o[2]||(o[2]=N(i=>d.value=null,["self"]))},[t("div",fe,[t("div",me,[o[9]||(o[9]=t("span",{class:"section-label"},"Combo Detail",-1)),t("button",{onClick:o[1]||(o[1]=i=>d.value=null),class:"text-zinc-500 hover:text-zinc-300",style:{background:"none",border:"none",cursor:"pointer"}},"Close")]),t("div",be,[t("span",ge,a(d.value.model_name),1),t("span",{class:"text-xs font-mono ml-2",style:x({color:w(d.value.overall_score*100)})},a((d.value.overall_score*100).toFixed(1))+"% ",5)]),t("div",ye,[(r(!0),l(b,null,g(d.value.config,(i,u)=>(r(),l("span",{key:u,class:"text-[10px] font-mono px-2 py-1 rounded-sm",style:{background:"rgba(255,255,255,0.04)",border:"1px solid var(--border-subtle)"}},a(u)+": "+a(k(i)),1))),128))]),((p=d.value.adjustments)==null?void 0:p.length)>0?(r(),l("div",_e,[o[10]||(o[10]=t("div",{class:"text-[10px] text-zinc-600 font-display tracking-wider uppercase mb-1"},"Adjustments",-1)),t("div",ve,[(r(!0),l(b,null,g(d.value.adjustments,i=>(r(),l("span",{key:i.param,class:"text-[10px] font-mono px-2 py-1 rounded-sm",style:x(i.type==="dropped"?{background:"rgba(255,59,92,0.1)",color:"var(--coral)"}:{background:"rgba(234,179,8,0.1)",color:"#EAB308"})},a(i.param)+": "+a(i.type)+a(i.type==="clamped"?` (${i.original} -> ${i.clamped})`:""),5))),128))])])):c("",!0),((m=d.value.case_results)==null?void 0:m.length)>0?(r(),l("div",he,[o[12]||(o[12]=t("div",{class:"text-[10px] text-zinc-600 font-display tracking-wider uppercase mb-2"},"Per-Case Results",-1)),t("table",ke,[o[11]||(o[11]=t("thead",null,[t("tr",{style:{"border-bottom":"1px solid var(--border-subtle)"}},[t("th",{class:"px-3 py-1.5 text-left section-label"},"Case"),t("th",{class:"px-3 py-1.5 text-left section-label"},"Expected"),t("th",{class:"px-3 py-1.5 text-left section-label"},"Actual"),t("th",{class:"px-3 py-1.5 text-right section-label"},"Score")])],-1)),t("tbody",null,[(r(!0),l(b,null,g(d.value.case_results,(i,u)=>(r(),l("tr",{key:u},[t("td",we,a(i.test_case_id||u+1),1),t("td",ze,a(i.expected_tool),1),t("td",{class:"px-3 py-1.5 text-xs font-mono",style:x({color:i.tool_selection_score>0?"var(--lime)":"var(--coral)"})},a(i.actual_tool||"(none)"),5),t("td",{class:"px-3 py-1.5 text-right text-xs font-mono",style:x({color:w((i.overall_score||0)*100)})},a(((i.overall_score||0)*100).toFixed(0))+"% ",5)]))),128))])])])):c("",!0)])])):c("",!0)])}}};export{Te as default};
