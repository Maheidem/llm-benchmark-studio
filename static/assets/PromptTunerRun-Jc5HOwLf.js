import{u as j}from"./promptTuner-BaNkKVMY.js";import{u as R}from"./promptLibrary-DEdGJ11d.js";import{p as z,o as L,I as V,c as i,d as t,t as l,x as o,i as x,j as f,f as c,l as g,y as _,k as p,K as F,r as v,a as N,b as a}from"./index-B7jY00Un.js";import{u as I}from"./useSharedContext-LEiTYig8.js";import{_ as J}from"./PromptTimeline-CB_aYuQ_.js";import"./useActiveSession-DdoXJmDo.js";const D={class:"flex items-center justify-between mb-6"},E={class:"text-sm text-zinc-600 font-body"},M={class:"flex items-center gap-2"},U={key:0,class:"card rounded-md p-5 mb-6"},W={class:"flex items-center justify-between mb-3"},$={class:"flex items-center gap-3"},q={key:0,class:"pulse-dot"},A={class:"text-sm text-zinc-400 font-body"},H={class:"flex items-center gap-3"},K={key:0,class:"text-[10px] font-mono text-zinc-600"},G={class:"text-xs font-mono text-zinc-600"},O={class:"progress-track rounded-full overflow-hidden"},Q={key:1,class:"card rounded-md p-5 mb-6",style:{"border-left":"3px solid var(--lime)"}},X={class:"flex items-center justify-between mb-2"},Y={class:"text-sm font-mono font-bold",style:{color:"var(--lime)"}},Z={class:"flex items-center gap-2 mt-2"},ee={key:3,class:"text-xs text-zinc-600 font-body text-center py-8"},te={key:4,class:"text-xs text-zinc-600 font-body text-center py-8"},de={__name:"PromptTunerRun",setup(oe){const e=j(),y=R(),k=z(),{setConfig:P,setSystemPrompt:h}=I(),{showToast:s}=F(),d=v(!1),u=v(!1);let m=null;L(()=>{e.restoreJob(),m=k.onMessage(n=>{if(!e.activeJobId||n.job_id&&n.job_id!==e.activeJobId)return;["tune_start","generation_start","prompt_generated","prompt_eval_start","prompt_eval_result","generation_complete","generation_error","tune_complete","job_progress","job_completed","job_failed","job_cancelled"].includes(n.type)&&(e.handleProgress(n),n.type==="tune_complete"&&(s("Prompt tuning complete!","success"),S()),n.type==="job_failed"&&s(n.error||"Tuning failed","error")),n.type==="eval_warning"&&s(n.detail||"Warning",""),n.type==="judge_failed"&&s(n.detail||"Judge analysis failed","error")}),e.activeRunId&&e.generations.length===0&&e.loadRun(e.activeRunId).catch(()=>{})}),V(()=>{m&&m()});async function w(){try{await e.cancelTuning(),s("Cancellation requested","")}catch{s("Failed to cancel","error")}}function C(){e.bestPrompt&&(h("_global",e.bestPrompt),P({lastUpdatedBy:"prompt_tuner"}),s("Best prompt applied to shared context","success"))}function T(){e.bestPrompt&&navigator.clipboard.writeText(e.bestPrompt).then(()=>s("Copied to clipboard","success"),()=>s("Failed to copy","error"))}async function S(){if(e.bestPrompt)try{await y.saveVersion(e.bestPrompt,null,"tuner"),u.value=!0,s("Best prompt auto-saved to Prompt Library","success")}catch{}}async function B(){if(e.bestPrompt)try{await y.saveVersion(e.bestPrompt,null,"tuner"),u.value=!0,s("Saved to Prompt Library","success")}catch{s("Failed to save to library","error")}}return(n,r)=>{const b=N("router-link");return a(),i("div",null,[t("div",D,[t("div",null,[r[1]||(r[1]=t("h2",{class:"font-display font-bold text-lg text-zinc-100 mb-1"},"Prompt Tuner Run",-1)),t("p",E,l(o(e).isRunning?"Tuning in progress...":"Run complete"),1)]),t("div",M,[x(b,{to:{name:"PromptTunerConfig"},class:"text-[10px] font-display tracking-wider uppercase px-3 py-1.5 rounded-sm",style:{border:"1px solid var(--border-subtle)",color:"var(--zinc-400)"}},{default:f(()=>[...r[2]||(r[2]=[p("Config",-1)])]),_:1}),o(e).isRunning?(a(),i("button",{key:0,onClick:w,class:"text-[10px] font-display font-medium tracking-wider uppercase px-3 py-1 rounded-sm transition-colors",style:{color:"var(--coral)",border:"1px solid rgba(255,59,92,0.3)"}},"Cancel")):c("",!0)])]),o(e).isRunning||o(e).progress.pct>0?(a(),i("div",U,[t("div",W,[t("div",$,[o(e).isRunning?(a(),i("div",q)):c("",!0),t("span",A,l(o(e).progress.detail),1)]),t("div",H,[o(e).progress.eta?(a(),i("span",K,l(o(e).progress.eta),1)):c("",!0),t("span",G,l(o(e).progress.pct)+"%",1)])]),t("div",O,[t("div",{class:"progress-fill",style:g({width:o(e).progress.pct+"%"})},null,4)])])):c("",!0),o(e).bestPrompt?(a(),i("div",Q,[t("div",X,[r[3]||(r[3]=t("span",{class:"section-label"},"Best Prompt",-1)),t("span",Y,l((o(e).bestScore*100).toFixed(1))+"% ",1)]),t("div",{class:"text-xs text-zinc-400 font-body rounded-sm px-3 py-2 cursor-pointer",style:g([{background:"rgba(0,0,0,0.2)",border:"1px solid var(--border-subtle)"},{maxHeight:d.value?"none":"80px",overflow:d.value?"visible":"hidden"}]),onClick:r[0]||(r[0]=re=>d.value=!d.value)},l(o(e).bestPrompt),5),t("div",Z,[t("button",{onClick:C,class:"text-[10px] font-display tracking-wider uppercase px-3 py-1 rounded-sm",style:{background:"rgba(191,255,0,0.08)",border:"1px solid rgba(191,255,0,0.2)",color:"var(--lime)"}},"Apply to Context"),u.value?(a(),_(b,{key:0,to:{name:"PromptLibrary"},class:"text-[10px] font-display tracking-wider uppercase px-3 py-1 rounded-sm",style:{background:"rgba(56,189,248,0.08)",border:"1px solid rgba(56,189,248,0.2)",color:"#38BDF8"}},{default:f(()=>[...r[4]||(r[4]=[p("View in Library â†’",-1)])]),_:1})):(a(),i("button",{key:1,onClick:B,class:"text-[10px] font-display tracking-wider uppercase px-3 py-1 rounded-sm",style:{background:"rgba(56,189,248,0.08)",border:"1px solid rgba(56,189,248,0.2)",color:"#38BDF8"}},"Save to Library")),t("button",{onClick:T,class:"text-[10px] font-display tracking-wider uppercase px-3 py-1 rounded-sm",style:{border:"1px solid var(--border-subtle)",color:"var(--zinc-400)"}},"Copy")])])):c("",!0),o(e).generations.length>0?(a(),_(J,{key:2,generations:o(e).generations,"current-generation-num":o(e).progress.generation},null,8,["generations","current-generation-num"])):o(e).isRunning?(a(),i("div",ee," Waiting for first generation... ")):!o(e).isRunning&&o(e).generations.length===0?(a(),i("div",te,[r[6]||(r[6]=p(" No active run. ",-1)),x(b,{to:{name:"PromptTunerConfig"},class:"text-lime-400 hover:text-lime-300"},{default:f(()=>[...r[5]||(r[5]=[p("Start a new tune",-1)])]),_:1})])):c("",!0)])}}};export{de as default};
