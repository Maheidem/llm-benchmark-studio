import{o as se,w as re,D as le,c as l,d as t,x as P,y as ne,j,f as h,i as U,h as f,z as D,F as T,A as M,l as L,e as E,t as a,k as z,v as B,K as ae,r as p,Q as ie,a as de,B as O,q as ue,b as r,R as pe}from"./index-BMBAIBBO.js";import{a as ce,u as me}from"./useSharedContext-DdThRwA2.js";import{u as ve}from"./promptTuner-DdMpWZDo.js";import{u as be}from"./promptLibrary-Ctpy1fet.js";import{u as xe}from"./config-bEE9BPiW.js";import"./useActiveSession-DdoXJmDo.js";const ye={class:"flex items-center justify-between mb-6"},ge={class:"flex items-center gap-2"},fe={class:"card rounded-md p-5 mb-6"},ke=["value"],_e={class:"card rounded-md p-5 mb-6"},we={class:"grid grid-cols-2 gap-3"},he={class:"card rounded-md p-5 mb-6"},ze=["value"],Se={class:"card rounded-md p-5 mb-6"},Ce={class:"flex items-center justify-between mb-3"},Pe={class:"text-xs font-mono text-zinc-600"},Te={key:0,class:"text-xs text-zinc-600 font-body"},Me={key:1,class:"flex flex-col gap-1"},Le=["onClick"],Ee={class:"provider-group-count"},Ve={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2 pl-4 pb-2"},Fe=["onClick"],$e={class:"text-xs font-mono text-zinc-200 truncate"},qe={class:"card rounded-md p-5 mb-6"},Ae={class:"flex items-center justify-between mb-2"},Be={class:"flex items-center gap-2"},Ie=["disabled"],Re={key:0,class:"mb-3 rounded-sm overflow-hidden",style:{border:"1px solid rgba(168,85,247,0.2)"}},je={key:0,class:"px-3 py-2 text-[10px] text-zinc-600"},Ke={key:1,class:"px-3 py-2 text-[10px] text-zinc-600"},Ne={key:2,style:{"max-height":"200px","overflow-y":"auto"}},Ue=["onClick"],De={class:"flex items-center gap-2 mb-0.5"},Oe={class:"text-[10px] font-mono text-zinc-400"},Ge={class:"text-[10px] text-zinc-600 truncate"},He={class:"px-3 py-2",style:{"border-top":"1px solid var(--border-subtle)"}},Qe={class:"card rounded-md p-5 mb-6"},Ye={class:"grid grid-cols-3 gap-4"},We={key:0},Je={key:1},Xe={key:0,class:"mt-3 text-[10px] text-zinc-600 font-body"},Ze={key:0,class:"text-yellow-400 ml-2"},et={class:"flex items-center justify-end"},tt=["disabled"],dt={__name:"PromptTunerConfig",setup(ot){const G=ue(),V=ce(),F=ve(),k=be(),$=xe(),{showToast:x}=ae(),{context:y,setSuite:H}=me(),_=p(!1),c=p(""),i=p("quick"),w=p(""),u=ie(new Set),m=p("You are a helpful assistant that uses tools to answer questions. When the user asks you to perform an action, use the appropriate tool."),S=p(5),C=p(3),I=p(.4),K=p(!0),N=p([]),g=p(null),Q=O(()=>$.allModels||[]),R=O(()=>c.value&&w.value&&u.size>0&&!F.isRunning);se(async()=>{var s,e;if(V.suites.length===0)try{await V.loadSuites()}catch{x("Failed to load suites","error")}try{await $.loadConfig(),$.config&&Y($.config)}catch{x("Failed to load model config","error")}finally{K.value=!1}y.suiteId&&(c.value=y.suiteId),(s=y.selectedModels)!=null&&s.length&&y.selectedModels.forEach(v=>u.add(v)),(e=y.systemPrompts)!=null&&e._global&&(m.value=y.systemPrompts._global)}),re([c,i,S,C,()=>u.size],async()=>{if(!c.value){g.value=null;return}try{g.value=await F.getEstimate({suite_id:c.value,mode:i.value,population_size:S.value,generations:i.value==="quick"?1:C.value,num_models:u.size||1})}catch{g.value=null}},{debounce:500});function Y(s){const e=[],v=s.providers||{};for(const[o,n]of Object.entries(v)){const b=n.provider_key||o,d=(n.models||[]).map(A=>({key:`${b}::${A.model_id}`,model_id:A.model_id,display_name:A.display_name||A.model_id,provider_key:b}));if(d.length===0)continue;const q=le(n.display_name||o);e.push({provider:n.display_name||o,color:q.text,models:d,collapsed:!1})}N.value=e}function W(s){u.has(s)?u.delete(s):u.add(s)}function J(){const s=V.suites.find(e=>e.id===c.value);s&&H(s.id,s.name)}function X(s){return s?s<60?`${Math.round(s)}s`:`${Math.ceil(s/60)}m`:"?"}async function Z(){if(_.value=!_.value,_.value&&k.versions.length===0)try{await k.loadVersions()}catch{x("Failed to load prompt library","error")}}function ee(s){m.value=s.prompt_text,_.value=!1,x(`Loaded: ${s.label||"prompt version"}`,"success")}async function te(){if(m.value.trim())try{await k.saveVersion(m.value.trim(),null,"manual"),x("Prompt saved to library","success")}catch{x("Failed to save to library","error")}}async function oe(){if(!R.value)return;const s=w.value.indexOf("::"),e=w.value.substring(0,s),v=w.value.substring(s+2),o=Array.from(u).map(d=>{const q=d.indexOf("::");return{provider_key:d.substring(0,q),model_id:d.substring(q+2)}}),n=Array.from(u).map(d=>d.substring(d.indexOf("::")+2)),b={suite_id:c.value,mode:i.value,meta_model:v,meta_provider_key:e,target_models:n,target_targets:o,base_prompt:m.value,config:{population_size:S.value,generations:i.value==="quick"?1:C.value,selection_ratio:I.value}};y.experimentId&&(b.experiment_id=y.experimentId);try{await F.startTuning(b),x("Prompt tuning started","success"),G.push({name:"PromptTunerRun"})}catch(d){x(d.message||"Failed to start tuning","error")}}return(s,e)=>{const v=de("router-link");return r(),l("div",null,[t("div",ye,[e[11]||(e[11]=t("div",null,[t("h2",{class:"font-display font-bold text-lg text-zinc-100 mb-1"},"Prompt Tuner"),t("p",{class:"text-sm text-zinc-600 font-body"},"AI-powered system prompt optimization for tool calling.")],-1)),t("div",ge,[P(F).isRunning?(r(),ne(v,{key:0,to:{name:"PromptTunerRun"},class:"text-[10px] font-display tracking-wider uppercase px-3 py-1.5 rounded-sm",style:{background:"rgba(191,255,0,0.08)",border:"1px solid rgba(191,255,0,0.2)",color:"var(--lime)"}},{default:j(()=>[...e[9]||(e[9]=[z("View Active Run",-1)])]),_:1})):h("",!0),U(v,{to:{name:"PromptTunerHistory"},class:"text-[10px] font-display tracking-wider uppercase px-3 py-1.5 rounded-sm",style:{border:"1px solid var(--border-subtle)",color:"var(--zinc-400)"}},{default:j(()=>[...e[10]||(e[10]=[z("History",-1)])]),_:1})])]),t("div",fe,[e[13]||(e[13]=t("label",{class:"section-label mb-2 block"},"Suite",-1)),f(t("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>c.value=o),onChange:J,class:"text-sm font-mono px-3 py-2 rounded-sm w-full",style:{background:"var(--surface)",border:"1px solid var(--border-subtle)",color:"#E4E4E7",outline:"none"}},[e[12]||(e[12]=t("option",{value:""},"-- Select a suite --",-1)),(r(!0),l(T,null,M(P(V).suites,o=>(r(),l("option",{key:o.id,value:o.id},a(o.name)+" ("+a(o.tool_count||0)+" tools, "+a(o.test_case_count||0)+" cases) ",9,ke))),128))],544),[[D,c.value]])]),t("div",_e,[e[16]||(e[16]=t("span",{class:"section-label mb-3 block"},"Tuning Mode",-1)),t("div",we,[t("div",{class:E(["rounded-sm px-4 py-3 cursor-pointer transition-colors",i.value==="quick"?"bg-white/[0.04]":"hover:bg-white/[0.02]"]),style:L(i.value==="quick"?{border:"1px solid rgba(191,255,0,0.3)"}:{border:"1px solid var(--border-subtle)"}),onClick:e[1]||(e[1]=o=>i.value="quick")},[...e[14]||(e[14]=[t("div",{class:"text-xs font-display font-bold text-zinc-200 mb-1"},"Quick",-1),t("div",{class:"text-[10px] text-zinc-600 font-body"},"Generate N prompts, evaluate once. Fast and simple.",-1)])],6),t("div",{class:E(["rounded-sm px-4 py-3 cursor-pointer transition-colors",i.value==="evolutionary"?"bg-white/[0.04]":"hover:bg-white/[0.02]"]),style:L(i.value==="evolutionary"?{border:"1px solid rgba(168,85,247,0.3)"}:{border:"1px solid var(--border-subtle)"}),onClick:e[2]||(e[2]=o=>i.value="evolutionary")},[...e[15]||(e[15]=[t("div",{class:"text-xs font-display font-bold text-zinc-200 mb-1"},"Evolutionary",-1),t("div",{class:"text-[10px] text-zinc-600 font-body"},"Multiple generations with selection. Best survive and mutate.",-1)])],6)])]),t("div",he,[e[18]||(e[18]=t("span",{class:"section-label mb-3 block"},"Meta Model (generates prompts)",-1)),f(t("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>w.value=o),class:"text-sm font-mono px-3 py-2 rounded-sm w-full",style:{background:"var(--surface)",border:"1px solid var(--border-subtle)",color:"#E4E4E7",outline:"none"}},[e[17]||(e[17]=t("option",{value:""},"-- Select meta model --",-1)),(r(!0),l(T,null,M(Q.value,o=>(r(),l("option",{key:o.compoundKey,value:o.compoundKey},a(o.display_name||o.model_id)+" ("+a(o.provider)+") ",9,ze))),128))],512),[[D,w.value]])]),t("div",Se,[t("div",Ce,[e[19]||(e[19]=t("span",{class:"section-label"},"Target Models (evaluated with generated prompts)",-1)),t("span",Pe,a(u.size)+" selected",1)]),K.value?(r(),l("div",Te,"Loading models...")):(r(),l("div",Me,[(r(!0),l(T,null,M(N.value,o=>(r(),l("div",{key:o.provider,class:"provider-group"},[t("div",{class:"provider-group-header",onClick:n=>o.collapsed=!o.collapsed},[t("div",{class:"provider-group-dot",style:L({background:o.color})},null,4),t("span",{class:"provider-group-label",style:L({color:o.color})},a(o.provider),5),t("span",Ee,a(o.models.length),1)],8,Le),f(t("div",Ve,[(r(!0),l(T,null,M(o.models,n=>(r(),l("div",{key:n.key,class:E(["model-card rounded-sm px-3 py-2 flex items-center gap-2",{selected:u.has(n.key)}]),onClick:b=>W(n.key)},[e[20]||(e[20]=t("div",{class:"check-dot"},null,-1)),t("div",$e,a(n.display_name||n.model_id),1)],10,Fe))),128))],512),[[pe,!o.collapsed]])]))),128))]))]),t("div",qe,[t("div",Ae,[e[21]||(e[21]=t("span",{class:"section-label"},"Base System Prompt",-1)),t("div",Be,[t("button",{onClick:te,disabled:!m.value.trim(),class:E(["text-[10px] font-display tracking-wider uppercase px-2 py-1 rounded-sm transition-opacity",m.value.trim()?"":"opacity-40 cursor-not-allowed"]),style:{background:"rgba(56,189,248,0.08)",border:"1px solid rgba(56,189,248,0.2)",color:"#38BDF8"},title:"Save current prompt to library"},"Save to Library",10,Ie),t("button",{onClick:Z,class:"text-[10px] font-display tracking-wider uppercase px-2 py-1 rounded-sm",style:{background:"rgba(168,85,247,0.08)",border:"1px solid rgba(168,85,247,0.2)",color:"#A855F7"},title:"Load a prompt from the library"},"Load from Library")])]),_.value?(r(),l("div",Re,[e[24]||(e[24]=t("div",{class:"px-3 py-2",style:{background:"rgba(168,85,247,0.05)","border-bottom":"1px solid rgba(168,85,247,0.15)"}},[t("span",{class:"text-[10px] font-display tracking-wider uppercase text-purple-400"},"Select from Library")],-1)),P(k).loading?(r(),l("div",je,"Loading...")):P(k).versions.length===0?(r(),l("div",Ke,[e[23]||(e[23]=z(" No saved prompts yet. ",-1)),U(v,{to:{name:"PromptLibrary"},class:"text-purple-400 hover:text-purple-300 ml-1"},{default:j(()=>[...e[22]||(e[22]=[z("Open Library",-1)])]),_:1})])):(r(),l("div",Ne,[(r(!0),l(T,null,M(P(k).versions,o=>{var n,b;return r(),l("div",{key:o.id,class:"px-3 py-2 cursor-pointer hover:bg-white/[0.03] transition-colors",style:{"border-top":"1px solid var(--border-subtle)"},onClick:d=>ee(o)},[t("div",De,[t("span",Oe,a(o.label||`#${o.version_number||((n=o.id)==null?void 0:n.slice(0,6))}`),1),t("span",{class:"text-[9px] px-1 rounded-sm",style:L(o.source==="tuner"||o.source==="prompt_tuner"?"background:rgba(168,85,247,0.1);color:#A855F7;":"background:rgba(255,255,255,0.04);color:#71717A;")},a(o.source||"manual"),5)]),t("div",Ge,a((b=o.prompt_text)==null?void 0:b.substring(0,80)),1)],8,Ue)}),128))])),t("div",He,[t("button",{onClick:e[4]||(e[4]=o=>_.value=!1),class:"text-[10px] text-zinc-600 hover:text-zinc-400 font-display tracking-wider uppercase"},"Cancel")])])):h("",!0),f(t("textarea",{"onUpdate:modelValue":e[5]||(e[5]=o=>m.value=o),rows:"4",class:"w-full text-xs font-body px-3 py-2 rounded-sm resize-y",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)",color:"#E4E4E7",outline:"none"},placeholder:"You are a helpful assistant that uses tools to answer questions..."},null,512),[[B,m.value]])]),t("div",Qe,[e[28]||(e[28]=t("span",{class:"section-label mb-3 block"},"Configuration",-1)),t("div",Ye,[t("div",null,[e[25]||(e[25]=t("label",{class:"text-[10px] text-zinc-600 font-display tracking-wider uppercase"},"Population Size",-1)),f(t("input",{"onUpdate:modelValue":e[6]||(e[6]=o=>S.value=o),type:"number",min:"2",max:"20",class:"w-full px-2 py-1.5 rounded-sm text-xs font-mono text-zinc-200 mt-1",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)",outline:"none"}},null,512),[[B,S.value,void 0,{number:!0}]])]),i.value==="evolutionary"?(r(),l("div",We,[e[26]||(e[26]=t("label",{class:"text-[10px] text-zinc-600 font-display tracking-wider uppercase"},"Generations",-1)),f(t("input",{"onUpdate:modelValue":e[7]||(e[7]=o=>C.value=o),type:"number",min:"1",max:"10",class:"w-full px-2 py-1.5 rounded-sm text-xs font-mono text-zinc-200 mt-1",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)",outline:"none"}},null,512),[[B,C.value,void 0,{number:!0}]])])):h("",!0),i.value==="evolutionary"?(r(),l("div",Je,[e[27]||(e[27]=t("label",{class:"text-[10px] text-zinc-600 font-display tracking-wider uppercase"},"Selection Ratio",-1)),f(t("input",{"onUpdate:modelValue":e[8]||(e[8]=o=>I.value=o),type:"number",min:"0.1",max:"0.9",step:"0.1",class:"w-full px-2 py-1.5 rounded-sm text-xs font-mono text-zinc-200 mt-1",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)",outline:"none"}},null,512),[[B,I.value,void 0,{number:!0}]])])):h("",!0)]),g.value?(r(),l("div",Xe,[z(" Estimated: "+a(g.value.total_api_calls)+" API calls, ~"+a(X(g.value.estimated_duration_s))+" ",1),g.value.warning?(r(),l("span",Ze,a(g.value.warning),1)):h("",!0)])):h("",!0)]),t("div",et,[t("button",{onClick:oe,disabled:!R.value,class:E(["run-btn px-6 py-2 rounded-sm text-xs flex items-center gap-2",{"opacity-50 cursor-not-allowed":!R.value}])},[...e[29]||(e[29]=[t("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor","stroke-width":"2.5",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1),z(" Start Prompt Tuning ",-1)])],10,tt)])])}}};export{dt as default};
