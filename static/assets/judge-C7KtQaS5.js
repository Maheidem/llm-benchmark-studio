import{S as O,r as i,B as R,s as l}from"./index-DQrEf9q5.js";const $=O("judge",()=>{const c=i([]),f=i(null),o=i(null),n=i(!1),r=i({pct:0,detail:""}),s=i([]),u=i([]),w=R(()=>[...c.value].sort((e,t)=>(t.timestamp||t.created_at||"").localeCompare(e.timestamp||e.created_at||""))),j="_jgJobId";function p(){try{o.value&&sessionStorage.setItem(j,o.value)}catch{}}function g(){try{const e=sessionStorage.getItem(j);e&&(o.value=e,n.value=!0)}catch{}}function d(){try{sessionStorage.removeItem(j)}catch{}}async function h(e){const t=await l("/api/tool-eval/judge",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(t.status===409)throw new Error("A job is already running");if(!t.ok){const v=await t.json().catch(()=>({}));throw new Error(v.error||`Server error (${t.status})`)}const a=await t.json();return o.value=a.job_id,n.value=!0,s.value=[],u.value=[],r.value={pct:0,detail:"Submitted..."},p(),a}async function b(e){const t=await l("/api/tool-eval/judge/compare",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(t.status===409)throw new Error("A job is already running");if(!t.ok){const v=await t.json().catch(()=>({}));throw new Error(v.error||`Server error (${t.status})`)}const a=await t.json();return o.value=a.job_id,n.value=!0,s.value=[],r.value={pct:0,detail:"Submitted..."},p(),a}async function y(){if(!o.value)return;if(!(await l("/api/tool-eval/judge/cancel",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({job_id:o.value})})).ok)throw new Error("Failed to cancel")}async function _(){const e=await l("/api/tool-eval/judge/reports");if(!e.ok)throw new Error("Failed to load reports");const t=await e.json();return c.value=t.reports||[],c.value}async function m(e){const t=await l(`/api/tool-eval/judge/reports/${e}`);if(!t.ok)throw new Error("Report not found");const a=await t.json();if(f.value=a,a._verdicts=Array.isArray(a.verdicts)?a.verdicts:[],a.report_json)try{a._reports=typeof a.report_json=="string"?JSON.parse(a.report_json):a.report_json}catch{a._reports=[]}return a}async function S(e){if(!(await l(`/api/tool-eval/judge/reports/${e}`,{method:"DELETE"})).ok)throw new Error("Failed to delete");c.value=c.value.filter(a=>a.id!==e)}async function k(e){const t=await l("/api/tool-eval/judge/rerun",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(t.status===409)throw new Error("A job is already running");if(!t.ok){const v=await t.json().catch(()=>({}));throw new Error(v.error||`Server error (${t.status})`)}const a=await t.json();return o.value=a.job_id,n.value=!0,s.value=[],u.value=[],r.value={pct:0,detail:`Re-running v${a.version||"?"}...`},p(),a}async function E(e){const t=await l(`/api/tool-eval/judge/reports/${e}/versions`);if(!t.ok)throw new Error("Failed to load versions");return(await t.json()).versions||[]}function J(e){switch(e.type){case"judge_start":{n.value=!0,s.value=[],u.value=[],r.value={pct:0,detail:`Judging with ${e.judge_model||""}...`},p();break}case"judge_verdict":{s.value=[...s.value,e];break}case"judge_report":{e.report&&(u.value=[...u.value,e.report]);break}case"judge_complete":{n.value=!1,r.value={pct:100,detail:"Complete!"},o.value=null,d();break}case"job_progress":{r.value={pct:e.progress_pct??r.value.pct,detail:e.progress_detail||r.value.detail};break}case"job_completed":{n.value=!1,r.value={pct:100,detail:"Complete!"},o.value=null,d();break}case"job_failed":{n.value=!1,r.value={pct:r.value.pct,detail:e.error||e.error_msg||"Failed"},o.value=null,d();break}case"job_cancelled":{n.value=!1,r.value={...r.value,detail:"Cancelled"},o.value=null,d();break}case"compare_case":{s.value=[...s.value,e];break}case"compare_complete":{n.value=!1,r.value={pct:100,detail:"Compare complete!"},o.value=null,d();break}}}function C(){s.value=[],u.value=[],f.value=null,n.value=!1,o.value=null,r.value={pct:0,detail:""},d()}return{reports:c,currentReport:f,activeJobId:o,isRunning:n,progress:r,verdicts:s,modelReports:u,sortedReports:w,runJudge:h,runCompare:b,cancelJudge:y,loadReports:_,loadReport:m,deleteReport:S,rerunJudge:k,fetchVersions:E,handleProgress:J,reset:C,restoreJob:g}});export{$ as u};
