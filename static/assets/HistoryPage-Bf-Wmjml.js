import{o as Z,c as n,d as e,e as B,h as tt,v as et,t as l,f as c,F as b,x as y,g as T,k as st,L as $,r as f,z as ot,B as nt,J as rt,q as lt,b as r,l as w,M as it}from"./index-DdRTlIgb.js";import{u as at}from"./benchmark-qGjkb4Aa.js";import{_ as dt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./config-Bc3_eHPH.js";import"./useActiveSession-DdoXJmDo.js";const ct={class:"max-w-7xl mx-auto px-6 py-8"},ut={class:"flex items-center justify-between mb-6"},pt={class:"flex items-center gap-3"},xt=["disabled"],mt={key:0},vt={key:1},bt={key:0,class:"card rounded-sm px-5 py-3 mb-4 flex items-center justify-between",style:{"border-color":"rgba(56,189,248,0.3)"}},yt={class:"text-xs font-body text-zinc-300"},ft={class:"flex gap-3"},_t={key:1,class:"mb-6"},gt={class:"card rounded-md overflow-hidden"},kt={class:"px-5 py-3 flex items-center justify-between",style:{"border-bottom":"1px solid var(--border-subtle)"}},ht={class:"overflow-x-auto"},wt={class:"w-full text-xs results-table"},zt={style:{"border-bottom":"1px solid var(--border-subtle)"}},Ct={class:"px-4 py-2.5"},St={class:"text-zinc-300 font-body text-[12px]"},Rt={key:2,class:"text-zinc-600 text-sm font-body"},Tt={key:3,class:"card rounded-sm p-10 text-center"},$t={key:4,class:"space-y-3"},Mt=["onClick"],Bt={class:"flex items-center justify-between mb-3"},Dt={class:"flex items-center gap-3"},jt=["onClick"],Ft={key:0,class:"w-2.5 h-2.5",fill:"none",stroke:"#38BDF8","stroke-width":"3",viewBox:"0 0 24 24"},Lt={class:"text-[11px] text-zinc-600 font-mono"},Ht={key:1,class:"badge",style:{background:"var(--lime-dim)",color:"var(--lime)",border:"1px solid rgba(191,255,0,0.2)"}},At={key:2,class:"badge",style:{background:"rgba(161,161,170,0.1)",color:"rgb(161,161,170)",border:"1px solid rgba(161,161,170,0.2)"},title:"Context tiers tested"},Et={class:"flex items-center gap-3"},Pt={key:0,class:"font-mono text-sm",style:{color:"var(--lime)"}},Vt=["onClick"],Nt=["onClick"],qt={class:"overflow-x-auto"},Jt={class:"w-full text-xs"},Kt={class:"text-zinc-700"},Qt={key:0,class:"px-3 py-1.5 text-right section-label"},Ut={key:1,class:"px-3 py-1.5 text-right section-label"},Wt={class:"px-3 py-2 text-zinc-400 font-body"},Xt={key:0,class:"px-3 py-2 text-right font-mono text-zinc-600"},Gt={key:1,class:"px-3 py-2 text-right font-mono text-zinc-600"},It={class:"px-3 py-2 text-right font-mono text-zinc-600"},Ot={class:"px-3 py-2 text-right font-mono text-zinc-600"},Yt={key:5,class:"text-red-400 text-sm font-body mt-4"},Zt={class:"card rounded-md p-6 mx-4 w-full",style:{"max-width":"680px","max-height":"85vh","overflow-y":"auto"}},te={class:"flex items-center justify-between mb-5"},ee={class:"text-[11px] font-mono text-zinc-600 mt-0.5"},se={class:"flex items-center gap-2"},oe={class:"grid grid-cols-2 sm:grid-cols-4 gap-3 mb-5"},ne={class:"p-3 rounded-sm",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)"}},re={class:"text-sm font-mono text-zinc-300"},le={class:"p-3 rounded-sm",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)"}},ie={class:"text-sm font-mono text-zinc-300"},ae={class:"p-3 rounded-sm",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)"}},de={class:"text-sm font-mono text-zinc-300"},ce={class:"p-3 rounded-sm",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)"}},ue={class:"text-sm font-mono text-zinc-300"},pe={key:0,class:"mb-4"},xe={class:"flex gap-2 flex-wrap"},me={key:1,class:"mb-5"},ve={class:"text-xs font-mono text-zinc-400 px-3 py-2 rounded-sm",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)","white-space":"pre-wrap","max-height":"80px","overflow-y":"auto"}},be={class:"overflow-x-auto rounded-sm",style:{border:"1px solid var(--border-subtle)"}},ye={class:"w-full text-xs"},fe={style:{"border-bottom":"1px solid var(--border-subtle)"}},_e={key:0,class:"px-3 py-2 text-right section-label"},ge={class:"px-3 py-2 text-zinc-400 font-body"},ke={key:0,class:"px-3 py-2 text-right font-mono text-zinc-600"},he={class:"px-3 py-2 text-right font-mono text-zinc-600"},we={class:"px-3 py-2 text-right font-mono text-zinc-600"},ze={class:"px-3 py-2 text-right"},Ce={key:0,class:"text-[10px] font-mono px-1.5 py-0.5 rounded-sm",style:{background:"rgba(191,255,0,0.08)",color:"var(--lime)"}},Se=["title"],Re={__name:"HistoryPage",setup(Te){const N=lt(),q=at(),{showToast:v}=rt(),{confirm:J}=it(),_=f([]),g=f(!0),z=f(""),C=f(""),x=f(new Set),h=f(null),a=f(null),D=nt(()=>{if(!C.value)return _.value;const o=C.value.toLowerCase();return _.value.filter(t=>{const s=new Date(t.timestamp).toLocaleString().toLowerCase(),i=(t.results||[]).map(u=>`${u.provider} ${u.model}`).join(" ").toLowerCase();return s.includes(o)||i.includes(o)})});async function j(){g.value=!0,z.value="";try{const o=await $("/api/history");if(!o.ok)throw new Error(`HTTP ${o.status}`);const t=await o.json();_.value=t.runs||[]}catch{z.value="Failed to load history."}finally{g.value=!1}}async function K(){await j(),v("History refreshed","success")}function k(o){return[...o.results||[]].map(t=>({...t,avg_tokens_per_second:t.avg_tokens_per_second??t.tokens_per_second??0,avg_ttft_ms:t.avg_ttft_ms??t.ttft_ms??0,avg_total_time_s:t.avg_total_time_s??t.total_time_s??0,std_dev_tps:t.std_dev_tps??0})).sort((t,s)=>s.avg_tokens_per_second-t.avg_tokens_per_second)}function S(o){return k(o)[0]||null}function F(o){return k(o).some(t=>(t.runs||1)>1)}function R(o){return new Set(k(o).map(s=>s.context_tokens??0)).size>1}function L(o){return new Date(o).toLocaleString()}function H(o){return o===0?"0":o>=1e3?o/1e3+"K":String(o)}function A(o){return o>=1e3?o/1e3+"K":String(o)}function Q(o){const t=new Set(x.value);t.has(o)?t.delete(o):t.add(o),x.value=t}function U(o){a.value=o}async function E(o){let t=o;if(o.id&&!o.config)try{const s=await $(`/api/history/${o.id}`);s.ok&&(t=await s.json())}catch{}q.prefillFromRun(t),a.value=null,v("Settings pre-filled from run. Adjust and submit.","success"),N.push({name:"Benchmark"})}async function W(o){var s;if(await J("Delete Run","Delete this benchmark run?",{danger:!0,confirmLabel:"Delete"}))try{const d=await $(`/api/history/${o}`,{method:"DELETE"});if(d.ok)v("Run deleted","success"),_.value=_.value.filter(i=>i.id!==o),((s=a.value)==null?void 0:s.id)===o&&(a.value=null);else{const i=await d.json().catch(()=>({}));v(i.error||"Failed to delete run","error")}}catch{v("Failed to delete run","error")}}async function X(){const o=Array.from(x.value);if(o.length<2){v("Select at least 2 runs to compare","error");return}try{const t=await Promise.all(o.map(async m=>(await $(`/api/history/${m}`)).json())),s=new Set;t.forEach(m=>{(m.results||[]).forEach(p=>{s.add(`${p.provider}||${p.model}`)})});const d=Array.from(s).sort(),i=t.map(m=>{const p=new Date(m.timestamp);return p.toLocaleDateString()+" "+p.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),u=d.map(m=>{const[p,P]=m.split("||"),I=ot(p),O=t.map(Y=>{const M=(Y.results||[]).find(V=>V.provider===p&&V.model===P);return M?M.avg_tokens_per_second??M.tokens_per_second??0:null});return{key:m,provider:p,model:P,color:I,values:O}});h.value={labels:i,rows:u}}catch{v("Failed to load comparison data","error")}}function G(o,t){if(o===null)return"text-zinc-700";const s=t.filter(u=>u!==null&&u>0);if(s.length<2)return"text-zinc-400";const d=Math.max(...s),i=Math.min(...s);return d===i?"text-zinc-400":o===d?"text-green-400":o===i?"text-red-400":"text-zinc-400"}return Z(j),(o,t)=>(r(),n("div",ct,[e("div",ut,[t[8]||(t[8]=e("h2",{class:"section-label"},"Benchmark History",-1)),e("div",pt,[e("button",{onClick:K,disabled:g.value,class:B(["text-[10px] font-display tracking-wider uppercase px-3 py-1.5 rounded-sm transition-opacity",g.value?"opacity-50 cursor-not-allowed":""]),style:{border:"1px solid var(--border-subtle)",color:"var(--zinc-400)"},title:"Refresh history"},[g.value?(r(),n("span",mt,"...")):(r(),n("span",vt,"Refresh"))],10,xt),tt(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>C.value=s),type:"text",placeholder:"Search history...",class:"px-3 py-1.5 rounded-sm text-xs font-mono text-zinc-200",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)",outline:"none",width:"200px"},onFocus:t[1]||(t[1]=s=>s.target.style.borderColor="rgba(191,255,0,0.3)"),onBlur:t[2]||(t[2]=s=>s.target.style.borderColor="var(--border-subtle)")},null,544),[[et,C.value]])])]),x.value.size>=2?(r(),n("div",bt,[e("span",yt,l(x.value.size)+" runs selected for comparison",1),e("div",ft,[e("button",{onClick:X,class:"lime-btn text-[10px]"},"Compare"),e("button",{onClick:t[3]||(t[3]=s=>x.value=new Set),class:"text-[10px] font-display tracking-wider uppercase text-zinc-600 hover:text-zinc-300 transition-colors"},"Clear")])])):c("",!0),h.value?(r(),n("div",_t,[e("div",gt,[e("div",kt,[t[9]||(t[9]=e("span",{class:"section-label"},"Cross-Run Comparison",-1)),e("button",{onClick:t[4]||(t[4]=s=>h.value=null),class:"text-[11px] font-display tracking-wider uppercase text-zinc-600 hover:text-zinc-300 px-2 py-1"},"Close")]),e("div",ht,[e("table",wt,[e("thead",null,[e("tr",zt,[t[10]||(t[10]=e("th",{class:"px-4 py-3 text-left section-label"},"Model",-1)),(r(!0),n(b,null,y(h.value.labels,s=>(r(),n("th",{key:s,class:"px-4 py-3 text-right section-label"},l(s),1))),128))])]),e("tbody",null,[(r(!0),n(b,null,y(h.value.rows,s=>(r(),n("tr",{key:s.key,style:{"border-top":"1px solid var(--border-subtle)"}},[e("td",Ct,[e("span",{class:"badge mr-2",style:w(`background:${s.color.bg};color:${s.color.text};border:1px solid ${s.color.border};font-size:9px`)},l(s.provider),5),e("span",St,l(s.model),1)]),(r(!0),n(b,null,y(s.values,(d,i)=>(r(),n("td",{key:i,class:B(["px-4 py-2.5 text-right font-mono",G(d,s.values)])},l(d===null?"-":(d.toFixed?d.toFixed(1):d)+" tok/s"),3))),128))]))),128))])])])])])):c("",!0),g.value?(r(),n("div",Rt,"Loading history...")):D.value.length===0&&_.value.length===0?(r(),n("div",Tt,[...t[11]||(t[11]=[e("p",{class:"text-zinc-600 font-body"},"No benchmark history yet.",-1),e("p",{class:"text-zinc-700 text-xs mt-1 font-body"},"Run your first benchmark to see results here.",-1)])])):(r(),n("div",$t,[(r(!0),n(b,null,y(D.value,(s,d)=>(r(),n("div",{key:s.id||d,class:"card rounded-sm p-5 fade-in cursor-pointer hover:bg-white/[0.02] transition-colors",style:w(`animation-delay: ${d*40}ms`),onClick:i=>U(s)},[e("div",Bt,[e("div",Dt,[s.id?(r(),n("button",{key:0,onClick:T(i=>Q(s.id),["stop"]),class:"w-4 h-4 rounded-sm border flex items-center justify-center transition-all flex-shrink-0",style:w(x.value.has(s.id)?"border-color:#38BDF8;background:rgba(56,189,248,0.15)":"border-color:var(--border-subtle)"),title:"Select for comparison"},[x.value.has(s.id)?(r(),n("svg",Ft,[...t[12]||(t[12]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5 13l4 4L19 7"},null,-1)])])):c("",!0)],12,jt)):c("",!0),e("span",Lt,l(L(s.timestamp)),1),S(s)?(r(),n("span",Ht,"P1: "+l(S(s).model),1)):c("",!0),s.context_tiers&&s.context_tiers.length?(r(),n("span",At,"CTX "+l(s.context_tiers.map(H).join(" / ")),1)):c("",!0)]),e("div",Et,[S(s)?(r(),n("span",Pt,l(S(s).avg_tokens_per_second)+" tok/s",1)):c("",!0),s.id?(r(),n("button",{key:1,onClick:T(i=>E(s),["stop"]),class:"text-zinc-500 hover:text-lime-400 transition-colors",title:"Re-run this benchmark"},[...t[13]||(t[13]=[e("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)])],8,Vt)):c("",!0),s.id?(r(),n("button",{key:2,onClick:T(i=>W(s.id),["stop"]),class:"text-zinc-700 hover:text-red-400 transition-colors",title:"Delete run"},[...t[14]||(t[14]=[e("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,Nt)):c("",!0)])]),e("div",qt,[e("table",Jt,[e("thead",null,[e("tr",Kt,[t[15]||(t[15]=e("th",{class:"px-3 py-1.5 text-left section-label"},"Model",-1)),R(s)?(r(),n("th",Qt,"Context")):c("",!0),t[16]||(t[16]=e("th",{class:"px-3 py-1.5 text-right section-label"},"Tok/s",-1)),F(s)?(r(),n("th",Ut,"Std Dev")):c("",!0),t[17]||(t[17]=e("th",{class:"px-3 py-1.5 text-right section-label"},"TTFT",-1)),t[18]||(t[18]=e("th",{class:"px-3 py-1.5 text-right section-label"},"Duration",-1))])]),e("tbody",null,[(r(!0),n(b,null,y(k(s),(i,u)=>(r(),n("tr",{key:u,style:{"border-top":"1px solid var(--border-subtle)"}},[e("td",Wt,l(i.provider)+" / "+l(i.model),1),R(s)?(r(),n("td",Xt,l((i.context_tokens??0)===0?"Base":A(i.context_tokens)),1)):c("",!0),e("td",{class:B(["px-3 py-2 text-right font-mono",u===0?"":"text-zinc-500"]),style:w(u===0?"color:var(--lime)":"")},l(i.avg_tokens_per_second),7),F(s)?(r(),n("td",Gt,l(i.std_dev_tps>0?"Â±"+i.std_dev_tps.toFixed(1):"-"),1)):c("",!0),e("td",It,l(i.avg_ttft_ms)+"ms",1),e("td",Ot,l(i.avg_total_time_s)+"s",1)]))),128))])])])],12,Mt))),128))])),z.value?(r(),n("div",Yt,l(z.value),1)):c("",!0),a.value?(r(),n("div",{key:6,class:"fixed inset-0 z-50 flex items-center justify-center",style:{background:"rgba(0,0,0,0.75)"},onClick:t[7]||(t[7]=T(s=>a.value=null,["self"]))},[e("div",Zt,[e("div",te,[e("div",null,[t[19]||(t[19]=e("span",{class:"section-label"},"Run Detail",-1)),e("p",ee,l(L(a.value.timestamp)),1)]),e("div",se,[e("button",{onClick:t[5]||(t[5]=s=>E(a.value)),class:"text-[10px] font-display tracking-wider uppercase px-3 py-1.5 rounded-sm transition-colors",style:{background:"rgba(191,255,0,0.08)",border:"1px solid rgba(191,255,0,0.2)",color:"var(--lime)"},title:"Re-run this benchmark"},[...t[20]||(t[20]=[e("span",{class:"flex items-center gap-1.5"},[e("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})]),st(" Re-Run ")],-1)])]),e("button",{onClick:t[6]||(t[6]=s=>a.value=null),class:"text-zinc-500 hover:text-zinc-300 transition-colors",style:{background:"none",border:"none",cursor:"pointer"}},"Close")])]),e("div",oe,[e("div",ne,[t[21]||(t[21]=e("p",{class:"text-[10px] font-display tracking-wider uppercase text-zinc-600 mb-1"},"Models",-1)),e("p",re,l(k(a.value).length),1)]),e("div",le,[t[22]||(t[22]=e("p",{class:"text-[10px] font-display tracking-wider uppercase text-zinc-600 mb-1"},"Runs",-1)),e("p",ie,l(a.value.runs||1),1)]),e("div",ae,[t[23]||(t[23]=e("p",{class:"text-[10px] font-display tracking-wider uppercase text-zinc-600 mb-1"},"Max Tokens",-1)),e("p",de,l(a.value.max_tokens||"-"),1)]),e("div",ce,[t[24]||(t[24]=e("p",{class:"text-[10px] font-display tracking-wider uppercase text-zinc-600 mb-1"},"Temperature",-1)),e("p",ue,l(a.value.temperature??"-"),1)])]),a.value.context_tiers&&a.value.context_tiers.length>0?(r(),n("div",pe,[t[25]||(t[25]=e("p",{class:"text-[10px] font-display tracking-wider uppercase text-zinc-600 mb-2"},"Context Tiers",-1)),e("div",xe,[(r(!0),n(b,null,y(a.value.context_tiers,s=>(r(),n("span",{key:s,class:"text-[10px] font-mono px-2 py-0.5 rounded-sm",style:{background:"rgba(255,255,255,0.04)",border:"1px solid var(--border-subtle)",color:"#A1A1AA"}},l(s===0?"Base":H(s)),1))),128))])])):c("",!0),a.value.prompt?(r(),n("div",me,[t[26]||(t[26]=e("p",{class:"text-[10px] font-display tracking-wider uppercase text-zinc-600 mb-2"},"Prompt",-1)),e("div",ve,l(a.value.prompt),1)])):c("",!0),e("div",null,[t[32]||(t[32]=e("p",{class:"text-[10px] font-display tracking-wider uppercase text-zinc-600 mb-2"},"Results",-1)),e("div",be,[e("table",ye,[e("thead",null,[e("tr",fe,[t[27]||(t[27]=e("th",{class:"px-3 py-2 text-left section-label"},"Model",-1)),R(a.value)?(r(),n("th",_e,"Context")):c("",!0),t[28]||(t[28]=e("th",{class:"px-3 py-2 text-right section-label"},"Tok/s",-1)),t[29]||(t[29]=e("th",{class:"px-3 py-2 text-right section-label"},"TTFT",-1)),t[30]||(t[30]=e("th",{class:"px-3 py-2 text-right section-label"},"Duration",-1)),t[31]||(t[31]=e("th",{class:"px-3 py-2 text-right section-label"},"Status",-1))])]),e("tbody",null,[(r(!0),n(b,null,y(k(a.value),(s,d)=>(r(),n("tr",{key:d,style:{"border-top":"1px solid var(--border-subtle)"}},[e("td",ge,l(s.provider)+" / "+l(s.model),1),R(a.value)?(r(),n("td",ke,l((s.context_tokens??0)===0?"Base":A(s.context_tokens)),1)):c("",!0),e("td",{class:"px-3 py-2 text-right font-mono",style:w(d===0?"color:var(--lime)":"color:#71717A")},l(s.avg_tokens_per_second),5),e("td",he,l(s.avg_ttft_ms)+"ms",1),e("td",we,l(s.avg_total_time_s)+"s",1),e("td",ze,[s.success!==!1?(r(),n("span",Ce,"ok")):(r(),n("span",{key:1,class:"text-[10px] font-mono px-1.5 py-0.5 rounded-sm",style:{background:"rgba(239,68,68,0.08)",color:"#EF4444"},title:s.error||""},"fail",8,Se))])]))),128))])])])])])])):c("",!0)]))}},Fe=dt(Re,[["__scopeId","data-v-6eee6d6a"]]);export{Fe as default};
