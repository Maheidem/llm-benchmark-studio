import{b as n,c as a,d as s,F,A as M,e as K,t as u,h as X,z as W,f as c,m as G,k as j,l as D,r as g,B as h,o as Z,i as E,j as Q,x as C,g as S,y as H,K as ee,a as te,s as I,M as oe}from"./index-DBNJ0RjU.js";import{u as se}from"./paramTuner-ZePMK9nO.js";import{u as le}from"./profiles-0LhYaj_P.js";import{u as re}from"./judge-DW_Xzzm-.js";import{u as ne}from"./useSharedContext-C-EAG0AM.js";import{_ as ae}from"./ParamTunerResults-DgyTc1QN.js";import"./useActiveSession-DdoXJmDo.js";const ie={class:"card rounded-md overflow-hidden mb-6"},ue={class:"px-5 py-3 flex items-center justify-between",style:{"border-bottom":"1px solid var(--border-subtle)"}},de={class:"flex items-center gap-2"},ce={class:"flex gap-1"},pe=["onClick"],me=["value"],ve={class:"text-[10px] text-zinc-600 font-body"},fe={key:0,class:"p-4"},xe={class:"relative",style:{height:"280px",overflow:"hidden"}},be={class:"w-full h-full",viewBox:"0 0 400 260",preserveAspectRatio:"xMidYMid meet"},ye=["points"],ge=["cx","cy","r","fill","stroke","onClick","onMouseenter"],_e=["x","y"],he={key:1},ke=["x","y"],we=["x","y"],$e=["x","y"],Ce={key:1,style:{"max-height":"400px","overflow-y":"auto"}},ze={class:"w-full text-xs results-table"},Se={style:{"border-bottom":"1px solid var(--border-subtle)"}},je=["onClick"],Fe={class:"px-4 py-2 text-xs font-mono text-zinc-300"},Me={class:"flex items-center gap-1"},Be={key:0,class:"text-lime-400 text-[10px]",title:"Pareto optimal"},Pe={class:"px-3 py-2 text-right font-mono text-zinc-400"},Ae={class:"px-3 py-2 text-right font-mono text-zinc-400"},qe={class:"px-3 py-2 text-center"},De={key:0,style:{color:"var(--lime)"}},Te={key:1,class:"text-zinc-700"},Ne={__name:"CorrelationView",props:{data:{type:Array,default:()=>[]}},emits:["select"],setup(O){const m=O,B=g("scatter"),z=g(""),v=g(null),d=g("quality"),$=g(!1),T=[{value:"scatter",label:"Scatter"},{value:"table",label:"Table"}],x=h(()=>{const r=new Set(m.data.map(e=>e.model_name).filter(Boolean));return Array.from(r).sort()}),p=h(()=>z.value?m.data.filter(r=>r.model_name===z.value):m.data),y=h(()=>{const e=[...p.value.filter(i=>i.throughput!=null&&i.quality!=null)].sort((i,l)=>l.throughput-i.throughput),o=[];let t=-1;for(const i of e)i.quality>t&&(t=i.quality,o.push(i));return o.sort((i,l)=>i.throughput-l.throughput)}),_=h(()=>new Set(y.value.map(r=>r.result))),N=h(()=>Math.min(...p.value.map(r=>r.throughput||0))*.9),V=h(()=>Math.max(...p.value.map(r=>r.throughput||0))*1.1||100),P=h(()=>Math.max(...p.value.map(r=>r.cost||0))||1);function k(r){const e=V.value-N.value||1;return 40+(r-N.value)/e*350}function w(r){return 230-(r||0)*220}function J(r){return!r||!P.value?4:3+r/P.value*8}const b=h(()=>p.value.map(r=>({...r,label:r.config_label||r.model_name||"",isPareto:_.value.has(r.result)})));function A(r){d.value===r?$.value=!$.value:(d.value=r,$.value=!1)}function q(r){return d.value!==r?"":$.value?"▲":"▼"}const R=h(()=>[...p.value].map(r=>({...r,isPareto:_.value.has(r.result)})).sort((r,e)=>{const o=r[d.value]??0,t=e[d.value]??0;return $.value?o-t:t-o}));function L(r){return r==null?"#52525B":r>=.8?"var(--lime)":r>=.5?"#FBBF24":"var(--coral)"}return(r,e)=>{var o;return n(),a("div",ie,[s("div",ue,[e[6]||(e[6]=s("span",{class:"section-label"},"Quality Correlation",-1)),s("div",de,[s("div",ce,[(n(),a(F,null,M(T,t=>s("button",{key:t.value,class:K(["text-[10px] font-display tracking-wider uppercase px-2 py-0.5 rounded-sm transition-colors",B.value===t.value?"text-lime-400 border border-lime-400/30":"text-zinc-500 border border-zinc-800 hover:text-zinc-300"]),onClick:i=>B.value=t.value},u(t.label),11,pe)),64))]),x.value.length>1?X((n(),a("select",{key:0,"onUpdate:modelValue":e[0]||(e[0]=t=>z.value=t),class:"text-[10px] font-mono px-2 py-0.5 rounded-sm",style:{background:"var(--surface)",border:"1px solid var(--border-subtle)",color:"#A1A1AA",outline:"none"}},[e[5]||(e[5]=s("option",{value:""},"All models",-1)),(n(!0),a(F,null,M(x.value,t=>(n(),a("option",{key:t,value:t},u(t),9,me))),128))],512)),[[W,z.value]]):c("",!0),s("span",ve,u(p.value.length)+" configs",1)])]),B.value==="scatter"?(n(),a("div",fe,[e[11]||(e[11]=s("div",{class:"text-[10px] text-zinc-600 font-body mb-2"}," X: tokens/sec (throughput)  |  Y: quality score (judge)  |  Size: cost ",-1)),s("div",xe,[(n(),a("svg",be,[e[7]||(e[7]=s("line",{x1:"40",y1:"10",x2:"40",y2:"230",stroke:"var(--border-subtle)","stroke-width":"1"},null,-1)),e[8]||(e[8]=s("line",{x1:"40",y1:"230",x2:"390",y2:"230",stroke:"var(--border-subtle)","stroke-width":"1"},null,-1)),e[9]||(e[9]=s("text",{x:"215",y:"255","text-anchor":"middle",class:"axis-label","font-size":"8",fill:"#52525B"},"Throughput (tok/s)",-1)),e[10]||(e[10]=s("text",{x:"12",y:"120","text-anchor":"middle",class:"axis-label","font-size":"8",fill:"#52525B",transform:"rotate(-90, 12, 120)"},"Quality Score",-1)),y.value.length>1?(n(),a("polyline",{key:0,points:y.value.map(t=>`${k(t.throughput)},${w(t.quality)}`).join(" "),fill:"none",stroke:"rgba(191,255,0,0.3)","stroke-width":"1","stroke-dasharray":"3,2"},null,8,ye)):c("",!0),(n(!0),a(F,null,M(b.value,(t,i)=>(n(),a("g",{key:i},[s("circle",{cx:k(t.throughput),cy:w(t.quality),r:J(t.cost),fill:t.isPareto?"rgba(191,255,0,0.15)":"rgba(56,189,248,0.1)",stroke:t.isPareto?"var(--lime)":"rgba(56,189,248,0.4)","stroke-width":"1",class:"cursor-pointer",onClick:l=>r.$emit("select",t.result),onMouseenter:l=>v.value=i,onMouseleave:e[1]||(e[1]=l=>v.value=null)},null,40,ge),t.isPareto?(n(),a("text",{key:0,x:k(t.throughput),y:w(t.quality)-J(t.cost)-2,"text-anchor":"middle","font-size":"7",fill:"var(--lime)"},"★",8,_e)):c("",!0)]))),128)),v.value!=null&&b.value[v.value]?(n(),a("g",he,[s("rect",{x:Math.min(k(b.value[v.value].throughput)+6,310),y:w(b.value[v.value].quality)-30,width:"80",height:"28",rx:"2",fill:"rgba(9,9,11,0.9)",stroke:"var(--border-subtle)"},null,8,ke),s("text",{x:Math.min(k(b.value[v.value].throughput)+10,314),y:w(b.value[v.value].quality)-18,"font-size":"7",fill:"#E4E4E7"},u(b.value[v.value].label),9,we),s("text",{x:Math.min(k(b.value[v.value].throughput)+10,314),y:w(b.value[v.value].quality)-8,"font-size":"7",fill:"#A1A1AA"},"Q:"+u((b.value[v.value].quality*100).toFixed(0))+"% T:"+u(((o=b.value[v.value].throughput)==null?void 0:o.toFixed(0))||"?"),9,$e)])):c("",!0)]))]),e[12]||(e[12]=G('<div class="flex items-center gap-4 mt-2 text-[9px] font-body text-zinc-600"><span class="flex items-center gap-1"><span class="inline-block w-2 h-2 rounded-full border" style="border-color:var(--lime);background:rgba(191,255,0,0.15);"></span> Pareto optimal </span><span class="flex items-center gap-1"><span class="inline-block w-2 h-2 rounded-full border" style="border-color:rgba(56,189,248,0.4);background:rgba(56,189,248,0.1);"></span> Other configs </span><span>Bubble size = relative cost</span></div>',1))])):(n(),a("div",Ce,[s("table",ze,[s("thead",null,[s("tr",Se,[e[13]||(e[13]=s("th",{class:"px-4 py-2 text-left section-label"},"Model",-1)),s("th",{class:"px-3 py-2 text-right section-label cursor-pointer",onClick:e[2]||(e[2]=t=>A("throughput"))}," Tok/s "+u(q("throughput")),1),s("th",{class:"px-3 py-2 text-right section-label cursor-pointer",onClick:e[3]||(e[3]=t=>A("quality"))}," Quality "+u(q("quality")),1),s("th",{class:"px-3 py-2 text-right section-label cursor-pointer",onClick:e[4]||(e[4]=t=>A("cost"))}," Cost "+u(q("cost")),1),e[14]||(e[14]=s("th",{class:"px-3 py-2 text-center section-label"},"Pareto",-1))])]),s("tbody",null,[(n(!0),a(F,null,M(R.value,(t,i)=>{var l;return n(),a("tr",{key:i,class:"cursor-pointer hover:bg-white/[0.02] transition-colors",onClick:f=>r.$emit("select",t.result)},[s("td",Fe,[s("div",Me,[t.isPareto?(n(),a("span",Be,"★")):c("",!0),j(" "+u(t.label),1)])]),s("td",Pe,u(((l=t.throughput)==null?void 0:l.toFixed(1))||"-"),1),s("td",{class:"px-3 py-2 text-right font-mono font-bold",style:D({color:L(t.quality)})},u(t.quality!=null?(t.quality*100).toFixed(1)+"%":"-"),5),s("td",Ae,u(t.cost!=null?"$"+t.cost.toFixed(4):"-"),1),s("td",qe,[t.isPareto?(n(),a("span",De,"★")):(n(),a("span",Te,"-"))])],8,je)}),128))])])]))])}}},Je={class:"flex items-center justify-between mb-6"},Re={key:0,class:"text-xs text-zinc-600 font-body text-center py-8"},Ve={key:1,class:"text-xs text-zinc-600 font-body text-center py-8"},Le={key:2,class:"space-y-3"},Oe=["onClick"],Ee={class:"flex-1 min-w-0"},Qe={class:"flex items-center gap-2 mb-1"},He={class:"text-xs font-mono text-zinc-300"},Ie={class:"text-[10px] text-zinc-600 font-body"},Ue={key:0,class:"ml-2"},Ye={key:1,class:"ml-2"},Ke={key:0,class:"text-[10px] text-zinc-600 font-body mt-1"},Xe={class:"text-right"},We={class:"flex items-center gap-2"},Ge=["onClick"],Ze=["onClick"],et=["onClick"],tt=["onClick"],ot={class:"card rounded-md p-6 max-w-4xl w-full mx-4",style:{"max-height":"85vh","overflow-y":"auto"}},st={class:"flex items-center justify-between mb-4"},lt={class:"section-label"},rt={class:"text-xs text-zinc-600 font-body ml-2"},nt={key:1,class:"mt-4"},at={class:"flex items-center gap-2 mb-3"},it=["disabled"],ut={key:0,class:"inline-block w-2.5 h-2.5 border border-yellow-400/50 border-t-yellow-400 rounded-full animate-spin"},dt={key:1,class:"text-[10px] text-zinc-600 font-body"},ct={class:"card rounded-md p-6 max-w-2xl w-full mx-4",style:{"max-height":"80vh","overflow-y":"auto"}},pt={class:"flex items-center justify-between mb-4"},mt={class:"mb-3"},vt={class:"text-xs font-mono text-zinc-300"},ft={class:"flex flex-wrap gap-2"},wt={__name:"ParamTunerHistory",setup(O){const m=se(),B=le(),z=re(),{setConfig:v}=ne(),{showToast:d}=ee(),{inputModal:$}=oe(),T=g(!0),x=g(null),p=g(null),y=g([]),_=g(!1);async function N(){var e;if(!(!((e=x.value)!=null&&e.eval_run_id)||_.value)){_.value=!0;try{const o=await I(`/api/param-tune/correlation/${x.value.id}/score`,{method:"POST"});if(!o.ok)throw new Error("Failed to score");const t=await o.json();V(t),d("Judge scores loaded","success")}catch(o){d(o.message||"Failed to score with judge","error")}finally{_.value=!1}}}function V(e){const o=e.results||e||[],t={};for(const i of o)t[i.combo_id||i.model_id]=i;y.value=m.results.map(i=>{const l=i.combo_id||i.model_id,f=t[l]||{};return{result:i,model_name:i.model_name||i.model_id||"",config_label:Object.entries(i.config||{}).map(([U,Y])=>`${U}=${Y}`).join(" "),throughput:i.throughput_tps||f.throughput||null,quality:f.judge_score!=null?f.judge_score:i.overall_score||0,cost:i.cost_usd||f.cost||null}})}function P(e){return e>=80?"var(--lime)":e>=50?"#FBBF24":"var(--coral)"}function k(e){return e==null?"-":typeof e=="number"?Number.isInteger(e)?e.toString():e.toFixed(3):String(e)}Z(async()=>{try{await m.loadHistory()}catch{d("Failed to load history","error")}finally{T.value=!1}});async function w(e){try{await m.loadRun(e.id),x.value=e,y.value=[]}catch{d("Failed to load run details","error")}}async function J(e){var o;if(confirm("Delete this tuning run?"))try{await m.deleteRun(e.id),d("Run deleted","success"),((o=x.value)==null?void 0:o.id)===e.id&&(x.value=null)}catch{d("Failed to delete run","error")}}function b(e){let o=null;if(e.best_config_json)try{o=typeof e.best_config_json=="string"?JSON.parse(e.best_config_json):e.best_config_json}catch{}if(!o){d("No best config available","error");return}const t={lastUpdatedBy:"param_tuner"};o.temperature!=null&&(t.temperature=o.temperature),o.tool_choice&&(t.toolChoice=o.tool_choice),o.provider_params&&(t.providerParams=o.provider_params),v(t),d("Best config applied to shared context","success")}async function A(e){var l;let o=null;if(e.best_config_json)try{o=typeof e.best_config_json=="string"?JSON.parse(e.best_config_json):e.best_config_json}catch{}if(!o){d("No best config available","error");return}const t=e.target_model_id||null,i=await $("Save as Profile","Profile name",{confirmLabel:"Save"});if((l=i==null?void 0:i.value)!=null&&l.trim())try{await B.createFromTuner({source_type:"param_tuner",source_id:e.id,model_id:t,name:i.value.trim(),params_json:o,system_prompt:null}),d("Profile saved","success")}catch(f){d(f.message||"Failed to save profile","error")}}async function q(e){if(!e.eval_run_id){d("No eval run linked to this tuning run","error");return}let o="";try{const t=await I("/api/settings/judge");t.ok&&(o=(await t.json()).default_judge_model||"")}catch{}if(!o){d("No default judge model configured. Set one in Settings > Judge.","error");return}try{await z.runJudge({eval_run_id:e.eval_run_id,judge_model:o,tune_run_id:e.id,tune_type:"param_tuner"}),d("Judge analyzing winning parameters...","success")}catch(t){d(t.message||"Failed to start judge","error")}}function R(e){return e?new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):""}function L(e){return e<60?`${Math.round(e)}s`:`${Math.round(e/60)}m`}function r(e){return e==="completed"?{background:"rgba(191,255,0,0.1)",color:"var(--lime)"}:e==="running"?{background:"rgba(56,189,248,0.1)",color:"#38BDF8"}:e==="cancelled"?{background:"rgba(255,255,255,0.04)",color:"#71717A"}:e==="interrupted"?{background:"rgba(249,115,22,0.1)",color:"#F97316"}:{background:"rgba(255,59,92,0.1)",color:"var(--coral)"}}return(e,o)=>{var i;const t=te("router-link");return n(),a("div",null,[s("div",Je,[o[7]||(o[7]=s("div",null,[s("h2",{class:"font-display font-bold text-lg text-zinc-100 mb-1"},"Param Tuner History"),s("p",{class:"text-sm text-zinc-600 font-body"},"Past parameter tuning runs.")],-1)),E(t,{to:{name:"ParamTunerConfig"},class:"text-[10px] font-display tracking-wider uppercase px-3 py-1.5 rounded-sm",style:{border:"1px solid var(--border-subtle)",color:"var(--zinc-400)"}},{default:Q(()=>[...o[6]||(o[6]=[j("New Tune",-1)])]),_:1})]),T.value?(n(),a("div",Re,"Loading...")):C(m).history.length===0?(n(),a("div",Ve,[o[9]||(o[9]=j(" No param tuning runs yet. ",-1)),E(t,{to:{name:"ParamTunerConfig"},class:"text-lime-400 hover:text-lime-300"},{default:Q(()=>[...o[8]||(o[8]=[j("Start your first tune",-1)])]),_:1})])):(n(),a("div",Le,[(n(!0),a(F,null,M(C(m).history,l=>(n(),a("div",{key:l.id,class:"card rounded-md px-5 py-4 flex items-center gap-4 cursor-pointer hover:bg-white/[0.02] transition-colors",onClick:f=>w(l)},[s("div",Ee,[s("div",Qe,[s("span",He,u(l.suite_name||"Suite"),1),s("span",{class:"text-[10px] font-mono px-1.5 py-0.5 rounded-sm",style:D(r(l.status))},u(l.status||"unknown"),5),l.optimization_mode&&l.optimization_mode!=="grid"?(n(),a("span",{key:0,class:"text-[9px] font-display tracking-wider uppercase px-1.5 py-0.5 rounded-sm",style:D(l.optimization_mode==="bayesian"?{background:"rgba(168,85,247,0.08)",color:"#A855F7",border:"1px solid rgba(168,85,247,0.2)"}:{background:"rgba(56,189,248,0.08)",color:"#38BDF8",border:"1px solid rgba(56,189,248,0.2)"})},u(l.optimization_mode),5)):c("",!0)]),s("div",Ie,[j(u(R(l.timestamp))+" ",1),l.total_combos?(n(),a("span",Ue,u(l.completed_combos||0)+"/"+u(l.total_combos)+" combos",1)):c("",!0),l.duration_s?(n(),a("span",Ye,u(L(l.duration_s)),1)):c("",!0)]),l.target_model_display_name||l.target_model_id?(n(),a("div",Ke," Model: "+u(l.target_model_display_name||l.target_model_id),1)):c("",!0)]),s("div",Xe,[l.best_score?(n(),a("div",{key:0,class:"text-sm font-mono font-bold",style:D({color:P(l.best_score*100)})},u((l.best_score*100).toFixed(1))+"% ",5)):c("",!0),o[10]||(o[10]=s("div",{class:"text-[10px] text-zinc-600 font-body"},"best",-1))]),s("div",We,[l.best_score?(n(),a("button",{key:0,onClick:S(f=>b(l),["stop"]),class:"text-[10px] font-display tracking-wider uppercase px-2 py-1 rounded-sm",style:{background:"rgba(191,255,0,0.08)",border:"1px solid rgba(191,255,0,0.2)",color:"var(--lime)"},title:"Apply best config to shared context"},"Apply",8,Ge)):c("",!0),l.best_score?(n(),a("button",{key:1,onClick:S(f=>A(l),["stop"]),class:"text-[10px] font-display tracking-wider uppercase px-2 py-1 rounded-sm",style:{background:"rgba(56,189,248,0.08)",border:"1px solid rgba(56,189,248,0.2)",color:"#38BDF8"},title:"Save best config as a profile"},"Save Profile",8,Ze)):c("",!0),l.eval_run_id?(n(),a("button",{key:2,onClick:S(f=>q(l),["stop"]),class:"text-[10px] font-display tracking-wider uppercase px-2 py-1 rounded-sm",style:{background:"rgba(251,191,36,0.08)",border:"1px solid rgba(251,191,36,0.2)",color:"#FBBF24"},title:"Run judge analysis on winning parameters"},"Judge",8,et)):c("",!0),s("button",{onClick:S(f=>J(l),["stop"]),class:"text-[10px] text-zinc-600 hover:text-red-400 transition-colors",style:{background:"none",border:"none",cursor:"pointer"},title:"Delete run"},[...o[11]||(o[11]=[s("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,tt)])],8,Oe))),128))])),x.value?(n(),a("div",{key:3,class:"fixed inset-0 z-50 flex items-center justify-center",style:{background:"rgba(0,0,0,0.7)"},onClick:o[3]||(o[3]=S(l=>x.value=null,["self"]))},[s("div",ot,[s("div",st,[s("div",null,[s("span",lt,u(x.value.suite_name||"Run Detail"),1),s("span",rt,u(R(x.value.timestamp)),1)]),s("button",{onClick:o[0]||(o[0]=l=>x.value=null),class:"text-zinc-500 hover:text-zinc-300",style:{background:"none",border:"none",cursor:"pointer"}},"Close")]),C(m).results.length>0?(n(),H(ae,{key:0,results:C(m).sortedResults,"best-overall-score":C(m).bestScore,onSort:o[1]||(o[1]=l=>C(m).setSort(l))},null,8,["results","best-overall-score"])):c("",!0),C(m).results.length>0?(n(),a("div",nt,[s("div",at,[(i=x.value)!=null&&i.eval_run_id&&!y.value.length?(n(),a("button",{key:0,onClick:N,disabled:_.value,class:"text-[10px] font-display tracking-wider uppercase px-3 py-1.5 rounded-sm inline-flex items-center gap-1.5",style:{background:"rgba(251,191,36,0.08)",border:"1px solid rgba(251,191,36,0.2)",color:"#FBBF24"}},[_.value?(n(),a("span",ut)):c("",!0),j(" "+u(_.value?"Scoring...":"Score with Judge"),1)],8,it)):c("",!0),y.value.length?(n(),a("span",dt," Judge scores loaded — showing 3-axis correlation ")):c("",!0)]),y.value.length?(n(),H(Ne,{key:0,data:y.value,onSelect:o[2]||(o[2]=l=>p.value=l)},null,8,["data"])):c("",!0)])):c("",!0)])])):c("",!0),p.value?(n(),a("div",{key:4,class:"fixed inset-0 z-[60] flex items-center justify-center",style:{background:"rgba(0,0,0,0.7)"},onClick:o[5]||(o[5]=S(l=>p.value=null,["self"]))},[s("div",ct,[s("div",pt,[o[12]||(o[12]=s("span",{class:"section-label"},"Combo Detail",-1)),s("button",{onClick:o[4]||(o[4]=l=>p.value=null),class:"text-zinc-500 hover:text-zinc-300",style:{background:"none",border:"none",cursor:"pointer"}},"Close")]),s("div",mt,[s("span",vt,u(p.value.model_name),1),s("span",{class:"text-xs font-mono ml-2",style:D({color:P(p.value.overall_score*100)})},u((p.value.overall_score*100).toFixed(1))+"% ",5)]),s("div",ft,[(n(!0),a(F,null,M(p.value.config,(l,f)=>(n(),a("span",{key:f,class:"text-[10px] font-mono px-2 py-1 rounded-sm",style:{background:"rgba(255,255,255,0.04)",border:"1px solid var(--border-subtle)"}},u(f)+": "+u(k(l)),1))),128))])])])):c("",!0)])}}};export{wt as default};
