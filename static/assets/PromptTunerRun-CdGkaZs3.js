import{u as C}from"./promptTuner-CWsfemrF.js";import{h as P,i as w,D as T,c as a,a as t,t as l,q as o,l as f,Q as b,d as c,g as x,B as R,k as u,G as j,J as z,r as B,o as r}from"./index-BxbfhC3f.js";import{u as S}from"./useSharedContext-DRtY8wlt.js";import{_ as N}from"./PromptTimeline-CJ2B7AOW.js";import"./useActiveSession-DdoXJmDo.js";const I={class:"flex items-center justify-between mb-6"},J={class:"text-sm text-zinc-600 font-body"},V={class:"flex items-center gap-2"},F={key:0,class:"card rounded-md p-5 mb-6"},q={class:"flex items-center justify-between mb-3"},D={class:"flex items-center gap-3"},E={key:0,class:"pulse-dot"},M={class:"text-sm text-zinc-400 font-body"},U={class:"text-xs font-mono text-zinc-600"},$={class:"progress-track rounded-full overflow-hidden"},A={key:1,class:"card rounded-md p-5 mb-6",style:{"border-left":"3px solid var(--lime)"}},G={class:"flex items-center justify-between mb-2"},H={class:"text-sm font-mono font-bold",style:{color:"var(--lime)"}},Q={key:3,class:"text-xs text-zinc-600 font-body text-center py-8"},W={key:4,class:"text-xs text-zinc-600 font-body text-center py-8"},te={__name:"PromptTunerRun",setup(K){const e=C(),g=P(),{setConfig:_,setSystemPrompt:y}=S(),{showToast:i}=j(),d=B(!1);let p=null;w(()=>{e.restoreJob(),p=g.onMessage(n=>{if(!e.activeJobId||n.job_id&&n.job_id!==e.activeJobId)return;["tune_start","generation_start","prompt_generated","prompt_eval_start","prompt_eval_result","generation_complete","generation_error","tune_complete","job_progress","job_completed","job_failed","job_cancelled"].includes(n.type)&&(e.handleProgress(n),n.type==="tune_complete"&&i("Prompt tuning complete!","success"),n.type==="job_failed"&&i(n.error||"Tuning failed","error"))}),e.activeRunId&&e.generations.length===0&&e.loadRun(e.activeRunId).catch(()=>{})}),T(()=>{p&&p()});async function v(){try{await e.cancelTuning(),i("Cancellation requested","")}catch{i("Failed to cancel","error")}}function k(){e.bestPrompt&&(y("_global",e.bestPrompt),_({lastUpdatedBy:"prompt_tuner"}),i("Best prompt applied to shared context","success"))}function h(){e.bestPrompt&&navigator.clipboard.writeText(e.bestPrompt).then(()=>i("Copied to clipboard","success"),()=>i("Failed to copy","error"))}return(n,s)=>{const m=z("router-link");return r(),a("div",null,[t("div",I,[t("div",null,[s[1]||(s[1]=t("h2",{class:"font-display font-bold text-lg text-zinc-100 mb-1"},"Prompt Tuner Run",-1)),t("p",J,l(o(e).isRunning?"Tuning in progress...":"Run complete"),1)]),t("div",V,[f(m,{to:{name:"PromptTunerConfig"},class:"text-[10px] font-display tracking-wider uppercase px-3 py-1.5 rounded-sm",style:{border:"1px solid var(--border-subtle)",color:"var(--zinc-400)"}},{default:b(()=>[...s[2]||(s[2]=[u("Config",-1)])]),_:1}),o(e).isRunning?(r(),a("button",{key:0,onClick:v,class:"text-[10px] font-display font-medium tracking-wider uppercase px-3 py-1 rounded-sm transition-colors",style:{color:"var(--coral)",border:"1px solid rgba(255,59,92,0.3)"}},"Cancel")):c("",!0)])]),o(e).isRunning||o(e).progress.pct>0?(r(),a("div",F,[t("div",q,[t("div",D,[o(e).isRunning?(r(),a("div",E)):c("",!0),t("span",M,l(o(e).progress.detail),1)]),t("span",U,l(o(e).progress.pct)+"%",1)]),t("div",$,[t("div",{class:"progress-fill",style:x({width:o(e).progress.pct+"%"})},null,4)])])):c("",!0),o(e).bestPrompt?(r(),a("div",A,[t("div",G,[s[3]||(s[3]=t("span",{class:"section-label"},"Best Prompt",-1)),t("span",H,l((o(e).bestScore*100).toFixed(1))+"% ",1)]),t("div",{class:"text-xs text-zinc-400 font-body rounded-sm px-3 py-2 cursor-pointer",style:x([{background:"rgba(0,0,0,0.2)",border:"1px solid var(--border-subtle)"},{maxHeight:d.value?"none":"80px",overflow:d.value?"visible":"hidden"}]),onClick:s[0]||(s[0]=L=>d.value=!d.value)},l(o(e).bestPrompt),5),t("div",{class:"flex items-center gap-2 mt-2"},[t("button",{onClick:k,class:"text-[10px] font-display tracking-wider uppercase px-3 py-1 rounded-sm",style:{background:"rgba(191,255,0,0.08)",border:"1px solid rgba(191,255,0,0.2)",color:"var(--lime)"}},"Apply to Context"),t("button",{onClick:h,class:"text-[10px] font-display tracking-wider uppercase px-3 py-1 rounded-sm",style:{border:"1px solid var(--border-subtle)",color:"var(--zinc-400)"}},"Copy")])])):c("",!0),o(e).generations.length>0?(r(),R(N,{key:2,generations:o(e).generations,"current-generation-num":o(e).progress.generation},null,8,["generations","current-generation-num"])):o(e).isRunning?(r(),a("div",Q," Waiting for first generation... ")):!o(e).isRunning&&o(e).generations.length===0?(r(),a("div",W,[s[5]||(s[5]=u(" No active run. ",-1)),f(m,{to:{name:"PromptTunerConfig"},class:"text-lime-400 hover:text-lime-300"},{default:b(()=>[...s[4]||(s[4]=[u("Start a new tune",-1)])]),_:1})])):c("",!0)])}}};export{te as default};
