import{b as n,c as r,d as o,i as z,x as F,F as y,A as x,t as m,f as T,B as g,o as $,e as B,s as w,Q as R,r as _,K as O}from"./index-BMBAIBBO.js";import{C as L,a as M,L as D,B as E,p as A,c as N,e as S}from"./index-C9ZVOmvI.js";const j={class:"space-y-6"},V={class:"card rounded-md p-4"},W={style:{height:"320px"}},K={class:"card rounded-md p-4"},P={style:{height:"320px"}},I={key:0,class:"card rounded-md p-4"},Q={class:"overflow-x-auto"},H={class:"w-full text-xs results-table"},q={style:{"border-bottom":"1px solid var(--border-subtle)"}},G={class:"px-3 py-2 text-zinc-300"},J={__name:"CompareCharts",props:{runs:{type:Array,default:()=>[]}},setup(f){L.register(M,D,E,A,N);const c=["#BFFF00","#00d4ff","#ff6b6b","#ffd93d","#6bcb77","#4d96ff","#ff9f43","#a855f7"],p=f,u=g(()=>{const a=new Set;return p.runs.forEach(t=>{(t.results||t.models||[]).forEach(e=>a.add(e.model||e.display_name))}),Array.from(a).sort()}),i=g(()=>p.runs.map(a=>{const t=new Date(a.timestamp),s=(a.prompt||"").substring(0,20);return t.toLocaleDateString()+(s?" - "+s:"")})),h=g(()=>({labels:u.value,datasets:p.runs.map((a,t)=>{const s=a.results||a.models||[];return{label:i.value[t],data:u.value.map(e=>{const l=s.find(d=>(d.model||d.display_name)===e);return l?l.avg_tokens_per_second??l.avg_tps??0:0}),backgroundColor:c[t%c.length]+"CC",borderColor:c[t%c.length],borderWidth:0,borderRadius:2}})})),b=g(()=>({labels:u.value,datasets:p.runs.map((a,t)=>{const s=a.results||a.models||[];return{label:i.value[t],data:u.value.map(e=>{const l=s.find(d=>(d.model||d.display_name)===e);return l?l.avg_ttft_ms??0:0}),backgroundColor:c[t%c.length]+"CC",borderColor:c[t%c.length],borderWidth:0,borderRadius:2}})}));function v(a,t){return{responsive:!0,maintainAspectRatio:!1,animation:{duration:800,easing:"easeOutQuart"},plugins:{legend:{display:!0,labels:{color:"#85858F",font:{family:"Outfit",size:11},boxWidth:12,padding:16}},tooltip:{backgroundColor:"#1c1c20",borderColor:"#27272A",borderWidth:1,titleFont:{family:"Outfit",size:13,weight:"500"},bodyFont:{family:"Space Mono",size:12},padding:12,cornerRadius:2,callbacks:{label:s=>` ${s.parsed.y.toFixed(1)} ${t}`}}},scales:{x:{grid:{color:"rgba(255,255,255,0.03)",drawBorder:!1},ticks:{color:"#85858F",font:{family:"Outfit",size:11},maxRotation:45}},y:{grid:{color:"rgba(255,255,255,0.03)",drawBorder:!1},ticks:{color:"#8B8B95",font:{family:"Space Mono",size:11}},title:{display:!0,text:a,color:"#63636B",font:{family:"Chakra Petch",size:10,weight:"600"}}}}}}function k(a,t){const e=(a.results||a.models||[]).find(d=>(d.model||d.display_name)===t);return e?(e.avg_tokens_per_second??e.avg_tps??0).toFixed(1):"-"}function C(a,t){const e=(a.results||a.models||[]).find(d=>(d.model||d.display_name)===t);return e?(e.avg_ttft_ms??0).toFixed(0)+"ms":"-"}return(a,t)=>(n(),r("div",j,[o("div",V,[t[0]||(t[0]=o("h3",{class:"section-label mb-3"},"Throughput Comparison (tok/s)",-1)),o("div",W,[z(F(S),{data:h.value,options:v("TOKENS / SECOND","tok/s")},null,8,["data","options"])])]),o("div",K,[t[1]||(t[1]=o("h3",{class:"section-label mb-3"},"TTFT Comparison (ms)",-1)),o("div",P,[z(F(S),{data:b.value,options:v("TIME TO FIRST TOKEN (MS)","ms")},null,8,["data","options"])])]),u.value.length&&f.runs.length>=2?(n(),r("div",I,[t[3]||(t[3]=o("h3",{class:"section-label mb-3"},"Delta Table",-1)),o("div",Q,[o("table",H,[o("thead",null,[o("tr",q,[t[2]||(t[2]=o("th",{class:"px-3 py-2 text-left section-label"},"Model",-1)),(n(!0),r(y,null,x(f.runs,(s,e)=>(n(),r("th",{key:"tps-"+e,class:"px-3 py-2 text-right section-label"},"Run "+m(e+1)+" TPS",1))),128)),(n(!0),r(y,null,x(f.runs,(s,e)=>(n(),r("th",{key:"ttft-"+e,class:"px-3 py-2 text-right section-label"},"Run "+m(e+1)+" TTFT",1))),128))])]),o("tbody",null,[(n(!0),r(y,null,x(u.value,s=>(n(),r("tr",{key:s,style:{"border-top":"1px solid var(--border-subtle)"}},[o("td",G,m(s),1),(n(!0),r(y,null,x(f.runs,(e,l)=>(n(),r("td",{key:"tps-val-"+l,class:"px-3 py-2 text-right font-mono text-zinc-400"},m(k(e,s)),1))),128)),(n(!0),r(y,null,x(f.runs,(e,l)=>(n(),r("td",{key:"ttft-val-"+l,class:"px-3 py-2 text-right font-mono text-zinc-400"},m(C(e,s)),1))),128))]))),128))])])])])):T("",!0)]))}},U={class:"mb-5"},X={class:"flex items-center justify-between mb-3"},Y=["disabled"],Z={key:0,class:"text-zinc-600 text-xs py-3"},tt={key:1,class:"text-zinc-600 text-xs py-3"},et={key:2,class:"flex flex-col gap-1 max-h-64 overflow-y-auto pr-1",style:{"scrollbar-width":"thin"}},st=["value","checked","onChange"],at={class:"text-xs font-mono text-zinc-500"},ot={class:"text-xs text-zinc-400 truncate flex-1"},nt={class:"text-[10px] font-mono text-zinc-600"},rt={key:0},lt={key:1,class:"text-zinc-600 text-sm text-center py-8"},it={key:2,class:"text-zinc-600 text-sm text-center py-8"},ut={__name:"CompareView",setup(f){const{showToast:c}=O(),p=_([]),u=_(!1),i=R(new Set),h=_([]),b=_(!1);function v(t){return t?new Date(t).toLocaleString():""}function k(t,s){if(s){if(i.size>=4){c("Max 4 runs can be compared","error");return}i.add(t)}else i.delete(t)}async function C(){u.value=!0;try{const s=await(await w("/api/history")).json();p.value=(s.runs||[]).filter(e=>e.id)}catch{p.value=[]}finally{u.value=!1}}async function a(){if(i.size<2)return;b.value=!0;const t=Array.from(i).join(",");try{const s=await w(`/api/analytics/compare?runs=${t}`);if(!s.ok)throw new Error("Failed");const e=await s.json();h.value=e.runs||[]}catch{try{const s=await Promise.all(Array.from(i).map(async e=>(await w(`/api/history/${e}`)).json()));h.value=s}catch{c("Failed to load comparison data","error"),h.value=[]}}finally{b.value=!1}}return $(C),(t,s)=>(n(),r("div",null,[o("div",U,[o("div",X,[s[0]||(s[0]=o("span",{class:"section-label"},"Select 2-4 runs to compare",-1)),o("button",{disabled:i.size<2,class:B(["text-[11px] font-display tracking-wider uppercase px-4 py-1.5 rounded-sm transition-all",i.size>=2?"text-[var(--lime)] border border-[rgba(191,255,0,0.3)] cursor-pointer opacity-100":"text-zinc-500 border border-[var(--border-subtle)] cursor-not-allowed opacity-50"]),onClick:a}," Compare ",10,Y)]),u.value?(n(),r("div",Z,"Loading recent runs...")):p.value.length?(n(),r("div",et,[(n(!0),r(y,null,x(p.value.slice(0,20),e=>(n(),r("label",{key:e.id,class:"flex items-center gap-3 px-3 py-2 rounded-sm cursor-pointer transition-colors hover:bg-white/[0.02]",style:{border:"1px solid var(--border-subtle)"}},[o("input",{type:"checkbox",value:e.id,checked:i.has(e.id),class:"accent-lime-400 w-3.5 h-3.5",onChange:l=>k(e.id,l.target.checked)},null,40,st),o("span",at,m(v(e.timestamp)),1),o("span",ot,m((e.prompt||"Benchmark run").substring(0,50)),1),o("span",nt,m((e.results||[]).length)+" models",1)]))),128))])):(n(),r("div",tt,"No benchmark runs found."))]),h.value.length?(n(),r("div",rt,[z(J,{runs:h.value},null,8,["runs"])])):b.value?T("",!0):(n(),r("div",lt," Select at least 2 benchmark runs above, then click Compare. ")),b.value?(n(),r("div",it," Loading comparison... ")):T("",!0)]))}};export{ut as default};
