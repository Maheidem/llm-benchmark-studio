import{o as A,c as a,d as s,i as x,j as v,y as m,k as _,F as R,x as L,g as f,t as l,E as V,f as u,J as H,r as k,a as O,b as n,l as h,L as E,M as U}from"./index-DdRTlIgb.js";import{u as I}from"./paramTuner-WruKFjGx.js";import{u as q}from"./profiles-z0bYLHRr.js";import{u as G}from"./judge-CmLUaamh.js";import{u as K}from"./useSharedContext-Ck8vzsgc.js";import{_ as Q}from"./ParamTunerResults-DoozOnDK.js";import"./useActiveSession-DdoXJmDo.js";const W={class:"flex items-center justify-between mb-6"},X={key:0,class:"text-xs text-zinc-600 font-body text-center py-8"},Y={key:1,class:"text-xs text-zinc-600 font-body text-center py-8"},Z={key:2,class:"space-y-3"},ee=["onClick"],te={class:"flex-1 min-w-0"},oe={class:"flex items-center gap-2 mb-1"},se={class:"text-xs font-mono text-zinc-300"},re={class:"text-[10px] text-zinc-600 font-body"},ne={key:0,class:"ml-2"},ae={key:1,class:"ml-2"},ie={key:0,class:"text-[10px] text-zinc-600 font-body mt-1"},le={class:"text-right"},ce={class:"flex items-center gap-2"},de=["onClick"],ue=["onClick"],pe=["onClick"],me=["onClick"],fe={class:"card rounded-md p-6 max-w-4xl w-full mx-4",style:{"max-height":"85vh","overflow-y":"auto"}},_e={class:"flex items-center justify-between mb-4"},ge={class:"section-label"},ye={class:"text-xs text-zinc-600 font-body ml-2"},Ce={__name:"ParamTunerHistory",setup(be){const c=I(),w=q(),j=G(),{setConfig:S}=K(),{showToast:i}=H(),{inputModal:C}=U(),g=k(!0),p=k(null);A(async()=>{try{await c.loadHistory()}catch{i("Failed to load history","error")}finally{g.value=!1}});async function F(e){try{await c.loadRun(e.id),p.value=e}catch{i("Failed to load run details","error")}}async function z(e){var t;if(confirm("Delete this tuning run?"))try{await c.deleteRun(e.id),i("Run deleted","success"),((t=p.value)==null?void 0:t.id)===e.id&&(p.value=null)}catch{i("Failed to delete run","error")}}function B(e){let t=null;if(e.best_config_json)try{t=typeof e.best_config_json=="string"?JSON.parse(e.best_config_json):e.best_config_json}catch{}if(!t){i("No best config available","error");return}const r={lastUpdatedBy:"param_tuner"};t.temperature!=null&&(r.temperature=t.temperature),t.tool_choice&&(r.toolChoice=t.tool_choice),t.provider_params&&(r.providerParams=t.provider_params),S(r),i("Best config applied to shared context","success")}async function N(e){var b;let t=null;if(e.best_config_json)try{t=typeof e.best_config_json=="string"?JSON.parse(e.best_config_json):e.best_config_json}catch{}if(!t){i("No best config available","error");return}const r=e.models_json?typeof e.models_json=="string"?JSON.parse(e.models_json):e.models_json:[],o=Array.isArray(r)&&r.length>0?r[0]:null,d=await C("Save as Profile","Profile name",{confirmLabel:"Save"});if((b=d==null?void 0:d.value)!=null&&b.trim())try{await w.createFromTuner({source_type:"param_tuner",source_id:e.id,model_id:o,name:d.value.trim(),params_json:t,system_prompt:null}),i("Profile saved","success")}catch($){i($.message||"Failed to save profile","error")}}async function P(e){if(!e.eval_run_id){i("No eval run linked to this tuning run","error");return}let t="";try{const r=await E("/api/settings/judge");r.ok&&(t=(await r.json()).default_judge_model||"")}catch{}if(!t){i("No default judge model configured. Set one in Settings > Judge.","error");return}try{await j.runJudge({eval_run_id:e.eval_run_id,judge_model:t,tune_run_id:e.id,tune_type:"param_tuner"}),i("Judge analyzing winning parameters...","success")}catch(r){i(r.message||"Failed to start judge","error")}}function y(e){return e?new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):""}function M(e){return e<60?`${Math.round(e)}s`:`${Math.round(e/60)}m`}function J(e){try{const t=typeof e=="string"?JSON.parse(e):e;if(Array.isArray(t))return t.map(r=>r.split("/").pop()).join(", ")}catch{}return""}function D(e){return e==="completed"?{background:"rgba(191,255,0,0.1)",color:"var(--lime)"}:e==="running"?{background:"rgba(56,189,248,0.1)",color:"#38BDF8"}:e==="cancelled"?{background:"rgba(255,255,255,0.04)",color:"#71717A"}:e==="interrupted"?{background:"rgba(249,115,22,0.1)",color:"#F97316"}:{background:"rgba(255,59,92,0.1)",color:"var(--coral)"}}function T(e){return e>=80?"var(--lime)":e>=50?"#FBBF24":"var(--coral)"}return(e,t)=>{const r=O("router-link");return n(),a("div",null,[s("div",W,[t[4]||(t[4]=s("div",null,[s("h2",{class:"font-display font-bold text-lg text-zinc-100 mb-1"},"Param Tuner History"),s("p",{class:"text-sm text-zinc-600 font-body"},"Past parameter tuning runs.")],-1)),x(r,{to:{name:"ParamTunerConfig"},class:"text-[10px] font-display tracking-wider uppercase px-3 py-1.5 rounded-sm",style:{border:"1px solid var(--border-subtle)",color:"var(--zinc-400)"}},{default:v(()=>[...t[3]||(t[3]=[_("New Tune",-1)])]),_:1})]),g.value?(n(),a("div",X,"Loading...")):m(c).history.length===0?(n(),a("div",Y,[t[6]||(t[6]=_(" No param tuning runs yet. ",-1)),x(r,{to:{name:"ParamTunerConfig"},class:"text-lime-400 hover:text-lime-300"},{default:v(()=>[...t[5]||(t[5]=[_("Start your first tune",-1)])]),_:1})])):(n(),a("div",Z,[(n(!0),a(R,null,L(m(c).history,o=>(n(),a("div",{key:o.id,class:"card rounded-md px-5 py-4 flex items-center gap-4 cursor-pointer hover:bg-white/[0.02] transition-colors",onClick:d=>F(o)},[s("div",te,[s("div",oe,[s("span",se,l(o.suite_name||"Suite"),1),s("span",{class:"text-[10px] font-mono px-1.5 py-0.5 rounded-sm",style:h(D(o.status))},l(o.status||"unknown"),5)]),s("div",re,[_(l(y(o.timestamp))+" ",1),o.total_combos?(n(),a("span",ne,l(o.completed_combos||0)+"/"+l(o.total_combos)+" combos",1)):u("",!0),o.duration_s?(n(),a("span",ae,l(M(o.duration_s)),1)):u("",!0)]),o.models_json?(n(),a("div",ie," Models: "+l(J(o.models_json)),1)):u("",!0)]),s("div",le,[o.best_score?(n(),a("div",{key:0,class:"text-sm font-mono font-bold",style:h({color:T(o.best_score*100)})},l((o.best_score*100).toFixed(1))+"% ",5)):u("",!0),t[7]||(t[7]=s("div",{class:"text-[10px] text-zinc-600 font-body"},"best",-1))]),s("div",ce,[o.best_score?(n(),a("button",{key:0,onClick:f(d=>B(o),["stop"]),class:"text-[10px] font-display tracking-wider uppercase px-2 py-1 rounded-sm",style:{background:"rgba(191,255,0,0.08)",border:"1px solid rgba(191,255,0,0.2)",color:"var(--lime)"},title:"Apply best config to shared context"},"Apply",8,de)):u("",!0),o.best_score?(n(),a("button",{key:1,onClick:f(d=>N(o),["stop"]),class:"text-[10px] font-display tracking-wider uppercase px-2 py-1 rounded-sm",style:{background:"rgba(56,189,248,0.08)",border:"1px solid rgba(56,189,248,0.2)",color:"#38BDF8"},title:"Save best config as a profile"},"Save Profile",8,ue)):u("",!0),o.eval_run_id?(n(),a("button",{key:2,onClick:f(d=>P(o),["stop"]),class:"text-[10px] font-display tracking-wider uppercase px-2 py-1 rounded-sm",style:{background:"rgba(251,191,36,0.08)",border:"1px solid rgba(251,191,36,0.2)",color:"#FBBF24"},title:"Run judge analysis on winning parameters"},"Judge",8,pe)):u("",!0),s("button",{onClick:f(d=>z(o),["stop"]),class:"text-[10px] text-zinc-600 hover:text-red-400 transition-colors",style:{background:"none",border:"none",cursor:"pointer"},title:"Delete run"},[...t[8]||(t[8]=[s("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,me)])],8,ee))),128))])),p.value?(n(),a("div",{key:3,class:"fixed inset-0 z-50 flex items-center justify-center",style:{background:"rgba(0,0,0,0.7)"},onClick:t[2]||(t[2]=f(o=>p.value=null,["self"]))},[s("div",fe,[s("div",_e,[s("div",null,[s("span",ge,l(p.value.suite_name||"Run Detail"),1),s("span",ye,l(y(p.value.timestamp)),1)]),s("button",{onClick:t[0]||(t[0]=o=>p.value=null),class:"text-zinc-500 hover:text-zinc-300",style:{background:"none",border:"none",cursor:"pointer"}},"Close")]),m(c).results.length>0?(n(),V(Q,{key:0,results:m(c).sortedResults,"best-overall-score":m(c).bestScore,onSort:t[1]||(t[1]=o=>m(c).setSort(o))},null,8,["results","best-overall-score"])):u("",!0)])])):u("",!0)])}}};export{Ce as default};
