import{o as J,c as i,d as s,i as v,j as k,x as m,k as _,F as L,A as V,g as f,t as a,f as d,y as H,K as O,r as h,a as U,b as n,l as y,s as q,M as E}from"./index-BqpQFpv6.js";import{u as G}from"./promptTuner-B6E68GtL.js";import{u as I}from"./profiles-DZkAa5Kq.js";import{u as K}from"./judge-WPFTl2xC.js";import{u as Q}from"./useSharedContext-BnDn8Z30.js";import{_ as W}from"./PromptTimeline-CDZf5t4b.js";import"./useActiveSession-DdoXJmDo.js";const X={class:"flex items-center justify-between mb-6"},Y={key:0,class:"text-xs text-zinc-600 font-body text-center py-8"},Z={key:1,class:"text-xs text-zinc-600 font-body text-center py-8"},tt={key:2,class:"space-y-3"},et=["onClick"],ot={class:"flex items-center gap-4"},st={class:"flex-1 min-w-0"},rt={class:"flex items-center gap-2 mb-1"},nt={class:"text-xs font-mono text-zinc-300"},it={class:"text-[10px] text-zinc-600 font-body"},at={key:0,class:"ml-2"},lt={key:1,class:"ml-2"},dt={class:"text-right"},ct={class:"flex items-center gap-2"},ut=["onClick"],pt=["onClick"],mt=["onClick"],ft=["onClick"],_t={key:0,class:"mt-2 text-[10px] text-zinc-600 font-body truncate"},yt={class:"card rounded-md p-6 max-w-3xl w-full mx-4",style:{"max-height":"85vh","overflow-y":"auto"}},gt={class:"flex items-center justify-between mb-4"},xt={class:"section-label"},bt={class:"text-xs text-zinc-600 font-body ml-2"},vt={key:0,class:"mb-4 rounded-sm px-4 py-3",style:{border:"1px solid rgba(191,255,0,0.2)",background:"rgba(191,255,0,0.03)"}},kt={class:"text-[10px] text-zinc-600 font-display tracking-wider uppercase mb-1"},ht={class:"text-xs text-zinc-400 font-body mb-2"},wt={key:0,class:"text-[10px] text-zinc-600 font-body italic"},Dt={__name:"PromptTunerHistory",setup(St){const c=G(),w=I(),S=K(),{setSystemPrompt:C,setConfig:F}=Q(),{showToast:l}=O(),{inputModal:z}=E(),g=h(!0),u=h(null);J(async()=>{try{await c.loadHistory()}catch{l("Failed to load history","error")}finally{g.value=!1}});async function j(t){try{await c.loadRun(t.id),u.value=t}catch{l("Failed to load run details","error")}}async function B(t){var o;if(confirm("Delete this prompt tuning run?"))try{await c.deleteRun(t.id),l("Run deleted","success"),((o=u.value)==null?void 0:o.id)===t.id&&(u.value=null)}catch{l("Failed to delete run","error")}}function P(t){if(!t.best_prompt){l("No best prompt available","error");return}C("_global",t.best_prompt),F({lastUpdatedBy:"prompt_tuner"}),l("Best prompt applied to shared context","success")}async function $(t){var e,p;if(!t.best_prompt){l("No best prompt available","error");return}const o=t.model_id||((e=t.target)==null?void 0:e.model_id)||null,r=await z("Save as Profile","Profile name",{confirmLabel:"Save"});if((p=r==null?void 0:r.value)!=null&&p.trim())try{await w.createFromTuner({source_type:"prompt_tuner",source_id:t.id,model_id:o,name:r.value.trim(),system_prompt:t.best_prompt,params_json:null}),l("Profile saved","success")}catch(R){l(R.message||"Failed to save profile","error")}}async function D(t){if(!t.eval_run_id){l("No eval run linked to this tuning run","error");return}let o="";try{const r=await q("/api/settings/judge");r.ok&&(o=(await r.json()).default_judge_model||"")}catch{}if(!o){l("No default judge model configured. Set one in Settings > Judge.","error");return}try{await S.runJudge({eval_run_id:t.eval_run_id,judge_model:o,tune_run_id:t.id,tune_type:"prompt_tuner"}),l("Judge analyzing winning prompt...","success")}catch(r){l(r.message||"Failed to start judge","error")}}function x(t){const o=t.best_prompt_origin_json||t.best_prompt_origin;if(!o)return null;try{const r=typeof o=="string"?JSON.parse(o):o,e=[];return r.generation!=null&&e.push(`Generation ${r.generation}`),r.prompt_index!=null&&e.push(`prompt ${r.prompt_index}`),r.style&&e.push(`style: ${r.style}`),e.length>0?`Best prompt found in ${e.join(", ")}`:null}catch{return null}}function b(t){return t?new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):""}function M(t){return t<60?`${Math.round(t)}s`:`${Math.round(t/60)}m`}function N(t){return t==="completed"?{background:"rgba(191,255,0,0.1)",color:"var(--lime)"}:t==="running"?{background:"rgba(56,189,248,0.1)",color:"#38BDF8"}:t==="cancelled"?{background:"rgba(255,255,255,0.04)",color:"#71717A"}:t==="interrupted"?{background:"rgba(249,115,22,0.1)",color:"#F97316"}:{background:"rgba(255,59,92,0.1)",color:"var(--coral)"}}function T(t){return t==="evolutionary"?{background:"rgba(168,85,247,0.1)",color:"#A855F7"}:{background:"rgba(56,189,248,0.08)",color:"#38BDF8"}}function A(t){return t>=80?"var(--lime)":t>=50?"#FBBF24":"var(--coral)"}return(t,o)=>{const r=U("router-link");return n(),i("div",null,[s("div",X,[o[3]||(o[3]=s("div",null,[s("h2",{class:"font-display font-bold text-lg text-zinc-100 mb-1"},"Prompt Tuner History"),s("p",{class:"text-sm text-zinc-600 font-body"},"Past prompt tuning runs.")],-1)),v(r,{to:{name:"PromptTunerConfig"},class:"text-[10px] font-display tracking-wider uppercase px-3 py-1.5 rounded-sm",style:{border:"1px solid var(--border-subtle)",color:"var(--zinc-400)"}},{default:k(()=>[...o[2]||(o[2]=[_("New Tune",-1)])]),_:1})]),g.value?(n(),i("div",Y,"Loading...")):m(c).history.length===0?(n(),i("div",Z,[o[5]||(o[5]=_(" No prompt tuning runs yet. ",-1)),v(r,{to:{name:"PromptTunerConfig"},class:"text-lime-400 hover:text-lime-300"},{default:k(()=>[...o[4]||(o[4]=[_("Start your first tune",-1)])]),_:1})])):(n(),i("div",tt,[(n(!0),i(L,null,V(m(c).history,e=>(n(),i("div",{key:e.id,class:"card rounded-md px-5 py-4 cursor-pointer hover:bg-white/[0.02] transition-colors",onClick:p=>j(e)},[s("div",ot,[s("div",st,[s("div",rt,[s("span",nt,a(e.suite_name||"Suite"),1),s("span",{class:"text-[10px] font-mono px-1.5 py-0.5 rounded-sm",style:y(N(e.status))},a(e.status||"unknown"),5),s("span",{class:"text-[10px] px-1.5 py-0.5 rounded-sm font-body",style:y(T(e.mode))},a(e.mode||"quick"),5)]),s("div",it,[_(a(b(e.timestamp))+" ",1),e.meta_model?(n(),i("span",at,"Meta: "+a(e.meta_model.split("/").pop()),1)):d("",!0),e.duration_s?(n(),i("span",lt,a(M(e.duration_s)),1)):d("",!0)])]),s("div",dt,[e.best_score?(n(),i("div",{key:0,class:"text-sm font-mono font-bold",style:y({color:A(e.best_score*100)})},a((e.best_score*100).toFixed(1))+"% ",5)):d("",!0),o[6]||(o[6]=s("div",{class:"text-[10px] text-zinc-600 font-body"},"best",-1))]),s("div",ct,[e.best_prompt?(n(),i("button",{key:0,onClick:f(p=>P(e),["stop"]),class:"text-[10px] font-display tracking-wider uppercase px-2 py-1 rounded-sm",style:{background:"rgba(168,85,247,0.08)",border:"1px solid rgba(168,85,247,0.2)",color:"#A855F7"},title:"Apply best prompt to shared context"},"Apply",8,ut)):d("",!0),e.best_prompt?(n(),i("button",{key:1,onClick:f(p=>$(e),["stop"]),class:"text-[10px] font-display tracking-wider uppercase px-2 py-1 rounded-sm",style:{background:"rgba(56,189,248,0.08)",border:"1px solid rgba(56,189,248,0.2)",color:"#38BDF8"},title:"Save best prompt as a profile"},"Save Profile",8,pt)):d("",!0),e.eval_run_id?(n(),i("button",{key:2,onClick:f(p=>D(e),["stop"]),class:"text-[10px] font-display tracking-wider uppercase px-2 py-1 rounded-sm",style:{background:"rgba(251,191,36,0.08)",border:"1px solid rgba(251,191,36,0.2)",color:"#FBBF24"},title:"Run judge analysis on winning prompt"},"Judge",8,mt)):d("",!0),s("button",{onClick:f(p=>B(e),["stop"]),class:"text-[10px] text-zinc-600 hover:text-red-400 transition-colors",style:{background:"none",border:"none",cursor:"pointer"},title:"Delete run"},[...o[7]||(o[7]=[s("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,ft)])]),e.best_prompt?(n(),i("div",_t,' "'+a(e.best_prompt.substring(0,100))+a(e.best_prompt.length>100?"...":"")+'" ',1)):d("",!0)],8,et))),128))])),u.value?(n(),i("div",{key:3,class:"fixed inset-0 z-50 flex items-center justify-center",style:{background:"rgba(0,0,0,0.7)"},onClick:o[1]||(o[1]=f(e=>u.value=null,["self"]))},[s("div",yt,[s("div",gt,[s("div",null,[s("span",xt,a(u.value.suite_name||"Run Detail"),1),s("span",bt,a(b(u.value.timestamp)),1)]),s("button",{onClick:o[0]||(o[0]=e=>u.value=null),class:"text-zinc-500 hover:text-zinc-300",style:{background:"none",border:"none",cursor:"pointer"}},"Close")]),m(c).bestPrompt?(n(),i("div",vt,[s("div",kt,"Best Prompt ("+a((m(c).bestScore*100).toFixed(1))+"%)",1),s("div",ht,a(m(c).bestPrompt),1),x(u.value)?(n(),i("div",wt,a(x(u.value)),1)):d("",!0)])):d("",!0),m(c).generations.length>0?(n(),H(W,{key:1,generations:m(c).generations},null,8,["generations"])):d("",!0)])])):d("",!0)])}}};export{Dt as default};
