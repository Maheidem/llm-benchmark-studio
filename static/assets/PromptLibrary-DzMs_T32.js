import{o as q,c as r,d as t,h as C,v as z,t as i,f as k,F as P,A as T,x as $,K as R,r as p,q as H,b as l,k as O,l as V,O as D}from"./index-DBNJ0RjU.js";import{u as W}from"./promptLibrary-EwM49QAX.js";import{u as G}from"./useSharedContext-C-EAG0AM.js";const J={class:"flex items-center justify-between mb-6"},Q={key:0,class:"card rounded-md p-5 mb-6"},X={class:"mb-3"},Y={class:"mb-3"},Z={key:0,class:"text-xs mb-3",style:{color:"var(--coral)"}},ee={class:"flex justify-end gap-2"},te=["disabled"],oe={key:1,class:"card rounded-md p-5 mb-6",style:{border:"1px solid rgba(56,189,248,0.2)"}},se={class:"flex items-center justify-between mb-3"},ne={class:"grid grid-cols-2 gap-4"},re={class:"text-[10px] font-display tracking-wider uppercase text-zinc-600 mb-1"},le={class:"ml-2 text-zinc-700"},ae={class:"text-[10px] font-mono text-zinc-400 p-2 rounded-sm overflow-x-auto whitespace-pre-wrap break-all",style:{background:"rgba(0,0,0,0.25)",border:"1px solid var(--border-subtle)","max-height":"200px","overflow-y":"auto"}},ie={key:2,class:"text-[10px] text-zinc-600 font-body mb-4"},de={key:3,class:"text-xs text-zinc-600 font-body text-center py-8"},ce={key:4,class:"text-xs text-zinc-600 font-body text-center py-8"},ue={key:5,class:"space-y-3"},pe={class:"flex items-start gap-3"},xe=["onClick","title"],be={key:0,class:"w-2.5 h-2.5",fill:"none",stroke:"#38BDF8","stroke-width":"3",viewBox:"0 0 24 24"},me={class:"flex-1 min-w-0"},ve={class:"flex items-center gap-2 mb-1 flex-wrap"},fe={class:"text-[10px] font-mono text-zinc-600"},ye={key:0,class:"flex items-center gap-1"},ge=["onKeyup"],ke=["onClick"],_e=["onClick"],he=["onClick"],we={key:3,class:"text-[10px] px-1.5 py-0.5 rounded-sm font-body",style:{background:"rgba(56,189,248,0.08)",color:"#38BDF8"}},Ce={class:"text-[10px] text-zinc-700 font-body ml-auto"},ze={class:"text-[10px] text-zinc-600 font-body truncate pr-2"},$e={class:"flex items-center gap-2 flex-shrink-0"},Ve=["onClick"],Le=["onClick"],Se=["onClick"],Be={__name:"PromptLibrary",setup(Fe){const B=H(),c=W(),{setSystemPrompt:j,setConfig:A}=G(),{showToast:d}=R(),v=p(!1),b=p(""),f=p(""),m=p(""),_=p(!1),y=p(null),h=p(""),n=p([]);q(async()=>{try{await c.loadVersions()}catch{d("Failed to load prompt library","error")}});async function N(){if(m.value="",!b.value.trim()){m.value="Prompt text is required";return}_.value=!0;try{await c.saveVersion(b.value.trim(),f.value.trim()||null),d("Prompt version saved","success"),v.value=!1,b.value="",f.value=""}catch(s){m.value=s.message||"Failed to save"}finally{_.value=!1}}function L(s){y.value=s.id,h.value=s.label||""}async function S(s){try{await c.updateVersion(s,h.value.trim()||null),y.value=null,d("Label updated","success")}catch{d("Failed to update label","error")}}async function M(s){var u;const o=s.label?`"${s.label}"`:`#${s.version_number||((u=s.id)==null?void 0:u.slice(0,6))}`,e=s.profile_count>0?` This version is linked by ${s.profile_count} profile${s.profile_count>1?"s":""}. Deleting will unlink them.`:"";if(confirm(`Delete prompt version ${o}?${e}`))try{await c.deleteVersion(s.id),n.value=n.value.filter(x=>x!==s.id),d("Version deleted","success")}catch{d("Failed to delete version","error")}}function U(s){j("_global",s.prompt_text),A({lastUpdatedBy:"prompt_library"}),d("Prompt loaded into tuner context","success"),B.push({name:"PromptTunerConfig"})}async function E(s){try{await navigator.clipboard.writeText(s),d("Copied to clipboard","success")}catch{d("Failed to copy","error")}}function K(s){n.value.includes(s)?n.value=n.value.filter(o=>o!==s):n.value.length<2?n.value=[...n.value,s]:n.value=[n.value[1],s]}function w(s){return c.versions.find(o=>o.id===s)}function I(s){return s==="tuner"||s==="prompt_tuner"?"background:rgba(168,85,247,0.1);color:#A855F7;":"background:rgba(255,255,255,0.04);color:#71717A;"}function F(s){return s?new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):""}return(s,o)=>(l(),r("div",null,[t("div",J,[o[8]||(o[8]=t("div",null,[t("h2",{class:"font-display font-bold text-lg text-zinc-100 mb-1"},"Prompt Library"),t("p",{class:"text-sm text-zinc-600 font-body"},"Saved system prompt versions. Load into tuner or compare side-by-side.")],-1)),t("button",{onClick:o[0]||(o[0]=e=>v.value=!v.value),class:"text-[10px] font-display tracking-wider uppercase px-3 py-1.5 rounded-sm",style:{background:"rgba(191,255,0,0.08)",border:"1px solid rgba(191,255,0,0.2)",color:"var(--lime)"}},"+ Save New")]),v.value?(l(),r("div",Q,[t("div",X,[o[9]||(o[9]=t("label",{class:"text-xs font-display tracking-wider uppercase text-zinc-500 mb-1 block"},"Prompt Text",-1)),C(t("textarea",{"onUpdate:modelValue":o[1]||(o[1]=e=>b.value=e),rows:"4",class:"w-full px-3 py-2 rounded-sm text-xs font-body text-zinc-200 resize-y",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)",outline:"none"},placeholder:"Enter system prompt..."},null,512),[[z,b.value]])]),t("div",Y,[o[10]||(o[10]=t("label",{class:"text-xs font-display tracking-wider uppercase text-zinc-500 mb-1 block"},"Label (optional)",-1)),C(t("input",{"onUpdate:modelValue":o[2]||(o[2]=e=>f.value=e),class:"w-full px-3 py-1.5 rounded-sm text-xs font-mono text-zinc-200",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)",outline:"none"},placeholder:"e.g. v1-tool-focused"},null,512),[[z,f.value]])]),m.value?(l(),r("div",Z,i(m.value),1)):k("",!0),t("div",ee,[t("button",{onClick:o[3]||(o[3]=e=>{v.value=!1,b.value="",f.value="",m.value=""}),class:"modal-btn modal-btn-cancel text-xs"},"Cancel"),t("button",{onClick:N,disabled:_.value,class:"modal-btn modal-btn-confirm text-xs"},i(_.value?"Saving...":"Save"),9,te)])])):k("",!0),n.value.length===2?(l(),r("div",oe,[t("div",se,[o[11]||(o[11]=t("span",{class:"text-xs font-display tracking-wider uppercase text-zinc-400"},"Comparing 2 Versions",-1)),t("button",{onClick:o[4]||(o[4]=e=>n.value=[]),class:"text-[10px] text-zinc-500 hover:text-zinc-300 font-display tracking-wider uppercase"},"Clear")]),t("div",ne,[(l(!0),r(P,null,T(n.value,e=>{var u,x,g,a;return l(),r("div",{key:e},[t("div",re,[O(i(((u=w(e))==null?void 0:u.label)||`Version ${((x=w(e))==null?void 0:x.version_number)||"?"}`)+" ",1),t("span",le,i(F((g=w(e))==null?void 0:g.created_at)),1)]),t("pre",ae,i(((a=w(e))==null?void 0:a.prompt_text)||""),1)])}),128))])])):n.value.length===1?(l(),r("div",ie," Select one more version to compare. ")):k("",!0),$(c).loading?(l(),r("div",de,"Loading...")):$(c).versions.length===0?(l(),r("div",ce," No saved prompts yet. Save a version above or run a prompt tuning job. ")):(l(),r("div",ue,[(l(!0),r(P,null,T($(c).versions,e=>{var u,x,g;return l(),r("div",{key:e.id,class:"card rounded-md px-5 py-4",style:V(n.value.includes(e.id)?"border:1px solid rgba(56,189,248,0.3);":"")},[t("div",pe,[t("button",{onClick:a=>K(e.id),class:"mt-0.5 flex-shrink-0 w-4 h-4 rounded-sm border flex items-center justify-center transition-colors",style:V(n.value.includes(e.id)?"border-color:rgba(56,189,248,0.6);background:rgba(56,189,248,0.15);":"border-color:var(--border-subtle);background:transparent;"),title:n.value.includes(e.id)?"Remove from diff":"Add to diff"},[n.value.includes(e.id)?(l(),r("svg",be,[...o[12]||(o[12]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5 13l4 4L19 7"},null,-1)])])):k("",!0)],12,xe),t("div",me,[t("div",ve,[t("span",fe,"#"+i(e.version_number||((u=e.id)==null?void 0:u.slice(0,6))),1),y.value===e.id?(l(),r("div",ye,[C(t("input",{"onUpdate:modelValue":o[5]||(o[5]=a=>h.value=a),class:"px-2 py-0.5 rounded-sm text-xs font-mono text-zinc-200",style:{background:"rgba(255,255,255,0.04)",border:"1px solid var(--border-subtle)",outline:"none",width:"160px"},onKeyup:[D(a=>S(e.id),["enter"]),o[6]||(o[6]=D(a=>y.value=null,["escape"]))]},null,40,ge),[[z,h.value]]),t("button",{onClick:a=>S(e.id),class:"text-[10px] text-lime-400 font-display tracking-wider uppercase"},"Save",8,ke),t("button",{onClick:o[7]||(o[7]=a=>y.value=null),class:"text-[10px] text-zinc-500 font-display tracking-wider uppercase"},"Cancel")])):e.label?(l(),r("span",{key:1,class:"text-xs font-mono text-zinc-300 cursor-pointer hover:text-zinc-100",onClick:a=>L(e),title:"Click to edit label"},i(e.label),9,_e)):(l(),r("button",{key:2,onClick:a=>L(e),class:"text-[10px] text-zinc-600 hover:text-zinc-400 font-display tracking-wider uppercase"},"+ label",8,he)),t("span",{class:"text-[10px] px-1.5 py-0.5 rounded-sm font-body",style:V(I(e.source))},i(e.source||"manual"),5),e.profile_count>0?(l(),r("span",we,i(e.profile_count)+" profile"+i(e.profile_count>1?"s":""),1)):k("",!0),t("span",Ce,i(F(e.created_at)),1)]),t("div",ze,i((x=e.prompt_text)==null?void 0:x.substring(0,120))+i(((g=e.prompt_text)==null?void 0:g.length)>120?"...":""),1)]),t("div",$e,[t("button",{onClick:a=>U(e),class:"text-[10px] font-display tracking-wider uppercase px-2 py-1 rounded-sm",style:{background:"rgba(168,85,247,0.08)",border:"1px solid rgba(168,85,247,0.2)",color:"#A855F7"},title:"Load into Prompt Tuner"},"Load",8,Ve),t("button",{onClick:a=>E(e.prompt_text),class:"text-[10px] font-display tracking-wider uppercase px-2 py-1 rounded-sm",style:{border:"1px solid var(--border-subtle)",color:"#71717A"},title:"Copy to clipboard"},"Copy",8,Le),t("button",{onClick:a=>M(e),class:"text-[10px] text-zinc-600 hover:text-red-400 transition-colors px-1",title:"Delete version"},[...o[13]||(o[13]=[t("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,Se)])])],4)}),128))]))]))}};export{Be as default};
