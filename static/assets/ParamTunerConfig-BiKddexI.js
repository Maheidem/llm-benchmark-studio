import{w as Q,b as a,c as r,d as t,t as p,l as Y,f as $,F as V,A as B,k as O,Q as Z,B as L,m as ce,h as R,z as ne,e as J,v as W,O as pe,r as S,K as ae,s as ee,o as me,D as fe,x as se,y as H,j as oe,i as ye,a as xe,q as ve,g as be,R as ge}from"./index-DBNJ0RjU.js";import{a as ke,u as he}from"./useSharedContext-C-EAG0AM.js";import{u as _e}from"./paramTuner-ZePMK9nO.js";import{u as we}from"./config-2dysVlIa.js";import"./useActiveSession-DdoXJmDo.js";const ze={class:"card rounded-md p-5 mb-6"},Se={class:"flex items-center justify-between mb-4"},$e={class:"flex items-center gap-2"},Pe={class:"text-xs font-mono text-zinc-600"},Ce={key:0,class:"text-xs text-zinc-600 font-body text-center py-4"},Ae={key:1,class:"space-y-4"},Me=["data-param-name"],Te={class:"relative inline-flex items-center cursor-pointer mt-1.5"},je=["checked","disabled","onChange"],Ve={class:"flex-1"},Be={class:"flex items-center gap-2 mb-2"},Ee={class:"text-xs text-zinc-400 font-body"},Ne={key:1,class:"text-[10px] text-zinc-600 font-mono"},Ie={class:"grid grid-cols-3 gap-2 mb-2"},Oe=["step","value","onInput"],Re=["step","value","onInput"],De=["min","step","value","onInput"],Le={class:"flex flex-wrap gap-1"},Ue={key:1,class:"flex flex-wrap gap-4"},Ke=["checked","onChange"],Fe={key:2,class:"text-[10px] text-zinc-600 font-body"},qe={key:3,class:"text-xs font-mono text-zinc-500"},Ge={key:2,class:"mt-4 pt-3",style:{"border-top":"1px solid var(--border-subtle)"}},He={class:"text-[10px] text-zinc-600 font-body"},Qe={__name:"SearchSpaceBuilder",props:{paramDefs:{type:Array,default:()=>[]},modelValue:{type:Object,default:()=>({})}},emits:["update:modelValue","update:totalCombos"],setup(z,{expose:N,emit:P}){const _=z,w=P,f=Z({}),l=Z({});Q(()=>_.paramDefs,o=>{const s=new Set(["temperature","tool_choice"]);for(const e of o)if(e.name in f||(f[e.name]=!e.locked&&(s.has(e.name)||e.name in(_.modelValue||{}))),!(e.name in l))if(e.name in(_.modelValue||{}))l[e.name]=_.modelValue[e.name];else if(e.type==="float"||e.type==="int")l[e.name]={min:e.min??0,max:e.max??1,step:e.step??(e.type==="float"?.1:1)};else if(e.type==="enum"){const c=e.name==="tool_choice"?["auto","required"]:[...e.values||[]];l[e.name]=c}else e.type==="bool"&&(l[e.name]=[!0,!1]);E()},{immediate:!0}),Q(()=>_.modelValue,o=>{if(!(!o||Object.keys(o).length===0)){for(const[s,e]of Object.entries(o))f[s]=!0,l[s]=e;for(const s of Object.keys(f))s in o||(f[s]=!1)}},{deep:!0});const m={temperature:"Temperature",top_p:"Top P",top_k:"Top K",tool_choice:"Tool Choice",repetition_penalty:"Repetition Penalty",min_p:"Min P",frequency_penalty:"Frequency Penalty",presence_penalty:"Presence Penalty",max_tokens:"Max Tokens"};function v(o){return m[o]||o.replace(/_/g," ").replace(/\b\w/g,s=>s.toUpperCase())}function k(o,s){const e=s>0?o/s:0;return e>=1?{background:"rgba(191,255,0,0.1)",color:"var(--lime)"}:e>=.5?{background:"rgba(234,179,8,0.1)",color:"#EAB308"}:{background:"rgba(255,59,92,0.1)",color:"var(--coral)"}}function d(o){f[o]=!f[o],E()}function C(o,s,e){const c=l[o];return c&&typeof c=="object"&&!Array.isArray(c)?c[s]??e:e}function M(o,s,e,c){(!l[o]||typeof l[o]!="object"||Array.isArray(l[o]))&&(l[o]={}),l[o][s]=c==="int"?parseInt(e):parseFloat(e),E()}function b(o,s){const e=l[o];return Array.isArray(e)&&e.includes(s)}function u(o,s){Array.isArray(l[o])||(l[o]=[]);const e=l[o].indexOf(s);e>=0?l[o].splice(e,1):l[o].push(s),E()}function g(o,s,e){const c=[];if(e<=0||o>s)return c;for(let I=o;I<=s+e*.001;I+=e)c.push(Math.round(I*1e3)/1e3);return c}function h(o,s){if(!f[o])return[];const e=l[o];if(!e||typeof e!="object"||Array.isArray(e))return[];const c=e.min??0,I=e.max??1,K=e.step??(s==="float"?.1:1),F=g(c,I,K);return s==="int"?F.map(q=>Math.round(q)):F}const T=L(()=>{const o=[];for(const s of _.paramDefs)if(f[s.name])if(s.type==="float"||s.type==="int"){const e=h(s.name,s.type);e.length>0&&o.push(e.length)}else if(s.type==="enum"){const e=l[s.name];Array.isArray(e)&&e.length>0&&o.push(e.length)}else s.type==="bool"&&o.push(2);return o.length>0?o.reduce((s,e)=>s*e,1):0});Q(T,o=>w("update:totalCombos",o));const U=L(()=>{const o=[];for(const s of _.paramDefs){if(!f[s.name])continue;let e=0;if(s.type==="float"||s.type==="int")e=h(s.name,s.type).length;else if(s.type==="enum"){const c=l[s.name];e=Array.isArray(c)?c.length:0}else s.type==="bool"&&(e=2);e>0&&o.push(`${e} ${s.name}`)}return o.length>1?"= "+o.map(s=>s.split(" ")[0]).join(" x "):""}),A=L(()=>{const o=T.value;return o<20?"QUICK":o<50?"MODERATE":o<=100?"LARGE":"WARNING"}),D=L(()=>{const o=T.value;return o<20?{background:"rgba(191,255,0,0.1)",color:"var(--lime)"}:o<50?{background:"rgba(234,179,8,0.1)",color:"#EAB308"}:o<=100?{background:"rgba(249,115,22,0.1)",color:"#F97316"}:{background:"rgba(255,59,92,0.1)",color:"var(--coral)"}});function E(){const o={};for(const s of _.paramDefs)if(f[s.name])if(s.type==="float"||s.type==="int"){const e=l[s.name];e&&typeof e=="object"&&!Array.isArray(e)&&(o[s.name]={min:e.min??0,max:e.max??1,step:e.step??.1})}else if(s.type==="enum"){const e=l[s.name];Array.isArray(e)&&e.length>0&&(o[s.name]=[...e])}else s.type==="bool"&&(o[s.name]=[!0,!1]);w("update:modelValue",o)}return N({enabledParams:f,paramValues:l}),(o,s)=>(a(),r("div",ze,[t("div",Se,[s[0]||(s[0]=t("span",{class:"section-label"},"Search Space",-1)),t("div",$e,[t("span",Pe,p(T.value)+" combos",1),T.value>0?(a(),r("span",{key:0,class:"text-[10px] font-display tracking-wider uppercase px-2 py-0.5 rounded-sm",style:Y(D.value)},p(A.value),5)):$("",!0)])]),z.paramDefs.length===0?(a(),r("div",Ce," Select models to configure parameters ")):(a(),r("div",Ae,[(a(!0),r(V,null,B(z.paramDefs,e=>(a(),r("div",{key:e.name,"data-param-name":e.name,class:"flex items-start gap-3"},[t("label",Te,[t("input",{type:"checkbox",checked:f[e.name],disabled:e.locked,class:"sr-only peer",onChange:c=>d(e.name)},null,40,je),s[1]||(s[1]=t("div",{class:"w-8 h-4 bg-zinc-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-zinc-400 after:rounded-full after:h-3 after:w-3 after:transition-all peer-checked:bg-lime-900 peer-checked:after:bg-lime-400"},null,-1))]),t("div",Ve,[t("div",Be,[t("span",Ee,p(v(e.name)),1),e.supportedBy!=null?(a(),r("span",{key:0,class:"text-[10px] font-mono px-1.5 py-0.5 rounded-sm",style:Y(k(e.supportedBy,e.totalModels))},p(e.supportedBy)+"/"+p(e.totalModels),5)):$("",!0),e.locked?(a(),r("span",Ne,"locked: "+p(e.lockedValue),1)):$("",!0)]),(e.type==="float"||e.type==="int")&&!e.locked?(a(),r(V,{key:0},[t("div",Ie,[t("div",null,[s[2]||(s[2]=t("label",{class:"text-[10px] text-zinc-600 font-display tracking-wider uppercase"},"Min",-1)),t("input",{type:"number",step:e.type==="float"?.01:1,value:C(e.name,"min",e.min??0),onInput:c=>M(e.name,"min",c.target.value,e.type),class:"w-full px-2 py-1.5 rounded-sm text-xs font-mono text-zinc-200",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)",outline:"none"}},null,40,Oe)]),t("div",null,[s[3]||(s[3]=t("label",{class:"text-[10px] text-zinc-600 font-display tracking-wider uppercase"},"Max",-1)),t("input",{type:"number",step:e.type==="float"?.01:1,value:C(e.name,"max",e.max??1),onInput:c=>M(e.name,"max",c.target.value,e.type),class:"w-full px-2 py-1.5 rounded-sm text-xs font-mono text-zinc-200",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)",outline:"none"}},null,40,Re)]),t("div",null,[s[4]||(s[4]=t("label",{class:"text-[10px] text-zinc-600 font-display tracking-wider uppercase"},"Step",-1)),t("input",{type:"number",min:e.type==="float"?.01:1,step:e.type==="float"?.01:1,value:C(e.name,"step",e.step??(e.type==="float"?.1:1)),onInput:c=>M(e.name,"step",c.target.value,e.type),class:"w-full px-2 py-1.5 rounded-sm text-xs font-mono text-zinc-200",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)",outline:"none"}},null,40,De)])]),t("div",Le,[(a(!0),r(V,null,B(h(e.name,e.type),c=>(a(),r("span",{key:c,class:"inline-block px-2 py-0.5 rounded-sm text-[10px] font-mono text-zinc-300",style:{background:"rgba(255,255,255,0.04)",border:"1px solid var(--border-subtle)"}},p(c),1))),128))])],64)):e.type==="enum"&&!e.locked?(a(),r("div",Ue,[(a(!0),r(V,null,B(e.values||[],c=>(a(),r("label",{key:c,class:"flex items-center gap-2 text-xs text-zinc-400 font-body cursor-pointer"},[t("input",{type:"checkbox",checked:b(e.name,c),onChange:I=>u(e.name,c),class:"accent-lime-400"},null,40,Ke),O(" "+p(c),1)]))),128))])):e.type==="bool"&&!e.locked?(a(),r("span",Fe,"Values: true, false")):e.locked?(a(),r("div",qe,p(e.lockedValue),1)):$("",!0)])],8,Me))),128))])),T.value>0?(a(),r("div",Ge,[t("div",He,p(U.value),1)])):$("",!0)]))}},Je={key:0,class:"card rounded-md overflow-hidden mb-6"},We={class:"px-5 py-3 flex items-center justify-between",style:{"border-bottom":"1px solid var(--border-subtle)"}},Ye={class:"text-[10px] text-zinc-600 font-body"},Xe={class:"px-5 py-3 overflow-x-auto"},Ze={class:"w-full text-xs results-table"},et={style:{"border-bottom":"1px solid var(--border-subtle)"}},tt={class:"px-3 py-2 text-xs font-mono text-zinc-300"},st={key:0,class:"text-lime-400",title:"Supported"},ot=["title"],nt={key:2,class:"text-red-400",title:"Not supported - will be dropped"},at={key:3,class:"text-zinc-600",title:"Passthrough (unknown)"},rt={__name:"CompatibilityMatrix",props:{models:{type:Array,default:()=>[]},enabledParams:{type:Array,default:()=>[]},paramSupport:{type:Object,default:null},registry:{type:Object,default:null}},setup(z){const N=z;function P(l){return{temperature:"Temp",top_p:"Top P",top_k:"Top K",tool_choice:"Tool Choice",repetition_penalty:"Rep Pen",min_p:"Min P",frequency_penalty:"Freq Pen",presence_penalty:"Pres Pen"}[l]||l.replace(/_/g," ")}function _(l,m){var M,b,u;const v=N.paramSupport;if(!v||!v.provider_defaults)return"passthrough";const k=v.provider_defaults[l.rk||l.providerKey];if(!k)return"passthrough";const d=((M=v.model_overrides)==null?void 0:M[l.rk||l.providerKey])||{};for(const[g,h]of Object.entries(d))if(f(l.id,g)){const T=(b=h==null?void 0:h.params)==null?void 0:b[m];if(T)return T.supported===!1?"dropped":"supported"}const C=(u=k.params)==null?void 0:u[m];return C?C.supported===!1?"dropped":C.clamp?"clamped":"supported":(k.skip_params||[]).includes(m)?"dropped":"passthrough"}function w(l,m){var C;const v=N.paramSupport;if(!v||!v.provider_defaults)return"";const k=v.provider_defaults[l.rk||l.providerKey];if(!k)return"";const d=(C=k.params)==null?void 0:C[m];return!d||!d.clamp?"":`min: ${d.clamp.min??"?"}, max: ${d.clamp.max??"?"}`}function f(l,m){return m.split("|").some(v=>new RegExp("^"+v.replace(/[.*+?^${}()|[\]\\]/g,d=>d==="*"?".*":"\\"+d)+"$","i").test(l))}return(l,m)=>z.models.length>0&&z.enabledParams.length>0?(a(),r("div",Je,[t("div",We,[m[0]||(m[0]=t("span",{class:"section-label"},"Compatibility Matrix",-1)),t("span",Ye,p(z.models.length)+" models, "+p(z.enabledParams.length)+" params",1)]),t("div",Xe,[t("table",Ze,[t("thead",null,[t("tr",et,[m[1]||(m[1]=t("th",{class:"px-3 py-2 text-left section-label"},"Model",-1)),(a(!0),r(V,null,B(z.enabledParams,v=>(a(),r("th",{key:v,class:"px-3 py-2 text-center section-label"},p(P(v)),1))),128))])]),t("tbody",null,[(a(!0),r(V,null,B(z.models,v=>(a(),r("tr",{key:v.id},[t("td",tt,p(v.shortName),1),(a(!0),r(V,null,B(z.enabledParams,k=>(a(),r("td",{key:k,class:"px-3 py-2 text-center"},[_(v,k)==="supported"?(a(),r("span",st,[...m[2]||(m[2]=[t("svg",{class:"w-3.5 h-3.5 inline",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"})],-1)])])):_(v,k)==="clamped"?(a(),r("span",{key:1,class:"text-yellow-400",title:"Clamped: "+w(v,k)},[...m[3]||(m[3]=[t("svg",{class:"w-3.5 h-3.5 inline",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"})],-1)])],8,ot)):_(v,k)==="dropped"?(a(),r("span",nt,[...m[4]||(m[4]=[t("svg",{class:"w-3.5 h-3.5 inline",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)])])):(a(),r("span",at,[...m[5]||(m[5]=[t("svg",{class:"w-3.5 h-3.5 inline",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01"})],-1)])]))]))),128))]))),128))])]),m[6]||(m[6]=ce('<div class="flex gap-4 mt-3 text-[10px] font-body text-zinc-600"><span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-lime-400 inline-block"></span> Supported</span><span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-yellow-400 inline-block"></span> Clamped</span><span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-red-400 inline-block"></span> Dropped</span><span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-zinc-600 inline-block"></span> Passthrough</span></div>',1))])])):$("",!0)}},lt={class:"card rounded-md p-5 mb-6"},it={class:"flex items-center gap-2"},dt=["value"],ut=["disabled"],ct={key:0,class:"mt-3 flex items-center gap-2"},pt={__name:"PresetManager",props:{presets:{type:Array,default:()=>[]},currentSearchSpace:{type:Object,default:()=>({})}},emits:["load","update:presets"],setup(z,{emit:N}){const P=z,_=N,{showToast:w}=ae(),f=S(""),l=S(!1),m=S("");function v(){if(f.value==="")return;const b=parseInt(f.value),u=P.presets[b];u&&(_("load",u.search_space||{}),w(`Preset "${u.name}" loaded`,"success"))}function k(){if(Object.keys(P.currentSearchSpace).length===0){w("Enable at least one parameter before saving","error");return}l.value=!0,m.value=""}async function d(){const b=m.value.trim();if(!b){w("Name is required","error");return}const u=[...P.presets],g=u.findIndex(T=>T.name===b),h={name:b,search_space:{...P.currentSearchSpace}};if(g>=0)u[g]=h;else{if(u.length>=20){w("Maximum 20 presets allowed","error");return}u.push(h)}await M(u),_("update:presets",u),l.value=!1,w(`Preset "${b}" saved`,"success")}async function C(){var h;if(f.value==="")return;const b=parseInt(f.value),u=((h=P.presets[b])==null?void 0:h.name)||"Unnamed",g=[...P.presets];g.splice(b,1),await M(g),_("update:presets",g),f.value="",w(`Preset "${u}" deleted`,"success")}async function M(b){try{const u=await ee("/api/settings/phase10"),g=u.ok?await u.json():{},h={...g,param_tuner:{...g.param_tuner||{},presets:b}};await ee("/api/settings/phase10",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)})}catch{w("Failed to save presets","error")}}return(b,u)=>(a(),r("div",lt,[u[4]||(u[4]=t("div",{class:"flex items-center justify-between mb-3"},[t("span",{class:"section-label"},"Presets")],-1)),t("div",it,[R(t("select",{"onUpdate:modelValue":u[0]||(u[0]=g=>f.value=g),class:"text-xs font-mono px-3 py-1.5 rounded-sm flex-1",style:{background:"var(--surface)",border:"1px solid var(--border-subtle)",color:"#E4E4E7",outline:"none"}},[u[3]||(u[3]=t("option",{value:""},"-- Presets --",-1)),(a(!0),r(V,null,B(z.presets,(g,h)=>(a(),r("option",{key:h,value:h},p(g.name||"Unnamed"),9,dt))),128))],512),[[ne,f.value]]),t("button",{onClick:v,disabled:f.value==="",class:J(["text-[10px] font-display tracking-wider uppercase px-3 py-1.5 rounded-sm transition-colors",{"opacity-50 cursor-not-allowed":f.value===""}]),style:{border:"1px solid var(--border-subtle)",color:"var(--zinc-400)"}},"Load",10,ut),t("button",{onClick:k,class:"text-[10px] font-display tracking-wider uppercase px-3 py-1.5 rounded-sm transition-colors",style:{border:"1px solid rgba(191,255,0,0.2)",color:"var(--lime)"}},"Save"),f.value!==""?(a(),r("button",{key:0,onClick:C,class:"text-[10px] font-display tracking-wider uppercase px-3 py-1.5 rounded-sm transition-colors",style:{border:"1px solid rgba(255,59,92,0.2)",color:"var(--coral)"}},"Delete")):$("",!0)]),l.value?(a(),r("div",ct,[R(t("input",{"onUpdate:modelValue":u[1]||(u[1]=g=>m.value=g),type:"text",placeholder:"Preset name",class:"text-xs font-mono px-3 py-1.5 rounded-sm flex-1",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)",color:"#E4E4E7",outline:"none"},onKeyup:pe(d,["enter"])},null,544),[[W,m.value]]),t("button",{onClick:d,class:"text-[10px] font-display tracking-wider uppercase px-3 py-1.5 rounded-sm",style:{background:"rgba(191,255,0,0.08)",border:"1px solid rgba(191,255,0,0.2)",color:"var(--lime)"}},"Save"),t("button",{onClick:u[2]||(u[2]=g=>l.value=!1),class:"text-[10px] font-display tracking-wider uppercase px-3 py-1.5 rounded-sm",style:{border:"1px solid var(--border-subtle)",color:"var(--zinc-600)"}},"Cancel")])):$("",!0)]))}},mt={class:"flex items-center justify-between mb-6"},ft={class:"flex items-center gap-2"},yt={class:"card rounded-md p-5 mb-6"},xt=["value"],vt={class:"card rounded-md p-5 mb-6"},bt={class:"flex items-center justify-between mb-3"},gt={class:"text-xs font-mono text-zinc-600"},kt={key:0,class:"text-xs text-zinc-600 font-body"},ht={key:1,class:"text-xs text-zinc-600 font-body"},_t={key:2,class:"flex flex-col gap-1"},wt=["onClick"],zt={class:"provider-group-count"},St=["onClick"],$t={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2 pl-4 pb-2"},Pt=["onClick"],Ct={class:"flex-1 min-w-0"},At={class:"text-xs font-mono text-zinc-200 truncate"},Mt={key:3,class:"card rounded-md p-5 mb-6"},Tt={class:"flex items-center justify-between mb-3"},jt={class:"text-[10px] text-zinc-600 font-body"},Vt={key:0},Bt={key:1},Et={key:2},Nt={class:"flex gap-2 mb-3"},It=["onClick"],Ot={key:0,class:"grid grid-cols-2 gap-4"},Rt={key:1,class:"grid grid-cols-1 gap-4"},Dt={class:"flex items-center justify-between mt-6"},Lt={class:"text-xs text-zinc-600 font-body"},Ut={key:0},Kt={key:1},Ft={key:2},qt=["disabled"],Yt={__name:"ParamTunerConfig",setup(z){const N=ve(),P=ke(),_=_e(),w=we(),{showToast:f}=ae(),{context:l,setSuite:m,setModels:v}=he(),k=S(""),d=Z(new Set),C=S(!0),M=S([]),b=S({}),u=S(0),g=S([]),h=S([]),T=S(null),U=S(null),A=S("grid"),D=S(30),E=S(50),o=S(0),s=[{value:"grid",label:"Grid"},{value:"random",label:"Random"},{value:"bayesian",label:"Bayesian"}],e=L(()=>!k.value||d.size===0||_.isRunning?!1:A.value==="grid"?u.value>0:!0),c=L(()=>{const x=[];for(const n of M.value)for(const y of n.models)d.has(y.key)&&x.push({id:y.model_id,shortName:y.display_name||y.model_id.split("/").pop(),rk:y.registryKey||y.provider_key,providerKey:y.provider_key});return x});me(async()=>{var x,n;if(P.suites.length===0)try{await P.loadSuites()}catch{f("Failed to load suites","error")}try{await w.loadConfig(),w.config&&I(w.config)}catch{f("Failed to load model config","error")}finally{C.value=!1}try{await w.loadParamsRegistry(),U.value=w.providerParamsRegistry}catch{}try{const y=await ee("/api/settings/phase10");if(y.ok){const i=await y.json();g.value=((x=i.param_tuner)==null?void 0:x.presets)||[],T.value=i.param_support||null}}catch{}l.suiteId&&(k.value=l.suiteId),(n=l.selectedModels)!=null&&n.length&&(l.selectedModels.forEach(y=>d.add(y)),K())}),Q(()=>d.size,()=>{K()});function I(x){const n=[],y=x.providers||{};for(const[i,j]of Object.entries(y)){const X=j.provider_key||i,te=(j.models||[]).map(G=>({key:`${X}::${G.model_id}`,model_id:G.model_id,display_name:G.display_name||G.model_id,provider_key:X}));if(te.length===0)continue;const ue=fe(j.display_name||i);n.push({provider:j.display_name||i,color:ue.text,models:te,collapsed:!1})}M.value=n}function K(){const x=d.size;if(x===0){h.value=[];return}const n=[{name:"temperature",type:"float",min:0,max:2,step:.1},{name:"top_p",type:"float",min:0,max:1,step:.1},{name:"top_k",type:"int",min:1,max:100,step:10},{name:"tool_choice",type:"enum",values:["auto","required","none"]},{name:"frequency_penalty",type:"float",min:-2,max:2,step:.1},{name:"presence_penalty",type:"float",min:-2,max:2,step:.1},{name:"repetition_penalty",type:"float",min:.5,max:2,step:.1},{name:"min_p",type:"float",min:0,max:1,step:.05}];h.value=n.map(y=>({...y,supportedBy:x,totalModels:x,locked:!1,lockedValue:null,notes:[]}))}function F(x){d.has(x)?d.delete(x):d.add(x),v(Array.from(d))}function q(x){return x.models.every(n=>d.has(n.key))}function re(x){const n=q(x);for(const y of x.models)n?d.delete(y.key):d.add(y.key);v(Array.from(d))}function le(){const x=P.suites.find(n=>n.id===k.value);x&&m(x.id,x.name)}function ie(x){b.value={...x}}async function de(){if(!e.value)return;const x=Array.from(d).map(y=>{const i=y.indexOf("::");return{provider_key:y.substring(0,i),model_id:y.substring(i+2)}}),n={suite_id:k.value,models:Array.from(d).map(y=>y.substring(y.indexOf("::")+2)),targets:x,search_space:b.value,optimization_mode:A.value};A.value==="bayesian"?(n.n_trials=D.value||30,o.value>0&&(n.timeout=o.value)):A.value==="random"&&(n.n_trials=E.value||50),l.experimentId&&(n.experiment_id=l.experimentId);try{await _.startTuning(n),f("Param tuning started","success"),N.push({name:"ParamTunerRun"})}catch(y){f(y.message||"Failed to start tuning","error")}}return(x,n)=>{const y=xe("router-link");return a(),r("div",null,[t("div",mt,[n[9]||(n[9]=t("div",null,[t("h2",{class:"font-display font-bold text-lg text-zinc-100 mb-1"},"Param Tuner"),t("p",{class:"text-sm text-zinc-600 font-body"},"Grid search across parameter combinations to find optimal tool calling config.")],-1)),t("div",ft,[se(_).isRunning?(a(),H(y,{key:0,to:{name:"ParamTunerRun"},class:"text-[10px] font-display tracking-wider uppercase px-3 py-1.5 rounded-sm",style:{background:"rgba(191,255,0,0.08)",border:"1px solid rgba(191,255,0,0.2)",color:"var(--lime)"}},{default:oe(()=>[...n[7]||(n[7]=[O("View Active Run",-1)])]),_:1})):$("",!0),ye(y,{to:{name:"ParamTunerHistory"},class:"text-[10px] font-display tracking-wider uppercase px-3 py-1.5 rounded-sm",style:{border:"1px solid var(--border-subtle)",color:"var(--zinc-400)"}},{default:oe(()=>[...n[8]||(n[8]=[O("History",-1)])]),_:1})])]),t("div",yt,[n[11]||(n[11]=t("label",{class:"section-label mb-2 block"},"Suite",-1)),R(t("select",{"onUpdate:modelValue":n[0]||(n[0]=i=>k.value=i),onChange:le,class:"text-sm font-mono px-3 py-2 rounded-sm w-full",style:{background:"var(--surface)",border:"1px solid var(--border-subtle)",color:"#E4E4E7",outline:"none"}},[n[10]||(n[10]=t("option",{value:""},"-- Select a suite --",-1)),(a(!0),r(V,null,B(se(P).suites,i=>(a(),r("option",{key:i.id,value:i.id},p(i.name)+" ("+p(i.tool_count||0)+" tools, "+p(i.test_case_count||0)+" cases) ",9,xt))),128))],544),[[ne,k.value]])]),t("div",vt,[t("div",bt,[n[12]||(n[12]=t("span",{class:"section-label"},"Models",-1)),t("span",gt,p(d.size)+" selected",1)]),C.value?(a(),r("div",kt,"Loading models...")):M.value.length===0?(a(),r("div",ht," No models available. Configure providers in Settings. ")):(a(),r("div",_t,[(a(!0),r(V,null,B(M.value,i=>(a(),r("div",{key:i.provider,class:"provider-group"},[t("div",{class:"provider-group-header",onClick:j=>i.collapsed=!i.collapsed},[t("div",{class:"provider-group-dot",style:Y({background:i.color})},null,4),t("span",{class:"provider-group-label",style:Y({color:i.color})},p(i.provider),5),t("span",zt,p(i.models.length),1),t("button",{onClick:be(j=>re(i),["stop"]),class:"text-[10px] font-display tracking-wider uppercase text-zinc-600 hover:text-zinc-400 ml-2"},p(q(i)?"None":"All"),9,St)],8,wt),R(t("div",$t,[(a(!0),r(V,null,B(i.models,j=>(a(),r("div",{key:j.key,class:J(["model-card rounded-sm px-3 py-2 flex items-center gap-2",{selected:d.has(j.key)}]),onClick:X=>F(j.key)},[n[13]||(n[13]=t("div",{class:"check-dot"},null,-1)),t("div",Ct,[t("div",At,p(j.display_name||j.model_id),1)])],10,Pt))),128))],512),[[ge,!i.collapsed]])]))),128))]))]),d.size>0?(a(),H(pt,{key:0,presets:g.value,"current-search-space":b.value,onLoad:ie,"onUpdate:presets":n[1]||(n[1]=i=>g.value=i)},null,8,["presets","current-search-space"])):$("",!0),d.size>0?(a(),H(Qe,{key:1,"param-defs":h.value,modelValue:b.value,"onUpdate:modelValue":n[2]||(n[2]=i=>b.value=i),"onUpdate:totalCombos":n[3]||(n[3]=i=>u.value=i)},null,8,["param-defs","modelValue"])):$("",!0),d.size>0&&Object.keys(b.value).length>0?(a(),H(rt,{key:2,models:c.value,"enabled-params":Object.keys(b.value),"param-support":T.value,registry:U.value},null,8,["models","enabled-params","param-support","registry"])):$("",!0),d.size>0?(a(),r("div",Mt,[t("div",Tt,[n[14]||(n[14]=t("span",{class:"section-label"},"Search Strategy",-1)),t("span",jt,[A.value==="grid"?(a(),r("span",Vt,"Exhaustive grid over all combinations")):A.value==="random"?(a(),r("span",Bt,"Random sampling — faster for large spaces")):(a(),r("span",Et,"Bayesian optimization — learns from each trial"))])]),t("div",Nt,[(a(),r(V,null,B(s,i=>t("button",{key:i.value,class:J(["flex-1 rounded-sm px-3 py-2 text-xs font-display tracking-wider uppercase transition-colors",A.value===i.value?"text-lime-400 bg-lime-400/[0.06] border border-lime-400/30":"text-zinc-500 border border-zinc-800 hover:text-zinc-300 hover:border-zinc-600"]),onClick:j=>A.value=i.value},p(i.label),11,It)),64))]),A.value==="bayesian"?(a(),r("div",Ot,[t("div",null,[n[15]||(n[15]=t("label",{class:"text-[10px] text-zinc-600 font-display tracking-wider uppercase mb-1 block"},[O(" Trials "),t("span",{class:"ml-1 text-zinc-700 cursor-help",title:"Number of optimization trials (iterations). More trials = better results, slower runtime."},"?")],-1)),R(t("input",{"onUpdate:modelValue":n[4]||(n[4]=i=>D.value=i),type:"number",min:"5",max:"200",step:"5",class:"w-full px-2 py-1.5 rounded-sm text-xs font-mono text-zinc-200",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)",outline:"none"}},null,512),[[W,D.value,void 0,{number:!0}]])]),t("div",null,[n[16]||(n[16]=t("label",{class:"text-[10px] text-zinc-600 font-display tracking-wider uppercase mb-1 block"},[O(" Timeout (s) "),t("span",{class:"ml-1 text-zinc-700 cursor-help",title:"Stop early if optimization takes longer than this (0 = no timeout)."},"?")],-1)),R(t("input",{"onUpdate:modelValue":n[5]||(n[5]=i=>o.value=i),type:"number",min:"0",max:"3600",step:"30",class:"w-full px-2 py-1.5 rounded-sm text-xs font-mono text-zinc-200",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)",outline:"none"}},null,512),[[W,o.value,void 0,{number:!0}]])])])):$("",!0),A.value==="random"?(a(),r("div",Rt,[t("div",null,[n[17]||(n[17]=t("label",{class:"text-[10px] text-zinc-600 font-display tracking-wider uppercase mb-1 block"},[O(" Samples "),t("span",{class:"ml-1 text-zinc-700 cursor-help",title:"Number of random parameter combinations to sample."},"?")],-1)),R(t("input",{"onUpdate:modelValue":n[6]||(n[6]=i=>E.value=i),type:"number",min:"5",max:"500",step:"5",class:"w-full px-2 py-1.5 rounded-sm text-xs font-mono text-zinc-200",style:{background:"rgba(255,255,255,0.02)",border:"1px solid var(--border-subtle)",outline:"none"}},null,512),[[W,E.value,void 0,{number:!0}]])])])):$("",!0)])):$("",!0),t("div",Dt,[t("div",Lt,[A.value==="grid"&&u.value>0?(a(),r("span",Ut,p(u.value)+" combos x "+p(d.size)+" model"+p(d.size!==1?"s":"")+" = "+p(u.value*d.size)+" total evaluations",1)):A.value==="random"?(a(),r("span",Kt,p(E.value)+" random samples x "+p(d.size)+" model"+p(d.size!==1?"s":""),1)):A.value==="bayesian"?(a(),r("span",Ft,p(D.value)+" Bayesian trials x "+p(d.size)+" model"+p(d.size!==1?"s":""),1)):$("",!0)]),t("button",{onClick:de,disabled:!e.value,class:J(["run-btn px-6 py-2 rounded-sm text-xs flex items-center gap-2",{"opacity-50 cursor-not-allowed":!e.value}])},[...n[18]||(n[18]=[t("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor","stroke-width":"2.5",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M13 10V3L4 14h7v7l9-11h-7z"})],-1),O(" Start Tuning ",-1)])],10,qt)])])}}};export{Yt as default};
